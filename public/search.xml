<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>K8sè‡ªåŠ¨æ‰©å®¹å’Œè‡ªæ„ˆ</title>
      <link href="/2025/03/16/K8s%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9%E5%92%8C%E8%87%AA%E6%84%88/"/>
      <url>/2025/03/16/K8s%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9%E5%92%8C%E8%87%AA%E6%84%88/</url>
      
        <content type="html"><![CDATA[<p>â€â€â€</p><h2 id="è‡ªåŠ¨è‡ªæ„ˆ"><a href="#è‡ªåŠ¨è‡ªæ„ˆ" class="headerlink" title="è‡ªåŠ¨è‡ªæ„ˆ"></a>è‡ªåŠ¨è‡ªæ„ˆ</h2><p>ä»€ä¹ˆæ˜¯è‡ªåŠ¨è‡ªæ„ˆï¼Ÿ</p><ul><li>å½“ä¸šåŠ¡è¿›ç¨‹æ„å¤–ä¸­æ–­ï¼Œæˆ–è€…èŠ‚ç‚¹äº§ç”Ÿæ•…éšœæ—¶ï¼Œç³»ç»Ÿå¯ä»¥å¿«é€Ÿè¯†åˆ«ï¼Œè‡ªåŠ¨é‡å¯å¹¶æ¢å¤æœåŠ¡ã€‚</li><li>è‡ªæ„ˆèƒ½å¤Ÿè‡ªåŠ¨è½¬ç§»æ•…éšœï¼Œä¹Ÿå°±æ˜¯è®©ä¸šåŠ¡ä¸å¥åº·çš„èŠ‚ç‚¹ä¸æ¥æ”¶æµé‡ï¼Œä¿è¯ç”¨æˆ·ä½“éªŒã€‚</li></ul><p>é€šè¿‡è‡ªåŠ¨è‡ªæ„ˆæ‘†è„± 7*24 å°æ—¶ OncallğŸ˜€</p><p>â€</p><p><strong>é¦–å…ˆ</strong>ï¼Œé€šè¿‡ kubectl create deployment åˆ›å»ºå¦ä¸€ç§å·¥ä½œè´Ÿè½½ç±»å‹ï¼šDeploymentã€‚</p><p>ä¾‹å¦‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl create deployment hello-docker-flask --image=kalosora/hello-docker-flask:latest --replicas=2</span><br><span class="line">deployment.apps/hello-docker-flask created</span><br></pre></td></tr></table></figure><ul><li>hello-docker-flaskï¼Œä»£è¡¨å·¥ä½œè´Ÿè½½çš„åç§°</li><li>â€“ imageï¼Œä»£è¡¨é•œåƒåç§°</li><li>â€“replicasï¼Œ ä»£è¡¨podçš„å‰¯æœ¬æ•°</li><li>è¿˜å¯ä»¥æ·»åŠ  â€“dry-run&#x3D;client å’Œ -o å‚æ•°ï¼Œå•çº¯è¾“å‡º Manifest å†…å®¹</li></ul><p>æœ¬è´¨ä¸Šï¼Œè¿™æ¡å‘½ä»¤ä¼šç”Ÿæˆ Deployment Manifestï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œ kubectl apply å°† Manifest åº”ç”¨åˆ°é›†ç¾¤å†…ï¼Œçœç•¥äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™ Manifest çš„è¿‡ç¨‹</p><p>â€</p><p><strong>ç„¶å</strong>ï¼Œä½¿ç”¨ kubectl create service å‘½ä»¤åˆ›å»º Serviceï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl create service clusterip hello-docker-flask --tcp=5000:5000</span><br><span class="line">service/hello-docker-flask created</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p><strong>æ­¤å¤–</strong>ï¼Œä½¿ç”¨ kubectl create ingress å‘½ä»¤åˆ›å»º Ingressï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ingress hello-docker-flask --rule=&quot;/=hello-docker-flask:5000&quot;</span><br></pre></td></tr></table></figure><p>â€</p><p><strong>æœ€å</strong>ï¼Œéƒ¨ç½²Ingress-nginx</p><p><a href="https://github.com/KaloSora/K8s-Learn/blob/main/resource/ingress-nginx/ingress-nginx.yaml">ingress-nginx</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl create -f https://ghfast.top/https://raw.githubusercontent.com/lyzhang1999/resource/main/ingress-nginx/ingress-nginx.yaml</span><br><span class="line">namespace/ingress-nginx created</span><br><span class="line">serviceaccount/ingress-nginx created</span><br><span class="line">serviceaccount/ingress-nginx-admission created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">configmap/ingress-nginx-controller created</span><br><span class="line">service/ingress-nginx-controller created</span><br><span class="line">service/ingress-nginx-controller-admission created</span><br><span class="line">deployment.apps/ingress-nginx-controller created</span><br><span class="line">job.batch/ingress-nginx-admission-create created</span><br><span class="line">job.batch/ingress-nginx-admission-patch created</span><br><span class="line">ingressclass.networking.k8s.io/nginx created</span><br><span class="line">validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œä¸Šè¿°æ­¥éª¤ä»¥åï¼š</p><ol><li>Pod ä¼šè¢« Deployment å·¥ä½œè´Ÿè½½ç®¡ç†èµ·æ¥ï¼Œä¾‹å¦‚åˆ›å»ºå’Œé”€æ¯ç­‰ï¼›</li><li>Service ç›¸å½“äºå¼¹æ€§ä¼¸ç¼©ç»„çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒèƒ½ä»¥åŠ æƒè½®è®­çš„æ–¹å¼å°†æµé‡è½¬å‘åˆ°å¤šä¸ª Pod å‰¯æœ¬ä¸Šï¼›</li><li>Ingress ç›¸å½“äºé›†ç¾¤çš„å¤–ç½‘è®¿é—®å…¥å£ã€‚</li></ol><p>â€</p><p><strong>å¼€å§‹K8sè‡ªæ„ˆå®éªŒã€‚</strong></p><p>æŸ¥çœ‹ç°æœ‰çš„pod</p><p>â€‹<img src="/2025/03/16/K8s%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9%E5%92%8C%E8%87%AA%E6%84%88/image-20250315224138-a9l4fdq.png" alt="image">â€‹</p><p>æœ‰äº† Ingress-nginxï¼Œæˆ‘ä»¬è®¿é—® Pod å°±ä¸å†éœ€è¦è¿›è¡Œç«¯å£è½¬å‘äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—® 127.0.0.1ã€‚ä¸‹é¢çš„å‘½ä»¤ä¼šæ¯éš” 1 ç§’é’Ÿå‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œå¹¶æ‰“å°å‡ºæ—¶é—´å’Œè¿”å›å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % while true; do sleep 1; curl http://127.0.0.1; echo -e &#x27;\n&#x27;$(date);done</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-txhbk</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†21ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-ccjnc</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†22ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-ccjnc</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†23ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-txhbk</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†24ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-txhbk</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†25ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-ccjnc</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†26ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-ccjnc</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†27ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-txhbk</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†28ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-ccjnc</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†29ç§’ CST</span><br><span class="line">Hello, my first docker images! hello-docker-flask-5dccc98654-ccjnc</span><br><span class="line">2025å¹´ 3æœˆ15æ—¥ æ˜ŸæœŸå…­ 22æ—¶42åˆ†30ç§’ CST</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥å‘ç°ï¼Œè¯·æ±‚è¢«åˆ†é…åˆ°äº†ä¸¤ä¸ª Pod ä¸Šï¼ŒPod åç§°æ˜¯äº¤æ›¿å‡ºç°çš„ã€‚</p><p>â€</p><p>æ¨¡æ‹Ÿå…¶ä¸­çš„ä¸€ä¸ª Pod å®•æœºï¼Œè§‚å¯Ÿè¿”å›å†…å®¹ã€‚</p><p>å¼€å¯æ–°çš„å‘½ä»¤è¡Œçª—å£ï¼Œç»ˆæ­¢å…¶ä¸­ä¸€ä¸ªpodçš„pythonè¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it hello-docker-flask-5dccc98654-ccjnc -- bash -c &quot;killall python3&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>ç­‰å¾…å‡ ç§’é’Ÿåå¯ä»¥çœ‹è§ï¼Œæ‰€æœ‰çš„æµé‡éƒ½è¢«è½¬å‘åˆ°äº† <code>hello-docker-flask-5dccc98654-txhbk</code>â€‹</p><p>â€‹<img src="/2025/03/16/K8s%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9%E5%92%8C%E8%87%AA%E6%84%88/image-20250315224808-cbfg1rf.png" alt="image">â€‹</p><p>ç´§æ¥ç€ï¼Œ<code>hello-docker-flask-5dccc98654-ccjnc</code>â€‹ä¹Ÿæ¢å¤äº†æœåŠ¡</p><p>â€</p><h2 id="è‡ªåŠ¨æ‰©å®¹"><a href="#è‡ªåŠ¨æ‰©å®¹" class="headerlink" title="è‡ªåŠ¨æ‰©å®¹"></a>è‡ªåŠ¨æ‰©å®¹</h2><p>è‡ªåŠ¨æ‰©å®¹ä¾èµ–äº K8s Metric Server æä¾›çš„ç›‘æ§æŒ‡æ ‡ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…å®ƒï¼š</p><p><a href="https://github.com/KaloSora/K8s-Learn/blob/main/resource/metrics/metrics.yaml">metrics.yaml</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl apply -f https://ghfast.top/https://raw.githubusercontent.com/lyzhang1999/resource/main/metrics/metrics.yaml</span><br><span class="line">serviceaccount/metrics-server created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class="line">service/metrics-server created</span><br><span class="line">deployment.apps/metrics-server created</span><br><span class="line">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created</span><br></pre></td></tr></table></figure><p>â€</p><p>å®‰è£…å®Œæˆåï¼Œç­‰å¾… Metric å·¥ä½œè´Ÿè½½å°±ç»ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl wait deployment -n kube-system metrics-server --for condition=Available=True --timeout=90s</span><br><span class="line">deployment.apps/metrics-server condition met</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p>Metric Server å°±ç»ªåï¼Œé€šè¿‡ kubectl autoscale å‘½ä»¤æ¥ä¸º Deployment åˆ›å»ºè‡ªåŠ¨æ‰©å®¹ç­–ç•¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl autoscale deployment hello-docker-flask --cpu-percent=50 --min=2 --max=10</span><br><span class="line">horizontalpodautoscaler.autoscaling/hello-docker-flask autoscaled</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€“cpu-percent è¡¨ç¤º CPU ä½¿ç”¨ç‡é˜ˆå€¼ï¼Œå½“ CPU è¶…è¿‡ 50% æ—¶å°†è¿›è¡Œè‡ªåŠ¨æ‰©å®¹ï¼›</p><p>â€“min ä»£è¡¨æœ€å°çš„ Pod å‰¯æœ¬æ•°ï¼›</p><p>â€“max ä»£è¡¨æœ€å¤§æ‰©å®¹çš„å‰¯æœ¬æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ªåŠ¨æ‰©å®¹ä¼šæ ¹æ® CPU çš„ä½¿ç”¨ç‡åœ¨ 2 ä¸ªå‰¯æœ¬å’Œ 10 ä¸ªå‰¯æœ¬ä¹‹é—´è¿›è¡Œæ‰©ç¼©å®¹</p><p>â€</p><p>æœ€åï¼Œè¦ä½¿è‡ªåŠ¨æ‰©å®¹ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦ä¸ºåˆšæ‰éƒ¨ç½²çš„ hello-docker-flask Deployment è®¾ç½®èµ„æºé…é¢ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl patch deployment hello-docker-flask --type=&#x27;json&#x27; -p=&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/resources&quot;, &quot;value&quot;: &#123;&quot;requests&quot;: &#123;&quot;memory&quot;: &quot;100Mi&quot;, &quot;cpu&quot;: &quot;100m&quot;&#125;&#125;&#125;]&#x27;</span><br><span class="line">deployment.apps/hello-docker-flask patched</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p>ç°åœ¨ï¼ŒDeployment å°†ä¼šé‡æ–°åˆ›å»ºä¸¤ä¸ªæ–°çš„ Podï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç­›é€‰å‡ºæ–°çš„ Podï¼š</p><p>â€‹<img src="/2025/03/16/K8s%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9%E5%92%8C%E8%87%AA%E6%84%88/image-20250316094914-emi0rys.png" alt="image">â€‹</p><p>å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl get pod --field-selector=status.phase==Running</span><br><span class="line">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class="line">hello-docker-flask-7b8f894675-bvnj6   1/1     Running   0          81s</span><br><span class="line">hello-docker-flask-7b8f894675-pn5br   1/1     Running   0          86s</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p>é€‰æ‹©ä¸€ä¸ª Pod å¹¶ä½¿ç”¨ kubectl exec è¿›å…¥åˆ°å®¹å™¨å†…ã€‚æ¨¡æ‹Ÿä¸šåŠ¡é«˜å³°æœŸåœºæ™¯ï¼Œä½¿ç”¨ ab å‘½ä»¤æ¥åˆ›å»ºå¹¶å‘è¯·æ±‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@hello-docker-flask-7b8f894675-bvnj6:/app#</span><br><span class="line">root@hello-docker-flask-7b8f894675-bvnj6:/app# ab -c 50 -n 10000 http://127.0.0.1:5000/</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1913912 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 127.0.0.1 (be patient)</span><br></pre></td></tr></table></figure><p>â€</p><p>å¼€å¯æ–°çš„å‘½ä»¤è¡Œçª—å£ï¼ŒæŒç»­ç›‘æ§ Pod çš„çŠ¶æ€ï¼Œâ€“watch å‚æ•°ä¼šä¸€ç›´ç­‰å¾…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --watch</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯ä»¥è§‚å¯Ÿåˆ°K8så·²ç»æ„ŸçŸ¥åˆ°äº†Podçš„å‹åŠ›ï¼Œå¹¶ä¸”æ­£åœ¨è‡ªåŠ¨æ¨ªå‘æ‰©å®¹</p><p>â€‹<img src="/2025/03/16/K8s%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9%E5%92%8C%E8%87%AA%E6%84%88/image-20250316095640-f39x90m.png" alt="image">â€‹</p><p>â€</p><p>å®éªŒçš„æœ€åï¼Œæ‰§è¡Œ kind delete cluster æ¥åˆ é™¤é›†ç¾¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Last login: Sun Mar 16 09:54:59 on ttys001</span><br><span class="line">(base) yihui.li@yihuilideMBP ~ % kind delete cluster</span><br><span class="line">Deleting cluster &quot;kind&quot; ...</span><br><span class="line">Deleted nodes: [&quot;kind-control-plane&quot;]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Cloud Native </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨ç½²å®¹å™¨é•œåƒåˆ°K8s</title>
      <link href="/2025/03/15/%E9%83%A8%E7%BD%B2%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%B0K8s/"/>
      <url>/2025/03/15/%E9%83%A8%E7%BD%B2%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%B0K8s/</url>
      
        <content type="html"><![CDATA[<p>â€â€â€</p><h2 id="å®‰è£…Kubernetes"><a href="#å®‰è£…Kubernetes" class="headerlink" title="å®‰è£…Kubernetes"></a>å®‰è£…Kubernetes</h2><p>é¦–å…ˆå®‰è£…Kubernetes cli tool <code>Kubectl</code>â€‹ï¼Œå®ƒå…è®¸å¼€å‘è€…é€šè¿‡å‘½ä»¤åç®¡ç†Kubernetesçš„èµ„æºã€‚</p><p>*Macå¯ä»¥ä½¿ç”¨<code>Homebrew</code>â€‹å®‰è£…</p><p><a href="https://kubernetes.io/docs/reference/kubectl/">ä»€ä¹ˆæ˜¯Kubectl</a></p><p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/">å®‰è£…Kubectl</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP hello_docker %</span><br><span class="line">yihui.li@yihuilideMBP hello_docker % kubectl version --client</span><br><span class="line">Client Version: v1.28.2</span><br><span class="line">Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3</span><br><span class="line">yihui.li@yihuilideMBP hello_docker %</span><br></pre></td></tr></table></figure><p>â€</p><p>æ ¹æ®å®˜æ–¹æ­¥éª¤å®‰è£…<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/">Kind</a>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨éå¸¸ç®€å•ã€‚</p><p>â€</p><p>å¼€å§‹åˆ›å»ºK8s</p><p>å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º config.yamlï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kind: Cluster</span><br><span class="line">apiVersion: kind.x-k8s.io/v1alpha4</span><br><span class="line">nodes:</span><br><span class="line">- role: control-plane</span><br><span class="line">  kubeadmConfigPatches:</span><br><span class="line">  - |</span><br><span class="line">    kind: InitConfiguration</span><br><span class="line">    nodeRegistration:</span><br><span class="line">      kubeletExtraArgs:</span><br><span class="line">        node-labels: &quot;ingress-ready=true&quot;</span><br><span class="line">  extraPortMappings:</span><br><span class="line">  - containerPort: 80</span><br><span class="line">    hostPort: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">  - containerPort: 443</span><br><span class="line">    hostPort: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œ kind create å‘½ä»¤ï¼Œåˆ›å»º K8s é›†ç¾¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kind create cluster --config config.yaml</span><br><span class="line">Creating cluster &quot;kind&quot; ...</span><br><span class="line"> âœ“ Ensuring node image (kindest/node:v1.32.2) ğŸ–¼</span><br><span class="line"> âœ“ Preparing nodes ğŸ“¦</span><br><span class="line"> âœ“ Writing configuration ğŸ“œ</span><br><span class="line"> âœ“ Starting control-plane ğŸ•¹ï¸</span><br><span class="line"> âœ“ Installing CNI ğŸ”Œ</span><br><span class="line"> âœ“ Installing StorageClass ğŸ’¾</span><br><span class="line">Set kubectl context to &quot;kind-kind&quot;</span><br><span class="line">You can now use your cluster with:</span><br><span class="line"></span><br><span class="line">kubectl cluster-info --context kind-kind</span><br><span class="line"></span><br><span class="line">Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p>æ£€æŸ¥K8sé›†ç¾¤çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl cluster-info</span><br><span class="line">Kubernetes control plane is running at https://127.0.0.1:51848</span><br><span class="line">CoreDNS is running at https://127.0.0.1:51848/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use &#x27;kubectl cluster-info dump&#x27;.</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>â€</p><p><strong>æ—¢ç„¶å·²ç»æœ‰äº†Dokcerï¼Œä¸ºä»€ä¹ˆéœ€è¦K8sï¼Ÿ</strong></p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ éœ€è¦åŒæ—¶å¯åŠ¨ 10 ä¸ªä¸åŒçš„å®¹å™¨é•œåƒï¼Œéœ€è¦è¿è¡Œ 10 æ¬¡ docker run å‘½ä»¤ã€‚<br>æ­¤å¤–ï¼Œå¦‚æœå®¹å™¨ä¹‹é—´æœ‰ä¾èµ–é¡ºåºï¼Œè¿˜éœ€è¦é¢å¤–è®°ä½è¿™ 10 æ¡å‘½ä»¤ç‰¹å®šçš„å¯åŠ¨é¡ºåºã€‚</p><p>K8s çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®ƒä¸ºæˆ‘ä»¬æŠ½è±¡äº†è¯¸å¦‚â€œå¯åŠ¨ 10 ä¸ªå®¹å™¨é•œåƒâ€è¿™æ ·çš„è¿‡ç¨‹å¼çš„å‘½ä»¤ï¼Œä½ åªéœ€è¦å‘ K8s æè¿°â€œæˆ‘éœ€è¦ 10 ä¸ªå®¹å™¨â€ã€‚10 ä¸ªå®¹å™¨æ˜¯æˆ‘æœŸæœ›çš„<strong>æœ€ç»ˆçŠ¶æ€</strong>ï¼Œæˆ‘ä¸ç®¡æ€ä¹ˆæ‰§è¡Œå‘½ä»¤ï¼Œæ‰§è¡Œäº†å¤šå°‘æ¬¡å‘½ä»¤ç­‰è¿‡ç¨‹ï¼Œæˆ‘æƒ³è¦çš„å°±æ˜¯è¿™ä¸ªç»“æœã€‚</p><p>ç”¨æ¥å‘ K8s æè¿°â€œæœŸæœ›æœ€ç»ˆçŠ¶æ€â€çš„æ–‡ä»¶ï¼Œå°±å«åš <strong>K8s Manifest</strong>ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºæ¸…å•æ–‡ä»¶ã€‚Manifest å°±å¥½æ¯”é¤å…çš„èœå•ï¼Œä½ åªç®¡ç‚¹èœï¼Œåšèœçš„è¿‡ç¨‹æˆ‘ä¸ç®¡ã€‚</p><p>â€</p><h2 id="éƒ¨ç½²å®¹å™¨é•œåƒ"><a href="#éƒ¨ç½²å®¹å™¨é•œåƒ" class="headerlink" title="éƒ¨ç½²å®¹å™¨é•œåƒ"></a>éƒ¨ç½²å®¹å™¨é•œåƒ</h2><p><strong>é€šè¿‡Kubectlä¸K8sé›†ç¾¤äº¤äº’</strong></p><p>Kubectl æ˜¯ä¸€ä¸ªä¸ K8s é›†ç¾¤äº¤äº’çš„å·¥å…·ï¼Œé€šè¿‡ Kubectlï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä»¥ Manifest ä¸ºåª’ä»‹æ“ä½œ K8s é›†ç¾¤çš„å¯¹è±¡ã€‚å°±åƒæ“ä½œæ•°æ®åº“ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Manifest æ‰€æè¿°çš„å¯¹è±¡è¿›è¡Œåˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥æ‰¾ç­‰æ“ä½œ</p><p>â€</p><p><strong>ç¼–å†™Manifestï¼Œå°†å®¹å™¨é•œåƒéƒ¨ç½²åˆ°K8sé›†ç¾¤</strong></p><p>å°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º flask-pod.yamlï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: hello-world-flask</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: flask</span><br><span class="line">      image: kalosora/hello-docker-flask</span><br><span class="line">      ports:</span><br><span class="line">        - containerPort: 5000</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Manifestå…³é”®å­—è§£é‡Š:</p><ul><li>Kindï¼Œè¡¨ç¤º K8s çš„å·¥ä½œè´Ÿè½½ç±»å‹ã€‚åœ¨ K8s ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½åƒ Docker ä¸€æ ·ç›´æ¥è¿è¡Œä¸€ä¸ªå®¹å™¨é•œåƒï¼Œé•œåƒéœ€è¦ä¾èµ–äº K8s æ›´ä¸Šå±‚çš„å°è£…æ–¹å¼è¿è¡Œï¼Œè¿™ç§å°è£…æ–¹å¼ä¹Ÿå°±æ˜¯å·¥ä½œè´Ÿè½½ï¼ŒPod æ˜¯å·¥ä½œè´Ÿè½½çš„ä¸€ç§ç±»å‹ã€‚<strong>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥åˆ›å»º Pod ç±»å‹çš„å·¥ä½œè´Ÿè½½ã€‚Podæ˜¯K8sè°ƒåº¦çš„æœ€å°å•ä½ã€‚</strong></li><li>Containersï¼Œè¡¨ç¤º Pod è¦è¿è¡Œçš„å®¹å™¨é…ç½®ï¼Œä¾‹å¦‚åç§°ã€é•œåƒå’Œç«¯å£ç­‰ã€‚å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª Pod é‡Œé¢é…ç½®å¤šä¸ªå®¹å™¨</li><li>Imageï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„å®¹å™¨é•œåƒ</li><li>Portsï¼Œè¡¨ç¤ºå®¹å™¨è¦æš´éœ²çš„ç«¯å£ï¼Œç›¸å½“äº docker run çš„ p å‚æ•°</li></ul><p>â€</p><p>æ‰§è¡Œkubectl applyåº”ç”¨è¿™æ®µManifest:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl apply -f flask-pod.yaml</span><br><span class="line">pod/hello-world-flask created</span><br><span class="line">yihui.li@yihuilideMBP k8sdemo %</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸçœ‹åˆ°è¾“å‡ºå†…å®¹ pod&#x2F;hello-world-flask createdï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æŠŠè¿™æ®µ Manifest æäº¤åˆ°é›†ç¾¤é‡Œäº†ã€‚å‚æ•° -f è¡¨ç¤ºâ€œæŒ‡å®šä¸€ä¸ª Manifest æ–‡ä»¶â€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬æƒ³è¦å‘ K8s æäº¤ Manifest çš„æ—¶å€™ï¼Œåªéœ€è¦è®°ä½ä¸€æ¡å‘½ä»¤ï¼Œé‚£å°±æ˜¯ kubectl applyã€‚</p><p>â€</p><h2 id="æŸ¥çœ‹å’Œè®¿é—®Pod"><a href="#æŸ¥çœ‹å’Œè®¿é—®Pod" class="headerlink" title="æŸ¥çœ‹å’Œè®¿é—®Pod"></a>æŸ¥çœ‹å’Œè®¿é—®Pod</h2><p>è¦æŸ¥çœ‹ K8s é›†ç¾¤æ­£åœ¨è¿è¡Œä¸­çš„ Podï¼Œå¯ä»¥ä½¿ç”¨ kubectl get pods ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl get pods</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE</span><br><span class="line">hello-world-flask   1/1     Running   0          15m</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>è¦åœ¨æœ¬åœ°è®¿é—®é›†ç¾¤å†…çš„ Podï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl port-forward å‘½ä»¤è¿›è¡Œç«¯å£è½¬å‘æ“ä½œï¼Œæ‰“é€šå®¹å™¨å’Œæœ¬åœ°ç½‘ç»œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl port-forward pod/hello-world-flask 8000:5000</span><br><span class="line">Forwarding from 127.0.0.1:8000 -&gt; 5000</span><br><span class="line">Forwarding from [::1]:8000 -&gt; 5000</span><br></pre></td></tr></table></figure><p>Manifest é‡Œå®šä¹‰äº† Ports å‚æ•°åœ¨é›†ç¾¤å†…éƒ¨æš´éœ²äº†ç«¯å£ï¼Œ5000çš„ç«¯å£åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚</p><p>æœ¬åœ°å’Œé›†ç¾¤çš„ç½‘ç»œæ˜¯éš”ç¦»çš„ï¼Œå¦‚æœéœ€è¦ä»é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œåˆ™éœ€è¦æ˜ å°„åˆ°æœ¬åœ°ç½‘ç»œçš„ç«¯å£ã€‚</p><p>æ‰“å¼€æµè§ˆå™¨è®¿é—® 127.0.0.1:8000</p><p>â€</p><p>ä½¿ç”¨ kubectl exec è¿›å…¥åˆ° Pod å®¹å™¨å†…éƒ¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl exec -it hello-world-flask -- bash</span><br><span class="line">root@hello-world-flask:/app#</span><br></pre></td></tr></table></figure><p>â€</p><p>ä½¿ç”¨ kubectl delete å‘½ä»¤æ¥åˆ é™¤ Podï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yihui.li@yihuilideMBP k8sdemo % kubectl delete pod hello-world-flask</span><br><span class="line">pod &quot;hello-world-flask&quot; deleted</span><br></pre></td></tr></table></figure><p>â€</p><p><strong>ä¸šåŠ¡è¿›ç¨‹ã€å®¹å™¨é•œåƒå’Œå·¥ä½œè´Ÿè½½ä¹‹é—´çš„å…³ç³»</strong></p><p>é€šè¿‡è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºï¼Œæœ€å†…å±‚æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡åº”ç”¨è¿›ç¨‹ï¼Œå¤–å±‚é€šè¿‡ Docker é•œåƒä»¥å®¹å™¨åŒ–çš„å½¢å¼è¿è¡Œï¼Œå†å¾€å¤–æ˜¯ K8s çš„æœ€å°è°ƒåº¦å•ä½ Podã€‚</p><p>â€‹<img src="/2025/03/15/%E9%83%A8%E7%BD%B2%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%B0K8s/image-20250315220015-tr78a9d.png" alt="image">â€‹</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Cloud Native </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker åŸºç¡€</title>
      <link href="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/04/Docker%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>â€â€</p><h2 id="åˆè¯†å®¹å™¨"><a href="#åˆè¯†å®¹å™¨" class="headerlink" title="åˆè¯†å®¹å™¨"></a>åˆè¯†å®¹å™¨</h2><p>é¦–å…ˆåœ¨æœºå™¨ä¸Šå®‰è£…å¥½dockerï¼Œå¹¶ä¸”é€šè¿‡å‘½ä»¤è¡Œç¡®è®¤çŠ¶æ€ã€‚</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304084250-9itzqkc.png" alt="image">â€‹</p><p>å°è¯•ä»å®˜æ–¹é•œåƒä»“åº“æ‹‰å–é•œåƒ</p><p>Docker ä¼šé»˜è®¤ä» docker.io å®˜æ–¹é•œåƒä»“åº“ä¸­æœç´¢ã€‚</p><p>â€‹<code>:latest</code>â€‹æŒ‡çš„æ˜¯è·å–æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pull lyzhang1999/hello-world-flask:latest</span></span><br></pre></td></tr></table></figure><p>â€</p><p>ä½¿ç”¨å‘½ä»¤åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„é•œåƒ(images)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images</span></span><br></pre></td></tr></table></figure><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304084713-xfggiuk.png" alt="image">â€‹</p><p>è¿è¡Œé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d -p 8000:5000 lyzhang1999/hello-world-flask:latest</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>-d ä»£è¡¨â€œåœ¨åå°è¿è¡Œå®¹å™¨â€ï¼ŒåŒæ—¶å®ƒä¼šè¾“å‡ºå®¹å™¨ IDï¼Œè¿™æ˜¯è¿è¡Œå®¹å™¨çš„å”¯ä¸€æ ‡è¯†ã€‚</p><p>-p ä»£è¡¨â€œå°†å®¹å™¨å†…çš„ 5000 ç«¯å£æš´éœ²åˆ°å®¿ä¸»æœºï¼ˆæœ¬åœ°çš„ 8000 ç«¯å£ï¼‰â€ï¼Œè¿™å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬åœ¨æœ¬åœ°è¿›è¡Œè®¿é—®ã€‚</p><p>çœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜æˆ‘ä»¬æˆåŠŸå¯åŠ¨äº† hello-world-flask é•œåƒã€‚</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304085847-m0rvxfj.png" alt="image">â€‹</p><p>æ‰“å¼€æµè§ˆå™¨è®¿é—® localhost:8000ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304085933-o8zexy8.png" alt="image">â€‹</p><p>â€</p><h2 id="è¿æ¥å®¹å™¨"><a href="#è¿æ¥å®¹å™¨" class="headerlink" title="è¿æ¥å®¹å™¨"></a>è¿æ¥å®¹å™¨</h2><p>é¦–å…ˆæŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨åˆ—è¡¨ï¼Œæ‰¾åˆ°<code>CONTAINER ID</code>â€‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE                                  COMMAND                   CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">c3f7297de428   lyzhang1999/hello-world-flask:latest   &quot;python3 -m flask ruâ€¦&quot;   2 minutes ago   Up 2 minutes   0.0.0.0:8000-&gt;5000/tcp   cool_mendel</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œå‘½ä»¤è¿›å…¥å®¹å™¨å†…éƒ¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">exec</span> -it c3f7297de428 bash</span></span><br></pre></td></tr></table></figure><p>-it çš„å«ä¹‰æ˜¯â€œä¿æŒ STDIN æ‰“å¼€çŠ¶æ€ï¼Œå¹¶ä¸”åˆ†é…ä¸€ä¸ªè™šæ‹Ÿçš„ç»ˆç«¯ï¼ˆTerminalï¼‰â€ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œæˆ‘ä»¬é€šè¿‡ SSH ç™»å½•åˆ°äº†å®¹å™¨å†…éƒ¨ï¼Œåœ¨å½“å‰ç»ˆç«¯ä¸‹è¿è¡Œçš„æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯åŸºäºå®¹å™¨å†…çš„</p><p>è¿”å›çš„ç»“æœå¦‚ä¸‹</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304090320-u1xget2.png" alt="image">â€‹</p><p>å°è¯•ç¼–è¾‘å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶<code>app.py</code>â€‹ï¼Œä¿å­˜å¹¶é€€å‡º</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304090438-v3utilc.png" alt="image">â€‹</p><p>å†æ¬¡è®¿é—® <a href="http://localhost:8000/">http://localhost:8000</a> å¯ä»¥çœ‹åˆ°é¡µé¢å·²ç»å‘ç”Ÿäº†å˜åŒ–</p><p>è¾“å…¥<code>exit</code>â€‹é€€å‡ºå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@c3f7297de428:/app# exit</span><br></pre></td></tr></table></figure><p>â€</p><p>æœ€åå¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤åœæ­¢å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stop [å®¹å™¨<span class="built_in">id</span>]</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304090815-631tc5h.png" alt="image">â€‹</p><p>â€</p><p><strong>å…³äºå®¹å™¨å’Œé•œåƒ</strong></p><p>é€šä¿—åœ°è¯´ï¼Œé•œåƒæ˜¯ä¸€ä¸ªåŒæ—¶åŒ…å«ä¸šåŠ¡åº”ç”¨å’Œè¿è¡Œç¯å¢ƒçš„â€œç³»ç»Ÿå®‰è£…åŒ…â€ï¼Œå®ƒéœ€è¦è¿è¡Œèµ·æ¥ä¹‹åæ‰èƒ½æä¾›æœåŠ¡ï¼Œè¿è¡Œåé•œåƒçš„â€œå®ä¾‹åŒ–â€ç§°ä¸ºå®¹å™¨ï¼ˆContainerï¼‰ã€‚ä½ å¯ä»¥å¯¹åŒä¸€ä¸ªé•œåƒå®ä¾‹åŒ–å¤šæ¬¡ï¼Œäº§ç”Ÿå¤šä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼Œè¿™äº›å®¹å™¨æ‹¥æœ‰ä¸åŒçš„å®¹å™¨ IDï¼Œä¸åŒçš„å®¹å™¨ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</p><p>è¿›ä¸€æ­¥ç†è§£ï¼Œä½ å¯ä»¥æŠŠå®¹å™¨æ¯”å–»ä¸ºè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºä¹Ÿæ˜¯ï¼Œå½¼æ­¤ä¹‹é—´çš„æ•°æ®å’ŒçŠ¶æ€éƒ½æ˜¯éš”ç¦»çš„ã€‚</p><p>â€</p><h2 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h2><p>ä½¿ç”¨ Python ç¼–å†™çš„ Flask Web åº”ç”¨ä½œä¸ºä¾‹å­</p><p>å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œå¹¶ä¿å­˜ä¸º<code>app.py</code>â€‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, my first docker images! &#x27;</span> + os.getenv(<span class="string">&quot;HOSTNAME&quot;</span>) + <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„å«ä¹‰éå¸¸ç®€å•ï¼Œå¯åŠ¨ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œå½“æ¥æ”¶åˆ° HTTP è¯·æ±‚æ—¶ï¼Œè¿”å› â€œHello, my first docker images!â€ ä»¥åŠ HOSTNAME ç¯å¢ƒå˜é‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»º Python çš„ä¾èµ–æ–‡ä»¶ requirements.txt ï¼Œç”¨å®ƒæ¥å®‰è£…ä¾èµ–çš„ Flask æ¡†æ¶ã€‚ä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»º requirements.txt æ–‡ä»¶å¹¶å°† Flask&#x3D;&#x3D;2.2.2 å†…å®¹å†™å…¥è¯¥æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;Flask==2.3.3&quot;</span> &gt;&gt; requirements.txt</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨æœ¬åœ°å¯åŠ¨è¿™ä¸ª Python Web åº”ç”¨äº†ã€‚</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304091801-u43j8m8.png" alt="image">â€‹</p><p><strong>æ¥ä¸‹æ¥ï¼Œå°†è¿™æ®µæœ€ç®€å•çš„ Python ä¸šåŠ¡ä»£ç åˆ¶ä½œæˆé•œåƒã€‚</strong></p><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–‡ä»¶æ¥æè¿°é•œåƒæ˜¯å¦‚ä½•è¢«æ„å»ºçš„ï¼Œè¿™ä¸ªæ–‡ä»¶å«åš <code>Dockerfile</code>â€‹ã€‚</p><p>å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º Dockerfile æ–‡ä»¶ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.8</span>-slim-buster</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y procps vim apache2-utils &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;python3&quot;</span>, <span class="string">&quot;-m&quot;</span> , <span class="string">&quot;flask&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;--host=0.0.0.0&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹ Dockerfile æ–‡ä»¶é‡Œçš„è¿™å‡ ä¸ªå‘½ä»¤</p><p>ç¬¬ä¸€è¡Œä»¥ syntax å¼€å¤´çš„æ˜¯è§£æå™¨æ³¨é‡Šï¼Œå®ƒä¸ Docker æ„å»ºé•œåƒçš„å·¥å…· buildkit ç›¸å…³ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µï¼Œå»ºè®®ä½¿ç”¨ docker&#x2F;dockerfile:1ï¼Œå®ƒä»£è¡¨å§‹ç»ˆæŒ‡å‘æœ€æ–°çš„è¯­æ³•ç‰ˆæœ¬ã€‚</p><p>FROM å‘½ä»¤ï¼Œè¡¨ç¤ºä½¿ç”¨å®˜æ–¹ä»“åº“çš„ python:3.8-slim-buster é•œåƒä½œä¸ºåŸºç¡€é•œåƒã€‚åœ¨æˆ‘ä»¬ç†Ÿæ‚‰çš„ç¼–ç¨‹æ–¹æ³•ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºä»è¯¥é•œåƒç»§æ‰¿ã€‚è¿™ä¸ªé•œåƒå·²ç»å®‰è£…äº† Python3 å’Œ Pip3 ç­‰æ‰€æœ‰çš„ Python ç›¸å…³çš„å·¥å…·å’ŒåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>RUN çš„å«ä¹‰æ˜¯åœ¨é•œåƒå†…è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºé•œåƒå®‰è£…äº†ä¸€äº›å¿…è¦çš„å·¥å…·ã€‚ WORKDIR çš„å«ä¹‰æ˜¯é•œåƒçš„å·¥ä½œç›®å½•ï¼Œä½ å¯ä»¥ç†è§£ä¸ºåç»­æ‰€æœ‰çš„å‘½ä»¤éƒ½å°†ä»¥æ­¤ä¸ºåŸºå‡†è·¯å¾„ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åç»­çš„å‘½ä»¤ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„è€Œä¸æ˜¯å®Œæ•´è·¯å¾„äº†ã€‚</p><p>COPY çš„å«ä¹‰æ˜¯å°†æœ¬åœ°çš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒå†…æŒ‡å®šçš„ä½ç½®ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨è¦å¤åˆ¶åˆ°é•œåƒå†…çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸ƒè¡Œ COPY è¡¨ç¤ºï¼Œå°†æœ¬åœ°å½“å‰ç›®å½•ä¸‹çš„ requirements.txt æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒå·¥ä½œç›®å½• &#x2F;app ä¸­ï¼Œæ–‡ä»¶å‘½ååŒæ ·ä¸º requirements.txtã€‚ ç¬¬åè¡Œ RUN çš„å«ä¹‰æ˜¯åœ¨é•œåƒé‡Œè¿è¡Œ pip3 å®‰è£… Python ä¾èµ–ã€‚<strong>è¯·æ³¨æ„ï¼Œè¿™äº›ä¾èµ–å°†ä¼šè¢«å®‰è£…åœ¨é•œåƒé‡Œè€Œä¸æ˜¯æœ¬åœ°</strong>ã€‚ æ¥ä¸‹æ¥ï¼Œç¬¬åè¡Œåˆå‡ºç°äº†ä¸€ä¸ª COPY å‘½ä»¤ï¼Œå®ƒçš„å«ä¹‰æ˜¯å°†å½“å‰ç›®å½•æ‰€æœ‰çš„æºä»£ç å¤åˆ¶åˆ°é•œåƒçš„å·¥ä½œç›®å½• &#x2F;app ä¸‹ï¼Œå¤åˆ¶ç›®å½•çš„è¯­æ³•å’Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„å¤åˆ¶æ–‡ä»¶æ˜¯ç±»ä¼¼çš„ã€‚ æœ€åä¸€è¡Œ CMD çš„å«ä¹‰æ˜¯é•œåƒçš„å¯åŠ¨å‘½ä»¤ã€‚åœ¨ä¸€ä¸ª Dockerfile ä¸­ï¼Œåªèƒ½æœ‰ä¸€ä¸ª CMD å‘½ä»¤ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ª CMD å‘½ä»¤ä¼šèµ·ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é•œåƒè¢«è¿è¡Œæ—¶å¯åŠ¨ Python Flask Web æœåŠ¡å™¨ï¼Œå¹¶ç›‘å¬åœ¨ç‰¹å®šä¸»æœºä¸Šã€‚CMD çš„ç¬¬ä¸€ä¸ªå‚æ•° python3 æ˜¯æˆ‘ä»¬å¸Œæœ›è¿è¡Œçš„å¯æ‰§è¡Œå‘½ä»¤ï¼Œåé¢çš„å‚æ•°è¡¨ç¤ºè¿è¡Œ python3 å‘½ä»¤æ‰€éœ€è¦çš„å‚æ•°ã€‚</p><p>â€</p><p><strong>å‡†å¤‡æ„å»ºç¬¬ä¸€ä¸ªé•œåƒ</strong></p><p>ç¡®ä¿å½“å‰ç›®å½•ä¸‹æœ‰æ‰€éœ€çš„æ–‡ä»¶</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250304092657-capxx14.png" alt="image">â€‹</p><p>åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build -t hello-docker-flask .</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>-t ä»£è¡¨çš„æ˜¯é•œåƒåã€‚è¿™é‡Œéšå«äº†é•œåƒç‰ˆæœ¬ï¼ŒDocker ä¼šé»˜è®¤ç”¨ latest ä½œä¸ºç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œhello-docker-flask ä¸ hello-docker-flask:latest çš„å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„æœ€åé¢æœ‰ä¸€ä¸ª â€œ.â€ ï¼Œè¿™ä»£è¡¨äº†æ„å»ºé•œåƒçš„ä¸Šä¸‹æ–‡ã€‚</p><p>æ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼ŒDocker ä¼šå¸®æˆ‘ä»¬ä»å®˜æ–¹é•œåƒä»“åº“æ‹‰å– python:3.8-slim-buster é•œåƒï¼Œå¹¶å¯åŠ¨è¯¥é•œåƒã€‚æ¥ä¸‹æ¥ï¼Œè¯¥å®¹å™¨ä¼šä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬åœ¨ Dockerfile ä¸­ä¹¦å†™çš„å‘½ä»¤ï¼Œä¾‹å¦‚ WORKDIRã€COPYã€RUN ç­‰ç­‰ã€‚</p><p>â€</p><p>å¦‚æœé‡åˆ°<code>fail to authorize</code>â€‹çš„å¼‚å¸¸ï¼Œéœ€è¦æŒ‡å®šç”¨æˆ·å’Œå¯†ç ï¼Œå¹¶é‡å¯docker</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250315113825-v1oo3f5.png" alt="image">â€‹</p><p>â€</p><p>æŸ¥çœ‹æœ¬åœ°é•œåƒï¼Œå¹¶è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d -p 8000:5000 hello-docker-flask:latest</span></span><br></pre></td></tr></table></figure><p>â€</p><p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å®¹å™¨å¯åŠ¨æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs [å®¹å™¨ID]</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯ä»¥çœ‹åˆ°å®¹å™¨å¯åŠ¨æ­£å¸¸</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250315121305-jpt6qcg.png" alt="image">â€‹</p><p>â€</p><p>æ‰“å¼€æµè§ˆå™¨è®¿é—® localhost:8000ï¼Œå¯ä»¥çœ‹åˆ°æ­£å¸¸è¾“å‡º</p><p>â€</p><h2 id="å…±äº«é•œåƒ"><a href="#å…±äº«é•œåƒ" class="headerlink" title="å…±äº«é•œåƒ"></a>å…±äº«é•œåƒ</h2><p>ä¸ºäº†èƒ½å¤Ÿåœ¨å›¢é˜Ÿä¸­å…±äº«é•œåƒï¼Œéœ€è¦å…ˆæ³¨å†Œä¸€ä¸ª <a href="https://hub.docker.com/" title="Docker HUB">Docker HUB</a> çš„è´¦å·ï¼Œå¹¶ä¸”ä½¿ç”¨ docker login ç™»å½•ï¼Œè¿™å’Œæˆ‘ä»¬ä½¿ç”¨çš„ Git å·¥å…·ç±»ä¼¼ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ docke tag é‡å‘½åæˆ‘ä»¬ä¹‹å‰åœ¨æœ¬åœ°æ„å»ºçš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker tag hello-world-flask my_dockerhub_name/hello-world-flask</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æŠŠ <code>my_dockerhub_name</code>â€‹ æ›¿æ¢ä¸ºä½ å®é™…çš„ Docker Hub è´¦æˆ·åï¼Œä¹Ÿç§°ä¸ºé•œåƒä»“åº“çš„åå­—</p><p>â€</p><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ docker push æŠŠæœ¬åœ°çš„é•œåƒä¸Šä¼ åˆ° Docker Hub äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker push my_dockerhub_name/hello-world-flask</span></span><br></pre></td></tr></table></figure><p>â€</p><p>æˆåŠŸä¸Šä¼ åï¼Œå…¶ä»–äººå¯ä»¥é€šè¿‡ docker pull å‘½ä»¤æ¥æ‹‰å–æˆ‘ä»¬ä¸Šä¼ çš„é•œåƒã€‚</p><p>â€</p><p>ä¾‹å¦‚</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250315121923-kdut6zn.png" alt="image">â€‹</p><p>â€‹<img src="/2025/03/04/Docker%E5%9F%BA%E7%A1%80/image-20250315121934-5u3db8s.png" alt="image">â€‹</p>]]></content>
      
      
      <categories>
          
          <category> Cloud Native </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨GPTæé«˜ç ”å‘æ•ˆç‡</title>
      <link href="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/"/>
      <url>/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/</url>
      
        <content type="html"><![CDATA[<p>â€â€</p><p>â€</p><p>ç›¸åŒç³»åˆ—çš„æ–‡ç« </p><p><a href="https://kalosora.github.io/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/">æ­å»ºHelloGPT</a></p><p><a href="https://kalosora.github.io/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/">æ”¹è¿›ä¸ºå¤šæ€æ¨¡GPT</a></p><p>â€</p><h2 id="ä½¿ç”¨LLMè¾…åŠ©è®¾è®¡"><a href="#ä½¿ç”¨LLMè¾…åŠ©è®¾è®¡" class="headerlink" title="ä½¿ç”¨LLMè¾…åŠ©è®¾è®¡"></a>ä½¿ç”¨LLMè¾…åŠ©è®¾è®¡</h2><p>å¯ä»¥è®©GPTç”Ÿæˆå¤šæ¬¡ä¸åŒçš„è®¾è®¡ï¼Œæœ€åç»“åˆè‡ªå·±çš„æ€è€ƒã€‚</p><p>å¯ä»¥å¤§å¤§æé«˜ç ”å‘äººå‘˜åœ¨é¢å¯¹é™Œç”Ÿé¢†åŸŸæ—¶çš„ç ”å‘æ•ˆç‡ã€‚</p><p>ä¹Ÿå¯ä»¥è®©GPTå¸®åŠ©ä»£ç ç”Ÿæˆ</p><ul><li>æ ¹æ®æ³¨é‡Šã€è¦æ±‚ç›´æ¥ç”Ÿæˆä»£ç </li><li>æ ¹æ®ä»£ç ç”Ÿæˆæµ‹è¯•ï¼ˆç›®å‰æœ€å‡†ç¡®ï¼Œå› ä¸ºä¸Šä¸‹æ–‡åªæœ‰ä»£ç ï¼Œæ²¡æœ‰ä¸šåŠ¡éœ€æ±‚ï¼‰</li><li>æ ¹æ®ä»£ç ç”Ÿæˆæ³¨é‡Š</li><li>åœ¨ä¸åŒç¼–ç¨‹è¯­è¨€ä¹‹é—´ç¿»è¯‘</li><li>è§£é‡Šä»£ç çš„è¿ä½œæ–¹å¼</li><li>ä¿®æ”¹ä»£ç ä¸­çš„bug</li><li>å…¶ä»–</li></ul><p>â€</p><p>å¯ä»¥ä½¿ç”¨ReActæ¨¡å¼ï¼šGPTä»£ç ç”Ÿæˆ -&gt; GPTè‡ªæµ‹ -&gt; GPTbugè‡ªåŠ¨ä¿®æ”¹ ï¼ˆè¿­ä»£ * Nï¼‰-&gt; æœ€ç»ˆä»£ç </p><p>éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ul><li>ReActè¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•</li><li>æ–¹æ³•çš„è¾“å…¥ç®€å•ï¼ˆç®€å•å­—ç¬¦&#x2F;JSONï¼‰</li><li>æ–¹æ³•çš„è¾“å‡ºæ˜¯å¤§æ¨¡å‹å¯ç†è§£ï¼ˆä¸èƒ½åªè¿”å›Error codeï¼Œç»™å‡ºä¸€ä¸ªè¯¦ç»†çš„è‡ªç„¶è¯­è¨€æè¿°ï¼‰</li></ul><p>â€</p><blockquote><p>æºç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_llm_assist_design.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_llm_assist_design.ipynb</a></p></blockquote><p>â€</p><h2 id="æé«˜ä»£ç ç”Ÿæˆçš„å¯ç”¨æ€§"><a href="#æé«˜ä»£ç ç”Ÿæˆçš„å¯ç”¨æ€§" class="headerlink" title="æé«˜ä»£ç ç”Ÿæˆçš„å¯ç”¨æ€§"></a>æé«˜ä»£ç ç”Ÿæˆçš„å¯ç”¨æ€§</h2><p>ä½¿ç”¨ReAct pattern</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222165312-868qflu.png" alt="image">â€‹</p><p>â€</p><p>è§£å†³é—ç•™ä»£ç ä¾èµ–</p><p>å¤–éƒ¨æ¨ç†ï¼šç¼–å†™ASTæ ‘éå†æ‰€æœ‰çš„ä¾èµ–ï¼Œæ•´åˆåˆ°Prompté‡Œä¼ ç»™å¤§æ¨¡å‹</p><p>å¤§æ¨¡å‹æ¨ç†ï¼šå¤§æ¨¡å‹åŸºäºReActæ¨¡å¼è‡ªå·±å¯»æ‰¾æµ‹è¯•ä¾èµ–</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222170014-8tbzyj0.png" alt="image">â€‹</p><p>â€</p><p>æ–¹æ¡ˆæ¯”è¾ƒ</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222170655-s3vbpcu.png" alt="image">â€‹</p><p>â€</p><blockquote><p>æºç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_code_generation_example.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_code_generation_example.ipynb</a></p></blockquote><p>â€</p><h2 id="ç¼–å†™å¤§æ¨¡å‹å‹å¥½ä»£ç "><a href="#ç¼–å†™å¤§æ¨¡å‹å‹å¥½ä»£ç " class="headerlink" title="ç¼–å†™å¤§æ¨¡å‹å‹å¥½ä»£ç "></a>ç¼–å†™å¤§æ¨¡å‹å‹å¥½ä»£ç </h2><p>é€‚åˆå¤§æ¨¡å‹ç”Ÿæˆä»£ç çš„åœºæ™¯ï¼š</p><ul><li><p>åŠŸèƒ½æ˜ç¡®ï¼Œå®šä¹‰æ¸…æ¥š</p><ul><li>é€šè¿‡è§„æ¨¡è¾ƒå°çš„æ¥å£&#x2F;æ–¹æ³•ç­¾åæ¥æ¸…æ™°å®šä¹‰</li><li>æ¸…æ™°çš„æ³¨é‡Š&#x2F;Promptçš„å®šä¹‰å®ç°é€»è¾‘</li></ul></li><li><p>é€šç”¨åŠŸèƒ½</p></li><li><p>ä¾èµ–ç®€å•</p><ul><li>å°¤å…¶æ˜¯å¯¹è‡ªèº«é—ç•™ä»£ç çš„ä¾èµ–</li></ul></li></ul><p>â€</p><h2 id="å¤§æ¨¡å‹è¾…åŠ©è¿ç»´å’Œéƒ¨ç½²"><a href="#å¤§æ¨¡å‹è¾…åŠ©è¿ç»´å’Œéƒ¨ç½²" class="headerlink" title="å¤§æ¨¡å‹è¾…åŠ©è¿ç»´å’Œéƒ¨ç½²"></a>å¤§æ¨¡å‹è¾…åŠ©è¿ç»´å’Œéƒ¨ç½²</h2><p>åˆ©ç”¨å¤§æ¨¡å‹å¸®åŠ©Devopsæé«˜æ•ˆç‡ï¼Œèµ‹èƒ½äº‘åŸç”Ÿå®è·µ</p><p>â€</p><p>ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿï¼Ÿ</p><p>è®¡ç®—èµ„æºå¼¹æ€§ä¼¸ç¼©ï¼šéœ€è¦çš„æ—¶å€™å¿«é€Ÿçš„è·å¾—è®¡ç®—èµ„æºï¼ˆå‡ åç§’è‡³å‡ åˆ†é’Ÿï¼‰ï¼Œä¸éœ€è¦çš„æ—¶å€™æŠŠè®¡ç®—èµ„æºé‡Šæ”¾æ‰ã€‚è®¡ç®—èµ„æºå…è®¸æ¨ªå‘æ‹“å±•ï¼ˆå¢åŠ é›†ç¾¤ï¼‰å’Œçºµå‘æ‹“å±•ï¼ˆåŠ å¼ºæœºå™¨é…ç½®ï¼‰</p><p>å•ç‰©ç†æœºï¼ˆå¤§å‹æœºï¼‰ vs äº‘åŸç”Ÿ</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222203049-jioftgx.png" alt="image">â€‹</p><p>â€</p><p>äº‘åŸç”Ÿå®è·µä¸­çš„CICD pipeline</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222203353-ht8yzo4.png" alt="image">â€‹</p><p>â€</p><p>Terraformä½œä¸ºIaCå·¥å…·ï¼Œåœ¨äº‘åŸç”Ÿä¸­å‘æŒ¥è‡³å…³é‡è¦çš„ä½œç”¨</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222203619-xj2r1ye.png" alt="image">â€‹</p><p>â€</p><p>å¯ä»¥åˆ©ç”¨å¤§æ¨¡å‹å¸®åŠ©å¼€å‘è€…ç”Ÿæˆterraform templateï¼Œå¼€å‘äººå‘˜åªéœ€è¦ä¿®æ”¹éƒ¨åˆ†å†…å®¹å³å¯å®Œæˆå¼€å‘ã€‚</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222212927-ug7e6ny.png" alt="image">â€‹</p><p>å¯ç”¨ä¸Šä¸‹æ–‡è®°å¿†åŠŸèƒ½ï¼Œè®©GPTæŠŠAWSäº‘è½¬æ¢æˆé˜¿é‡Œäº‘çš„terraformæ ¼å¼</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222213417-vtmq4wm.png" alt="image">â€‹</p><p>â€</p><p>è¿˜å¯ä»¥åˆ©ç”¨å¤§æ¨¡å‹ç”Ÿç¬¦åˆKubernetesæœ€ä½³å®è·µçš„éƒ¨ç½²é…ç½®æ–‡ä»¶</p><p>æœ€ä½³å®è·µçš„è¦æ±‚</p><ul><li>éƒ¨ç½²çš„namespaceä¸ºâ€serviceâ€</li><li>åŒ…å«readinessåŠliveness probe</li><li>é‡‡ç”¨ä¸€ä¸ªç‹¬ç«‹çš„ service account è¿è¡Œ</li><li>åŒ…å«å®Œç¾ç»ˆæ­¢ï¼ˆgraceful terminationï¼‰é…ç½®</li></ul><p><a href="https://learnk8s.io/production-best-practices">K8s best practice</a></p><p>â€</p><blockquote><p>æºç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_cloud_devops_example.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_cloud_devops_example.ipynb</a></p></blockquote><p>â€</p><h2 id="æ¢ç´¢å¼€æºAIç¤¾åŒº"><a href="#æ¢ç´¢å¼€æºAIç¤¾åŒº" class="headerlink" title="æ¢ç´¢å¼€æºAIç¤¾åŒº"></a>æ¢ç´¢å¼€æºAIç¤¾åŒº</h2><p>åˆ©ç”¨Hugging Faceå¼€æºç¤¾åŒºä¸­å¤§é‡çš„å¼€æºæ¨¡å‹ï¼Œæå‡ç ”å‘æ•ˆç‡</p><p><a href="https://huggingface.co/">huggingface</a></p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222214912-demx9p0.png" alt="image">â€‹</p><p>â€</p><p>Open sourceçš„æ¨¡å‹ç»Ÿç§°ä¸º <code>pre-trained</code>â€‹æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒ</p><p>Transformer Pipeline</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222215626-k9qx1ue.png" alt="image">â€‹</p><p>â€</p><p>Hugging Faceçš„æ¨¡å‹å¯ä»¥ç»Ÿä¸€ä½¿ç”¨Transformer Pipelineè°ƒç”¨ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨è¿œç¨‹è°ƒç”¨æ¨¡å‹çš„æ–¹å¼ï¼Œéœ€è¦æ³¨å†Œè´¦å·å¹¶åˆ›å»ºAPI token</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250222221046-uj658fe.png" alt="image">â€‹</p><p>â€</p><p><strong>æ³¨æ„ï¼šHugging Faceéœ€è¦å®‰è£…tensorflow</strong></p><p>Mac intel arm64ä¼šå‡ºç°æ‰¾ä¸åˆ°å®‰è£…åŒ…çš„æƒ…å†µ</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250223100358-l19mdgb.png" alt="image">â€‹</p><p>â€</p><p>è§£å†³æ–¹æ³•ï¼šå®‰è£…Anacondaï¼Œå¹¶åˆ›å»ºæ–°çš„pythonè¿è¡Œç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">conda --version</span><br><span class="line"></span><br><span class="line">conda create -n TFmacOS python=3.9 pip</span><br><span class="line">conda activate TFmacOS </span><br><span class="line">python -m pip install tensorflow-macos==2.9.0</span><br><span class="line">python -m pip install tensorflow-metal</span><br><span class="line"></span><br><span class="line">conda install jupyter</span><br></pre></td></tr></table></figure><p>ä»<code>TFmacOS</code>â€‹ç¯å¢ƒä¸­å¯åŠ¨jupyter notebook</p><p>â€</p><blockquote><p>æºç </p><p>é€šè¿‡Hugging Face + Deepseek API å®ç°çœ‹å›¾è®²æ•…äº‹</p><p>æˆ–</p><p>LangChain + Hugging Face model</p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_hugging_face_example.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_hugging_face_example.ipynb</a></p></blockquote><p>â€</p><h2 id="AIä¼ä¸šæ¶æ„ä¸­çš„æ€è€ƒ"><a href="#AIä¼ä¸šæ¶æ„ä¸­çš„æ€è€ƒ" class="headerlink" title="AIä¼ä¸šæ¶æ„ä¸­çš„æ€è€ƒ"></a>AIä¼ä¸šæ¶æ„ä¸­çš„æ€è€ƒ</h2><p>ä¼ä¸šå†…éƒ¨æ–‡æ¡£å¤„ç†</p><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250223091728-jlaozxf.png" alt="image">â€‹</p><p>â€</p><p>å…¶ä»–å‚è€ƒæ¶æ„</p><ul><li>ä½¿ç”¨<code>prompt validation</code>â€‹é˜²å¾¡æç¤ºè¯æ³¨å…¥è¿›æ”»</li></ul><p>â€‹<img src="/2025/02/23/%E4%BD%BF%E7%94%A8GPT%E6%8F%90%E9%AB%98%E7%A0%94%E5%8F%91%E6%95%88%E7%8E%87/image-20250223092857-9zxbsip.png" alt="image">â€‹</p><p>â€</p><p>æœ€åæ€»ç»“ä¸€ä¸‹ä½¿ç”¨åˆ°çš„æ¨¡å‹ç¤¾åŒº</p><p>Hugging Face</p><p>Ollama</p>]]></content>
      
      
      <categories>
          
          <category> AI/ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> DeepSeek </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©GPTä½¿ç”¨å·¥å…·</title>
      <link href="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
      <url>/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>â€â€</p><p>*ä½¿ç”¨DeepSeek APIæµ‹è¯•</p><h2 id="Function-Calling"><a href="#Function-Calling" class="headerlink" title="Function Calling"></a>Function Calling</h2><p>è®©AIè°ƒç”¨å·²ç»å®šä¹‰å¥½çš„python æ–¹æ³•</p><p>Function Calling è®©æ¨¡å‹èƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæ¥å¢å¼ºè‡ªèº«èƒ½åŠ›ã€‚</p><ul><li>å°†å¯ä»¥ä½¿ç”¨æ–¹æ³•ï¼ˆå·¥å…·ï¼‰è¯´æ˜ï¼Œéšç”¨æˆ·è¯·æ±‚ä¸€èµ·æ”¾åœ¨Promptä¸­ä¼ ç»™GPT</li><li>GPTè¿”å›è¦è°ƒç”¨çš„æ–¹æ³•åŠå‚æ•°å€¼ï¼Œç„¶ååœ¨å¤–éƒ¨è¿è¡Œè¯¥æ–¹æ³•è·å¾—ç»“æœ</li><li>å°†è°ƒç”¨ç»“æœåŠå‰é¢çš„å¯¹è¯å†å²ä¸€èµ·æ”¾å…¥Promptï¼Œå†æ¬¡è°ƒç”¨GPT</li></ul><p>â€</p><p>ä¾‹å¦‚ï¼š</p><ul><li>æ„å»ºä¸€ä¸ªdictå¯¹è±¡å­˜å‚¨ï¼š{â€œMethod1â€, â€œMethod2â€, â€¦}</li><li>åœ¨Promptä¸­åŠ å…¥æ–¹æ³•å®šä¹‰</li><li>æ ¹æ®LLMçš„è¿”å›ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨å‡½æ•°ï¼ˆè¿”å›ä¿¡æ¯ä¸­å«æœ‰â€Function_callâ€ï¼‰ï¼Œè¿˜æ˜¯ç›´æ¥è¿”å›ä¿¡æ¯ç»™ç”¨æˆ·</li><li>å¦‚éœ€è°ƒç”¨å‡½æ•°ï¼Œåˆ™è°ƒç”¨LLMæŒ‡å®šå‡½æ•°ï¼Œå¹¶å°†ç»“æœåŠè°ƒç”¨çš„å‡½æ•°ä¸€èµ·æ”¾åœ¨Promptä¸­å†æ¬¡è°ƒç”¨LLM</li></ul><p>â€</p><p>OpenAI GPT4oçš„ä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> AzureOpenAI</span><br><span class="line">  </span><br><span class="line">client = AzureOpenAI(</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;OPENAI_API_KEY&quot;</span>),  </span><br><span class="line">    api_version=os.getenv(<span class="string">&quot;OPENAI_API_VERSION&quot;</span>),</span><br><span class="line">    azure_endpoint = os.getenv(<span class="string">&quot;OPENAI_API_BASE&quot;</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">funcs = &#123;<span class="string">&quot;get_current_cluster_state&quot;</span>: get_current_cluster_state&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_cluster_state</span>(<span class="params">cluster_name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;cluster:<span class="subst">&#123;cluster_name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span>  <span class="string">&quot;&quot;&quot;ERROR: Failed to pull image &quot;/docker/dsp:latest&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    msg=[&#123;<span class="string">&quot;role&quot;</span>:<span class="string">&quot;user&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="built_in">input</span>&#125;]</span><br><span class="line">    ret = run_conversation(msg)</span><br><span class="line">    <span class="keyword">return</span> ret.content</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_conversation</span>(<span class="params">msg</span>):</span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">        model=deployment,</span><br><span class="line">        messages=msg,</span><br><span class="line">        functions=[</span><br><span class="line">            &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_current_cluster_state&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Get the current state in a given cluster&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;cluster_name&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;the name of the cluster&quot;</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;cluster_name&quot;</span>],</span><br><span class="line">                    &#125;</span><br><span class="line">          </span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        function_call=<span class="string">&quot;auto&quot;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response_message = response.choices[<span class="number">0</span>].message</span><br><span class="line">  </span><br><span class="line">    function_call = response_message.function_call</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># å¦‚æœä¸éœ€è¦è°ƒç”¨functionï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> function_call:</span><br><span class="line">        <span class="keyword">return</span> response_message</span><br><span class="line">    function_name = function_call.name</span><br><span class="line">    function_to_call = funcs[function_name] </span><br><span class="line">    function_args = json.loads(response_message.function_call.arguments)</span><br><span class="line">    function_response = function_to_call(**function_args)            </span><br><span class="line">    msg.append( <span class="comment"># adding assistant response to messages</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: response_message.role,</span><br><span class="line">            <span class="string">&quot;function_call&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: function_name,</span><br><span class="line">                <span class="string">&quot;arguments&quot;</span>: response_message.function_call.arguments,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    msg.append( <span class="comment"># adding function response to messages</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: function_name,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: function_response,</span><br><span class="line">        &#125;</span><br><span class="line">    ) </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> run_conversation(msg)</span><br><span class="line">   </span><br></pre></td></tr></table></figure><p>â€</p><p>åœ¨Promptä¸­åŠ å…¥æ–¹æ³•æè¿°</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250215180507-3yfoplo.png" alt="image">â€‹</p><blockquote><p>DeepSeekç¤ºä¾‹æºä»£ç </p><p>ç›®å‰ä¼šå‡ºç°ç©ºå›å¤çš„bug</p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_function_calling.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_function_calling.ipynb</a></p></blockquote><p>â€</p><h2 id="ä½¿ç”¨LangChain-Agent"><a href="#ä½¿ç”¨LangChain-Agent" class="headerlink" title="ä½¿ç”¨LangChain Agent"></a>ä½¿ç”¨LangChain Agent</h2><p>è®©GPTä»¥æ›´ç®€å•çš„æ–¹å¼ï¼Œå­¦ä¼šä½¿ç”¨å·¥å…·ã€‚</p><p>Agentçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥é€‰æ‹©è¦é‡‡å–çš„ä¸€ç³»åˆ—æ“ä½œã€‚</p><p>â€</p><blockquote><p>LangChain å·¥å…·é›†</p><p><a href="https://python.langchain.com/api_reference/">https://python.langchain.com/api_reference/</a></p></blockquote><p>â€</p><p>æµ‹è¯•ä»¥åå¯ä»¥å‘ç°ï¼ŒLangChainä½¿ç”¨å·¥å…·çš„æ–¹æ³•æ›´åŠ æ™ºèƒ½ã€çµæ´»</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250216110005-bxe9e3f.png" alt="image">â€‹</p><h3 id="Wolfram-Alpha-API-Wrapper"><a href="#Wolfram-Alpha-API-Wrapper" class="headerlink" title="Wolfram Alpha API Wrapper"></a>Wolfram Alpha API Wrapper</h3><p>â€‹<code>Wolfram Alpha</code>â€‹æ˜¯ä¸“æ³¨äºè§£å†³ç§‘å­¦è®¡ç®—çš„å·¥å…·ï¼Œå¸®åŠ©AIæ›´å¥½å¾—æ€è€ƒæ•°å­¦é—®é¢˜</p><blockquote><p>å®˜ç½‘</p><p><a href="https://zh.wolframalpha.com/">https://zh.wolframalpha.com</a></p><p>â€</p><p>API ID Ceation</p><p><a href="https://developer.wolframalpha.com/">https://developer.wolframalpha.com</a></p><p>â€</p><p>WolframAlphaAPIWrapper document</p><p><a href="https://python.langchain.com/api_reference/community/utilities/langchain_community.utilities.wolfram_alpha.WolframAlphaAPIWrapper.html">https://python.langchain.com/api_reference/community/utilities/langchain_community.utilities.wolfram_alpha.WolframAlphaAPIWrapper.html</a></p></blockquote><p>â€</p><p>åˆ›å»ºè´¦å·</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250216111208-2qgm45s.png" alt="image">â€‹</p><p>åˆ›å»ºä½ çš„APP ID</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250216111431-fmyfj9j.png" alt="image">â€‹</p><p>å¤åˆ¶<code>App ID</code>â€‹<br><img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250216111655-uxjwrxm.png" alt="image">â€‹</p><blockquote><p>å‚è€ƒæºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_langchain_agent.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_langchain_agent.ipynb</a></p></blockquote><h2 id="In-context-learning"><a href="#In-context-learning" class="headerlink" title="In-context learning"></a>In-context learning</h2><p><strong>Zero-shot Learning</strong></p><p>ä¸€ç§æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œå®ƒå…è®¸æ¨¡å‹åœ¨æ²¡æœ‰è§è¿‡ä»»ä½•è®­ç»ƒæ ·æœ¬çš„æƒ…å†µä¸‹ï¼Œå¯¹æ–°ç±»åˆ«çš„æ•°æ®è¿›è¡Œåˆ†ç±»æˆ–è¯†åˆ«ã€‚</p><p>è¿™ç§æ–¹æ³•é€šå¸¸ä¾èµ–äºæ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼Œä»¥åŠå¯¹æ–°ç±»åˆ«çš„ä¸€äº›æè¿°æ€§ä¿¡æ¯ï¼Œå¦‚å±æ€§æˆ–åŸæ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å‡ºä¸€äº›çŒ«çš„ç‰¹å¾ï¼Œç„¶åç»™å‡ºä¸€å †å›¾ç‰‡ï¼Œè®©æœºå™¨è¯†åˆ«å‡ºå…¶ä¸­å“ªäº›å›¾ç‰‡æ˜¯ä¸çŒ«ç›¸å…³çš„ã€‚</p><p>â€</p><p><strong>Few-shot Learning</strong></p><p>æ•™å¯¼æ¨¡å‹ä½¿ç”¨éå¸¸æœ‰é™çš„è®­ç»ƒæ•°æ®æ¥è¯†åˆ«æ–°çš„å¯¹è±¡ã€ç±»æˆ–ä»»åŠ¡ã€‚åœ¨è¿™é‡Œæ˜¯é€šè¿‡Prompté‡ŒåŠ å…¥å°‘é‡ç¤ºä¾‹ï¼Œæ¥å®ç°æ¨¡å‹å­¦ä¹ ã€‚</p><p>â€</p><p>åº”ç”¨å¤§è¯­è¨€æ¨¡å‹è¦ä»ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ€ç»´åˆ‡æ¢ä¸ºä¸Šä¸‹æ–‡å­¦ä¹ æ€è·¯</p><p>ä¸Šä¸‹æ–‡å­¦ä¹ åŒ…æ‹¬Zero-shot Learning å’Œ Few-shot Learningï¼Œä¸¤è€…å¹¶æ— æ˜æ˜¾ç•Œé™ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦çµæ´»è¿ç”¨ã€‚</p><p>â€</p><blockquote><p>æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_in-ontext_learning.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_in-ontext_learning.ipynb</a></p></blockquote><p>â€</p><h2 id="ReActæ¨¡å¼"><a href="#ReActæ¨¡å¼" class="headerlink" title="ReActæ¨¡å¼"></a>ReActæ¨¡å¼</h2><p>å¤§è¯­è¨€æ¨¡å‹å…·æœ‰æ¨ç†èƒ½åŠ›ï¼Œå› ä¸ºå®ƒä»¬é€šè¿‡å­¦ä¹ å¤§é‡çš„æ–‡æœ¬æ•°æ®ï¼Œæ•æ‰è¯­è¨€ä¸­çš„æ¨¡å¼å’Œç»“æ„ã€‚è¿™äº›æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šå­¦ä¹ åˆ°å„ç§çŸ¥è¯†ã€é€»è¾‘å…³ç³»å’Œæ¨ç†æ–¹æ³•ã€‚å½“å®ƒä»¬é‡åˆ°æ–°çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥æ ¹æ®å·²ç»å­¦åˆ°çš„çŸ¥è¯†å’Œæ¨ç†æ–¹æ³•ï¼Œç”Ÿæˆæœ‰æ„ä¹‰çš„å›ç­”ã€‚</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220092417-an4b6d6.png" alt="image">â€‹</p><p>â€</p><p>é€šè¿‡è·å–å½“å‰ç¯å¢ƒä¿¡æ¯ï¼ˆè§‚å¯Ÿï¼‰ï¼Œè¿›ä¸€æ­¥æ€è€ƒï¼Œé‡‡å–è¡ŒåŠ¨</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220092516-ffjujn5.png" alt="image">â€‹</p><p>â€</p><h3 id="LangChain-ReAct-Agent"><a href="#LangChain-ReAct-Agent" class="headerlink" title="LangChain ReAct Agent"></a>LangChain ReAct Agent</h3><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220092544-lca8ao4.png" alt="image">â€‹</p><p>â€</p><p>æ„å»ºGPTï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹èŒƒå¼</p><p><span data-type="text" style="color: var(--b3-font-color6);">Question</span>: the input question you must answer</p><p><span data-type="text" style="color: var(--b3-font-color6);">Thought</span>: you should always think about what to do</p><p><span data-type="text" style="color: var(--b3-font-color6);">Action</span>: the action to take, should be one of [{tool_names}]</p><p><span data-type="text" style="color: var(--b3-font-color6);">Action Input:</span> the input to the action</p><p><span data-type="text" style="color: var(--b3-font-color6);">Observation</span>: the result of thr actionâ€¦ (Though&#x2F;Action&#x2F;Action Input&#x2F;Observation repeat N times)</p><p><span data-type="text" style="color: var(--b3-font-color6);">Thought</span>: Now I know the answer</p><p><span data-type="text" style="color: var(--b3-font-color6);">Final Answer</span>: the answer to the input question</p><p>â€</p><p>AutoGPT - é’ˆå¯¹æŸä¸ªè§£å†³æ–¹æ¡ˆçš„å¾ªç¯è‡ªæ‰§è¡ŒGPT</p><p>å¦‚æœå¯ä»¥ï¼Œé…åˆçŸ­æœŸå’Œé•¿æœŸè®°å¿†ä¿è¯ä¸Šä¸‹æ–‡æ•ˆæœã€‚</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220093712-epgkrva.png" alt="image">â€‹</p><p>Plan: è®¾è®¡å®ç°é¢„æœŸç»“æœçš„è®¡åˆ’ï¼Œå°†å¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸ºè¾ƒå°çš„æ­¥éª¤ã€‚</p><p>Criticize: è¯„ä¼°è®¡åˆ’çš„å¯è¡Œæ€§å’Œæ•ˆç‡ï¼Œè¯†åˆ«æ½œåœ¨é—®é¢˜å’Œæ”¹è¿›é¢†åŸŸ</p><p>Act: ä½¿ç”¨å…¶å¤šåŠŸèƒ½çš„èƒ½åŠ›æ‰§è¡Œè®¡åˆ’çš„æ“ä½œï¼Œä¾‹å¦‚ç½‘ç»œæœç´¢å’Œæ•°æ®æ£€ç´¢</p><p>Observeï¼šåˆ†æä»Actä¸­ç”Ÿæˆçš„åé¦ˆï¼Œä»ä»¥å‰çš„æ€§èƒ½ä¸­å­¦ä¹ ä»¥æ”¹å–„æœªæ¥çš„ç»“æœ</p><p>Planï¼ˆä¿®æ”¹ï¼‰ï¼šæ ¹æ®åé¦ˆï¼Œä¿®æ”¹åˆå§‹è®¡åˆ’ï¼Œå…è®¸æŒç»­æ”¹è¿›é—®é¢˜è§£å†³ç­–ç•¥</p><p>â€</p><blockquote><p>æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_autogpt_example.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_autogpt_example.ipynb</a></p></blockquote><p>â€</p><h2 id="æ–‡æœ¬åˆ†ç‰‡ä¸å‘é‡åŒ–"><a href="#æ–‡æœ¬åˆ†ç‰‡ä¸å‘é‡åŒ–" class="headerlink" title="æ–‡æœ¬åˆ†ç‰‡ä¸å‘é‡åŒ–"></a>æ–‡æœ¬åˆ†ç‰‡ä¸å‘é‡åŒ–</h2><p>è®©å¤§æ¨¡å‹åº”ç”¨ä¼ä¸šå†…éƒ¨æ•°æ®</p><p>å¤§é‡æ–‡æ¡£å’Œæ•°æ®çš„æŒ‘æˆ˜ï¼šå¦‚æœä½¿ç”¨promptçš„æ–¹å¼æ¥ä¼ é€’æ•°æ®æˆ–ä¸Šä¸‹æ–‡ï¼Œä¼šé¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p><ul><li>Promptçš„å†…å®¹å¤§å°é™åˆ¶</li><li>ä½¿ç”¨å¤§é‡æ•°æ®çš„æˆæœ¬</li><li>å¹¶éæ‰€æœ‰æ•°æ®éƒ½ä¼šç”¨äºè§£å†³å½“å‰é—®é¢˜</li></ul><p>â€</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220210925-xq0i4n2.png" alt="image">â€‹</p><p>ä¸€ç§å¯èƒ½çš„å¤„ç†æ–¹å¼<strong>å…³é”®è¯æ£€ç´¢</strong>ï¼šé€šè¿‡Elaticsearchã€Luceneç­‰ç±»ä¼¼æœç´¢å¼•æ“çš„æ–¹å¼ï¼Œæ ¹æ®æ–‡æœ¬å»ºç«‹ç´¢å¼•ï¼Œé€šè¿‡å…³é”®è¯<u>ä¸¥æ ¼åŒ¹é…</u>åˆ°å¯¹åº”çš„æ–‡æœ¬å†…å®¹ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä¸¢å¤±å¾ˆå¤šä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼Œä¼šè®©ç›¸åŒè¯­æ„çš„æ–‡æœ¬ä¸¢å¤±ã€‚</p><p>â€</p><p>æ›´å¥½çš„æ–¹æ³•æ˜¯è®©å…³é”®è¯æ£€ç´¢å˜ä¸º<strong>è¯­ä¹‰æ£€ç´¢</strong></p><p>è¯­ä¹‰æ£€ç´¢æ˜¯ä¸€ç§åŸºäºæ–‡æœ¬å†…å®¹å’Œæ„ä¹‰çš„ä¿¡æ¯æ£€ç´¢æ–¹æ³•ï¼Œå®ƒè¯•å›¾ç†è§£æŸ¥è¯¢å’Œæ–‡æ¡£çš„è¯­ä¹‰ï¼Œä»¥ä¾¿æ›´å‡†ç¡®åœ°æ‰¾åˆ°ä¸æŸ¥è¯¢ç›¸å…³çš„æ–‡æ¡£ã€‚</p><p>å‘é‡åŒ–(embedding)æ˜¯å°†æ–‡æœ¬æ•°æ®è½¬ä¸ºæ•°å€¼å‘é‡çš„è¿‡ç¨‹ã€‚å‘é‡åŒ–åçš„æ–‡æœ¬å¯ä»¥ç”¨äºè®¡ç®—æ–‡æœ¬ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§å‡ é‡Œå¾·è·ç¦»ç­‰åº¦é‡ã€‚<strong>è¿™ä½¿å¾—è¯­ä¹‰æ£€ç´¢èƒ½å¤Ÿæ ¹æ®æŸ¥è¯¢å’Œæ–‡æ¡£ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§æ¥å¯¹æ–‡æ¡£è¿›è¡Œæ’åºå’Œæ£€ç´¢ï¼Œä»è€Œæé«˜æ£€ç´¢çš„å‡†ç¡®æ€§å’Œæ•ˆç‡</strong>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠå­—ç¬¦å—è¿›è¡Œå‘é‡åŒ–ï¼Œé€šè¿‡å‘é‡é—´çš„è·ç¦»æ¥æ±‚è§£è¿™äº›å‘é‡ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯­ä¹‰è¶Šç›¸è¿‘çš„å‘é‡ï¼Œå®ƒçš„è·ç¦»å°±è¶ŠçŸ­ã€‚</p><blockquote><p>å‚è€ƒé˜…è¯»</p><p>Word2Vecç›¸å…³çš„ä¸€äº›æœºå™¨å­¦ä¹ çš„ç†è®º</p></blockquote><p>â€</p><p>å®ç°æµç¨‹</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222100753-1kzxpe0.png" alt="image">â€‹</p><p>ä»£ç ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘é‡åŒ–ç®€å•ç¤ºä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain.embeddings.openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># embedding = OpenAIEmbeddings() #å¦‚æœç›´æ¥ä½¿ç”¨OpenAIçš„GPTæœåŠ¡</span></span><br><span class="line">embedding = OpenAIEmbeddings(deployment=embedding_deployment) <span class="comment">#deploymentæ˜¯ä½ åœ¨Azureä¸­çš„ embedding æ¨¡å‹çš„éƒ¨ç½²åå­—</span></span><br><span class="line">sentence1 = <span class="string">&quot;æˆ‘æ˜¯ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆ&quot;</span></span><br><span class="line">sentence2 = <span class="string">&quot;å°å¼ ä»äº‹æ³•å¾‹å·¥ä½œ&quot;</span></span><br><span class="line">sentence3 = <span class="string">&quot;æˆ‘æ˜¯ä¸€åç¨‹åºå‘˜&quot;</span></span><br><span class="line"></span><br><span class="line">embedding1 = embedding.embed_query(sentence1)</span><br><span class="line">embedding2 = embedding.embed_query(sentence2)</span><br><span class="line">embedding3 = embedding.embed_query(sentence3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‚¹é›†è®¡ç®—å‘é‡é—´çš„è·ç¦»</span></span><br><span class="line"><span class="built_in">print</span>(np.dot(embedding1,embedding2))</span><br><span class="line"><span class="built_in">print</span>(np.dot(embedding2,embedding3))</span><br><span class="line"><span class="built_in">print</span>(np.dot(embedding1,embedding3))</span><br></pre></td></tr></table></figure><p>â€</p><p>æ–‡æœ¬å‘é‡åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.embeddings.openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">embed</span>(<span class="params">chunks</span>): </span><br><span class="line">    <span class="comment"># embedding = OpenAIEmbeddings()#å¦‚æœç›´æ¥ä½¿ç”¨OpenAIçš„GPTæœåŠ¡</span></span><br><span class="line">    embedding = OpenAIEmbeddings(deployment=embedding_deployment)</span><br><span class="line">    <span class="keyword">return</span> [embedding.embed_query(chunk) <span class="keyword">for</span> chunk <span class="keyword">in</span> chunks]</span><br><span class="line"></span><br><span class="line">chunks = split_file_into_chunks(<span class="string">&quot;spotmax_intro.txt&quot;</span>,<span class="number">100</span>)</span><br><span class="line">embeddeds = embed(chunks)</span><br></pre></td></tr></table></figure><p>â€</p><p>å‘é‡æ£€ç´¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_k_largest_indices</span>(<span class="params">input_list, k</span>):</span><br><span class="line">    sorted_indices = <span class="built_in">sorted</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(input_list)), key=<span class="keyword">lambda</span> i: input_list[i], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(input_list)</span><br><span class="line">    <span class="built_in">print</span>(sorted_indices)</span><br><span class="line">    <span class="keyword">return</span> sorted_indices[:k]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">chunks,embeddeds,top_k, txt</span>):</span><br><span class="line">    embedding = OpenAIEmbeddings(deployment=<span class="string">&quot;embedding&quot;</span>,chunk_size=<span class="number">1</span>)</span><br><span class="line">    embedded_txt = embedding.embed_query(txt)</span><br><span class="line">    distances = [np.dot(embedded_txt,embedded) <span class="keyword">for</span> embedded <span class="keyword">in</span> embeddeds]</span><br><span class="line">    ret_idx = find_k_largest_indices(distances, top_k)</span><br><span class="line">    <span class="keyword">return</span> [chunks[i] <span class="keyword">for</span> i <span class="keyword">in</span> ret_idx]</span><br><span class="line"></span><br><span class="line">search(chunks,embeddeds,<span class="number">2</span>, <span class="string">&quot;æé«˜ç³»ç»Ÿå¯ç”¨æ€§&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€</p><p>å‘é‡æ£€ç´¢ + GPT</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">anwser_question_with_doc</span>(<span class="params">question, chunks, embeddeds</span>):</span><br><span class="line">    relevent_chunks = search(chunks,embeddeds,<span class="number">2</span>, question)</span><br><span class="line">    prompt = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä»…é€šè¿‡æ€»ç»“ä»¥ä¸‹çš„æ–‡å­—ç‰‡æ®µå›ç­”ç”¨æˆ·é—®é¢˜, æ³¨æ„ä¿æŒå›ç­”çš„è¯­è¨€é€šé¡ºï¼ˆå­—æ•°åœ¨30å­—ä»¥å†…ï¼‰</span></span><br><span class="line"><span class="string">    --- </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> rchunks <span class="keyword">in</span> relevent_chunks:</span><br><span class="line">        prompt = prompt + <span class="string">&quot;\n&#x27;&quot;</span> + rchunks + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">  </span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">    engine=deployment, <span class="comment"># engine = &quot;deployment_name&quot;.</span></span><br><span class="line">    messages=[</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;,   </span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: question&#125;</span><br><span class="line">        ],</span><br><span class="line">        temperature = <span class="number">0.9</span>, </span><br><span class="line">        max_tokens = <span class="number">200</span></span><br><span class="line">   )</span><br><span class="line">   <span class="keyword">return</span> response.choices[<span class="number">0</span>].message.content</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(anwser_question_with_doc(<span class="string">&quot;å¦‚ä½•æé«˜å¯ç”¨æ€§&quot;</span>, chunks,embeddeds))</span><br></pre></td></tr></table></figure><p>â€</p><p>*ä¹Ÿå¯ä»¥ä½¿ç”¨embeddingæ¨¡å‹è¾…åŠ©å®ç°ï¼Œembedding modelä½¿ç”¨<code>nomic-embed-text</code>â€‹</p><blockquote><p>Ollama embedding model</p><p><a href="https://ollama.com/blog/embedding-models">https://ollama.com/blog/embedding-models</a></p><p>â€</p><p>nomic-embed-text model</p><p><a href="https://ollama.com/library/nomic-embed-text">https://ollama.com/library/nomic-embed-text</a></p></blockquote><p>â€</p><p>é€šè¿‡ollamaå®‰è£…æ¨¡å‹</p><p>å¤åˆ¶å‘½ä»¤</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220213540-anf19y3.png" alt="image">â€‹</p><p>â€</p><p>åœ¨å‘½ä»¤è¡Œå®‰è£…</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220214052-vh76gw4.png" alt="image">â€‹</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250220214331-7pqihxh.png" alt="image">â€‹</p><h3 id="LangChain-Retrieval"><a href="#LangChain-Retrieval" class="headerlink" title="LangChain Retrieval"></a>LangChain Retrieval</h3><p>é€šè¿‡LangChainè¿æ¥å¤§æ¨¡å‹å’Œå†…éƒ¨æ–‡æœ¬</p><p>ä¸Šé¢ä½¿ç”¨äº†chromaå‘é‡æ•°æ®åº“ï¼Œåœ¨è¿™ä¸€èŠ‚é…åˆLangChainä½¿ç”¨å®ç°åˆ†ç‰‡å‘é‡åŒ–çš„æ•´ä¸ªå·¥ä½œæµ</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222100908-g99sack.png" alt="image">â€‹</p><p>LangChain Document LoaderåŠ è½½æ•°æ®</p><p>æ”¯æŒCSVï¼Œæ–‡ä»¶ç›®å½•ï¼ŒHTMLï¼ŒJSONï¼ŒPDFï¼ŒMarkdownç­‰å¤šç§æ ¼å¼</p><p><a href="https://python.langchain.com/docs/integrations/document_loaders/">https://python.langchain.com/docs/integrations/document_loaders/</a></p><p>â€</p><p>LangChain Retrievers</p><p>æ›´å¥½çš„æ–‡æ¡£åˆ†ç‰‡å·¥å…·</p><p><a href="https://python.langchain.com/docs/integrations/document_transformers/">https://python.langchain.com/docs/integrations/retrievers/</a></p><p>â€</p><p>æœ€åæŠŠåˆ†ç‰‡å¥½çš„æ•°æ®embedåˆ°å‘é‡æ•°æ®åº“</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222101728-6nouej4.png" alt="image">â€‹</p><p>LangChainæä¾›äº†<code>RetrievalQA</code>â€‹çš„æ–¹æ³•ç›´æ¥æŸ¥è¯¢å‘é‡æ•°æ®åº“ï¼ˆVectordbï¼‰</p><p>ç”¨æˆ·æé—® -&gt; å‘é‡æ•°æ®åº“æ£€ç´¢ -&gt; æ„æˆæ–°çš„prompt -&gt; å¤§æ¨¡å‹å›ç­”</p><p>â€</p><p>è¿™é‡Œä½¿ç”¨mdæ–‡æ¡£ä¸ºä¾‹</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222114740-ivn5gg8.png" alt="image">â€‹</p><p>â€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">retriever=vectordb.as_retriever(</span><br><span class="line">    search_type=<span class="string">&quot;mmr&quot;</span>, search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">3</span>&#125;</span><br><span class="line">    <span class="comment">#search_type=&quot;similarity&quot;, search_kwargs=&#123;&quot;k&quot;: 3&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>search_typeï¼šæ ¹æ®åœºæ™¯é€‰æ‹©é€‚åˆçš„å‚æ•°</p><ul><li>similarityï¼šæ ¹æ®ç›¸ä¼¼æ€§æŸ¥æ‰¾ï¼Œæœ€å¤šæŸ¥æ‰¾3ä¸ª</li><li>mmrï¼ˆmax marginalï¼‰ï¼šæ‰¾åˆ°ä¸‰ä¸ªæœ€ç›¸ä¼¼çš„ï¼Œç„¶åæ ¹æ®è¿™ä¸‰ä¸ªæ•°æ®åº“ä¹‹é—´å·®åˆ«æœ€å¤§çš„ï¼Œä½†æ˜¯è·Ÿç”¨æˆ·é—®é¢˜åˆæœ‰å…³è”æ€§çš„é—®é¢˜</li></ul><p>â€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qa = RetrievalQA.from_chain_type(llm=llm, chain_type=<span class="string">&quot;refine&quot;</span>, retriever=retriever,</span><br><span class="line">                                 return_source_documents=<span class="literal">False</span>, verbose=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>chain_type: å¯é€‰å€¼ stuff &#x2F; refine &#x2F; map reduce &#x2F; map re-rank</p><ul><li>è¦æ ¹æ®ä¼ä¸šå†…éƒ¨çš„å®é™…æƒ…å†µå’Œæ•°æ®ç‰¹æ€§ï¼Œå°½å¯èƒ½å¤šåœ°æµ‹è¯•</li><li>é€‚å½“åšä¸€äº›å®šåˆ¶åŒ–çš„æ”¹åŠ¨ä»¥æ»¡è¶³éœ€æ±‚</li></ul><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222103300-hr9bz2x.png" alt="image">â€‹</p><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222103405-zo9pqum.png" alt="image">â€‹</p><p>â€</p><blockquote><p>æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_langchain_retrieval.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_langchain_retrieval.ipynb</a></p><p>å‚è€ƒé˜…è¯»</p><p><a href="https://medium.com/@rahul.dusad/run-rag-pipeline-locally-with-ollama-embedding-model-nomic-embed-text-generate-model-llama3-e7a554a541b3">https://medium.com/@rahul.dusad/run-rag-pipeline-locally-with-ollama-embedding-model-nomic-embed-text-generate-model-llama3-e7a554a541b3</a></p></blockquote><p>â€</p><h2 id="æ„å»ºå¤šæ¨¡æ€Chatbot"><a href="#æ„å»ºå¤šæ¨¡æ€Chatbot" class="headerlink" title="æ„å»ºå¤šæ¨¡æ€Chatbot"></a>æ„å»ºå¤šæ¨¡æ€Chatbot</h2><p>â€‹<img src="/2025/02/22/%E8%AE%A9GPT%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/image-20250222150709-zlbhx60.png" alt="image">â€‹</p><p>å›¾å½¢ç”Ÿæˆèƒ½åŠ›ï¼šopenaiå¯ä»¥ä½¿ç”¨DALL E2ï¼Œæˆ–è€…æ˜¯Stable Diffusion</p><p>Openai apiç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> http.client</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_image</span>(<span class="params">prompt</span>):</span><br><span class="line">  api_base = os.getenv(<span class="string">&quot;OPENAI_API_BASE&quot;</span>)</span><br><span class="line">  api_key = os.getenv(<span class="string">&quot;OPENAI_API_KEY&quot;</span>)</span><br><span class="line">  api_version = api_version = <span class="string">&#x27;2022-08-03-preview&#x27;</span></span><br><span class="line"></span><br><span class="line">  url = <span class="string">&quot;&#123;&#125;dalle/text-to-image?api-version=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(api_base, api_version)</span><br><span class="line">  headers= &#123; <span class="string">&quot;api-key&quot;</span>: api_key, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span> &#125;</span><br><span class="line">  body = &#123;</span><br><span class="line">      <span class="string">&quot;caption&quot;</span>: prompt,</span><br><span class="line">      <span class="string">&quot;resolution&quot;</span>: <span class="string">&quot;512x512&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  submission = requests.post(url, headers=headers, json=body)</span><br><span class="line">  operation_location = submission.headers[<span class="string">&#x27;Operation-Location&#x27;</span>]</span><br><span class="line">  retry_after = submission.headers[<span class="string">&#x27;Retry-after&#x27;</span>]</span><br><span class="line">  status = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">while</span> (status != <span class="string">&quot;Succeeded&quot;</span>):</span><br><span class="line">      time.sleep(<span class="built_in">int</span>(retry_after))</span><br><span class="line">      response = requests.get(operation_location, headers=headers)</span><br><span class="line">      status = response.json()[<span class="string">&#x27;status&#x27;</span>]</span><br><span class="line">  image_url = response.json()[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;contentUrl&#x27;</span>]</span><br><span class="line">  <span class="comment">#display(Image(url=image_url))</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;\n![image](&quot;</span>+image_url+<span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (create_image(<span class="string">&quot;A dog on the street.&quot;</span>))</span><br></pre></td></tr></table></figure><p>â€</p><blockquote><p>Openai ä»£ç ç¤ºä¾‹</p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_all_in_one_example.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_all_in_one_example.ipynb</a></p></blockquote><p>â€</p><p>â€</p><p>â€</p><p>â€</p><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> AI/ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> DeepSeek </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºHelloGPT</title>
      <link href="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/"/>
      <url>/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/</url>
      
        <content type="html"><![CDATA[<p>â€</p><h2 id="é€šè¿‡Azureè®¿é—®GPT"><a href="#é€šè¿‡Azureè®¿é—®GPT" class="headerlink" title="é€šè¿‡Azureè®¿é—®GPT"></a>é€šè¿‡Azureè®¿é—®GPT</h2><p>ä¸­å›½å¤§é™†åœ°åŒºä¸å…è®¸è®¿é—®GPTæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡å¾®è½¯äº‘æ­å»ºGPTæœåŠ¡ã€‚</p><p>*å¾®è½¯äº‘é¦–æ¬¡æ³¨å†Œæœ‰30å¤©å…è´¹ä½“éªŒ</p><p><a href="https://azure.microsoft.com/zh-cn/pricing/purchase-options/azure-account/">https://azure.microsoft.com/zh-cn/pricing/purchase-options/azure-account/</a></p><p>â€</p><p>åˆ›å»ºOpenAIæœåŠ¡</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125200329-jo21jm7.png" alt="image">â€‹</p><p>â€</p><p>é€‰æ‹©éƒ¨ç½²æ¨¡å‹</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125200414-0bcfzdx.png" alt="image">â€‹</p><p>â€</p><p>è·å–ç¯å¢ƒå˜é‡</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125200526-o69r4x2.png" alt="image">â€‹</p><p>è®¾ç½®åˆ°ç³»ç»Ÿé…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­import</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125200541-inoh9dd.png" alt="image">â€‹</p><p>â€</p><p>ä»£ç è¯¦è§£</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125200913-vsz9usw.png" alt="image">â€‹</p><ul><li>temperatureï¼šé’ˆå¯¹å›ç­”çš„ç¨³å®šæ€§è®¾ç½®ï¼Œ0ä¸ºæœ€ç¨³å®š</li><li>max_tokenï¼šè®¾ç½®å›ç­”çš„é•¿åº¦</li></ul><p>â€</p><p>Tokenè®¡è´¹è§„åˆ™</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125105549-o7q171o.png" alt="image">â€‹</p><p>â€</p><p>æ¨¡å‹è¯·æ±‚é…é¢</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250125105618-6jmorto.png" alt="image">â€‹</p><h2 id="ä½¿ç”¨DeepSeekAPI"><a href="#ä½¿ç”¨DeepSeekAPI" class="headerlink" title="ä½¿ç”¨DeepSeekAPI"></a><strong>ä½¿ç”¨DeepSeekAPI</strong></h2><p>å¯ä»¥ä½¿ç”¨DeepSeekçš„APIä½œä¸ºä»£æ›¿</p><p><a href="https://platform.deepseek.com/sign_in">deepseek open platform</a></p><p><a href="https://chat.deepseek.com/">deepseek free chat</a></p><p>é¦–æ¬¡æ³¨å†Œå¯ä»¥è·å¾—å…è´¹é¢åº¦</p><p>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250128103053-btd7xa1.png" alt="image">â€‹</p><p>â€</p><p><a href="https://api-docs.deepseek.com/zh-cn/">API document</a></p><blockquote><p>ç¤ºä¾‹æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_api_example.ipynb">https://github.com/KaloSora/HelloGPT/blob/main/code/gpt_api_example.ipynb</a></p></blockquote><p>â€</p><h2 id="æç¤ºè¯å·¥ç¨‹"><a href="#æç¤ºè¯å·¥ç¨‹" class="headerlink" title="æç¤ºè¯å·¥ç¨‹"></a>æç¤ºè¯å·¥ç¨‹</h2><p>å¤§æ¨¡å‹è¿”å›çš„è‡ªç„¶è¯­è¨€æ— æ³•è¢«ç¨‹åºä½¿ç”¨ã€‚</p><p>è®©å¤§æ¨¡å‹ç»“åˆåˆ°ç¨‹åºä¸­ï¼Œè®©ç¨‹åºèƒ½ç†è§£å¤§æ¨¡å‹è¿”å›çš„ç»“æœã€‚</p><h3 id="æç¤ºè¯æŠ€å·§"><a href="#æç¤ºè¯æŠ€å·§" class="headerlink" title="æç¤ºè¯æŠ€å·§"></a>æç¤ºè¯æŠ€å·§</h3><ul><li>åˆ©ç”¨åå‘æç¤ºè¯ï¼ˆå¦‚ï¼šä¸ä½¿ç”¨â€¦â€¦ï¼‰</li><li>è§„èŒƒè¾“å‡ºçš„æ ¼å¼ï¼ˆå¦‚æŒ‡å®šJsonæ ¼å¼ï¼Œä¾¿äºç¨‹åºå¤„ç†ï¼‰</li><li>æ–‡æœ¬è§„èŒƒå¼‚å¸¸è¾“å‡ºçš„æ ¼å¼ï¼ˆå¦‚é‡åˆ°å¼‚å¸¸æ—¶ï¼Œè¿”å›ç®€å•çš„ERRORï¼Œä¾¿äºç¨‹åºå¤„ç†ï¼‰</li><li>ä¸æ–­è¿­ä»£æç¤ºè¯</li><li>æç¤ºè¯å°½é‡ä½¿ç”¨è‹±è¯­</li></ul><p>â€</p><p>DeepSeekå®˜æ–¹æç¤ºåº“</p><p><a href="https://api-docs.deepseek.com/zh-cn/prompt-library/">DeepSeekæç¤ºåº“</a></p><p>â€</p><blockquote><p>ç¤ºä¾‹æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_prompt_demo.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_prompt_demo.ipynb</a></p></blockquote><p>â€</p><h2 id="LangChain"><a href="#LangChain" class="headerlink" title="LangChain"></a>LangChain</h2><p>å¤§è¯­è¨€æ¨¡å‹ä¸­çš„æ‹“å±•å·¥å…·ç±»åº“ï¼Œä½œä¸ºå¤§è¯­è¨€æ¨¡å‹å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„æ¡¥æ¢ã€‚</p><blockquote><p>LangChain is a flexible abstractions and extensive toolkit enables developers to harness the power of LLMs.</p></blockquote><p>â€</p><p>å®‰è£…æ–¹å¼</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install langchain</span><br><span class="line"></span><br><span class="line">pip install langchain-community</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><ul><li><p>æç¤ºè¯æ¨¡æ¿</p></li><li><p>ä¸åŒç¨‹åº¦çš„ä¸Šä¸‹æ–‡è®°å¿†</p></li><li><p>å¤§æ¨¡å‹è°ƒç”¨API</p><ul><li>è¿™ç§æŸ¥è¯¢æ–¹å¼ç±»ä¼¼äºçˆ¬è™«ï¼Œå¯èƒ½ä¼šè¢«å¤–éƒ¨ç½‘ç«™é˜»æ­¢ï¼Œå»ºè®®ä½¿ç”¨ç½‘ç«™æä¾›çš„API</li></ul></li><li><p>é“¾å¼è¯·æ±‚</p><ul><li>å°†å¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸ºæ›´ç®€å•çš„å­ä»»åŠ¡</li><li>â€‹<img src="/2025/02/15/%E6%90%AD%E5%BB%BAHelloGPT/image-20250128163023-kgl4499.png" alt="image">â€‹</li></ul></li></ul><p>â€</p><blockquote><p>ç¤ºä¾‹æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/langchain_demo.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/langchain_demo.ipynb</a></p></blockquote><p>â€</p><h2 id="ä¿æŒä¼šè¯çŠ¶æ€"><a href="#ä¿æŒä¼šè¯çŠ¶æ€" class="headerlink" title="ä¿æŒä¼šè¯çŠ¶æ€"></a>ä¿æŒä¼šè¯çŠ¶æ€</h2><p>LLMæ¨¡å‹æœ¬èº«çš„å¯¹è¯æ˜¯æ— çŠ¶æ€çš„ã€‚</p><p>ä½¿ç”¨<code>Gradio</code>â€‹ç±»åº“è®©Chatbotè·å¾—è®°å¿†ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚</p><ul><li>èƒ½å¤Ÿå¿«é€Ÿæ„å»ºåŸå‹</li><li>èƒ½å¤Ÿä¿å­˜ä¸Šä¸‹æ–‡å¯¹è¯ä¿¡æ¯</li></ul><p>â€</p><p>å®‰è£…</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gradio</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯ä»¥ä½¿ç”¨LangChainçš„è®°å¿†åŠŸèƒ½ï¼Œè®©å¼€å‘æ›´åŠ ç®€å•</p><p>å¯ä»¥å°è¯•ä¸åŒç¨‹åº¦çš„è®°å¿†åŠŸèƒ½</p><p>ä¾‹å¦‚ï¼šConversationSummaryBufferMemory</p><p>å½“ç¼“å­˜å†…å®¹Tokenè¶…è¿‡å‚æ•° â€œmax_token_limitâ€ çš„å€¼åï¼Œå°±ä¼šå°†è¶…å‡ºçš„ä¼šè¯å†…å®¹è¿›è¡Œæ€»ç»“ï¼Œè¿™ä¸ªæ€»ç»“è¿‡ç¨‹ä¹Ÿæ˜¯é€šè¿‡å¤§æ¨¡å‹å®Œæˆçš„ã€‚</p><p>â€</p><p>ä½¿ç”¨è®°å¿†åŠŸèƒ½çš„æ¨¡å‹ï¼š</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ§åˆ¶äº†ç¼“å­˜å†…å®¹çš„å¤§å°</li><li>å°½é‡è®°å¿†å¯¹è¯çš„ä¸Šä¸‹æ–‡</li></ul><p>ç¼ºç‚¹</p><ul><li>åœ¨ç¼“å­˜å†…å®¹è¶…å‡ºé™åˆ¶åï¼Œä¸ºäº†æ§åˆ¶ç¼“å­˜çš„å¤§å°ï¼Œä¼šæŒç»­é€šè¿‡å¤§æ¨¡å‹æ¥æ€»ç»“è¾ƒæ—©çš„å†…å®¹ï¼Œä½¿ç¨‹åºç›¸åº”çš„å»¶è¿Ÿå¢åŠ </li><li>æˆæœ¬å¢åŠ </li></ul><p>â€</p><blockquote><p> ç¤ºä¾‹æºä»£ç </p><p><a href="https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_langchain_history.ipynb">https://github.com/KaloSora/HelloGPT/blob/dev/code/gpt_langchain_history.ipynb</a></p></blockquote><p>â€</p><h2 id="å¤§æ¨¡å‹åœ¨ä¼ä¸šä¸­çš„åº”ç”¨ç•…æƒ³"><a href="#å¤§æ¨¡å‹åœ¨ä¼ä¸šä¸­çš„åº”ç”¨ç•…æƒ³" class="headerlink" title="å¤§æ¨¡å‹åœ¨ä¼ä¸šä¸­çš„åº”ç”¨ç•…æƒ³"></a>å¤§æ¨¡å‹åœ¨ä¼ä¸šä¸­çš„åº”ç”¨ç•…æƒ³</h2><p>å¯å‘å¼äº¤äº’åº”ç”¨ï¼šå¦‚ä½ä»£ç å¹³å°ï¼Œæˆ–è‡ªç„¶è¯­è¨€ç”Ÿæˆä»£ç </p><p>Copilotï¼šAIåŠ©æ‰‹ï¼Œå¦‚å¾®è½¯ã€Appleçš„AIåŠ©æ‰‹ï¼Œæˆ–è€…æ˜¯ä¼ä¸šä¸­çš„ITç³»ç»Ÿè¯Šæ–­åŠ©æ‰‹</p><p>å¤§è¯­è¨€æ¨¡å‹çš„æ¨ç†&#x2F;ç”Ÿæˆï¼šç”Ÿæˆå¼AIåº”ç”¨</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> AI/ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> DeepSeek </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac DeepSeekæœ¬åœ°éƒ¨ç½²</title>
      <link href="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/"/>
      <url>/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<p>â€</p><blockquote><p>DeepSeek Githubå¼€æºä»“åº“</p><p><a href="https://github.com/deepseek-ai">https://github.com/deepseek-ai</a></p><p>â€</p><p>R1ä»“åº“</p><p><a href="https://github.com/deepseek-ai/DeepSeek-R1">https://github.com/deepseek-ai/DeepSeek-R1</a></p></blockquote><p>â€</p><h2 id="å®‰è£…Ollama"><a href="#å®‰è£…Ollama" class="headerlink" title="å®‰è£…Ollama"></a>å®‰è£…Ollama</h2><p>Ollamaæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œä¸“ä¸ºåœ¨æœ¬åœ°æœºå™¨ï¼ˆæ”¯æŒè·¨å¹³å°ï¼Œå¦‚Mac&#x2F;Windowsï¼‰ä¸Šä¾¿æ·éƒ¨ç½²å’Œè¿è¡Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è€Œè®¾è®¡ã€‚</p><p>*ä½¿ç”¨çš„æœºå™¨ä¸ºMac 2018 Pro, Intel CPUï¼ŒLM Studioä¸æ”¯æŒã€‚</p><blockquote><p>Ollamaä¸‹è½½é“¾æ¥</p><p><a href="https://ollama.com/download/mac">https://ollama.com/download/mac</a></p></blockquote><p>â€</p><p>éªŒè¯å®‰è£…ç»“æœ</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208155744-ss6d35f.png" alt="image">â€‹</p><p>â€</p><h2 id="Ollamaè½½å…¥Deepseek-r1"><a href="#Ollamaè½½å…¥Deepseek-r1" class="headerlink" title="Ollamaè½½å…¥Deepseek-r1"></a>Ollamaè½½å…¥Deepseek-r1</h2><p>åœ¨Ollamaå®˜ç½‘æ‰¾åˆ°R1æ¨¡å‹</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208160225-5ukfsvg.png" alt="image">â€‹</p><p>â€</p><p>é€‰æ‹©éœ€è¦çš„æ¨¡å‹ï¼Œå¤åˆ¶å‘½ä»¤</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208160323-kngn783.png" alt="image">â€‹</p><p>åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œå¯¹åº”çš„å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208160414-bywa9rp.png" alt="image">â€‹</p><p>â€</p><p>è¿è¡Œç»“æœ</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208193550-jd15aq2.png" alt="image">â€‹</p><p>â€</p><h2 id="Chatboxä¸ºAIæ·»åŠ UI"><a href="#Chatboxä¸ºAIæ·»åŠ UI" class="headerlink" title="Chatboxä¸ºAIæ·»åŠ UI"></a>Chatboxä¸ºAIæ·»åŠ UI</h2><blockquote><p>Chatboxå®˜ç½‘</p><p><a href="https://chatboxai.app/zh">https://chatboxai.app/zh</a></p></blockquote><p>*UIä¹Ÿå¯ä»¥é€‰æ‹©Cherry Studio</p><p>é€‰æ‹©Ollama API</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208193833-c6ffl5u.png" alt="image">â€‹</p><p>â€</p><p>é€‰æ‹©å·²ä¸‹è½½çš„æ¨¡å‹</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208193914-rpsuerz.png" alt="image">â€‹</p><p>â€</p><p>é€‰æ‹©ä½ é…ç½®å¥½çš„æ¨¡å‹ï¼Œç„¶åæå‡ºä½ çš„é—®é¢˜</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250208194057-96fy3y7.png" alt="image">â€‹</p><p>â€</p><h2 id="å¼€å¯æœ¬åœ°è”ç½‘æœåŠ¡"><a href="#å¼€å¯æœ¬åœ°è”ç½‘æœåŠ¡" class="headerlink" title="å¼€å¯æœ¬åœ°è”ç½‘æœåŠ¡"></a>å¼€å¯æœ¬åœ°è”ç½‘æœåŠ¡</h2><p>å®‰è£…AnythingLLM</p><p><a href="https://docs.anythingllm.com/installation-desktop/macos">https://docs.anythingllm.com/installation-desktop/macos</a></p><p>â€</p><p>APIæä¾›å•†é€‰æ‹©Ollama</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250209094623-o1t509s.png" alt="image">â€‹</p><p>â€</p><p>åœ¨è®¾ç½®ä¸­æ‰¾åˆ°â€œä»£ç†æŠ€èƒ½â€ï¼Œå¼€å¯è¿ç½‘æœç´¢</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250209094943-2vud5jw.png" alt="image">â€‹</p><p>â€</p><p>å°è¯•æå‡ºä¸€ä¸ª2025å¹´2æœˆçš„äº‹ä»¶ï¼Œå¹¶è¦æ±‚deepseekåˆ†æå…¶å½±å“</p><p>*è¿™é‡Œè”ç½‘é€Ÿåº¦å’Œæ€è€ƒé€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢</p><p>â€‹<img src="/2025/02/09/Mac-DeepSeek%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/image-20250209100454-72pvg99.png" alt="image">â€‹</p>]]></content>
      
      
      <categories>
          
          <category> AI/ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> DeepSeek </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows DeepSeekæœ¬åœ°éƒ¨ç½²</title>
      <link href="/2025/02/02/Windows-DeepSeek%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA/"/>
      <url>/2025/02/02/Windows-DeepSeek%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>â€</p><p>DeepSeek R1 Distill æœ¬åœ°éƒ¨ç½²ç›¸å…³èµ„æ–™</p><blockquote><p>èµ„æ–™æ¥æº <a href="https://henjihenji.feishu.cn/wiki/MN3Vwl2STigk2qk1r6lcGoY5nYg">https://henjihenji.feishu.cn/wiki/MN3Vwl2STigk2qk1r6lcGoY5nYg</a></p></blockquote><h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><p>å»ºè®®ä½¿ç”¨ NVIDIA å¡ï¼Œä½“éªŒä¼šå¥½ä¸å°‘ï¼ŒAMD æ˜¾å¡æœªåšæµ‹è¯•ï¼Œä½†åº”è¯¥ä¹Ÿæ˜¯èƒ½è·‘çš„</p><p>æ¬¢è¿å„ä½åœ¨æœ¬æ–‡æ¡£è¯„è®ºåŒºåé¦ˆå„è‡ªè¿è¡Œæƒ…å†µï¼Œè¿™æ ·å¯ä»¥å¸®åˆ°æ›´å¤šäºº</p><h1 id="LM-Studio"><a href="#LM-Studio" class="headerlink" title="LM Studio"></a>LM Studio</h1><p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://lmstudio.ai/">https://lmstudio.ai/</a></p><p>å¤¸å…‹ç½‘ç›˜ï¼š<a href="https://pan.quark.cn/s/f7f610d2ac7a">https://pan.quark.cn/s/f7f610d2ac7a</a></p><h1 id="æ¨¡å‹åˆ—è¡¨"><a href="#æ¨¡å‹åˆ—è¡¨" class="headerlink" title="æ¨¡å‹åˆ—è¡¨"></a>æ¨¡å‹åˆ—è¡¨</h1><p>è¯·é€‰æ‹©æ–‡ä»¶ä½“ç§¯å°äºè‡ªå·±æ˜¾å­˜å¤§å°çš„æ¨¡å‹ï¼Œç•¥å¤§ä¸€äº›çš„è™½ç„¶ä¹Ÿèƒ½è·‘ï¼Œä½†æ˜¯é€Ÿåº¦ä¼šæ…¢å¾ˆå¤šã€‚å› ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œä»¥ä¸‹æ¨¡å‹æ¨èä¸ä¸€å®šæ˜¯æœ€å¥½çš„</p><p>æ›´å¤šæ¨¡å‹ä¸‹è½½</p><p>  é“¾æ¥1ï¼š<a href="https://www.modelscope.cn/organization/lmstudio-community">https://www.modelscope.cn/organization/lmstudio-community</a></p><p>  è®°å¾—ç”¨æœç´¢åŠŸèƒ½æœç´¢ DeepSeek ç›¸å…³æ¨¡å‹</p><p>  é“¾æ¥2ï¼š<a href="https://www.modelscope.cn/collections/DeepSeek-R1-Distill-GGUF-eec5fee2f2ee42">https://www.modelscope.cn/collections/DeepSeek-R1-Distill-GGUF-eec5fee2f2ee42</a></p><p>  ç›¸æ¯”é“¾æ¥1ä¼šå¤šä¸€ç‚¹ä¸åŒé‡åŒ–ç²¾åº¦çš„æ¨¡å‹</p><p><strong>ç‚¹å‡»æ¨¡å‹åç§°å¯ä»¥ç›´æ¥ä¸‹è½½</strong></p><table><thead><tr><th>æ˜¾å­˜å¤§å°</th><th>æ¨èæ¨¡å‹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>32GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-32B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-32B-Q6_K.gguf">DeepSeek-R1-Distill-Qwen-32B-Q6_K.gguf</a></td><td></td></tr><tr><td>24GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-32B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-32B-Q4_K_M.gguf">DeepSeek-R1-Distill-Qwen-32B-Q4_K_M.gguf</a><br><a href="https://www.modelscope.cn/models/unsloth/DeepSeek-R1-Distill-Qwen-32B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-32B-Q5_K_M.gguf">DeepSeek-R1-Distill-Qwen-32B-Q5_K_M.gguf</a></td><td>äºŒé€‰ä¸€å³å¯ï¼Œæ¯”è¾ƒæ¨èç¬¬ä¸€ä¸ª<br><a href="https://www.modelscope.cn/models/unsloth/DeepSeek-R1-Distill-Qwen-32B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-32B-Q5_K_M.gguf">Q5</a> è´¨é‡ä¸Šå¯èƒ½ä¼šå¥½ä¸€ç‚¹ï¼Œä½†æ˜¯å› ä¸ºå¤ªæ¥è¿‘ 24G æ˜¾å­˜ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡å¤šäº†ä¹‹åï¼Œé€Ÿåº¦å¯èƒ½ä¼šæ…¢ã€‚<br>ä¸Šé¢çš„ <a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-32B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-32B-Q6_K.gguf">Q6</a> å‹‰å¼ºä¹Ÿèƒ½è·‘ï¼Œä½†é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚</td></tr><tr><td>16GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-14B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-14B-Q6_K.gguf">DeepSeek-R1-Distill-Qwen-14B-Q6_K.gguf</a></td><td></td></tr><tr><td>12GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-14B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-14B-Q4_K_M.gguf">DeepSeek-R1-Distill-Qwen-14B-Q4_K_M.gguf</a></td><td></td></tr><tr><td>11GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-14B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-14B-Q4_K_M.gguf">DeepSeek-R1-Distill-Qwen-14B-Q4_K_M.gguf</a></td><td></td></tr><tr><td>8GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-7B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-7B-Q6_K.gguf">DeepSeek-R1-Distill-Qwen-7B-Q6_K.gguf</a><br><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Llama-8B-GGUF/resolve/master/DeepSeek-R1-Distill-Llama-8B-Q6_K.gguf">DeepSeek-R1-Distill-Llama-8B-Q6_K.gguf</a></td><td>äºŒé€‰ä¸€å³å¯</td></tr><tr><td>6GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-7B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-7B-Q4_K_M.gguf">DeepSeek-R1-Distill-Qwen-7B-Q4_K_M.gguf</a><br><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Llama-8B-GGUF/resolve/master/DeepSeek-R1-Distill-Llama-8B-Q4_K_M.gguf">DeepSeek-R1-Distill-Llama-8B-Q4_K_M.gguf</a></td><td>äºŒé€‰ä¸€å³å¯</td></tr><tr><td>4GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-7B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-7B-Q3_K_L.gguf">DeepSeek-R1-Distill-Qwen-7B-Q3_K_L.gguf</a><br><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-1.5B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-1.5B-Q8_0.gguf">DeepSeek-R1-Distill-Qwen-1.5B-Q8_0.gguf</a></td><td>äºŒé€‰ä¸€å³å¯ï¼Œæ¯”è¾ƒæ¨èç¬¬ä¸€ä¸ª<br>ç¬¬äºŒä¸ª 4G æ˜¾å­˜èƒ½è·‘ï¼Œä½†å¯èƒ½ä¼šæ¯”è¾ƒæ…¢</td></tr><tr><td>3GBã€2GB</td><td><a href="https://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Qwen-1.5B-GGUF/resolve/master/DeepSeek-R1-Distill-Qwen-1.5B-Q8_0.gguf">DeepSeek-R1-Distill-Qwen-1.5B-Q8_0.gguf</a></td><td></td></tr></tbody></table><h1 id="å¦‚ä½•æŸ¥çœ‹è‡ªå·±çš„æ˜¾å­˜"><a href="#å¦‚ä½•æŸ¥çœ‹è‡ªå·±çš„æ˜¾å­˜" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹è‡ªå·±çš„æ˜¾å­˜"></a>å¦‚ä½•æŸ¥çœ‹è‡ªå·±çš„æ˜¾å­˜</h1><p>â€‹<img src="/2025/02/02/Windows-DeepSeek%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA/image-20250209100647-xmyvf48.png" alt="image">â€‹</p><table><thead><tr><th>æ˜¾å­˜å¤§å°</th><th>å¯¹åº”Nå¡å‹å·</th></tr></thead><tbody><tr><td>2GB</td><td>GTX 1050ã€GT 1030</td></tr><tr><td>3GB</td><td>GTX 1060 3GB</td></tr><tr><td>4GB</td><td>GTX 1050 Ti</td></tr><tr><td>6GB</td><td>GTX 1060 6GBã€RTX 2060 6GBã€RTX 3050 (6GB)</td></tr><tr><td>8GB</td><td>GTX 1080ã€GTX 1070 Tiã€GTX 1070ã€RTX 2080 SUPERã€RTX 2080ã€RTX 2070 SUPERã€RTX 2070ã€RTX 2060 SUPERã€RTX 3070 Tiã€RTX 3070ã€RTX 3060 Tiã€RTX 3060 (8GB)ã€RTX 3050 (8GB)ã€RTX 4080ã€RTX 4060 Ti 8GBã€RTX 4060ã€RTX 5070</td></tr><tr><td>11GB</td><td>GTX 1080 Tiã€RTX 2080 Ti</td></tr><tr><td>12GB</td><td>RTX 2060 12GBã€RTX 3060 (12GB)ã€RTX 4070 Ti SUPERã€RTX 4070ã€RTX 5070 Ti</td></tr><tr><td>16GB</td><td>RTX 4060 Ti 16GBã€RTX 5080</td></tr><tr><td>24GB</td><td>RTX 3090 Tiã€RTX 3090ã€RTX 4090</td></tr><tr><td>32GB</td><td>RTX 5090</td></tr></tbody></table><p>â€</p><h1 id="æœ¬åœ°éƒ¨ç½²æµ‹è¯•"><a href="#æœ¬åœ°éƒ¨ç½²æµ‹è¯•" class="headerlink" title="æœ¬åœ°éƒ¨ç½²æµ‹è¯•"></a>æœ¬åœ°éƒ¨ç½²æµ‹è¯•</h1><p>GPUï¼šAMD Radeon RX580 8G</p><p>CPUï¼šAMD Ryzen 5600X</p><p>å†…å­˜ï¼š16G</p><p>â€</p><p>è¿è¡ŒLM Studio</p><p>â€‹<img src="/2025/02/02/Windows-DeepSeek%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA/image-20250209110548-fxxeq1n.png" alt="image">â€‹</p><p>â€</p><p>åŠ è½½æœ¬åœ°æ¨¡å‹</p><p>æ³¨æ„æ¨¡å‹è¿™é‡Œç›´æ¥é€‰æ ¹ç›®å½•ï¼ŒLM Studioä¼šè‡ªåŠ¨æœç´¢</p><p>â€‹<img src="/2025/02/02/Windows-DeepSeek%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA/image-20250209110613-zipexwj.png" alt="image">â€‹</p><p>â€</p><p>ç‚¹å‡»é¡¶éƒ¨åŠ è½½æ¨¡å‹ï¼Œå¼€å§‹æ–°çš„å¯¹è¯</p><p>â€‹<img src="/2025/02/02/Windows-DeepSeek%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BA/image-20250209110630-hf4qhqg.png" alt="image">â€‹</p>]]></content>
      
      
      <categories>
          
          <category> AI/ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> DeepSeek </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jupyter Notebook</title>
      <link href="/2025/01/29/Jupyter-Notebook/"/>
      <url>/2025/01/29/Jupyter-Notebook/</url>
      
        <content type="html"><![CDATA[<p>â€</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://jupyter.org/">Jupyterå®˜ç½‘</a></p><blockquote><p>JupyterLabæ˜¯æœ€æ–°çš„åŸºäºwebçš„ç¬”è®°æœ¬ã€ä»£ç å’Œæ•°æ®äº¤äº’å¼å¼€å‘ç¯å¢ƒã€‚å…¶çµæ´»çš„ç•Œé¢å…è®¸ç”¨æˆ·é…ç½®å’Œå®‰æ’æ•°æ®ç§‘å­¦ã€ç§‘å­¦è®¡ç®—ã€è®¡ç®—æ–°é—»å’Œæœºå™¨å­¦ä¹ ä¸­çš„å·¥ä½œæµç¨‹ã€‚æ¨¡å—åŒ–è®¾è®¡é‚€è¯·æ‰©å±•æ¥æ‰©å±•å’Œä¸°å¯ŒåŠŸèƒ½ã€‚</p></blockquote><p>è¯¥å·¥å…·å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p><ul><li>å…è®¸ä½¿ç”¨markdownè¯­æ³•</li><li>æ”¯æŒå¿«é€Ÿå¯¼å‡ºå¤šç§æ–‡ä»¶æ ¼å¼</li><li>æ”¯æŒéƒ¨ç½²åœ¨è¿œç¨‹ç¯å¢ƒ</li><li>ä¸ä»…ä»…æ”¯æŒPythonï¼Œä¹Ÿæ”¯æŒJavascriptï¼ŒRubyç­‰è¯­è¨€</li></ul><p>å› æ­¤ï¼Œè®¸å¤šå…¬å¼€è¯¾ç½‘ç«™å’Œå¤§å­¦è¯¾ç¨‹æ™®éä½¿ç”¨Jupyteråˆ†å‘ä½œä¸šã€‚å®ƒä¹Ÿé€‚åˆæœºå™¨å­¦ä¹ å’Œæ•°æ®åˆ†æï¼Œæ˜¯é›†ç¼–ç¨‹å’Œå†™ä½œä¸ä¸€èº«çš„å·¥å…·ã€‚</p><p>è¿™ç§ç¼–ç¨‹æ–¹å¼ä¹Ÿå¯ä»¥ç§°ä¸ºæ–‡å­¦ç¼–ç¨‹ã€‚</p><h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><p>å®‰è£…å‘½ä»¤</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyter</span><br></pre></td></tr></table></figure><p>â€</p><p>è¿è¡Œç»“æœ</p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194112-m528stx.png" alt="image">â€‹</p><p>â€</p><p>è¿è¡Œå‘½ä»¤</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="punctuation">[</span>target_folder<span class="punctuation">]</span></span><br><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure><p>â€</p><p>è¿è¡Œç»“æœ</p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194224-8owk4qo.png" alt="image">â€‹</p><p>æµè§ˆå™¨è¾“å…¥<code>http://localhost:8888/</code>â€‹è®¿é—®Jupyter</p><p>â€</p><p>åˆ›å»ºæ–°Pythonæ–‡ä»¶ï¼Œå¹¶è¿è¡Œç¬¬ä¸€è¡Œæµ‹è¯•ä»£ç </p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194421-wre78l2.png" alt="image">â€‹</p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194624-s0xokbq.png" alt="image">â€‹</p><p>â€</p><p>åœ¨æœ¬åœ°ç›®å½•æ£€æŸ¥æ–°æ–‡ä»¶</p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194833-rsd6qx2.png" alt="image">â€‹</p><p>â€</p><p>Jupyteræ–‡ä»¶æ”¯æŒå¯¼å‡ºå¤šç§æ ¼å¼</p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194946-9pknd69.png" alt="image">â€‹</p><p>â€</p><p>è¾“å…¥<code>h</code>â€‹æŸ¥çœ‹æ‰€æœ‰å¿«æ·é”®</p><p>â€‹<img src="/2025/01/29/Jupyter-Notebook/image-20250125194351-1zd7ao9.png" alt="image">â€‹</p>]]></content>
      
      
      <categories>
          
          <category> AI/ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS Terraform Section4 - Project</title>
      <link href="/2024/06/30/AWS-Terraform-Section4-Project/"/>
      <url>/2024/06/30/AWS-Terraform-Section4-Project/</url>
      
        <content type="html"><![CDATA[<p>â€</p><p>åˆ›å»ºGitä»“åº“ç”¨äºå­˜æ”¾Terraformä»£ç </p><p>åˆ›å»º.gitignore</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ignore local .terraform dir</span><br><span class="line">.terraform/*</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>ç›®æ ‡ï¼šåˆ›å»ºä¸€ä¸ªEC2å®ä¾‹ï¼Œå¹¶ä¸”åœ¨EC2é‡Œè¿è¡Œä¸€ä¸ªnginx dockerå®¹å™¨</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240627220019-nclsrwk.png" alt="image">â€‹</p><p>â€</p><p>éœ€è¦åˆ›å»ºçš„AWSèµ„æº</p><p>*æœ€å¥½ä¸è¦ä½¿ç”¨é»˜è®¤çš„AWSèµ„æº</p><ol><li>åˆ›å»ºVPC</li><li>åˆ›å»ºSubnet</li><li>åˆ›å»ºRoute Table &amp; Internet Gateway</li><li>åˆ›å»ºEC2</li><li>éƒ¨ç½²nginx dockerå®¹å™¨</li><li>åˆ›å»ºSecurity Group(Firewall)ï¼Œå¹¶å…è®¸ssh</li></ol><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240627220353-vawsy7w.png" alt="image">â€‹</p><p>â€</p><h2 id="åˆ›å»ºVPC-Subnet"><a href="#åˆ›å»ºVPC-Subnet" class="headerlink" title="åˆ›å»ºVPC &amp; Subnet"></a>åˆ›å»ºVPC &amp; Subnet</h2><p>terraform.tfvars</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vpc_cidr_block = &quot;10.0.0.0/16&quot;</span><br><span class="line">subnet_cidr_block = &quot;10.0.0.0/24&quot;</span><br><span class="line">avail_zone = &quot;eu-west-3b&quot;</span><br><span class="line">env_prefix = &quot;dev&quot;</span><br></pre></td></tr></table></figure><p>â€</p><p>main.tf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">    region = &quot;eu-west-3&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable vpc_cidr_block &#123;&#125;</span><br><span class="line">variable subnet_cidr_block &#123;&#125;</span><br><span class="line">variable avail_zone &#123;&#125;</span><br><span class="line">variable env_prefix &#123;&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºVPC</span><br><span class="line">resource &quot;aws_vpc&quot; &quot;myapp-vpc&quot; &#123;</span><br><span class="line">  cidr_block = var.vpc_cidr_block</span><br><span class="line"></span><br><span class="line">  # vpcåç§°å¸¦æœ‰&quot;vpc&quot;å‰ç¼€</span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name: &quot;$&#123;var.env_prefix&#125;-vpc&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºSubnet</span><br><span class="line">resource &quot;aws_subnet&quot; &quot;myapp-subnet-1&quot; &#123;</span><br><span class="line">  vpc_id = aws_vpc.myapp-vpc.id</span><br><span class="line">  cidr_block = var.vpc_cidr_block</span><br><span class="line">  availability_zone = var.avail_zone</span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name: &quot;$&#123;var.env_prefix&#125;-subnet-1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>åœ¨AWSä¸ŠæŸ¥çœ‹ç»“æœ</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240627221856-zq53z7g.png" alt="image">â€‹</p><p>â€</p><h2 id="Route-Table"><a href="#Route-Table" class="headerlink" title="Route Table"></a>Route Table</h2><p>Route tableå†³å®šäº†VPCè½¬å‘çš„ç›®çš„åœ°</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629093707-g015c9a.png" alt="image">â€‹</p><p>â€</p><p>åœ¨Terraform codeä¸å¿…æ ¹æ®æ‰§è¡Œçš„å…ˆåæ¥ç¼–å†™ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºRoute table</span><br><span class="line">resource &quot;aws_route_table&quot; &quot;myapp-route-table&quot; &#123;</span><br><span class="line">  vpc_id = aws_vpc.myapp-vpc.id</span><br><span class="line"></span><br><span class="line">  route = &#123;</span><br><span class="line">    cidr_block = &quot;0.0.0.0/0&quot;</span><br><span class="line">    gateway_id = aws_internet_gateway.myapp-igw.id</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name: &quot;$&#123;var.env_prefix&#125;-rtb&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Route table gateway</span><br><span class="line">resource &quot;aws_internet_gateway&quot; &quot;myapp-igw&quot; &#123;</span><br><span class="line">  vpc_id = aws_vpc.myapp-vpc.id</span><br><span class="line"></span><br><span class="line">    tags = &#123;</span><br><span class="line">    Name: &quot;$&#123;var.env_prefix&#125;-igw&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œç»“æœ</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629095048-bxhndn1.png" alt="image">â€‹</p><p>â€</p><p>åŒæ—¶è¿˜è¦ä¸ºRoute tableå’ŒSubnetåˆ›å»ºå…³è”</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629095414-dwpb65b.png" alt="image">â€‹</p><p>Terraform code</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Route table &amp; Subnect</span><br><span class="line">resource &quot;aws_route_table_association&quot; &quot;a-rtb-subnet&quot; &#123;</span><br><span class="line">  subnet_id = aws_subnet.myapp-subnet-1.id</span><br><span class="line">  route_table_id = aws_route_table.myapp-route-table.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h2 id="Security-Group-Firewall"><a href="#Security-Group-Firewall" class="headerlink" title="Security Group &amp; Firewall"></a>Security Group &amp; Firewall</h2><p>åˆ›å»ºå®‰å…¨ç»„</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629100936-owifg74.png" alt="image">â€‹</p><p>Terraform code</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># Security Group</span><br><span class="line">resource &quot;aws_security_group&quot; &quot;myapp-sg&quot; &#123;</span><br><span class="line">  name = &quot;myapp-sg&quot;</span><br><span class="line">  vpc_id = aws_vpc.myapp-vpc.id</span><br><span class="line">  </span><br><span class="line">  # Incoming traffic</span><br><span class="line">  ingress = &#123;</span><br><span class="line">    from_port = 22</span><br><span class="line">    to_port = 22</span><br><span class="line">    protocal = &quot;tcp&quot;</span><br><span class="line"></span><br><span class="line">    # IPs allow list</span><br><span class="line">    cidr_block = [&quot;your_allow_ip/32&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  # Outgoing traffic</span><br><span class="line">  egress = &#123;</span><br><span class="line">    # Allowing all port and ip</span><br><span class="line">    from_port = 0</span><br><span class="line">    to_port = 0</span><br><span class="line">    protocal = &quot;-1&quot;</span><br><span class="line">    cidr_block = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">    prefix_list_ids = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name: &quot;$&#123;var.env_prefix&#125;-sg&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œç»“æœ</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629101551-0c9lczq.png" alt="image">â€‹</p><p>â€</p><h2 id="EC2-AMI"><a href="#EC2-AMI" class="headerlink" title="EC2 &amp; AMI"></a>EC2 &amp; AMI</h2><p>Amazon Machine Image(AMI)æ˜¯awsæä¾›çš„æ“ä½œç³»ç»Ÿé•œåƒï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®AMIåˆ›å»ºè‡ªå·±çš„æ“ä½œç³»ç»Ÿå®ä¾‹ã€‚</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629102443-vk9vmei.png" alt="image">â€‹</p><p>â€</p><p>Terraform code</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># AWS AMI data definition</span><br><span class="line">data &quot;aws_ami&quot; &quot;latest_aws-linux-image&quot; &#123;</span><br><span class="line">  # Always get latest image</span><br><span class="line">  most_recent = true</span><br><span class="line"></span><br><span class="line">  owners = [&quot;amazon&quot;]</span><br><span class="line">  </span><br><span class="line">  # filter image name with regrex</span><br><span class="line">  filter &#123;</span><br><span class="line">    name = &quot;name&quot;</span><br><span class="line">    values = [&quot;amzn2-ami-hvm-*-x86_64_gp2&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">  filter &#123;</span><br><span class="line">    name = &quot;virtualization-type&quot;</span><br><span class="line">    values = [&quot;hvm&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Only test for ami id output</span><br><span class="line"># When execute &quot;terraform plan&quot;, can see value from console</span><br><span class="line"># output &quot;name&quot; &#123;</span><br><span class="line">#   value = data.aws_ami.latest_aws-linux-image</span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºaws key pair</span><br><span class="line">resource &quot;aws_key_pair&quot; &quot;ssh-key&quot; &#123;</span><br><span class="line">  key_name = &quot;server-key&quot;</span><br><span class="line"></span><br><span class="line">  # å¼•ç”¨æ–‡ä»¶</span><br><span class="line">  public_key = &quot;$&#123;file(&quot;/User/xxx/.ssh/key_file.pub&quot;)&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ“ä½œç³»ç»Ÿå®ä¾‹ - EC2</span><br><span class="line">resource &quot;aws_instance&quot; &quot;myapp-server&quot; &#123;</span><br><span class="line">  # Id of ami</span><br><span class="line">  ami = data.aws_ami.latest_aws-linux-image.id</span><br><span class="line">  instance_type = &quot;t2.micro&quot;</span><br><span class="line"></span><br><span class="line">  # å¼•ç”¨å·²ç»åˆ›å»ºå¥½çš„VPC &amp; Subnect</span><br><span class="line">  subnet_id = aws_subnet.myapp-subnet-1.id</span><br><span class="line">  vpc_security_group_ids = [aws_default_security_group.default-sg.id]</span><br><span class="line">  availability_zone = var.avail_zone</span><br><span class="line">  associate_public_ip_address = true</span><br><span class="line"></span><br><span class="line">  # Server key pair, permission should be 400</span><br><span class="line">  # AWS will reject ssh request if permission not set correctly</span><br><span class="line">  # It&#x27;s generate from AWS console, provide the key file name</span><br><span class="line">  key_name = aws_key_pair.ssh-key.key_name </span><br><span class="line">  </span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;var.env_prefix&#125;-server&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç­‰å¾…EC2åˆ›å»º</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629145356-5h7sdlf.png" alt="image">â€‹</p><p>â€</p><h3 id="EC2-initialize-script"><a href="#EC2-initialize-script" class="headerlink" title="EC2 initialize script"></a>EC2 initialize script</h3><p>æ·»åŠ  <code>user_data=</code>â€‹ï¼Œè®¾ç½®EC2åˆå§‹åŒ–æ—¶è‡ªåŠ¨è¿è¡Œè„šæœ¬</p><p>ä¸‹å›¾ä¸­çš„ä»£ç å—åªä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«æ‰§è¡Œä¸€æ¬¡</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629152214-ngas3tc.png" alt="image">â€‹</p><p>â€</p><p>å¦‚æœéœ€è¦æ‰§è¡Œå®šä¹‰å¥½çš„è„šæœ¬è€Œä¸æ˜¯ä»£ç å—ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629152738-j165ka4.png" alt="image">â€‹</p><p>â€</p><p><strong>å¦ä¸€ç§æ–¹å¼ï¼šä½¿ç”¨Provisioneræ‰§è¡Œè„šæœ¬</strong></p><p>ä½¿ç”¨<code>remote-exec</code>â€‹åœ¨EC2ä¸Šæ‰§è¡Œè„šæœ¬</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629154524-8ou2ulm.png" alt="image">â€‹</p><p>â€</p><p>å¯ä»¥ä½¿ç”¨<code>local-exec</code>â€‹åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">provisioner &quot;local-exec&quot; &#123;</span><br><span class="line">  command = &quot;echo $&#123;self.public_ip&#125; &gt; output.txt&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>Terraformæ–‡æ¡£ä¸Šè¯´æ˜<code>Provisioners</code>â€‹æ˜¯æ²¡æœ‰å…¶ä»–é€‰æ‹©æ—¶çš„æœ€åæ‰‹æ®µ</p><ul><li>å°½é‡é‡‡ç”¨<code>user_data</code>â€‹è€Œä¸æ˜¯<code>Provisioners</code>â€‹</li><li>å°½é‡ä½¿ç”¨â€local providerâ€å–ä»£<code>local-exec</code>â€‹</li><li>å°½é‡é‡‡ç”¨é…ç½®ç®¡ç†å·¥å…·å–ä»£<code>Provisioners</code>â€‹ï¼Œå¦‚Ansible, Jenkins</li></ul><p>å®é™…ä¸Š<code>Provisioners</code>â€‹æ‰“ç ´äº†Terraformçš„æ¦‚å¿µã€‚Terraformèƒ½é€šè¿‡ç›¸åŒçš„ç»„ä»¶çŠ¶æ€æ€»æ˜¯æä¾›ä¸€è‡´çš„è¿”å›ç»“æœï¼Œä½†æ˜¯<code>Provisioners</code>â€‹æ‰§è¡Œçš„è„šæœ¬å´æ˜¯æœªçŸ¥çš„ï¼ŒTerraformæ— æ³•è·å–åˆ°å…¶ä¸­çš„çŠ¶æ€ã€‚</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629155206-cpb6z6n.png" alt="image">â€‹</p><p>â€</p><p>ä¸€ç§å¯èƒ½çš„æƒ…å†µæ˜¯ï¼ŒProvisionerä¸­çš„è„šæœ¬æ‰§è¡Œé”™è¯¯ï¼Œæ­¤æ—¶terraformä¸ä¼šè¿”å›å…·ä½“çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><p>è¿™ç§çŠ¶æ€ä¸‹æ— æ³•å¾—çŸ¥EC2å…·ä½“æ˜¯å¦è¢«åˆ›å»º</p><p>â€‹<img src="/2024/06/30/AWS-Terraform-Section4-Project/image-20240629160318-0x1irb3.png" alt="image">â€‹</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> AWS Terraform </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS Terraform Section3 - Input and Output</title>
      <link href="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/"/>
      <url>/2024/06/29/AWS-Terraform-Section3-Input-and-Output/</url>
      
        <content type="html"><![CDATA[<p>â€</p><h2 id="Terraform-output"><a href="#Terraform-output" class="headerlink" title="Terraform output"></a>Terraform output</h2><p>ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_subnet&quot; &quot;dev-subnet-1&quot; &#123;</span><br><span class="line">    # æŒ‡å®šsubnetæ‰€å±çš„VPC</span><br><span class="line">    # ç›®å‰VPCè¿˜æ²¡åˆ›å»ºï¼Œæ‰€ä»¥éœ€è¦åŠ¨æ€å¼•ç”¨å®šä¹‰çš„èµ„æº</span><br><span class="line">    vpc_id = aws_pvc.development-vpc.id</span><br><span class="line"></span><br><span class="line">    # å®šä¹‰VPCåœ°å€èŒƒå›´çš„å­é›†</span><br><span class="line">    cidr_block = &quot;10.0.10.0/24&quot;</span><br><span class="line"></span><br><span class="line">    availability_zone = &quot;eu-west-3a&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">output &quot;dev-subnet-id&quot; &#123;</span><br><span class="line">    value = aws_subnet.dev-subnet-1.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform plan</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºäº†<code>output</code>â€‹ä¸­å®šä¹‰çš„å€¼</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627085444-muswq4x.png" alt="image">â€‹</p><p>â€</p><p>*å¯ä»¥ä½¿ç”¨vscodeç¼–å†™Terraform codeï¼Œè¯¥å·¥å…·æ”¯æŒæ‰“å¼€ç»ˆç«¯</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240629162626-a5xvcbc.png" alt="image">â€‹</p><p>â€</p><h2 id="Terraform-input"><a href="#Terraform-input" class="headerlink" title="Terraform input"></a>Terraform input</h2><p>åœ¨Terraformä¸­å¼•ç”¨å˜é‡</p><ul><li>é€šè¿‡<code>default</code>â€‹ç»™å®šé»˜è®¤å€¼</li><li>é€šè¿‡<code>type</code>â€‹è®¾ç½®å˜é‡ç±»å‹ï¼Œå¦‚list(string), string, objectç­‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;subnet_cidr_block&quot; &#123;</span><br><span class="line">    description = &quot;subnet cidr block&quot;</span><br><span class="line">default=&quot;10.0.10.0/24&quot;</span><br><span class="line">type = string</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">resource &quot;aws_subnet&quot; &quot;dev-subnet-1&quot; &#123;</span><br><span class="line">    vpc_id = aws_pvc.development-vpc.id</span><br><span class="line">    cidr_block = var.subnet_cidr_block</span><br><span class="line"></span><br><span class="line">    availability_zone = &quot;eu-west-3a&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>Objectç¤ºä¾‹</p><p>terraform.tfvars</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cidr_blocks = [</span><br><span class="line">&#123;cidr_block-=&quot;10.0.0.0/16&quot;, name=&quot;dev-vpc&quot;&#125;, </span><br><span class="line">&#123;cidr_block-=&quot;10.0.0.0/16&quot;, name=&quot;dev-vpc&quot;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>â€</p><p>å˜é‡å®šä¹‰æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;cidr_blocks&quot; &#123;</span><br><span class="line">  type = list(object(&#123;</span><br><span class="line">    cidr_block = string</span><br><span class="line">    name = string</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>å¼•ç”¨æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_pvc&quot; &quot;development-vpc&quot; &#123;</span><br><span class="line"></span><br><span class="line">    cider_block = var.cider_block[0].cider_block</span><br><span class="line">    tags = &#123;</span><br><span class="line">        Name: var.cider_block[0].name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å˜é‡çš„èµ‹å€¼æ–¹å¼"><a href="#å˜é‡çš„èµ‹å€¼æ–¹å¼" class="headerlink" title="å˜é‡çš„èµ‹å€¼æ–¹å¼"></a>å˜é‡çš„èµ‹å€¼æ–¹å¼</h3><h4 id="é€šè¿‡æ§åˆ¶å°è¾“å…¥"><a href="#é€šè¿‡æ§åˆ¶å°è¾“å…¥" class="headerlink" title="é€šè¿‡æ§åˆ¶å°è¾“å…¥"></a>é€šè¿‡æ§åˆ¶å°è¾“å…¥</h4><p>ç›´æ¥æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply</span><br></pre></td></tr></table></figure><p>â€</p><p>ç„¶ååœ¨æ§åˆ¶å°è¾“å…¥å†…å®¹</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627090358-a0f77fr.png" alt="image">â€‹</p><p>â€</p><h4 id="å‘½ä»¤è¡Œä¼ å‚æ•°"><a href="#å‘½ä»¤è¡Œä¼ å‚æ•°" class="headerlink" title="å‘½ä»¤è¡Œä¼ å‚æ•°"></a>å‘½ä»¤è¡Œä¼ å‚æ•°</h4><p>åœ¨æ§åˆ¶å°æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform -var &quot;subnet_cidr_block=10.0.30.0/24&quot;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="ï¼ˆå¸¸ç”¨ï¼‰å®šä¹‰å˜é‡æ–‡ä»¶"><a href="#ï¼ˆå¸¸ç”¨ï¼‰å®šä¹‰å˜é‡æ–‡ä»¶" class="headerlink" title="ï¼ˆå¸¸ç”¨ï¼‰å®šä¹‰å˜é‡æ–‡ä»¶"></a>ï¼ˆå¸¸ç”¨ï¼‰å®šä¹‰å˜é‡æ–‡ä»¶</h4><p>å½“æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply -var-file terraform-dev.tfvars --target=module.xxx</span><br></pre></td></tr></table></figure><p>å˜é‡ä¼ é€’é“¾è·¯å¦‚ä¸‹</p><p>â€‹<code>*.tfvars</code>â€‹ -&gt; variable.tf -&gt; main.tf -&gt; output.tf</p><p>â€</p><p>ä¾‹å¦‚ï¼š</p><p>åˆ›å»ºä¸€ä¸ª<code>*.tfvars</code>â€‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚terraform.tfvars</p><p>Terraformèƒ½è‡ªåŠ¨æ‰¾åˆ°<code>tfvars</code>â€‹å¹¶è¯†åˆ«ä¸ºå˜é‡æ–‡ä»¶</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627091135-d3dfmv2.png" alt="image">â€‹</p><p>â€</p><p>æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply</span><br></pre></td></tr></table></figure><p>â€</p><p>æ­¤æ—¶ä¸éœ€è¦é¢å¤–è¾“å…¥å˜é‡çš„å€¼ï¼ŒTerraformä¼šè‡ªåŠ¨æ‰¾åˆ°å˜é‡å¹¶ä¸”èµ‹å€¼</p><p>â€</p><p>æ¨èæŠŠå˜é‡æ–‡ä»¶æ ¹æ®ç¯å¢ƒæ¥å‘½å</p><p>ä¾‹å¦‚ terraform-dev.tfvars</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627091655-ofb3joh.png" alt="image">â€‹</p><p>æŒ‡å®šå˜é‡æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply -var-file terraform-dev.tfvars</span><br></pre></td></tr></table></figure><p>â€</p><h2 id="AWS-Credential"><a href="#AWS-Credential" class="headerlink" title="AWS Credential"></a>AWS Credential</h2><p>ä¸æ¨èä»¥ä¸‹æ–¹å¼æ˜æ–‡å†™å…¥access key</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">    region = &quot;eu-west-3&quot; # å–å†³äºè´­ä¹°çš„EC2å®ä¾‹æ‰€å±çš„åŒºåŸŸ</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    ä¸æ¨èhardcodeæ˜æ–‡çš„key</span><br><span class="line">    **/</span><br><span class="line">    access_key = &quot;&quot;</span><br><span class="line">    secret_key = &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>1.å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export AWS_SECRET_ACCESS = &quot;XXXX&quot;</span><br><span class="line">export AWS_ACCESS_KEY_ID = &quot;XXXX&quot;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç„¶åç›´æ¥æ‰§è¡Œterraformå‘½ä»¤ï¼Œä¼šè‡ªåŠ¨è¿æ¥åˆ°AWS</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627212211-b63szv1.png" alt="image">â€‹</p><p>â€</p><p>2.åœ¨æ–‡ä»¶ä¸­å­˜å‚¨ä»¥ä¾¿å…¨å±€è°ƒç”¨</p><p>å­˜å‚¨ä½ç½®ï¼š <code>~/.aws/credentials</code>â€‹</p><p>å¯ä»¥ç›´æ¥è¾“å…¥ aws configureè¿›è¡Œé…ç½®ï¼Œè‡ªåŠ¨å­˜å‚¨åˆ° <code>~/.aws/credentials</code>â€‹</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627212506-aehf3ue.png" alt="image">â€‹</p><p>â€</p><p>ä¹Ÿå¯ä»¥è®¾ç½®AWS_DEFAULT_REGIONæŒ‡å®šé»˜è®¤çš„åŒºåŸŸ</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627212919-krbqr1f.png" alt="image">â€‹</p><p>â€</p><p>3.å¯ä»¥é€šè¿‡å®‰è£…adfsç™»å½•AWS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python install adf-assume</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œä»¥ä¸‹è„šæœ¬ä¸€é”®è¿æ¥åˆ°AWS</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">source [python_env]</span><br><span class="line">echo -n &quot;Input AWS password: &quot;</span><br><span class="line">read -s AWS_PASSWORD</span><br><span class="line">export AWS_PROFILE=saml</span><br><span class="line">adfs-assume -u $ACCOUNT --domain=$DOMAIN</span><br></pre></td></tr></table></figure><h2 id="Global-Variable"><a href="#Global-Variable" class="headerlink" title="Global Variable"></a>Global Variable</h2><p>å‘½åè§„åˆ™å¿…é¡»ä¸ºï¼š<code>TF_VAR_xxx</code>â€‹</p><p>â€</p><p>ä¾‹å¦‚ï¼Œéœ€è¦å¼•ç”¨æ“ä½œç³»ç»Ÿå½“å‰ç¯å¢ƒä¸‹çš„æŸä¸ªå˜é‡</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627213207-7vyobna.png" alt="image">â€‹</p><p>åœ¨Terraformä¸­å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">variable avail_zone &#123;&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">resource &quot;aws_subnet&quot; &quot;dev-subnet-1&quot; &#123;</span><br><span class="line">  availability_zone = var.avail_zone</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œç»“æœ</p><p>å¯ä»¥çœ‹åˆ°è‡ªåŠ¨è¯†åˆ«åˆ°äº†å˜é‡ avail_zone è‡ªåŠ¨åŒ¹é…åˆ°äº† TF_VAR_avail_zone</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240627213338-wu1puwy.png" alt="image">â€‹</p><p>â€</p><h2 id="Terraform-Module"><a href="#Terraform-Module" class="headerlink" title="Terraform Module"></a>Terraform Module</h2><p>é€šè¿‡æ¨¡å—çš„æ–¹å¼ç¼–å†™ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰çš„ä»£ç éƒ½æ”¾åœ¨åŒä¸€ä¸ª<code>tf</code>â€‹æ–‡ä»¶ä¸­</p><p>ä¸€ä¸ªmoduleåº”è¯¥å°†å¤šä¸ªresourceæ•´åˆèµ·æ¥ï¼Œæ–¹ä¾¿ç›¸åŒçš„ç»„ä»¶é‡ç”¨</p><p>ä¾‹å¦‚VPCã€Subnetã€Route tableã€Internate gatewayéƒ½åº”è¯¥æ”¾åˆ°åŒä¸€ä¸ªmoduleä¸­ï¼Œæ–¹ä¾¿åˆ›å»ºEC2æ—¶ç›´æ¥è°ƒç”¨</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240629160704-lusjo4f.png" alt="image">â€‹</p><p>â€</p><p>åŒæ—¶Terraformä¹Ÿæœ‰ä¸€äº›ç°æˆçš„moduleæ–¹ä¾¿å‚è€ƒï¼Œä¸éœ€è¦é‡å¤åˆ›é€ åŠŸèƒ½ç›¸åŒçš„æ¨¡å—</p><p><a href="https://registry.terraform.io/browse/modules">https://registry.terraform.io/browse/modules</a></p><p>â€</p><h2 id="Terraform-state"><a href="#Terraform-state" class="headerlink" title="Terraform state"></a>Terraform state</h2><p>Terraform planä¼šæ ¹æ®stateæ–‡ä»¶ç”Ÿæˆæ‰§è¡Œè®¡åˆ’</p><p>æœ€å¥½æŠŠ<code>tfstate</code>â€‹å­˜æ”¾èµ·æ¥è¿œç¨‹è®¿é—®ï¼Œç¡®ä¿Jenkinså’Œå›¢é˜Ÿæˆå‘˜æœ¬åœ°æ‰§è¡Œéƒ½èƒ½è¯»å–åˆ°æœ€æ–°çš„çŠ¶æ€</p><p>AWSå¯ä»¥ä½¿ç”¨S3å­˜å‚¨</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240629165547-mwpen00.png" alt="image">â€‹</p><p>â€</p><p>ä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºS3</span><br><span class="line">terraform &#123;</span><br><span class="line">  required_version = &quot;&gt;=0.12&quot;</span><br><span class="line">  backend &quot;s3&quot; &#123;</span><br><span class="line">    bucket = &quot;myapp-bucket&quot;</span><br><span class="line">    key = &quot;myapp/state.tfstate&quot;</span><br><span class="line">    region = &quot;eu-west-3&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šè¯¢é—®æ˜¯å¦æŠŠçŠ¶æ€å­˜å‚¨åˆ°S3<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240629170359-36haj4u.png" alt="image">â€‹</p><p>â€</p><p>æ­¤æ—¶stateæ–‡ä»¶å°†äº¤ç»™AWSæ§åˆ¶ï¼ŒJenkinså’Œå¼€å‘äººå‘˜æœ¬åœ°ä¼šè‡ªåŠ¨ä½¿ç”¨S3çš„stateæ–‡ä»¶</p><p>â€‹<img src="/2024/06/29/AWS-Terraform-Section3-Input-and-Output/image-20240629170604-2elttg6.png" alt="image">â€‹</p><p>â€</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤éªŒè¯ï¼Œä¸åŒçš„ç¯å¢ƒæ‰§è¡Œåº”è¯¥å¾—åˆ°ç›¸åŒçš„ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform state list</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> AWS Terraform </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS Terraform Section2 - VPC</title>
      <link href="/2024/06/23/AWS-Terraform-Section2-VPC/"/>
      <url>/2024/06/23/AWS-Terraform-Section2-VPC/</url>
      
        <content type="html"><![CDATA[<h2 id="VPC-Subnet"><a href="#VPC-Subnet" class="headerlink" title="VPC &amp; Subnet"></a>VPC &amp; Subnet</h2><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621090538-0t4qsb0.png" alt="image">â€‹</p><p>â€</p><p>æ¯å½“ä¸€ä¸ªè´¦æˆ·åœ¨åŒºåŸŸåˆ›å»ºæ—¶ï¼Œéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªAWS VPCï¼ˆVirtual Private Cloudï¼‰</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621090636-8pfda8m.png" alt="image">â€‹</p><p>â€</p><p>è·ŸéšåŒºåŸŸï¼Œè·ŸéšAWSè´¦æˆ·é»˜è®¤åˆ›å»ºï¼Œç”¨äºä¿æŠ¤æ¯ä¸ªè´¦æˆ·çš„ç§æœ‰èµ„æºè®¿é—®æƒé™</p><p>ä¾‹å¦‚ä¸åŒçš„è´¦æˆ·å¯èƒ½åˆ›å»ºåœ¨åŒä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯ä¸åŒçš„è´¦å·é—´çš„èµ„æºè®¿é—®æ˜¯äº’ç›¸éš”ç¦»çš„</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621091018-bj1wwsq.png" alt="image">â€‹</p><p>â€</p><p>æ§åˆ¶å°å¯ä»¥çœ‹åˆ°é»˜è®¤åˆ›å»ºçš„VPC</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621090729-glyury5.png" alt="image">â€‹</p><p>â€</p><p>VPCä»£è¡¨äº†å…¬å¸çš„ç½‘ç»œæ¶æ„ï¼ŒåŒ…æ‹¬ç½‘ç»œé…ç½®ã€è·¯ç”±ã€é˜²ç«å¢™ç­‰</p><p>VPCç”±ä¸åŒçš„<code>Availability Zone</code>â€‹ç»„æˆï¼Œå…·ä½“æŒ‡ä»£å®é™…çš„ç‰©ç†æœåŠ¡å™¨æ‰€åœ¨çš„æ•°æ®ä¸­å¿ƒ</p><p>ä¾‹å¦‚ æˆ‘åœ¨ä¸­å›½åŒºï¼Œå¯èƒ½ä¼šæœ‰åå—ã€åä¸­ã€ååŒ—3ä¸ªæ•°æ®ä¸­å¿ƒéƒ½æœ‰è™šæ‹ŸæœåŠ¡å™¨è¿è¡Œï¼Œé‚£ä¹ˆå°±ä¼šæœ‰3ä¸ª<code>Availability Zone</code>â€‹ï¼Œä¹Ÿå°±ä¼šæœ‰3ä¸ªsubnet</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621091717-r6rsa9e.png" alt="image">â€‹</p><p>â€</p><p>å½“æˆ‘ä»¬éœ€è¦ä»å¤–éƒ¨è®¿é—®èµ„æºæ—¶ï¼Œéœ€è¦é…ç½®ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œå¯ä»¥ä½¿ç”¨<code>Internet Gateway</code>â€‹</p><p>å½“æˆ‘ä»¬éœ€è¦æ§åˆ¶å¤–éƒ¨å¯¹VPCè®¿é—®æƒé™ï¼Œå¯ä»¥é…ç½®é˜²ç«å¢™</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621092301-v45hvvl.png" alt="image">â€‹</p><p>â€</p><h3 id="é…ç½®å¤–éƒ¨è®¿é—®"><a href="#é…ç½®å¤–éƒ¨è®¿é—®" class="headerlink" title="é…ç½®å¤–éƒ¨è®¿é—®"></a>é…ç½®å¤–éƒ¨è®¿é—®</h3><p>è®¾ç½®é˜²ç«å¢™è§„åˆ™å’Œå®‰å…¨ç»„</p><p>VPC -&gt; SECURITY</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240621092558-4chx80a.png" alt="image">â€‹</p><p>â€</p><h2 id="æ·»åŠ VPCèµ„æº"><a href="#æ·»åŠ VPCèµ„æº" class="headerlink" title="æ·»åŠ VPCèµ„æº"></a>æ·»åŠ VPCèµ„æº</h2><p>èµ„æºå‘½åè§„åˆ™:  aws_[resource_name]</p><p>â€</p><p>æ‰€æœ‰çš„è¯­æ³•ç¤ºä¾‹éƒ½èƒ½åœ¨æ–‡æ¡£ä¸­æ‰¾åˆ°</p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc">https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc</a></p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623100755-9y6u10a.png" alt="image">â€‹</p><p>â€</p><p>ä»£ç ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">    region = &quot;eu-west-3&quot; # å–å†³äºè´­ä¹°çš„EC2å®ä¾‹æ‰€å±çš„åŒºåŸŸ</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    ä¸æ¨èhardcodeæ˜æ–‡çš„key</span><br><span class="line">    **/</span><br><span class="line">    access_key = &quot;&quot;</span><br><span class="line">    secret_key = &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># èµ„æºå‘½åè§„åˆ™ - aws_resource</span><br><span class="line"># åˆ›å»ºåä¸º development-vpcçš„VPC</span><br><span class="line">resource &quot;aws_pvc&quot; &quot;development-vpc&quot; &#123;</span><br><span class="line"></span><br><span class="line">    # VPCåœ°å€èŒƒå›´</span><br><span class="line">    cider_block = &quot;10.0.0.0/16&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºåä¸º dev-subnet-1 çš„subnet</span><br><span class="line">resource &quot;aws_subnet&quot; &quot;dev-subnet-1&quot; &#123;</span><br><span class="line">    # æŒ‡å®šsubnetæ‰€å±çš„VPC</span><br><span class="line">    # ç›®å‰VPCè¿˜æ²¡åˆ›å»ºï¼Œæ‰€ä»¥éœ€è¦åŠ¨æ€å¼•ç”¨å®šä¹‰çš„èµ„æº</span><br><span class="line">    vpc_id = aws_pvc.development-vpc.id</span><br><span class="line"></span><br><span class="line">    # å®šä¹‰VPCåœ°å€èŒƒå›´çš„å­é›†</span><br><span class="line">    cidr_block = &quot;10.0.10.0/24&quot;</span><br><span class="line"></span><br><span class="line">    availability_zone = &quot;eu-west-3a&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>é€šè¿‡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åº”ç”¨åˆ°AWS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œå‘½ä»¤ä»¥åå¯ä»¥é¢„è§ˆterraformçš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åè¾“å…¥<code>yes</code>â€‹ç¡®è®¤è¯¥è®¡åˆ’</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623101644-fx9ybbf.png" alt="image">â€‹</p><p>â€</p><h3 id="DataSource"><a href="#DataSource" class="headerlink" title="DataSource"></a>DataSource</h3><p>å‡å¦‚æˆ‘ä»¬éœ€è¦ä»å·²æœ‰çš„VPCä¸­åˆ›å»ºsubnetï¼Œåˆ™éœ€è¦å…ˆæ‹‰å–AWSå·²æœ‰çš„VPCä¿¡æ¯ï¼Œç„¶åå¼•ç”¨å…¶id</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623102401-7sfq2ts.png" alt="image">â€‹</p><p>â€</p><p>ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># æ‹‰å–awsæ•°æ®</span><br><span class="line"># å®šä¹‰å˜é‡åä¸º existing_vpc çš„vpcæ•°æ®æº</span><br><span class="line">data &quot;aws_vpc&quot; &quot;existing_vpc&quot; &#123;</span><br><span class="line"></span><br><span class="line">    # æ‹‰å–é»˜è®¤çš„vpc</span><br><span class="line">    default = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºåä¸º dev-subnet-1 çš„subnet</span><br><span class="line">resource &quot;aws_subnet&quot; &quot;dev-subnet-2&quot; &#123;</span><br><span class="line">    # ä»å·²æœ‰çš„vpcä¸­è·å–id</span><br><span class="line">    vpc_id = data.aws_vpc.existing_vpc.id</span><br><span class="line"></span><br><span class="line">    # å®šä¹‰VPCåœ°å€èŒƒå›´çš„å­é›†</span><br><span class="line">    # ä¸åº”ä¸vpcä¸­çš„å·²æœ‰subnet ipèŒƒå›´é‡å¤</span><br><span class="line">    cidr_block = &quot;172.31.48.0/20&quot;</span><br><span class="line"></span><br><span class="line">    availability_zone = &quot;eu-west-3a&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œ terraform apply</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623103153-6tu25vy.png" alt="image">â€‹</p><p>â€</p><h2 id="ä¿®æ”¹-åˆ é™¤èµ„æº"><a href="#ä¿®æ”¹-åˆ é™¤èµ„æº" class="headerlink" title="ä¿®æ”¹ &amp; åˆ é™¤èµ„æº"></a>ä¿®æ”¹ &amp; åˆ é™¤èµ„æº</h2><p>ç»§ç»­ä»¥AWS VPCä¸ºä¾‹</p><h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><p>ä½¿ç”¨å…³é”®å­—<code>tags</code>â€‹ï¼Œå®ƒå­˜åœ¨äºæ‰€æœ‰çš„èµ„æºä¸­</p><p>ä¾‹å¦‚ï¼ŒæŒ‡å®šVPCåç§°</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623104620-e98o9gy.png" alt="image">â€‹</p><p>åœ¨åº”ç”¨tfæ–‡ä»¶çš„æ—¶å€™ï¼Œ<code>~</code>â€‹ä»£è¡¨èµ„æºä¿®æ”¹ï¼Œ<code>+</code>â€‹ä»£è¡¨æ–°å¢</p><p>å¹¶ä¸”åœ¨æ‰§è¡Œè®¡åˆ’ä¸­æœ‰8ä¸ªå±æ€§ä¿æŒä¸å˜</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623105005-f2r9sza.png" alt="image">â€‹</p><p>â€</p><p>å°†ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºåç§°</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623104640-82dkf08.png" alt="image">â€‹</p><p>â€</p><p>å¦‚æœåˆ é™¤æ‰<code>tags</code>â€‹ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè®¡åˆ’ä¸­ä¼šä»¥<code>-</code>â€‹æ˜¾ç¤º</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623105243-u2uvsfs.png" alt="image">â€‹</p><p>â€</p><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><h4 id="ä¿®æ”¹tf"><a href="#ä¿®æ”¹tf" class="headerlink" title="ä¿®æ”¹tf"></a>ä¿®æ”¹tf</h4><p> *<strong>æ¨èä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œé…ç½®æ–‡ä»¶æ–¹ä¾¿ä»£ç ç®¡ç†</strong></p><p>å¦‚æœæŠŠ<code>*.tf</code>â€‹ä¸­çš„subnetåˆ é™¤ï¼Œæ‰§è¡Œ terraform applyï¼Œåˆ™æ„å‘³ç€åˆ é™¤è¯¥subnet</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623105535-ysouex2.png" alt="image">â€‹</p><p>â€</p><p>æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹</p><p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªèµ„æºéƒ½æ ‡æœ‰<code>-</code>â€‹ï¼Œå› ä¸ºè¿™ä¸ªèµ„æºå³å°†è¢«åˆ é™¤</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623105738-ldw0dxg.png" alt="image">â€‹</p><p>â€</p><h4 id="terraform-destroy"><a href="#terraform-destroy" class="headerlink" title="terraform destroy"></a>terraform destroy</h4><p>æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform destroy -target [resource_type] [resource_name]</span><br></pre></td></tr></table></figure><p>â€</p><p>ä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform destroy -target aws_subnet dev-subnet-2</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œè®¡åˆ’ä¹Ÿæ˜¯ç±»ä¼¼çš„</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623110048-4j3479w.png" alt="image">â€‹</p><p>â€</p><h2 id="å¯¹æ¯”å·®å¼‚"><a href="#å¯¹æ¯”å·®å¼‚" class="headerlink" title="å¯¹æ¯”å·®å¼‚"></a>å¯¹æ¯”å·®å¼‚</h2><p>æ£€æŸ¥awså’Œtfæ–‡ä»¶çš„å·®å¼‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform plan</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623110453-hpt2fxs.png" alt="image">â€‹</p><p>â€</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>provider: ç”¨äºå¯¼å…¥ä¸€ç»„æˆ–ä¸€æ®µä»£ç ï¼Œç±»ä¼¼import library</li><li>resource: ç±»ä¼¼äºä»åº“ä¸­è°ƒç”¨ä¸€æ®µå‡½æ•°</li><li>data: ç±»ä¼¼äºè¿”å›å·²ç»å­˜åœ¨çš„èµ„æºçš„å‡½æ•°</li></ul><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623103603-vixezkm.png" alt="image">â€‹</p><p>â€</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ç”¨æˆ·å¿…é¡»å…·æœ‰åˆ›å»ºèµ„æºæ‰€å¿…é¡»çš„æƒé™<img src="/2024/06/23/AWS-Terraform-Section2-VPC/image-20240623103705-nm2hmts.png" alt="image">â€‹</p><p>â€</p><p>å¦å¤–ï¼Œterraformåœ¨applyç›¸åŒçš„tfæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€</p><p>å¦‚æœç»„ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™terraformä¸ä¼šå†æ‰§è¡Œæ“ä½œ</p><p>ä¹Ÿå°±æ˜¯è¯´æ¯å½“åº”ç”¨ç›¸åŒçš„é…ç½®æ—¶ï¼Œæ€»ä¼šå¾—åˆ°ä¸€æ ·çš„ç»“æœã€‚ç”¨æˆ·ä¸éœ€è¦è®°ä½å½“å‰ç»„ä»¶çš„çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šæ„å¤–åœ°ç ´åæŸäº›åŸæœ‰çš„ç»„ä»¶ã€‚</p><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> AWS Terraform </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS Terraform Section1 - ç®€ä»‹</title>
      <link href="/2024/06/23/AWS-Terraform-Section1/"/>
      <url>/2024/06/23/AWS-Terraform-Section1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å®˜ç½‘ <a href="https://developer.hashicorp.com/terraform/intro">https://developer.hashicorp.com/terraform/intro</a></p><p>Infrastructure as Code tool.</p><p>Terraformæœ¬è´¨ä¸Šæ˜¯é€šè¿‡è°ƒç”¨APIå®ç°å¯¹å„ç§æœåŠ¡å™¨èµ„æºçš„CRUDæ“ä½œã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621083744-cph8xt3.png" alt="image">â€‹</p><p>Terraformä¸»è¦æ˜¯ç”¨äºæ¶æ„çš„ç¼–æ’ï¼Œè­¬å¦‚åˆ›å»ºEC2ï¼Œè®¾ç½®VPCï¼Œå®‰è£…dockerç­‰ï¼Œè€Œä¸”å…¶ä¸­çš„é¡ºåºå¿…é¡»è¦éµå¾ªä¸€å®šçš„é¡ºåºã€‚</p><p>å¦ä¸€ä¸ªIaCå·¥å…·æ˜¯Ansibleã€‚Ansibleå¯ä»¥ç”¨æ¥é…ç½®åŸºç¡€è®¾ç½®ã€éƒ¨ç½²åº”ç”¨ã€å®‰è£…å’Œæ›´æ–°åº”ç”¨ç­‰</p><p>Terraformåˆ›å»ºå¹¶æµ‹è¯•å®Œåï¼Œå¯ä»¥ç²¾ç¡®è‡ªåŠ¨åŒ–åœ°å¤åˆ¶æ›´å¤šçš„ç¯å¢ƒã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617213010-g7rnt9g.png" alt="image">â€‹</p><p>â€<img src="/2024/06/23/AWS-Terraform-Section1/image-20240629153340-5rpwr4n.png" alt="image">â€‹</p><p>â€</p><h2 id="å®‰è£…Terraform"><a href="#å®‰è£…Terraform" class="headerlink" title="å®‰è£…Terraform"></a>å®‰è£…Terraform</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install terraform</span><br></pre></td></tr></table></figure><p>â€</p><p>æŸ¥çœ‹Terraformç‰ˆæœ¬å·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform -v</span><br></pre></td></tr></table></figure><p>â€</p><p>å®‰è£…ç»“æœå¦‚ä¸‹</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617213642-gi9trte.png" alt="image">â€‹</p><p>â€</p><h2 id="åˆå§‹åŒ–AWSç¯å¢ƒ"><a href="#åˆå§‹åŒ–AWSç¯å¢ƒ" class="headerlink" title="åˆå§‹åŒ–AWSç¯å¢ƒ"></a>åˆå§‹åŒ–AWSç¯å¢ƒ</h2><ul><li>è¿æ¥åˆ°AWSè´¦æˆ·</li><li>åˆ›å»ºVPC</li><li>åˆ›å»ºSubnet</li></ul><h3 id="æœ¬åœ°ç¯å¢ƒè®¾ç½®"><a href="#æœ¬åœ°ç¯å¢ƒè®¾ç½®" class="headerlink" title="æœ¬åœ°ç¯å¢ƒè®¾ç½®"></a>æœ¬åœ°ç¯å¢ƒè®¾ç½®</h3><p>åˆ›å»ºåä¸º<code>Terraformed</code>â€‹çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶<code>main.tf</code>â€‹</p><p>â€‹<code>*.tf</code>â€‹æ˜¯Terraformæ–‡ä»¶çš„æ ‡å‡†å‘½åæ–¹å¼</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617214824-h3zyfo9.png" alt="image">â€‹</p><p>â€</p><p>ä½¿ç”¨Visual Studio Codeæ‰“å¼€<code>main.tf</code>â€‹ï¼Œå¹¶ä¸”å®‰è£…Terraformå®˜æ–¹æ’ä»¶ã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617215049-jdiqpkh.png" alt="image">â€‹</p><p>â€</p><p>å®‰è£…å®Œæ’ä»¶ä»¥åå¯ä»¥åœ¨VS Codeä¸­æ›´æ–¹ä¾¿åœ°ç¼–è¾‘Terraformæ–‡ä»¶</p><p>â€</p><h3 id="æ³¨å†ŒAWSäº‘è´¦å·"><a href="#æ³¨å†ŒAWSäº‘è´¦å·" class="headerlink" title="æ³¨å†ŒAWSäº‘è´¦å·"></a>æ³¨å†ŒAWSäº‘è´¦å·</h3><p>æ³¨å†Œå®Œæ¯•åå¯ä»¥å…è´¹ä½¿ç”¨AWSäº‘è®¡ç®—èµ„æº</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617215341-n63hg26.png" alt="image">â€‹</p><p>â€</p><p>æ³¨å†Œå®Œæ¯•åä¼šè‡ªåŠ¨åˆ›å»ºrootç”¨æˆ·ï¼Œæ­¤æ—¶åº”è¯¥é€šè¿‡IAMåˆ›å»ºä¸€ä¸ªæƒé™è¾ƒä½çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶é€šè¿‡ç®¡ç†å‘˜è´¦æˆ·ç®¡ç†æ™®é€šè´¦æˆ·ã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621082633-pze0qoe.png" alt="image">â€‹</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621082734-ltw8n4d.png" alt="image">â€‹</p><p>æ·»åŠ groupæˆ–è€…é€‰æ‹©â€Attach existing policies directlyâ€å‹¾é€‰éœ€è¦èµ‹äºˆçš„æƒé™</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621082909-kl5bllb.png" alt="image">â€‹</p><p>â€</p><h3 id="Terraformè¿æ¥åˆ°AWS"><a href="#Terraformè¿æ¥åˆ°AWS" class="headerlink" title="Terraformè¿æ¥åˆ°AWS"></a>Terraformè¿æ¥åˆ°AWS</h3><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621083520-o2agtmi.png" alt="image">â€‹</p><p>â€</p><p>Providersä½œä¸ºTerraformä¸­æœ€é‡è¦çš„å…³é”®å­—ï¼Œç”¨äºæ ‡è¯†éœ€è¦è°ƒç”¨çš„è¿œç¨‹äº‘æœåŠ¡ä¾›åº”å•†API</p><p>Providersåˆ—è¡¨å¦‚ä¸‹ï¼Œæ”¯æŒè®¸å¤šçš„äº‘æœåŠ¡ä¾›åº”å•†</p><p>æ”¯æŒçš„èµ„æºä¾›åº”å•†åˆ—è¡¨ <a href="https://registry.terraform.io/browse/providers">https://registry.terraform.io/browse/providers</a></p><p>åŒ…æ‹¬äº‘æœåŠ¡ã€Devopså·¥å…·(Ansibleã€Githubã€Grafanaã€Jenkinsã€Kubernetes â€¦)ç­‰</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621084141-ejuxa61.png" alt="image">â€‹</p><p>â€</p><p>é€šè¿‡ä»¥ä¸‹*.tfæ–‡ä»¶ï¼Œå°†ä»¥ç¼–ç¨‹çš„æ–¹å¼è¿æ¥åˆ°AWSæœåŠ¡</p><p>AWSè¯­æ³•å’Œæºç ç¤ºä¾‹</p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest">https://registry.terraform.io/providers/hashicorp/aws/latest</a></p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs">https://registry.terraform.io/providers/hashicorp/aws/latest/docs</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">    region = &quot;eu-west-3&quot; # å–å†³äºè´­ä¹°çš„EC2å®ä¾‹æ‰€å±çš„åŒºåŸŸ</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    ä¸æ¨èhardcodeæ˜æ–‡çš„key</span><br><span class="line">    **/</span><br><span class="line">    access_key = &quot;&quot;</span><br><span class="line">    secret_key = &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>*.tfæ–‡ä»¶æ˜¯ä¸€ä¸ªå®šä¹‰æ–‡ä»¶ï¼Œç¼–å†™å®Œæ¯•åéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ç›¸åº”çš„ä¾èµ–(ç±»ä¼¼npm&#x2F;maven instal)</p><p>è¿›å…¥<code>*.tf</code>â€‹æ‰€åœ¨çš„æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform init</span><br></pre></td></tr></table></figure><p>â€</p><p>è¿è¡Œç»“æœ</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621090125-g8a8waj.png" alt="image">â€‹</p><p>â€</p><p>å¯ä»¥çœ‹åˆ°æ–°æ–‡ä»¶ç”Ÿæˆ</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621090308-ajssusd.png" alt="image">â€‹</p><p>â€</p><h3 id="æŸ¥çœ‹terraformçŠ¶æ€"><a href="#æŸ¥çœ‹terraformçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹terraformçŠ¶æ€"></a>æŸ¥çœ‹terraformçŠ¶æ€</h3><p>æ‰§è¡Œ terraaform stateï¼Œä»¥ç”Ÿæˆ<code>tfstate</code>â€‹æ–‡ä»¶</p><p>è¯¥æ–‡ä»¶å¯ä»¥è®°å½•å½“å‰terraformèµ„æºçš„çŠ¶æ€åˆ—è¡¨</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240627084650-6jzruh4.png" alt="image">â€‹</p><p>â€</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240627084208-hc9n0md.png" alt="image">â€‹</p><p>â€</p><p>terraform stateçš„å­å‘½ä»¤</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240627084312-2xv492o.png" alt="image">â€‹</p><p>â€</p><h2 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å®˜ç½‘ <a href="https://developer.hashicorp.com/terraform/intro">https://developer.hashicorp.com/terraform/intro</a></p><p>Infrastructure as Code tool.</p><p>Terraformæœ¬è´¨ä¸Šæ˜¯é€šè¿‡è°ƒç”¨APIå®ç°å¯¹å„ç§æœåŠ¡å™¨èµ„æºçš„CRUDæ“ä½œã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621083744-cph8xt3.png" alt="image">â€‹</p><p>Terraformä¸»è¦æ˜¯ç”¨äºæ¶æ„çš„ç¼–æ’ï¼Œè­¬å¦‚åˆ›å»ºEC2ï¼Œè®¾ç½®VPCï¼Œå®‰è£…dockerç­‰ï¼Œè€Œä¸”å…¶ä¸­çš„é¡ºåºå¿…é¡»è¦éµå¾ªä¸€å®šçš„é¡ºåºã€‚</p><p>å¦ä¸€ä¸ªIaCå·¥å…·æ˜¯Ansibleã€‚Ansibleå¯ä»¥ç”¨æ¥é…ç½®åŸºç¡€è®¾ç½®ã€éƒ¨ç½²åº”ç”¨ã€å®‰è£…å’Œæ›´æ–°åº”ç”¨ç­‰</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617213010-g7rnt9g.png" alt="image">â€‹</p><p>â€</p><p>Terraformåˆ›å»ºå¹¶æµ‹è¯•å®Œåï¼Œå¯ä»¥ç²¾ç¡®è‡ªåŠ¨åŒ–åœ°å¤åˆ¶æ›´å¤šçš„ç¯å¢ƒã€‚</p><p>â€</p><h2 id="å®‰è£…Terraform-1"><a href="#å®‰è£…Terraform-1" class="headerlink" title="å®‰è£…Terraform"></a>å®‰è£…Terraform</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install terraform</span><br></pre></td></tr></table></figure><p>â€</p><p>æŸ¥çœ‹Terraformç‰ˆæœ¬å·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform -v</span><br></pre></td></tr></table></figure><p>â€</p><p>å®‰è£…ç»“æœå¦‚ä¸‹</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617213642-gi9trte.png" alt="image">â€‹</p><p>â€</p><h2 id="åˆå§‹åŒ–AWSç¯å¢ƒ-1"><a href="#åˆå§‹åŒ–AWSç¯å¢ƒ-1" class="headerlink" title="åˆå§‹åŒ–AWSç¯å¢ƒ"></a>åˆå§‹åŒ–AWSç¯å¢ƒ</h2><ul><li>è¿æ¥åˆ°AWSè´¦æˆ·</li><li>åˆ›å»ºVPC</li><li>åˆ›å»ºSubnet</li></ul><h3 id="æœ¬åœ°ç¯å¢ƒè®¾ç½®-1"><a href="#æœ¬åœ°ç¯å¢ƒè®¾ç½®-1" class="headerlink" title="æœ¬åœ°ç¯å¢ƒè®¾ç½®"></a>æœ¬åœ°ç¯å¢ƒè®¾ç½®</h3><p>åˆ›å»ºåä¸º<code>Terraformed</code>â€‹çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶<code>main.tf</code>â€‹</p><p>â€‹<code>*.tf</code>â€‹æ˜¯Terraformæ–‡ä»¶çš„æ ‡å‡†å‘½åæ–¹å¼</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617214824-h3zyfo9.png" alt="image">â€‹</p><p>â€</p><p>ä½¿ç”¨Visual Studio Codeæ‰“å¼€<code>main.tf</code>â€‹ï¼Œå¹¶ä¸”å®‰è£…Terraformå®˜æ–¹æ’ä»¶ã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617215049-jdiqpkh.png" alt="image">â€‹</p><p>â€</p><p>å®‰è£…å®Œæ’ä»¶ä»¥åå¯ä»¥åœ¨VS Codeä¸­æ›´æ–¹ä¾¿åœ°ç¼–è¾‘Terraformæ–‡ä»¶</p><p>â€</p><h3 id="æ³¨å†ŒAWSäº‘è´¦å·-1"><a href="#æ³¨å†ŒAWSäº‘è´¦å·-1" class="headerlink" title="æ³¨å†ŒAWSäº‘è´¦å·"></a>æ³¨å†ŒAWSäº‘è´¦å·</h3><p>æ³¨å†Œå®Œæ¯•åå¯ä»¥å…è´¹ä½¿ç”¨AWSäº‘è®¡ç®—èµ„æº</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240617215341-n63hg26.png" alt="image">â€‹</p><p>â€</p><p>æ³¨å†Œå®Œæ¯•åä¼šè‡ªåŠ¨åˆ›å»ºrootç”¨æˆ·ï¼Œæ­¤æ—¶åº”è¯¥é€šè¿‡IAMåˆ›å»ºä¸€ä¸ªæƒé™è¾ƒä½çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶é€šè¿‡ç®¡ç†å‘˜è´¦æˆ·ç®¡ç†æ™®é€šè´¦æˆ·ã€‚</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621082633-pze0qoe.png" alt="image">â€‹</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621082734-ltw8n4d.png" alt="image">â€‹</p><p>æ·»åŠ groupæˆ–è€…é€‰æ‹©â€Attach existing policies directlyâ€å‹¾é€‰éœ€è¦èµ‹äºˆçš„æƒé™</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621082909-kl5bllb.png" alt="image">â€‹</p><p>â€</p><h3 id="Terraformè¿æ¥åˆ°AWS-1"><a href="#Terraformè¿æ¥åˆ°AWS-1" class="headerlink" title="Terraformè¿æ¥åˆ°AWS"></a>Terraformè¿æ¥åˆ°AWS</h3><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621083520-o2agtmi.png" alt="image">â€‹</p><p>â€</p><p>Providersä½œä¸ºTerraformä¸­æœ€é‡è¦çš„å…³é”®å­—ï¼Œç”¨äºæ ‡è¯†éœ€è¦è°ƒç”¨çš„è¿œç¨‹äº‘æœåŠ¡ä¾›åº”å•†API</p><p>Providersåˆ—è¡¨å¦‚ä¸‹ï¼Œæ”¯æŒè®¸å¤šçš„äº‘æœåŠ¡ä¾›åº”å•†</p><p>æ”¯æŒçš„èµ„æºä¾›åº”å•†åˆ—è¡¨ <a href="https://registry.terraform.io/browse/providers">https://registry.terraform.io/browse/providers</a></p><p>åŒ…æ‹¬äº‘æœåŠ¡ã€Devopså·¥å…·(Ansibleã€Githubã€Grafanaã€Jenkinsã€Kubernetes â€¦)ç­‰</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621084141-ejuxa61.png" alt="image">â€‹</p><p>â€</p><p>é€šè¿‡ä»¥ä¸‹*.tfæ–‡ä»¶ï¼Œå°†ä»¥ç¼–ç¨‹çš„æ–¹å¼è¿æ¥åˆ°AWSæœåŠ¡</p><p>AWSè¯­æ³•å’Œæºç ç¤ºä¾‹</p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest">https://registry.terraform.io/providers/hashicorp/aws/latest</a></p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs">https://registry.terraform.io/providers/hashicorp/aws/latest/docs</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">    region = &quot;eu-west-3&quot; # å–å†³äºè´­ä¹°çš„EC2å®ä¾‹æ‰€å±çš„åŒºåŸŸ</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    ä¸æ¨èhardcodeæ˜æ–‡çš„key</span><br><span class="line">    **/</span><br><span class="line">    access_key = &quot;&quot;</span><br><span class="line">    secret_key = &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>*.tfæ–‡ä»¶æ˜¯ä¸€ä¸ªå®šä¹‰æ–‡ä»¶ï¼Œç¼–å†™å®Œæ¯•åéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ç›¸åº”çš„ä¾èµ–(ç±»ä¼¼npm&#x2F;maven instal)</p><p>è¿›å…¥<code>*.tf</code>â€‹æ‰€åœ¨çš„æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform init</span><br></pre></td></tr></table></figure><p>â€</p><p>è¿è¡Œç»“æœ</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621090125-g8a8waj.png" alt="image">â€‹</p><p>â€</p><p>å¯ä»¥çœ‹åˆ°æ–°æ–‡ä»¶ç”Ÿæˆ</p><p>â€‹<img src="/2024/06/23/AWS-Terraform-Section1/image-20240621090308-ajssusd.png" alt="image">â€‹</p><p>â€</p><h2 id="Terraformå¸¸ç”¨å‘½ä»¤"><a href="#Terraformå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Terraformå¸¸ç”¨å‘½ä»¤"></a>Terraformå¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">terraform init       # åˆå§‹åŒ–terraformæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">terraform plan       # æ¯”å¯¹å½“å‰ç¯å¢ƒä¸tfæ–‡ä»¶çš„å·®å¼‚</span><br><span class="line"></span><br><span class="line">terraform apply      # å°†tfæ–‡ä»¶çš„è®¾ç½®åº”ç”¨åˆ°aws</span><br><span class="line"></span><br><span class="line">terraform destroy -target [resource_type] [resource_name]  # åˆ é™¤èµ„æº </span><br><span class="line"></span><br><span class="line">terraform apply -auto-approve  # æ— éœ€äºŒæ¬¡ç¡®è®¤ï¼Œç«‹å³åº”ç”¨tfé…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">terraform destroy    # åˆ é™¤å…¨éƒ¨åŸºç¡€è®¾æ–½</span><br><span class="line"></span><br><span class="line">terraform state      # ç”ŸæˆterraformçŠ¶æ€æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">terraform state list # tfstate æ˜¾ç¤ºæ–‡ä»¶ä¸­æ‰€æœ‰ç»„ä»¶</span><br><span class="line"></span><br><span class="line">terraform state show [ç»„ä»¶å]  # æ˜¾ç¤ºtfstateæ–‡ä»¶ä¸­æŸä¸ªç»„ä»¶çš„terraformå®Œæ•´è¯­æ³•</span><br><span class="line"></span><br><span class="line">terraform version    # æ˜¾ç¤ºterraformç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">terraform fmt        # æ ¼å¼åŒ–tfæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">terraform validate   # éªŒè¯terraformæ–‡ä»¶æ˜¯å¦æ­£ç¡®</span><br><span class="line"></span><br><span class="line">terraform show       # æŸ¥çœ‹terraformçŠ¶æ€</span><br><span class="line"></span><br><span class="line">terraform workspace  # ç®¡ç†terraformå·¥ä½œç©ºé—´</span><br><span class="line"></span><br><span class="line">terraform get        # ä¸‹è½½ &amp; å®‰è£…(æˆ–å‡çº§)æ¨¡å—</span><br><span class="line"></span><br><span class="line">terraform import     # å¯¼å…¥æ¨¡å—</span><br></pre></td></tr></table></figure><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> AWS Terraform </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DRF Django å­¦ä¹ ç¬”è®°</title>
      <link href="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•é¡¹ç›®"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•é¡¹ç›®" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•é¡¹ç›®"></a>åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•é¡¹ç›®</h2><p>å®‰è£…djanago</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Django==<span class="number">4.2</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p>â€</p><p>åˆ›å»ºé¡¹ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject [project_name]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é¡¹ç›®å·²ç»åˆ›å»º</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520212137-og7cyxd.png" alt="image">â€‹</p><p>â€</p><p>ç„¶ååœ¨pycharmæ‰“å¼€é¡¹ç›®</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520212307-dqj5svv.png" alt="image">â€‹</p><p>â€</p><p>é¡¹ç›®åŸºæœ¬ç»“æ„</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520212403-15sh3or.png" alt="image">â€‹</p><ul><li>wsgi.py - é…ç½®WSGIå…¼å®¹çš„WebæœåŠ¡ç«™ç‚¹</li><li>asgi.py - é…ç½®ASGIå…¼å®¹çš„WebæœåŠ¡ç«™ç‚¹</li><li>urls.py - é…ç½®ç«™ç‚¹è½¬å‘çš„è·¯å¾„</li><li>settings.py - Djangoé¡¹ç›®çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆé‡è¦ï¼‰</li></ul><p>â€</p><p>æ·»åŠ é¡¹ç›®æ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp [module_app]</span><br></pre></td></tr></table></figure><p>â€</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç¬¬ä¸€ä¸ªæ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp first_module</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæ¨¡å—å·²ç»åˆ›å»ºæˆåŠŸ</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520212725-g8y3rur.png" alt="image">â€‹</p><p>â€</p><p>æ·»åŠ åˆ°settings.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240524211817-438xeg9.png" alt="image">â€‹</p><p>â€</p><p>æ¨¡å—æ–‡ä»¶ç»“æ„</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520213459-e7qzjk5.png" alt="image">â€‹</p><ul><li>views.py - è§†å›¾å±‚ï¼Œç›¸å½“äºWebå¼€å‘ä¸­çš„Controllerã€‚ç”¨äºæ‹¦æˆªè¯·æ±‚ï¼Œè¿›è¡Œé€»è¾‘å¤„ç†å¹¶è¿”å›æ•°æ®</li><li>tests.py - ç”¨äºç¼–å†™æµ‹è¯•ç”¨ä¾‹</li><li>models.py - æ¨¡å‹å±‚ï¼Œç”¨äºå­˜æ”¾ä¸æ•°æ®åº“å®ä½“ç›¸å¯¹åº”çš„model</li><li>apps.py -</li><li>admin.py - ä¸€èˆ¬ä¸ç”¨</li></ul><p>â€</p><p>è¿è¡Œé¡¹ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver [port]</span><br></pre></td></tr></table></figure><p>â€</p><p>ä½¿ç”¨7000ç«¯å£å¯åŠ¨é¡¹ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver <span class="number">7000</span></span><br></pre></td></tr></table></figure><p>â€</p><p>æ§åˆ¶å°</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520214939-lfnc7qk.png" alt="image">â€‹</p><p>â€</p><p>è¾“å…¥URLè®¿é—® <a href="http://127.0.0.1:7000/">http://127.0.0.1:7000/</a></p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240520215022-tmwz4k0.png" alt="image">â€‹</p><p>â€</p><p>â€</p><h2 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h2><p>è¿æ¥MySQL</p><p>å…ˆå®‰è£…mysqlå®¢æˆ·ç«¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install mysqlclient</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯åŠ¨dockeræ•°æ®åº“</p><p>é€šè¿‡UIå¯åŠ¨</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240524210048-lomz4iw.png" alt="image">â€‹</p><p>æˆ–é€šè¿‡å‘½ä»¤å¯åŠ¨</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240524210149-3nlah8m.png" alt="image">â€‹</p><p>â€</p><p>settings.pyæ·»åŠ æ•°æ®åº“ä¿¡æ¯</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240525103915-lf2t7a9.png" alt="image">â€‹</p><p>å¦‚æœèƒ½æ­£å¸¸å¯åŠ¨åˆ™è¯´æ˜é…ç½®æˆåŠŸ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py runserver <span class="number">8000</span></span><br></pre></td></tr></table></figure><p>â€</p><h2 id="DRFå®ç°ç™»å½•åŠŸèƒ½"><a href="#DRFå®ç°ç™»å½•åŠŸèƒ½" class="headerlink" title="DRFå®ç°ç™»å½•åŠŸèƒ½"></a>DRFå®ç°ç™»å½•åŠŸèƒ½</h2><h3 id="DRFæ¦‚è¿°"><a href="#DRFæ¦‚è¿°" class="headerlink" title="DRFæ¦‚è¿°"></a>DRFæ¦‚è¿°</h3><p>DRF(Django rest framework) åŸºäºDjangoçš„å°è£…ï¼Œæ˜¯Restfulé£æ ¼çš„å¼€å‘æ¡†æ¶</p><p>å®˜æ–¹ç½‘ç«™ <a href="https://www.django-rest-framework.org/">https://www.django-rest-framework.org</a></p><p>â€</p><p>å®‰è£…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install djangorestframework</span><br></pre></td></tr></table></figure><p>â€</p><p>æ·»åŠ åˆ°settings.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240524211854-v56ns98.png" alt="image">â€‹</p><p>â€</p><h3 id="åˆ›å»ºuserå’Œitemæ¨¡å—"><a href="#åˆ›å»ºuserå’Œitemæ¨¡å—" class="headerlink" title="åˆ›å»ºuserå’Œitemæ¨¡å—"></a>åˆ›å»ºuserå’Œitemæ¨¡å—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp user</span><br><span class="line">python manage.py startapp item</span><br></pre></td></tr></table></figure><p>â€</p><p>æ·»åŠ åˆ°settings.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240525110511-tt1031h.png" alt="image">â€‹</p><p>â€</p><h3 id="æ•°æ®è¡¨è®¾è®¡"><a href="#æ•°æ®è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®è¡¨è®¾è®¡"></a>æ•°æ®è¡¨è®¾è®¡</h3><p>Userè¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(models.Model):</span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>, null=<span class="literal">False</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    user_name = models.CharField(null=<span class="literal">False</span>, max_length=<span class="number">255</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    is_delete = models.IntegerField()</span><br><span class="line">    password = models.CharField(null=<span class="literal">False</span>, max_length=<span class="number">255</span>, unique=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&quot;user_tbl&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>Itemè¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table `item_tbl`(</span><br><span class="line">  `<span class="built_in">id</span>` <span class="built_in">int</span> NOT NULL AUTO_INCREMENT,</span><br><span class="line">`name` varchar(<span class="number">255</span>) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span class="line">`price` <span class="built_in">int</span> NULL DEFAULT NULL,</span><br><span class="line">`vendor_id` <span class="built_in">int</span> NULL DEFAULT NULL,</span><br><span class="line">PRIMARY KEY (`<span class="built_in">id</span>`) USING BTREE</span><br><span class="line">)ENGINE = InnoDB AUTO_INCREMENT = <span class="number">4894</span> CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;</span><br></pre></td></tr></table></figure><p>â€</p><p><strong>Userè¡¨ - æ ¹æ®classè‡ªåŠ¨åœ¨mysql dbåˆ›å»º</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><p>â€</p><p>æ•°æ®è¡¨å·²ç»åˆ›å»º</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240525110258-ot38hp7.png" alt="image">â€‹</p><p>â€</p><p><strong>Itemè¡¨ - åœ¨æ•°æ®åº“åˆ›å»ºè¡¨ï¼Œå¹¶è‡ªåŠ¨åœ¨é¡¹ç›®é‡Œç”Ÿæˆå¯¹åº”çš„model class</strong></p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240525111124-9q3y8t1.png" alt="image">â€‹</p><p>â€</p><p>è¿è¡Œå‘½ä»¤ç”Ÿæˆclass</p><ul><li>å¦‚æœéœ€è¦è¿½åŠ åˆ™æŠŠ<code>&gt;</code>â€‹æ›¿æ¢ä¸º<code>&gt;&gt;</code>â€‹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb --database default item_tbl &gt; item/models.py</span><br></pre></td></tr></table></figure><p>â€</p><p>å¯¹åº”çš„classè‡ªåŠ¨ç”Ÿæˆ</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240525111655-kg6g4qh.png" alt="image">â€‹</p><p>â€</p><p>åœ¨user_tblæ’å…¥ä¸€æ¡è®°å½•ä½œä¸ºç¬¬ä¸€ä¸ªç”¨æˆ·</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> user_tbl(user_name, is_delete, password) <span class="keyword">VALUES</span>(<span class="string">&#x27;test1&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å‰ç«¯UIå‡†å¤‡"><a href="#å‰ç«¯UIå‡†å¤‡" class="headerlink" title="å‰ç«¯UIå‡†å¤‡"></a>å‰ç«¯UIå‡†å¤‡</h3><p>å‰åç«¯åˆ†ç¦»ï¼Œä½¿ç”¨Vue + axios + Bootstrapå¿«é€Ÿå¼€å‘</p><p>UI source code <a href="https://github.com/nauvalazhar/bootstrap-4-login-page">https://github.com/nauvalazhar/bootstrap-4-login-page</a></p><p>index.htmlå¼•å…¥vueå’Œaxios</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@3.4.21&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€</p><p>ä¿®æ”¹djangoä¸»é¡µ</p><p>settings.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165314-j1pafek.png" alt="image">â€‹</p><p>â€</p><p>æ·»åŠ è·¯ç”±å’Œcontroller</p><p>urls.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165237-mww0vfw.png" alt="image">â€‹</p><p>views.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165219-ej1ga44.png" alt="image">â€‹</p><p>â€</p><p>å¯åŠ¨æ•ˆæœ</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531151106-gh93lfl.png" alt="image">â€‹</p><p>â€</p><h3 id="æ·»åŠ åç«¯æ•°æ®æŸ¥è¯¢æ¥å£"><a href="#æ·»åŠ åç«¯æ•°æ®æŸ¥è¯¢æ¥å£" class="headerlink" title="æ·»åŠ åç«¯æ•°æ®æŸ¥è¯¢æ¥å£"></a>æ·»åŠ åç«¯æ•°æ®æŸ¥è¯¢æ¥å£</h3><p>ç›®çš„ï¼šè¿æ¥åˆ°æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·è¡¨ï¼Œå¹¶ä¸”æ ¡éªŒç”¨æˆ·å¯†ç </p><p>é¡¹ç›®å…¥å£æ–‡ä»¶urls.pyæ·»åŠ userè·¯ç”±</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531152238-c1ml76q.png" alt="image">â€‹</p><p>â€</p><p>Useræ¨¡å—ä¸‹æ·»åŠ åºåˆ—åŒ–å™¨</p><p>*æ–‡ä»¶åå¿…é¡»ä¸º<code>serializers.py</code>â€‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from user.models import User</span><br><span class="line">from rest_framework import serializers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model = User</span><br><span class="line">        fields = &quot;__all__&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>Useræ¨¡å—ä¸‹views.pyæ·»åŠ æ§åˆ¶å™¨é€»è¾‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">from rest_framework.generics import GenericAPIView</span><br><span class="line">from rest_framework.mixins import CreateModelMixin, RetrieveModelMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from user.models import User</span><br><span class="line">from user.serializers import UserSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">def home_page(request):</span><br><span class="line">    return render(request, &quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># User controller</span><br><span class="line"># post   - å¯¹åº”dbæ“ä½œinsert</span><br><span class="line"># get    - query by id</span><br><span class="line"># put    - update by id</span><br><span class="line"># delete - delete by id</span><br><span class="line">class UserMixinAPIView(GenericAPIView,</span><br><span class="line">                        CreateModelMixin,</span><br><span class="line">                        RetrieveModelMixin):</span><br><span class="line"></span><br><span class="line">    queryset = User.objects</span><br><span class="line">    serializer_class = UserSerializer</span><br><span class="line"></span><br><span class="line">    # æ·»åŠ ç”¨æˆ·</span><br><span class="line">    # æ·»åŠ useræ–¹æ³•æµ‹è¯•</span><br><span class="line">    def post(self, request):</span><br><span class="line">        return self.create(request)</span><br><span class="line"></span><br><span class="line">    # æŸ¥è¯¢ç”¨æˆ·</span><br><span class="line">    def get(self, request, pk):</span><br><span class="line">        return self.retrieve(request, pk)</span><br></pre></td></tr></table></figure><p>â€</p><p>Useræ¨¡å—ä¸‹urls.pyæ·»åŠ è·¯ç”±æ‹¦æˆªè§„åˆ™</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165409-zoibwhs.png" alt="image">â€‹</p><p>â€</p><p>é€šè¿‡postmanæµ‹è¯•getæ¥å£, user idä¸º1</p><p>å¯ä»¥çœ‹åˆ°æ­£å¸¸è¿”å›äº†dbé‡Œçš„ç”¨æˆ·ä¿¡æ¯</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531160648-oo4nkj6.png" alt="image">â€‹</p><p>â€</p><p>ç›®å‰å¯ä»¥çœ‹åˆ°è®¿é—®apiè¿”å›çš„æ˜¯Jsonæ•°æ®ï¼Œè€Œä¸æ˜¯çŠ¶æ€ç </p><p>éœ€è¦æ·»åŠ ä¸€ä¸ªå·¥å…·ç±»ï¼Œå¹¶ä¸”å°†è¿”å›ç»“æœè¿›è¡Œå°è£…</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165446-ta1euqw.png" alt="image">â€‹</p><p>ä¿®æ”¹user&#x2F;views.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165622-705tdqv.png" alt="image">â€‹</p><p>â€</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531165536-de2orro.png" alt="image">â€‹</p><h3 id="ç™»å½•æ”¹é€ "><a href="#ç™»å½•æ”¹é€ " class="headerlink" title="ç™»å½•æ”¹é€ "></a>ç™»å½•æ”¹é€ </h3><p>ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¸ä¼šç”¨user_idè¿›è¡Œç™»å½•ï¼Œè€Œæ˜¯ä½¿ç”¨è´¦å·å’Œå¯†ç </p><p>views.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531172411-rt9ehxp.png" alt="image">â€‹</p><ul><li><p>è¿™é‡Œå¼•å…¥äº†<code>ViewSetMixin</code>â€‹ï¼Œç”¨äºåŒºåˆ†ä¸¤ä¸ªgetè¯·æ±‚</p><ul><li><a href="http://127.0.0.1:8000/user/">http://127.0.0.1:8000/user/</a> -&gt; è½¬å‘åˆ°<code>login</code>â€‹æ–¹æ³•, åŒæ—¶ä¼šå‘é€ä¸€ä¸ªrequest body</li><li><a href="http://127.0.0.1:8000/user/1-%3E">http://127.0.0.1:8000/user/1-&gt;</a> è½¬å‘åˆ°<code>get</code>â€‹æ–¹æ³•ï¼Œå‚æ•°åªæœ‰ä¸€ä¸ªidï¼Œæ²¡æœ‰request body</li></ul></li></ul><p>â€</p><p>urls.pyä¹Ÿè¦åšç›¸åº”çš„æ”¹åŠ¨</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616105216-aghtber.png" alt="image">â€‹</p><p>å¯ä»¥çœ‹åˆ°åŒä¸€ä¸ªget urlå¯ä»¥å…¼å®¹ä¸åŒçš„è¾“å…¥å‚æ•°</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240531172635-ki0kfir.png" alt="image">â€‹</p><p>â€</p><p>æ·»åŠ å‰ç«¯è¿”å›ç»“æœ</p><p>é€šè¿‡@clickç»‘å®šç‚¹å‡»äº‹ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@3.4.21&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// Method will be executed when the page initialize</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// For testing</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// this.loginTest();</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// Mount your method to DOM element</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// Static method</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">loginTest</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">alert</span>(<span class="string">&quot;Test vue.&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">userLogin</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> accountName = $(<span class="string">&#x27;#account-name&#x27;</span>).<span class="title function_">val</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> accountPwd = $(<span class="string">&#x27;#account-password&#x27;</span>).<span class="title function_">val</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> userLoginInfo = &#123;&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">userLoginInfo.<span class="property">accountName</span> = accountName;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">userLoginInfo.<span class="property">accountPwd</span> = accountPwd;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">axios.<span class="title function_">post</span>(<span class="string">&#x27;/user/&#x27;</span>, userLoginInfo)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// debugger;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// TODO ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">alert</span>(<span class="string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">alert</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">app.<span class="title function_">mount</span>(<span class="string">&#x27;#loginApp&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>â€</p><h2 id="JWTè®¤è¯"><a href="#JWTè®¤è¯" class="headerlink" title="JWTè®¤è¯"></a>JWTè®¤è¯</h2><p>Web appçš„ä¼šè¯æ§åˆ¶</p><ul><li>Cookie  -&gt; å­˜å‚¨åœ¨æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šçš„å°æ–‡ä»¶ï¼Œç”¨äºä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„key-valueæ–‡ä»¶</li><li>Session -&gt; å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç”¨äºä¿å­˜ç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·è¿‡å¤šä¼šå¯¼è‡´å ç”¨çš„å†…å­˜è¿‡å¤§</li><li>Token    -&gt; ç”¨æˆ·è®¿é—®APIèµ„æºæ‰€éœ€çš„å‡­è¯ï¼Œä¸€èˆ¬ç”±èº«ä»½æ ‡è¯†ã€æ—¶é—´æˆ³ã€ç”¨æˆ·å¿…è¦ä¿¡æ¯ç­‰å†…å®¹ç»„æˆï¼Œæ˜¯ä¸€ä¸²åŠ å¯†çš„å­—ç¬¦ä¸²</li></ul><p>â€</p><p>å“åº”æµç¨‹</p><p>â€</p><p>JWTï¼šJson web token</p><p>å®˜ç½‘ï¼š<a href="https://jwt.io/">https://jwt.io</a></p><p>JWTæ ¼å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>.</code>â€‹è¿æ¥æˆçš„ä¸‰æ®µå­—ç¬¦ä¸²</p><p>JWTç»„æˆ</p><ul><li>ç¬¬ä¸€æ®µï¼šheaderï¼ŒæŒ‡å¤´ä¿¡æ¯åŒ…å«ç®—æ³•ï¼Œå­—ç¬¦ä¸²æ˜¯ç”±å¤´ä¿¡æ¯è¿›è¡Œbase64åŠ å¯†</li><li>ç¬¬äºŒæ®µï¼špayloadï¼ŒæŒ‡ç³»ç»Ÿè‡ªå®šä¹‰å­˜å‚¨çš„ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åã€è¿‡æœŸæ—¶é—´ç­‰ï¼Œå¹¶è¿›è¡Œbase64åŠ å¯†</li><li>ç¬¬ä¸‰æ®µï¼šverify signatureï¼ŒæŒ‡éœ€è¦ç³»ç»Ÿå®šä¹‰ â€œsaltâ€ï¼Œæˆ–è€…ç§°ä¸ºå¯†é’¥</li></ul><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20231123211650-59w49ap.png" alt="image">â€‹</p><p>â€</p><p>JWTæœåŠ¡ç«¯è§£å¯†</p><p>è·å–tokenï¼Œä¾‹å¦‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.GET.get(<span class="string">&quot;token&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡<code>.</code>â€‹æŠŠå­—ç¬¦ä¸²åˆ†å‰²æˆä¸‰ä¸ªéƒ¨åˆ†</p><ul><li>ç¬¬ä¸€æ­¥ï¼šç”¨base64è§£å¯†å¾—åˆ°<code>header</code>â€‹å¤´éƒ¨ä¿¡æ¯</li><li>ç¬¬äºŒæ­¥ï¼šç”¨base64è§£å¯†å¾—åˆ°ç³»ç»Ÿä¸­çš„<code>info</code>â€‹ç”¨æˆ·æ•°æ®</li><li>ç¬¬ä¸‰æ­¥ï¼šåˆ¤æ–­ base64 (header + info + ç³»ç»Ÿå¯†é’¥) æ˜¯å¦ç­‰äºåˆ†å‰²åçš„ç¬¬ä¸‰éƒ¨åˆ†</li></ul><p>*è¦æ³¨æ„ä¿æŠ¤å¥½ç³»ç»Ÿçš„å¯†é’¥</p><p>â€</p><h3 id="å®‰è£…pyjwt"><a href="#å®‰è£…pyjwt" class="headerlink" title="å®‰è£…pyjwt"></a>å®‰è£…pyjwt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyjwt</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="JWTå·¥å…·ç±»æµ‹è¯•"><a href="#JWTå·¥å…·ç±»æµ‹è¯•" class="headerlink" title="JWTå·¥å…·ç±»æµ‹è¯•"></a>JWTå·¥å…·ç±»æµ‹è¯•</h3><p>Djangoåœ¨åˆå§‹åŒ–é¡¹ç›®çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªkeyï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªä½œä¸ºå¯†é’¥</p><p>ä¹Ÿæ ¹æ®è‡ªå®šä¹‰ç®—æ³•ç”Ÿæˆéšæœºå­—ç¬¦ä¸²</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616112951-1zjp40y.png" alt="image">â€‹</p><p>â€</p><p>ç¼–å†™å·¥å…·ç±»ç”Ÿæˆtoken</p><p>è®¾ç½®tokenè¿‡æœŸæ—¶é—´ä¸º5åˆ†é’Ÿ</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616185722-ugvjkj5.png" alt="image">â€‹</p><p>jwt_demo.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> djangoDRFDemo.settings <span class="keyword">import</span> SECRET_KEY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_token</span>():</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;alg&#x27;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;typ&#x27;</span>: <span class="string">&quot;jwt&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;test_user&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;exp&#x27;</span>: datetime.datetime.utcnow() + datetime.timedelta(minutes=<span class="number">1</span>)  <span class="comment"># å®šä¹‰è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = jwt.encode(headers=headers, payload=payload, key=SECRET_KEY, algorithm=<span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_payload</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> jwt.decode(token, SECRET_KEY,algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">    <span class="keyword">except</span> jwt.exceptions.DecodeError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;tokenè®¤è¯å¤±è´¥&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> jwt.exceptions.ExpiredSignatureError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;tokenå·²ç»å¤±æ•ˆäº†&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> jwt.exceptions.InvalidTokenError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ— æ•ˆçš„token&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ å¯†è¿‡ç¨‹ - ç”Ÿæˆtoken</span></span><br><span class="line">    token = create_token()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆtokenï¼š&quot;</span> + token)</span><br><span class="line"></span><br><span class="line">    payload = get_payload(token)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è·å–payloadï¼š&quot;</span> + <span class="built_in">str</span>(payload))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨æ—§çš„tokenæµ‹è¯•éªŒè¯è¿‡ç¨‹</span></span><br><span class="line">    <span class="comment"># ä¼šæŠ›å‡ºSignature has expiredå¼‚å¸¸</span></span><br><span class="line">    expired_token = <span class="string">&quot;&quot;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6Imp3dCJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6InRlc3RfdXNlciIsImV4cCI6MTcxODUzNTcyNH0.8miAzL3pG7yMRonfR68kBJdGnUM1JksyriomfdB-zFY&quot;&quot;&quot;</span></span><br><span class="line">    payload = get_payload(expired_token)</span><br></pre></td></tr></table></figure><p>â€</p><p>è¿è¡Œç»“æœ</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616190642-p6db7se.png" alt="image">â€‹</p><p>â€</p><h3 id="JWTç™»å½•åŠŸèƒ½æ•´åˆ"><a href="#JWTç™»å½•åŠŸèƒ½æ•´åˆ" class="headerlink" title="JWTç™»å½•åŠŸèƒ½æ•´åˆ"></a>JWTç™»å½•åŠŸèƒ½æ•´åˆ</h3><h4 id="é¦–æ¬¡ç™»å½•æ—¶è¿”å›token"><a href="#é¦–æ¬¡ç™»å½•æ—¶è¿”å›token" class="headerlink" title="é¦–æ¬¡ç™»å½•æ—¶è¿”å›token"></a>é¦–æ¬¡ç™»å½•æ—¶è¿”å›token</h4><p>1.æ·»åŠ JWTå·¥å…·ç±»</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616193837-in20fg9.png" alt="image">â€‹</p><p>â€</p><p>2.æ·»åŠ Viewæ–¹æ³•</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616193907-luppdc2.png" alt="image">â€‹</p><p>â€</p><p>3.æ·»åŠ è·¯ç”±</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616193933-5vh48a9.png" alt="image">â€‹</p><p>â€</p><p>4.æµ‹è¯•æ¥å£</p><p>æˆåŠŸè¿”å›token</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616194000-v88wi5c.png" alt="image">â€‹</p><p>â€</p><h4 id="é’ˆå¯¹éç™»å½•æ¥å£æ·»åŠ JWTéªŒè¯"><a href="#é’ˆå¯¹éç™»å½•æ¥å£æ·»åŠ JWTéªŒè¯" class="headerlink" title="é’ˆå¯¹éç™»å½•æ¥å£æ·»åŠ JWTéªŒè¯"></a>é’ˆå¯¹éç™»å½•æ¥å£æ·»åŠ JWTéªŒè¯</h4><p>1.é’ˆå¯¹urlä¸­æºå¸¦tokenè¿›è¡ŒéªŒè¯</p><p>jwtå·¥å…·ç±»æ·»åŠ æ–¹æ³•</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616201642-aawmuiu.png" alt="image">â€‹</p><p>â€</p><p>Viewä¸­çš„æ–¹æ³•ä¹Ÿåšç›¸åº”çš„ä¿®æ”¹</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616203620-gtorlbn.png" alt="image">â€‹</p><p>â€</p><p>æµ‹è¯•</p><p>1.å…ˆç™»å½•ä¸€æ¬¡æ‹¿åˆ°token</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616202924-6gi24r3.png" alt="image">â€‹</p><p>â€</p><p>2.åœ¨å‚æ•°ä¸­ä½¿ç”¨tokenï¼Œç„¶åå‘é€GETè¯·æ±‚</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616202946-8wylpft.png" alt="image">â€‹</p><p>â€</p><p>æ§åˆ¶å°ä¹Ÿä¼šæ‰“å°å‡ºtokençš„ä¿¡æ¯</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616203047-lokq4um.png" alt="image">â€‹</p><p>â€</p><p>3.ç­‰å¾…tokenè¿‡æœŸåå†æ¬¡å‘èµ·è¯·æ±‚</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616203640-pq1rd2p.png" alt="image">â€‹</p><p>æ§åˆ¶å°æ˜¾ç¤ºtokenå¤±æ•ˆ</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616203707-qw67jl3.png" alt="image">â€‹</p><p>â€</p><h4 id="é’ˆå¯¹è¯·æ±‚headerä¸­æºå¸¦tokençš„éªŒè¯æ–¹å¼"><a href="#é’ˆå¯¹è¯·æ±‚headerä¸­æºå¸¦tokençš„éªŒè¯æ–¹å¼" class="headerlink" title="é’ˆå¯¹è¯·æ±‚headerä¸­æºå¸¦tokençš„éªŒè¯æ–¹å¼"></a>é’ˆå¯¹è¯·æ±‚headerä¸­æºå¸¦tokençš„éªŒè¯æ–¹å¼</h4><p>æ·»åŠ å·¥å…·ç±»</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616204928-23tnv8s.png" alt="image">â€‹</p><p>â€</p><p>Viewé‡Œåšç›¸åº”çš„ä¿®æ”¹</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616205007-v9zy1hx.png" alt="image">â€‹</p><p>â€</p><p>æµ‹è¯•æ¥å£ï¼Œä¹Ÿæ˜¯å…ˆæ‹¿åˆ°token</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616205048-svf0zn0.png" alt="image">â€‹</p><p>â€</p><p>â€</p><h4 id="JWTå…¨å±€é…ç½®"><a href="#JWTå…¨å±€é…ç½®" class="headerlink" title="JWTå…¨å±€é…ç½®"></a>JWTå…¨å±€é…ç½®</h4><p>å¦‚æœæ¯ä¸€ä¸ªç±»éƒ½æ·»åŠ JWTéªŒè¯ç±»ï¼Œä¸æ–¹ä¾¿ç»´æŠ¤</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616205142-aeipl2x.png" alt="image">â€‹</p><p>â€</p><p>åœ¨settings.pyä¸­æ·»åŠ å…¨å±€é…ç½®</p><p>æ‰€æœ‰çš„urléƒ½ä¼šè¢«æ‹¦æˆª</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616205423-o15i58r.png" alt="image">â€‹</p><p>â€</p><p>Viewé‡Œåšç›¸åº”çš„ä¿®æ”¹</p><p>æ³¨é‡Šæ‰ç±»é‡Œçš„authentication</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616205511-oxd492e.png" alt="image">â€‹</p><p>â€</p><p>éœ€è¦éªŒè¯çš„æ–¹æ³•é‡Œé¢åªéœ€è¦æ·»åŠ å¦‚ä¸‹ä»£ç å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ¤æ–­tokençŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> request.user.get(<span class="string">&quot;status&quot;</span>):</span><br><span class="line"><span class="keyword">return</span> ResponseMessage.UserResponse.failed(<span class="string">&quot;User token is invalid.&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€</p><p>æµ‹è¯•</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616205732-ufbdmfi.png" alt="image">â€‹</p><p>â€</p><h2 id="è®¾ç½®å®šæ—¶ä»»åŠ¡"><a href="#è®¾ç½®å®šæ—¶ä»»åŠ¡" class="headerlink" title="è®¾ç½®å®šæ—¶ä»»åŠ¡"></a>è®¾ç½®å®šæ—¶ä»»åŠ¡</h2><p>å®‰è£…APSchedule</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django_apscheduler</span><br></pre></td></tr></table></figure><p>â€</p><p>settings.pyæ·»åŠ </p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616210113-vl0ot45.png" alt="image">â€‹</p><p>â€</p><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®ŒæˆDBçš„æ›´æ”¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py makemigrations</span><br><span class="line">python3 manage.py migrate</span><br></pre></td></tr></table></figure><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616210647-anm7hc6.png" alt="image">â€‹</p><p>â€</p><p>ä¼šåœ¨DBä¸­åˆ›å»ºAPScheduleræ‰€éœ€çš„è¡¨</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616210633-bolnwxx.png" alt="image">â€‹</p><p>â€</p><p>ä¿®æ”¹app folderä¸­çš„urls.py</p><p>â€‹<img src="/2024/06/16/DRF-Django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240616212555-kl9jbpb.png" alt="image">â€‹</p><p>â€</p><p>å¯åŠ¨APPå³å¯çœ‹åˆ°æ•ˆæœ</p><p>ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> apscheduler.schedulers.background <span class="keyword">import</span> BackgroundScheduler</span><br><span class="line"><span class="keyword">from</span> django_apscheduler.jobstores <span class="keyword">import</span> DjangoJobStore,register_job</span><br><span class="line"></span><br><span class="line">scheduler = BackgroundScheduler()</span><br><span class="line">scheduler.add_jobstore(DjangoJobStore(), <span class="string">&quot;default&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@register_job(<span class="params">scheduler, <span class="string">&#x27;interval&#x27;</span>, seconds=<span class="number">5</span>, name=<span class="string">&#x27;auto_hello&#x27;</span>, replace_existing=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_schedule</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello schedule&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Luceneä¸­æ–‡åˆ†è¯</title>
      <link href="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/"/>
      <url>/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="Luceneä¸­æ–‡åˆ†è¯"><a href="#Luceneä¸­æ–‡åˆ†è¯" class="headerlink" title="Luceneä¸­æ–‡åˆ†è¯"></a>Luceneä¸­æ–‡åˆ†è¯</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="éç»“æ„åŒ–æ•°æ®æŸ¥è¯¢æ–¹æ³•"><a href="#éç»“æ„åŒ–æ•°æ®æŸ¥è¯¢æ–¹æ³•" class="headerlink" title="éç»“æ„åŒ–æ•°æ®æŸ¥è¯¢æ–¹æ³•"></a>éç»“æ„åŒ–æ•°æ®æŸ¥è¯¢æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰é¡ºåºæ‰«ææ³•(Serial Scanning)</p><p>æ‰€è°“é¡ºåºæ‰«æï¼Œæ¯”å¦‚è¦æ‰¾å†…å®¹åŒ…å«æŸä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ä¸€ä¸ªæ–‡æ¡£çš„çœ‹ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ–‡æ¡£ï¼Œ</p><p>ä»å¤´çœ‹åˆ°å°¾ï¼Œå¦‚æœæ­¤æ–‡æ¡£åŒ…å«æ­¤å­—ç¬¦ä¸²ï¼Œåˆ™æ­¤æ–‡æ¡£ä¸ºæˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶ï¼Œæ¥ç€çœ‹ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œ</p><p>ç›´åˆ°æ‰«æå®Œæ‰€æœ‰çš„æ–‡ä»¶ã€‚å¦‚åˆ©ç”¨windowsçš„æœç´¢ä¹Ÿå¯ä»¥æœç´¢æ–‡ä»¶å†…å®¹ï¼Œåªæ˜¯ç›¸å½“çš„æ…¢ã€‚</p><p>ï¼ˆ2ï¼‰å…¨æ–‡æ£€ç´¢(Full-text Search)</p><p>å°†éç»“æ„åŒ–æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ä¿¡æ¯æå–å‡ºæ¥ï¼Œé‡æ–°ç»„ç»‡ï¼Œä½¿å…¶å˜å¾—æœ‰ä¸€å®šç»“æ„ï¼Œç„¶åå¯¹æ­¤æœ‰ä¸€å®šç»“æ„çš„æ•°æ®è¿›è¡Œæœç´¢ï¼Œ</p><p>ä»è€Œè¾¾åˆ°æœç´¢ç›¸å¯¹è¾ƒå¿«çš„ç›®çš„ã€‚è¿™éƒ¨åˆ†ä»éç»“æ„åŒ–æ•°æ®ä¸­æå–å‡ºçš„ç„¶åé‡æ–°ç»„ç»‡çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç§°ä¹‹ç´¢å¼•ã€‚</p><p>ä¾‹å¦‚ï¼šå­—å…¸ã€‚å­—å…¸çš„æ‹¼éŸ³è¡¨å’Œéƒ¨é¦–æ£€å­—è¡¨å°±ç›¸å½“äºå­—å…¸çš„ç´¢å¼•ï¼Œå¯¹æ¯ä¸€ä¸ªå­—çš„è§£é‡Šæ˜¯éç»“æ„åŒ–çš„ï¼Œ</p><p>å¦‚æœå­—å…¸æ²¡æœ‰éŸ³èŠ‚è¡¨å’Œéƒ¨é¦–æ£€å­—è¡¨ï¼Œåœ¨èŒ«èŒ«è¾æµ·ä¸­æ‰¾ä¸€ä¸ªå­—åªèƒ½é¡ºåºæ‰«æã€‚ç„¶è€Œå­—çš„æŸäº›ä¿¡æ¯å¯ä»¥æå–å‡ºæ¥è¿›è¡Œç»“æ„åŒ–å¤„ç†ï¼Œ</p><p>æ¯”å¦‚è¯»éŸ³ï¼Œå°±æ¯”è¾ƒç»“æ„åŒ–ï¼Œåˆ†å£°æ¯å’ŒéŸµæ¯ï¼Œåˆ†åˆ«åªæœ‰å‡ ç§å¯ä»¥ä¸€ä¸€åˆ—ä¸¾ï¼Œäºæ˜¯å°†è¯»éŸ³æ‹¿å‡ºæ¥æŒ‰ä¸€å®šçš„é¡ºåºæ’åˆ—ï¼Œ</p><p>æ¯ä¸€é¡¹è¯»éŸ³éƒ½æŒ‡å‘æ­¤å­—çš„è¯¦ç»†è§£é‡Šçš„é¡µæ•°ã€‚æˆ‘ä»¬æœç´¢æ—¶æŒ‰ç»“æ„åŒ–çš„æ‹¼éŸ³æœåˆ°è¯»éŸ³ï¼Œç„¶åæŒ‰å…¶æŒ‡å‘çš„é¡µæ•°ï¼Œä¾¿å¯æ‰¾åˆ°æˆ‘ä»¬çš„éç»“æ„åŒ–æ•°æ®â€”â€”ä¹Ÿå³å¯¹å­—çš„è§£é‡Šã€‚</p><p><strong>è¿™ç§å…ˆå»ºç«‹ç´¢å¼•ï¼Œå†å¯¹ç´¢å¼•è¿›è¡Œæœç´¢çš„è¿‡ç¨‹å°±å«å…¨æ–‡æ£€ç´¢(Full-text Search)ã€‚</strong></p><p>è™½ç„¶åˆ›å»ºç´¢å¼•çš„è¿‡ç¨‹ä¹Ÿæ˜¯éå¸¸è€—æ—¶çš„ï¼Œä½†æ˜¯ç´¢å¼•ä¸€æ—¦åˆ›å»ºå°±å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå…¨æ–‡æ£€ç´¢ä¸»è¦å¤„ç†çš„æ˜¯æŸ¥è¯¢ï¼Œæ‰€ä»¥è€—æ—¶é—´åˆ›å»ºç´¢å¼•æ˜¯å€¼å¾—çš„ã€‚</p><p>â€</p><h3 id="ä»€ä¹ˆæ˜¯Lucene"><a href="#ä»€ä¹ˆæ˜¯Lucene" class="headerlink" title="ä»€ä¹ˆæ˜¯Lucene"></a>ä»€ä¹ˆæ˜¯Lucene</h3><p><strong>Luceneæ˜¯apacheä¸‹çš„ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å…¨æ–‡æ£€ç´¢å¼•æ“å·¥å…·åŒ…</strong>ã€‚æä¾›äº†å®Œæ•´çš„æŸ¥è¯¢å¼•æ“å’Œç´¢å¼•å¼•æ“ï¼Œéƒ¨åˆ†æ–‡æœ¬åˆ†æå¼•æ“ï¼ˆè‹±æ–‡ä¸å¾·æ–‡ä¸¤ç§è¥¿æ–¹è¯­è¨€ï¼‰ã€‚</p><p>å¯¹äºæ•°æ®é‡å¤§ã€æ•°æ®ç»“æ„ä¸å›ºå®šçš„æ•°æ®å¯é‡‡ç”¨å…¨æ–‡æ£€ç´¢æ–¹å¼æœç´¢ï¼Œæ¯”å¦‚ç™¾åº¦ã€Googleç­‰æœç´¢å¼•æ“ã€è®ºå›ç«™å†…æœç´¢ã€ç”µå•†ç½‘ç«™ç«™å†…æœç´¢ç­‰ã€‚</p><p><img src="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/image-20210529105841-4936d6f.png" alt="image.png"></p><p>å¯¹æœç´¢çš„åŸå§‹å†…å®¹è¿›è¡Œç´¢å¼•æ„å»ºä¸€ä¸ªç´¢å¼•åº“ï¼Œç´¢å¼•è¿‡ç¨‹åŒ…æ‹¬ï¼šç¡®å®šåŸå§‹å†…å®¹å³è¦æœç´¢çš„å†…å®¹ã€é‡‡é›†æ–‡æ¡£ã€åˆ›å»ºæ–‡æ¡£ã€åˆ†ææ–‡æ¡£ã€ç´¢å¼•æ–‡æ¡£</p><p>ä»ç´¢å¼•åº“ä¸­æœç´¢å†…å®¹ï¼Œæœç´¢è¿‡ç¨‹åŒ…æ‹¬ï¼šç”¨æˆ·é€šè¿‡æœç´¢ç•Œé¢ã€åˆ›å»ºæŸ¥è¯¢ã€æ‰§è¡Œæœç´¢ï¼Œä»ç´¢å¼•åº“æœç´¢ã€æ¸²æŸ“æœç´¢ç»“æœ</p><p>â€</p><h3 id="å…¨æ–‡ç´¢å¼•"><a href="#å…¨æ–‡ç´¢å¼•" class="headerlink" title="å…¨æ–‡ç´¢å¼•"></a>å…¨æ–‡ç´¢å¼•</h3><p>æœç´¢å¼•æ“é€šå¸¸æ£€ç´¢çš„åœºæ™¯æ˜¯ï¼šç»™å®šå‡ ä¸ªå…³é”®è¯ï¼Œæ‰¾å‡ºåŒ…å«å…³é”®è¯çš„æ–‡æ¡£ã€‚æ€ä¹ˆå¿«é€Ÿæ‰¾åˆ°åŒ…å«æŸä¸ªå…³é”®è¯çš„æ–‡æ¡£å°±æˆä¸ºæœç´¢çš„å…³é”®ã€‚æ‰€ä»¥å…¨æ–‡æ£€ç´¢å¼•æ“ä¸€èˆ¬ä½¿ç”¨å€’æ’ç´¢å¼•ï¼Œå¦‚Luceneã€‚</p><p><strong>å…¨æ–‡æ­£æ’ç´¢å¼•</strong></p><p>ä¸€å¥è¯æ€»ç»“ï¼šé€šè¿‡æ–‡æ¡£æ‰¾åˆ°æ‰€æœ‰çš„è¯ï¼Œç§°ä¸ºæ­£æ’ç´¢å¼•</p><p>æ­£æ’è¡¨æ˜¯ä»¥æ–‡æ¡£çš„IDä¸ºå…³é”®å­—ï¼Œè¡¨ä¸­è®°å½•æ–‡æ¡£ä¸­æ¯ä¸ªå­—çš„ä½ç½®ä¿¡æ¯ï¼ŒæŸ¥æ‰¾æ—¶æ‰«æè¡¨ä¸­æ¯ä¸ªæ–‡æ¡£ä¸­å­—çš„ä¿¡æ¯ç›´åˆ°æ‰¾å‡ºæ‰€æœ‰åŒ…å«æŸ¥è¯¢å…³é”®å­—çš„æ–‡æ¡£ã€‚<br>æ­£æ’è¡¨ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œè¿™ç§ç»„ç»‡æ–¹æ³•åœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™ç»“æ„æ¯”è¾ƒç®€å•ï¼Œå»ºç«‹æ¯”è¾ƒæ–¹ä¾¿ä¸”æ˜“äºç»´æŠ¤;å› ä¸ºç´¢å¼•æ˜¯åŸºäºæ–‡æ¡£å»ºç«‹çš„ï¼Œè‹¥æ˜¯æœ‰æ–°çš„æ–‡æ¡£åŠ å…¥ï¼Œç›´æ¥ä¸ºè¯¥æ–‡æ¡£å»ºç«‹ä¸€ä¸ªæ–°çš„ç´¢å¼•å—ï¼ŒæŒ‚æ¥åœ¨åŸæ¥ç´¢å¼•æ–‡ä»¶çš„åé¢ã€‚è‹¥æ˜¯æœ‰æ–‡æ¡£åˆ é™¤ï¼Œåˆ™ç›´æ¥æ‰¾åˆ°è¯¥æ–‡æ¡£å·æ–‡æ¡£å¯¹åº”çš„ç´¢å¼•ä¿¡æ¯ï¼Œå°†å…¶ç›´æ¥åˆ é™¤ã€‚ä½†æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™éœ€å¯¹æ‰€æœ‰çš„æ–‡æ¡£è¿›è¡Œæ‰«æä»¥ç¡®ä¿æ²¡æœ‰é—æ¼ï¼Œè¿™æ ·å°±ä½¿å¾—æ£€ç´¢æ—¶é—´å¤§å¤§å»¶é•¿ï¼Œæ£€ç´¢æ•ˆç‡ä½ä¸‹ã€‚<br>å°½ç®¡æ­£æ’è¡¨çš„å·¥ä½œåŸç†éå¸¸çš„ç®€å•ï¼Œä½†æ˜¯ç”±äºå…¶æ£€ç´¢æ•ˆç‡å¤ªä½ï¼Œé™¤éåœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œå¦åˆ™å®ç”¨æ€§ä»·å€¼ä¸å¤§ã€‚</p><p><img src="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/image-20210602160526-o4n214r.png" alt="image.png"></p><p>â€</p><p><strong>å…¨æ–‡å€’æ’ç´¢å¼•</strong></p><p>ä¸€å¥è¯æ€»ç»“ï¼šé€šè¿‡è¯æ‰¾åˆ°æ‰€æœ‰æ–‡æ¡£ï¼Œç§°ä¸ºå€’æ’ç´¢å¼•</p><p>å€’æ’è¡¨ä»¥å­—æˆ–è¯ä¸ºå…³é”®å­—è¿›è¡Œç´¢å¼•ï¼Œè¡¨ä¸­å…³é”®å­—æ‰€å¯¹åº”çš„è®°å½•è¡¨é¡¹è®°å½•äº†å‡ºç°è¿™ä¸ªå­—æˆ–è¯çš„æ‰€æœ‰æ–‡æ¡£ï¼Œä¸€ä¸ªè¡¨é¡¹å°±æ˜¯ä¸€ä¸ªå­—è¡¨æ®µï¼Œå®ƒè®°å½•è¯¥æ–‡æ¡£çš„IDå’Œå­—ç¬¦åœ¨è¯¥æ–‡æ¡£ä¸­å‡ºç°çš„ä½ç½®æƒ…å†µã€‚<br>ç”±äºæ¯ä¸ªå­—æˆ–è¯å¯¹åº”çš„æ–‡æ¡£æ•°é‡åœ¨åŠ¨æ€å˜åŒ–ï¼Œæ‰€ä»¥å€’æ’è¡¨çš„å»ºç«‹å’Œç»´æŠ¤éƒ½è¾ƒä¸ºå¤æ‚ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™ç”±äºå¯ä»¥ä¸€æ¬¡å¾—åˆ°æŸ¥è¯¢å…³é”®å­—æ‰€å¯¹åº”çš„æ‰€æœ‰æ–‡æ¡£ï¼Œæ‰€ä»¥æ•ˆç‡é«˜äºæ­£æ’è¡¨ã€‚åœ¨å…¨æ–‡æ£€ç´¢ä¸­ï¼Œæ£€ç´¢çš„å¿«é€Ÿå“åº”æ˜¯ä¸€ä¸ªæœ€ä¸ºå…³é”®çš„æ€§èƒ½ï¼Œè€Œç´¢å¼•å»ºç«‹ç”±äºåœ¨åå°è¿›è¡Œï¼Œå°½ç®¡æ•ˆç‡ç›¸å¯¹ä½ä¸€äº›ï¼Œä½†ä¸ä¼šå½±å“æ•´ä¸ªæœç´¢å¼•æ“çš„æ•ˆç‡ã€‚</p><p><img src="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/image-20210602160619-ul7mobu.png" alt="image.png"></p><p>â€</p><h3 id="Luceneçš„è¯„åˆ†æœºåˆ¶"><a href="#Luceneçš„è¯„åˆ†æœºåˆ¶" class="headerlink" title="Luceneçš„è¯„åˆ†æœºåˆ¶"></a>Luceneçš„è¯„åˆ†æœºåˆ¶</h3><ul><li>ç»“æœï¼šï¼ˆTF-IDFï¼Œæ–‡æ¡£idï¼‰</li><li>è¯é¢‘ï¼šTerm Frequencyï¼Œç®€ç§°TFâ€”â€”è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘ç‡</li><li>é€†æ–‡æ¡£é¢‘ç‡ï¼šInverse Document Frequencyï¼Œç®€ç§°IDFâ€”â€”è¯åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘ç‡è¶Šä½ï¼Œè¯´æ˜è¯è¶Šé‡è¦</li></ul><p>â€</p><h3 id="ä¸­æ–‡åˆ†æå™¨"><a href="#ä¸­æ–‡åˆ†æå™¨" class="headerlink" title="ä¸­æ–‡åˆ†æå™¨"></a>ä¸­æ–‡åˆ†æå™¨</h3><p>Analyzeræ›¿æ¢æˆèƒ½å¤„ç†ä¸­æ–‡çš„åˆ†æå™¨</p><ul><li>åº–ä¸</li><li>ç›˜å¤</li><li>IK</li></ul><p>â€</p><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>ä¸»è¦ç›®æ ‡ï¼šé’ˆå¯¹txtå°è¯´æ–‡ä»¶è¿›è¡Œå…³é”®è¯æŸ¥è¯¢ï¼Œå…³é”®è¯ä¸º<code>æ³¡æ²« è´·æ¬¾</code></p><h3 id="æ­¥éª¤åˆ†è§£"><a href="#æ­¥éª¤åˆ†è§£" class="headerlink" title="æ­¥éª¤åˆ†è§£"></a>æ­¥éª¤åˆ†è§£</h3><p>1.æ˜ç¡®æŸ¥è¯¢èŒƒå›´ï¼Œå‡†å¤‡åŸºç¡€æ•°æ®ï¼Œå¹¶æ•´ç†åˆ°ç›®å½•ä¸‹</p><p><img src="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/image-20210603145755-lvyw6f9.png" alt="image.png"></p><p>ã€æ³¨æ„ã€‘ä½¿ç”¨<code>IK Analyzer</code>è¦ä¿è¯æ–‡æ¡£æ˜¯<code>UTF_8</code>ç¼–ç æ ¼å¼</p><p>â€</p><p>2.åˆ›å»ºç´¢å¼•ç”Ÿæˆå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºç´¢å¼•ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> IndexWriter <span class="title function_">createWriter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡å®šç´¢å¼•ç”Ÿæˆç›®å½•å¹¶æ‰“å¼€</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(INDEX_DIR);</span><br><span class="line">    <span class="type">var</span> <span class="variable">dir</span> <span class="operator">=</span> FSDirectory.open(path);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡å®šè¯æ³•åˆ†æå™¨</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IKAnalyzer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»ºé€ è€…æ¨¡å¼ç”Ÿæˆé…ç½®</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">writerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(analyzer);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(dir, writerConfig);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ä½¿ç”¨è‹±æ–‡åˆ†æå™¨ï¼Œåˆ™<code>new IKAnalyzer()</code>æ”¹ä¸º<code>new StandardAnalyzer()</code></p><p>â€</p><p>3.è¯»å–å°è¯´æ•°æ®ï¼Œç”±Luceneå¼•æ“åœ¨æŒ‡å®šç›®å½•åˆ›å»ºç´¢å¼•</p><p>4.åˆ›å»ºç´¢å¼•æœç´¢å™¨</p><p>5.ä½¿ç”¨ç´¢å¼•æœç´¢å™¨è¿›è¡Œæœç´¢ï¼Œæ³¨æ„æœç´¢ä¸­çš„åˆ†æå™¨å¿…é¡»ä¸<code>ç¬¬äºŒæ­¥</code>ä¸­çš„<strong>åˆ†æå™¨ä¸€è‡´</strong></p><blockquote><p>Luceneçš„æŸ¥è¯¢æ–¹å¼å¾ˆ ä¸°å¯Œï¼Œå¯¹äºæ•°å€¼ç±»å‹çš„æ•°æ®ï¼Œé‡‡å–TermRangeQueryçš„æ–¹å¼ï¼Œå¯¹äºStringç±»å‹çš„ï¼Œå°±å¯ä»¥é‡‡å–TermQueryç­‰ï¼ŒæŸ¥è¯¢æ–¹å¼äº†ï¼Œå¯ä»¥é€šè¿‡é‡‡å–åˆé€‚çš„æŸ¥è¯¢æ–¹å¼ï¼Œæ£€ç´¢åˆ°æ•°æ®ã€‚Queryparserè¿™ä¸ªæŸ¥è¯¢æ–¹å¼åŒ…å«äº†å…¶ä»–å‡ ç§æŸ¥è¯¢æ–¹å¼ã€‚</p></blockquote><p>ã€æ³¨æ„ã€‘å‡ ç§æŸ¥è¯¢æ–¹å¼çš„æ¯”è¾ƒ</p><table><thead><tr><th>TermQuery</th><th>ç²¾ç¡®æŸ¥è¯¢</th></tr></thead><tbody><tr><td>TermRangeQuery</td><td>æŸ¥è¯¢ä¸€ä¸ªèŒƒå›´</td></tr><tr><td>PrefixQuery</td><td>å‰ç¼€åŒ¹é…æŸ¥è¯¢</td></tr><tr><td>WildcardQuery</td><td>é€šé…ç¬¦æŸ¥è¯¢</td></tr><tr><td>BooleanQuery</td><td>å¤šæ¡ä»¶æŸ¥è¯¢</td></tr><tr><td>PhraseQuery</td><td>çŸ­è¯­æŸ¥è¯¢</td></tr><tr><td>FuzzyQuery</td><td>æ¨¡ç³ŠæŸ¥è¯¢</td></tr><tr><td>Queryparser</td><td>ä¸‡èƒ½æŸ¥è¯¢ï¼ˆä¸Šé¢çš„éƒ½å¯ä»¥ç”¨è¿™ä¸ªæ¥æŸ¥è¯¢åˆ°ï¼‰</td></tr></tbody></table><p>â€</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>Lucene.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lucene;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> data.Book;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.standard.StandardAnalyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Field;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.ParseException;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.FSDirectory;</span><br><span class="line"><span class="keyword">import</span> org.wltea.analyzer.lucene.IKAnalyzer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Luceneä¸­æ–‡åˆ†è¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuceneCN</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INDEX_DIR</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/novel/index_data&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DATA_DIR</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/novel/book&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºç´¢å¼•ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> IndexWriter <span class="title function_">createWriter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‡å®šç´¢å¼•ç”Ÿæˆç›®å½•å¹¶æ‰“å¼€</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(INDEX_DIR);</span><br><span class="line">        <span class="type">var</span> <span class="variable">dir</span> <span class="operator">=</span> FSDirectory.open(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‡å®šè¯æ³•åˆ†æå™¨</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IKAnalyzer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å»ºé€ è€…æ¨¡å¼ç”Ÿæˆé…ç½®</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">writerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(analyzer);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(dir, writerConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç´¢å¼•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ç´¢å¼•ç”Ÿæˆå™¨</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="built_in">this</span>.createWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡‡é›†æ•°æ®</span></span><br><span class="line">        Map&lt;Integer, Book&gt; bookMap = readFromBooks(DATA_DIR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO æŒ‰ç« èŠ‚åˆ†å‰²æ–‡æ¡£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO å¤šçº¿ç¨‹å¤„ç†ä»¥æé«˜æ•ˆç‡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–‡æ¡£å¯¹è±¡</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">documents</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;Document&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer, Book&gt; entry : bookMap.entrySet()) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">Book</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line"></span><br><span class="line">            <span class="type">var</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;Name&quot;</span>,</span><br><span class="line">                    value.getName(),</span><br><span class="line">                    Field.Store.YES));</span><br><span class="line"><span class="comment">//            document.add(new TextField(&quot;Author&quot;,</span></span><br><span class="line"><span class="comment">//                    value.getAuthor(),</span></span><br><span class="line"><span class="comment">//                    Field.Store.YES));</span></span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;Sentence&quot;</span>,</span><br><span class="line">                    value.getSentence(),</span><br><span class="line">                    Field.Store.YES));</span><br><span class="line"></span><br><span class="line">            documents.add(document);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹æ–‡æ¡£å¯¹è±¡åˆ›å»ºç´¢å¼•</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> document : documents) &#123;</span><br><span class="line">            writer.addDocument(document);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        writer.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;å…¨æ–‡ç´¢å¼•ç”Ÿæˆå®Œæ¯•!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æŒ‡å®šç›®å½•è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, Book&gt; <span class="title function_">readFromBooks</span><span class="params">(String bookPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Map&lt;Integer, Book&gt; bookMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">booksPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(bookPath);</span><br><span class="line">        <span class="type">var</span> <span class="variable">books</span> <span class="operator">=</span> booksPath.listFiles();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ–‡ä»¶</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> book : books) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–ä¹¦åå’Œä½œè€…å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> book.getName();</span><br><span class="line"></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(book);</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(fis, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">context</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">            <span class="keyword">while</span> (context != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// ç»„è£…ä¹¦æœ¬ä¿¡æ¯</span></span><br><span class="line">                <span class="type">Book</span> <span class="variable">bookInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">                bookInfo.setName(fileName);</span><br><span class="line">                <span class="comment">//bookInfo.setAuthor(bookAuthor);</span></span><br><span class="line">                bookInfo.setSentence(context);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å…¥é˜Ÿå¹¶è¯»å–ä¸‹ä¸€ä¸ªå¥å­</span></span><br><span class="line">                bookMap.put(count, bookInfo);</span><br><span class="line">                context = reader.readLine();</span><br><span class="line"></span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bookMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºç´¢å¼•æœç´¢å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> IndexSearcher <span class="title function_">createSearcher</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// æŒ‡å®šç´¢å¼•ç”Ÿæˆç›®å½•å¹¶æ‰“å¼€</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(INDEX_DIR);</span><br><span class="line">        <span class="type">var</span> <span class="variable">dir</span> <span class="operator">=</span> FSDirectory.open(path);</span><br><span class="line">        <span class="type">var</span> <span class="variable">reader</span> <span class="operator">=</span> DirectoryReader.open(dir);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(reader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»ç´¢å¼•æœç´¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyWord</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryIndex</span><span class="params">(String keyWord)</span> <span class="keyword">throws</span> ParseException, IOException &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryParser</span>(<span class="string">&quot;Sentence&quot;</span>, <span class="keyword">new</span> <span class="title class_">IKAnalyzer</span>()).parse(keyWord);</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">searcher</span> <span class="operator">=</span> <span class="built_in">this</span>.createSearcher();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»…æŸ¥è¯¢å‰10æ¡</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">docs</span> <span class="operator">=</span> searcher.search(query, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> scoreDoc : docs.scoreDocs) &#123;</span><br><span class="line">            <span class="type">var</span> <span class="variable">docID</span> <span class="operator">=</span> scoreDoc.doc;</span><br><span class="line">            <span class="type">var</span> <span class="variable">doc</span> <span class="operator">=</span> searcher.doc(docID);</span><br><span class="line"><span class="comment">//            System.out.format(&quot;%s %s %s %s\n&quot;, scoreDoc.score,</span></span><br><span class="line"><span class="comment">//                    doc.get(&quot;Author&quot;),</span></span><br><span class="line"><span class="comment">//                    doc.get(&quot;Name&quot;),</span></span><br><span class="line"><span class="comment">//                    doc.get(&quot;Sentence&quot;));</span></span><br><span class="line"></span><br><span class="line">            System.out.format(<span class="string">&quot;%s %s %s\n&quot;</span>, scoreDoc.score,</span><br><span class="line">                    doc.get(<span class="string">&quot;Name&quot;</span>),</span><br><span class="line">                    doc.get(<span class="string">&quot;Sentence&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>main.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸­æ–‡åˆ†è¯å…¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ParseException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">LuceneCN</span> <span class="variable">lucene</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LuceneCN</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºç´¢å¼•</span></span><br><span class="line">        <span class="comment">//lucene.createIndex();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å…³é”®è¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> <span class="string">&quot;è´·æ¬¾ æ³¡æ²«&quot;</span>;</span><br><span class="line">        lucene.queryIndex(keyword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>pom.xml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;LuceneX&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- Lucene Lib --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lucene-memory&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">7.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lucene-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">7.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lucene-queryparser&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">7.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- IK ä¸­æ–‡åˆ†è¯ --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.magese&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;ik-analyzer&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">7.4</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;<span class="number">12</span>&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;<span class="number">12</span>&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p>è¾“å‡ºç›®å½•</p><p><img src="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/image-20210603151149-q6tptou.png" alt="image.png"></p><p>â€</p><p>è¿è¡Œç»“æœ</p><p><img src="/2024/04/15/Lucene%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/image-20210603151130-diflmqr.png" alt="image.png"></p><p>â€</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/47764999">Java å…¨æ–‡æ£€ç´¢å¼•æ“å·¥å…·åŒ… Lucene åŸç†è§£æ</a></p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—…ç¨‹è¿˜åœ¨ç»§ç»­</title>
      <link href="/2024/03/29/%E6%97%85%E7%A8%8B%E8%BF%98%E5%9C%A8%E7%BB%A7%E7%BB%AD/"/>
      <url>/2024/03/29/%E6%97%85%E7%A8%8B%E8%BF%98%E5%9C%A8%E7%BB%A7%E7%BB%AD/</url>
      
        <content type="html"><![CDATA[<h1 id="æ—…ç¨‹è¿˜åœ¨ç»§ç»­"><a href="#æ—…ç¨‹è¿˜åœ¨ç»§ç»­" class="headerlink" title="æ—…ç¨‹è¿˜åœ¨ç»§ç»­"></a>æ—…ç¨‹è¿˜åœ¨ç»§ç»­</h1><p>ä¸€å¹´åŠæ²¡æœ‰æ›´æ–°åšå®¢ï¼ŒåŸå› æ˜¯Macé‡ç½®æ•°æ®ä»¥åï¼Œæˆ‘å‘ç°åšå®¢æ•°æ®æ²¡æœ‰å¤‡ä»½â€¦</p><p>è¿˜å¥½æœ‰è®°ä¸‹hexoé…ç½®çš„è¿‡ç¨‹ï¼Œäºæ˜¯åªèƒ½ä»å¤´æ¥è¿‡</p><p>Hexo NEXTä¸»é¢˜ä¹Ÿä»åŸæ¥çš„5.Xå‡çº§åˆ°äº†7.X</p><p>â€‹<img src="/2024/03/29/%E6%97%85%E7%A8%8B%E8%BF%98%E5%9C%A8%E7%BB%A7%E7%BB%AD/image-20240317124230-zpap1uq.png" alt="image">â€‹</p><p>â€</p><p>æ—…ç¨‹è¿˜åœ¨ç»§ç»­ï¼Œå­¦ä¹ ä¹Ÿä¸èƒ½æ­¢æ­¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> éšè®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšè®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle å¼€å‘å¸¸ç”¨ä»£ç </title>
      <link href="/2022/06/14/Oracle%20%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/"/>
      <url>/2022/06/14/Oracle%20%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬"><a href="#åŸºæœ¬" class="headerlink" title="åŸºæœ¬"></a>åŸºæœ¬</h2><h3 id="è·å–ç¯å¢ƒä¿¡æ¯"><a href="#è·å–ç¯å¢ƒä¿¡æ¯" class="headerlink" title="è·å–ç¯å¢ƒä¿¡æ¯"></a>è·å–ç¯å¢ƒä¿¡æ¯</h3><p>USEREVN()æ–¹æ³•è¿”å›ç”¨æˆ·ç¯å¢ƒçš„ä¿¡æ¯ã€‚</p><p>option å¯ä»¥æ˜¯ ENTRYID,SESSIONID,TERMINAL,ISDBA,LANGUAGE,CLIENT_INFO,LANG,VSIZE</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ DBAï¼Œå¦‚æœæ˜¯è¿”å› true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;isbda&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å› SESSION ä¼šè¯ ID </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;sessionid&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å›å¤šäººä¼šè¯äººæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;entryid&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å›å½“å‰ instance æ ‡å¿—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;instance&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å›å½“å‰è¯­è¨€ç¯å¢ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;language&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å›å½“å‰è¯­è¨€ç¯å¢ƒçš„ç¼©å†™ï¼Œå¦‚ ZHS,EN ç­‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;lang&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å›ç”¨æˆ·ç»ˆç«¯æˆ–æœºå™¨æ ‡è¯†</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(<span class="string">&#x27;terminal&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--è¿”å›ä¼ å…¥å­—ç¬¦çš„å­—èŠ‚æ•°ï¼Œä»¥ X ä¸ºä¾‹ï¼Œè¿”å›çš„å°±æ˜¯ X å­—ç¬¦çš„å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> userevn(X) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æˆªå–åˆ°æŸä¸€ä¸ªå­—ç¬¦ä¸²å‰é¢çš„å†…å®¹"><a href="#æˆªå–åˆ°æŸä¸€ä¸ªå­—ç¬¦ä¸²å‰é¢çš„å†…å®¹" class="headerlink" title="æˆªå–åˆ°æŸä¸€ä¸ªå­—ç¬¦ä¸²å‰é¢çš„å†…å®¹"></a>æˆªå–åˆ°æŸä¸€ä¸ªå­—ç¬¦ä¸²å‰é¢çš„å†…å®¹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substr(<span class="string">&#x27;210-1106000001&#x27;</span>,<span class="number">1</span>,instr(<span class="string">&#x27;210-1106000001&#x27;</span>,<span class="string">&#x27;-&#x27;</span>)<span class="number">-1</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="è®¾ç½®å½“å‰ä¼šè¯æ—¥æœŸæ ¼å¼"><a href="#è®¾ç½®å½“å‰ä¼šè¯æ—¥æœŸæ ¼å¼" class="headerlink" title="è®¾ç½®å½“å‰ä¼šè¯æ—¥æœŸæ ¼å¼"></a>è®¾ç½®å½“å‰ä¼šè¯æ—¥æœŸæ ¼å¼</h3><p>è®¾ç½®å½“å‰ä¼šè¯æ—¥æœŸæ ¼å¼ä¸ºè‹±æ–‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> nls_date_language<span class="operator">=</span>american;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å¼€å¯æ§åˆ¶å°è¾“å‡º"><a href="#å¼€å¯æ§åˆ¶å°è¾“å‡º" class="headerlink" title="å¼€å¯æ§åˆ¶å°è¾“å‡º"></a>å¼€å¯æ§åˆ¶å°è¾“å‡º</h3><p>ç”¨äºä½¿ <code>dbms_output.put_line()</code> ç”Ÿæ•ˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> serveroutput <span class="keyword">on</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å…³é—­å‚æ•°è¾“å…¥"><a href="#å…³é—­å‚æ•°è¾“å…¥" class="headerlink" title="å…³é—­å‚æ•°è¾“å…¥"></a>å…³é—­å‚æ•°è¾“å…¥</h3><p>ä½¿Oracleçš„å‚æ•°ç¬¦å· <code>&amp;</code> å¤±æ•ˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">define</span> off;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>â€</p><h2 id="æ•°æ®åº“æŒ‡æ ‡"><a href="#æ•°æ®åº“æŒ‡æ ‡" class="headerlink" title="æ•°æ®åº“æŒ‡æ ‡"></a>æ•°æ®åº“æŒ‡æ ‡</h2><h3 id="æŸ¥çœ‹å ç”¨è¡¨ç©ºé—´å¤§å°"><a href="#æŸ¥çœ‹å ç”¨è¡¨ç©ºé—´å¤§å°" class="headerlink" title="æŸ¥çœ‹å ç”¨è¡¨ç©ºé—´å¤§å°"></a>æŸ¥çœ‹å ç”¨è¡¨ç©ºé—´å¤§å°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> se.username,</span><br><span class="line">       se.sid,</span><br><span class="line">       su.extents,</span><br><span class="line">       su.blocks <span class="operator">*</span> to_number(rtrim(p.value)) <span class="keyword">AS</span> Space,</span><br><span class="line">       tablespace,</span><br><span class="line">       segtype,</span><br><span class="line">       sql_text</span><br><span class="line">  <span class="keyword">FROM</span> v$sort_usage su, v$<span class="keyword">parameter</span> p, v$session se, v$<span class="keyword">sql</span> s</span><br><span class="line"> <span class="keyword">WHERE</span> p.name <span class="operator">=</span> <span class="string">&#x27;db_block_size&#x27;</span></span><br><span class="line">   <span class="keyword">AND</span> su.session_addr <span class="operator">=</span> se.saddr</span><br><span class="line">   <span class="keyword">AND</span> s.hash_value <span class="operator">=</span> su.sqlhash</span><br><span class="line">   <span class="keyword">AND</span> s.address <span class="operator">=</span> su.sqladdr</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> se.username, se.sid;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æŸ¥çœ‹å ç”¨çš„ç£ç›˜ç©ºé—´"><a href="#æŸ¥çœ‹å ç”¨çš„ç£ç›˜ç©ºé—´" class="headerlink" title="æŸ¥çœ‹å ç”¨çš„ç£ç›˜ç©ºé—´"></a>æŸ¥çœ‹å ç”¨çš„ç£ç›˜ç©ºé—´</h3><p>å¯¹äºäº§ç”Ÿå¤§é‡DMLçš„åœºæ™¯ï¼Œä¼šéœ€è¦ç›‘æ§ç£ç›˜ç©ºé—´ã€‚å¦‚æœç©ºé—´çˆ†æ»¡ä¼šå¯¼è‡´Oracleå®•æœºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TRUNC(first_time) &quot;Date&quot;,</span><br><span class="line">       to_char(first_time, <span class="string">&#x27;Dy&#x27;</span>) &quot;Day&quot;,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="number">1</span>) &quot;Total(GB)&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;00&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h0&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;01&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h1&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;02&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h2&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;03&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h3&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;04&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h4&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;05&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h5&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;06&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h6&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;07&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h7&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;08&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h8&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;09&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h9&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;10&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h10&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;11&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h11&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;12&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h12&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;13&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h13&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;14&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h14&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;15&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h15&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;16&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h16&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;17&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h17&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;18&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h18&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;19&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h19&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;20&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h20&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;21&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h21&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;22&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h22&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(DECODE(to_char(first_time, <span class="string">&#x27;hh24&#x27;</span>), <span class="string">&#x27;23&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;h23&quot;,</span><br><span class="line">       ROUND(<span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">/</span> <span class="number">24</span>, <span class="number">2</span>) &quot;Avg&quot;</span><br><span class="line">  <span class="keyword">FROM</span> gv$log_history</span><br><span class="line"> <span class="keyword">WHERE</span> thread# <span class="operator">=</span> inst_id</span><br><span class="line">   <span class="keyword">AND</span> TRUNC(first_time) <span class="operator">&gt;=</span> to_date(<span class="string">&#x27;2022/01/25&#x27;</span>, <span class="string">&#x27;yyyy/mm/dd&#x27;</span>)</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> TRUNC(first_time), to_char(first_time, <span class="string">&#x27;Dy&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æŸ¥è¯¢é”ä½çš„è¡¨"><a href="#æŸ¥è¯¢é”ä½çš„è¡¨" class="headerlink" title="æŸ¥è¯¢é”ä½çš„è¡¨"></a>æŸ¥è¯¢é”ä½çš„è¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dob.object_name &quot;å¯¹è±¡åç§°&quot;,</span><br><span class="line">       lo.session_id &quot;ä¼šè¯ID&quot;,</span><br><span class="line">       vss.serial# &quot;ç©¿è¡Œ&quot;,</span><br><span class="line">       vss.action &quot;èŒè´£&quot;,</span><br><span class="line">       vss.module &quot;è¡¨å•&quot;,</span><br><span class="line">       vss.blocking_session &quot;ç­‰å¾…å…¶ä»–ä¼šè¯ID&quot;,</span><br><span class="line">       vss.client_identifier &quot;ç”¨æˆ·&quot;,</span><br><span class="line">       vql.sql_text &quot;SQLè¯­å¥&quot;,</span><br><span class="line">       <span class="string">&#x27;alter system kill session &#x27;</span> <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;&#x27;</span> <span class="operator">||</span> lo.session_id <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> vss.serial# <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;immediate;&#x27;</span> &quot;å‘½ä»¤&quot;</span><br><span class="line">  <span class="keyword">FROM</span> v$locked_object lo,</span><br><span class="line">       dba_objects     dob,</span><br><span class="line">       v$session       vss,</span><br><span class="line">       v$process       vps,</span><br><span class="line">       v$<span class="keyword">sql</span>           vql</span><br><span class="line"> <span class="keyword">WHERE</span> lo.object_id <span class="operator">=</span> dob.object_id</span><br><span class="line">   <span class="keyword">AND</span> lo.session_id <span class="operator">=</span> vss.sid</span><br><span class="line">   <span class="keyword">AND</span> vss.paddr <span class="operator">=</span> vps.addr</span><br><span class="line">   <span class="keyword">AND</span> vql.sql_id(<span class="operator">+</span>) <span class="operator">=</span> vss.sql_id</span><br><span class="line">   <span class="comment">--AND OBJECT_NAME = &#x27;AP_INVOICES_ALL&#x27;</span></span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> lo.session_id;</span><br></pre></td></tr></table></figure><p>â€</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><h3 id="æ•°å­—è½¬æ¢æˆå¤§å†™"><a href="#æ•°å­—è½¬æ¢æˆå¤§å†™" class="headerlink" title="æ•°å­—è½¬æ¢æˆå¤§å†™"></a>æ•°å­—è½¬æ¢æˆå¤§å†™</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FUNCTION</span> convert_money(input_nbr1 NUMBER) <span class="keyword">RETURN</span> VARCHAR2 <span class="keyword">IS</span></span><br><span class="line">    input_nbr_bak  NUMBER(<span class="number">20</span>);</span><br><span class="line">    num_character  VARCHAR2(<span class="number">200</span>) :<span class="operator">=</span> <span class="string">&#x27;é›¶å£¹è´°åè‚†ä¼é™†æŸ’æŒç–&#x27;</span>;</span><br><span class="line">    unit_character VARCHAR2(<span class="number">400</span>) :<span class="operator">=</span> <span class="string">&#x27;åˆ†è§’åœ†æ‹¾ä½°ä»Ÿä¸‡æ‹¾ä½°ä»Ÿäº¿æ‹¾ä½°ä»Ÿä¸‡æ‹¾ä½°ä»Ÿäº¿&#x27;</span>;</span><br><span class="line">    output_string  VARCHAR2(<span class="number">1000</span>) :<span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    remain_nbr     NUMBER(<span class="number">20</span>);</span><br><span class="line">    bit_num        NUMBER(<span class="number">20</span>);</span><br><span class="line">    bit_unit       VARCHAR2(<span class="number">20</span>);</span><br><span class="line">    bit_indic      NUMBER(<span class="number">1</span>) :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    i              NUMBER(<span class="number">2</span>) :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    spe_unit       VARCHAR2(<span class="number">20</span>) :<span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    sign_indic     VARCHAR2(<span class="number">10</span>);</span><br><span class="line">    input_nbr      NUMBER(<span class="number">38</span>);</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    input_nbr :<span class="operator">=</span> input_nbr1 <span class="operator">*</span> <span class="number">100</span>;</span><br><span class="line">    IF input_nbr <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">RETURN</span> <span class="string">&#x27;é›¶åœ†æ•´&#x27;</span>;</span><br><span class="line">    ELSIF input_nbr <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      sign_indic    :<span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">      input_nbr_bak :<span class="operator">=</span> input_nbr;</span><br><span class="line">    ELSIF input_nbr <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      sign_indic    :<span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">      input_nbr_bak :<span class="operator">=</span> <span class="operator">-</span>input_nbr;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    LOOP</span><br><span class="line">      remain_nbr    :<span class="operator">=</span> <span class="built_in">floor</span>(input_nbr_bak <span class="operator">/</span> <span class="number">10</span>);</span><br><span class="line">      bit_num       :<span class="operator">=</span> input_nbr_bak <span class="operator">-</span> remain_nbr <span class="operator">*</span> <span class="number">10</span>;</span><br><span class="line">      input_nbr_bak :<span class="operator">=</span> remain_nbr;</span><br><span class="line">      bit_unit      :<span class="operator">=</span> rtrim(substr(unit_character,</span><br><span class="line">                                    i <span class="operator">+</span> <span class="number">1</span>,</span><br><span class="line">                                    <span class="number">1</span>));</span><br><span class="line">      IF bit_num <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">        bit_indic :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        IF i <span class="operator">=</span> <span class="number">6</span></span><br><span class="line">           <span class="keyword">OR</span> i <span class="operator">=</span> <span class="number">14</span> <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">          spe_unit :<span class="operator">=</span> <span class="string">&#x27;ä¸‡&#x27;</span>;</span><br><span class="line">        ELSIF (i <span class="operator">&gt;=</span> <span class="number">7</span> <span class="keyword">AND</span> i <span class="operator">&lt;=</span> <span class="number">9</span>)</span><br><span class="line">              <span class="keyword">OR</span> (i <span class="operator">&gt;=</span> <span class="number">15</span> <span class="keyword">AND</span> i <span class="operator">&lt;=</span> <span class="number">17</span>) <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">          IF spe_unit <span class="operator">!=</span> <span class="string">&#x27;ä¸‡&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">            output_string :<span class="operator">=</span> <span class="string">&#x27;ä¸‡&#x27;</span> <span class="operator">||</span> output_string;</span><br><span class="line">            spe_unit      :<span class="operator">=</span> <span class="string">&#x27;ä¸‡&#x27;</span>;</span><br><span class="line">          <span class="keyword">END</span> IF;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line">        output_string :<span class="operator">=</span> substr(num_character,</span><br><span class="line">                                bit_num <span class="operator">+</span> <span class="number">1</span>,</span><br><span class="line">                                <span class="number">1</span>) <span class="operator">||</span> bit_unit <span class="operator">||</span> output_string;</span><br><span class="line">      <span class="keyword">ELSE</span></span><br><span class="line"> </span><br><span class="line">        IF bit_indic <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">          output_string :<span class="operator">=</span> <span class="string">&#x27;é›¶&#x27;</span> <span class="operator">||</span> output_string;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line">        IF bit_unit <span class="keyword">IN</span> (<span class="string">&#x27;åœ†&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;äº¿&#x27;</span>) <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">          spe_unit      :<span class="operator">=</span> bit_unit;</span><br><span class="line">          output_string :<span class="operator">=</span> bit_unit <span class="operator">||</span> output_string;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line">        bit_indic :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">END</span> IF;</span><br><span class="line">      i :<span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">      EXIT <span class="keyword">WHEN</span> input_nbr_bak <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    IF <span class="built_in">MOD</span>(input_nbr,</span><br><span class="line">           <span class="number">100</span>) <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line"> </span><br><span class="line">      output_string :<span class="operator">=</span> output_string <span class="operator">||</span> <span class="string">&#x27;æ•´&#x27;</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    IF sign_indic <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">      output_string :<span class="operator">=</span> <span class="string">&#x27;è´Ÿ&#x27;</span> <span class="operator">||</span> output_string;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    <span class="keyword">RETURN</span> output_string;</span><br><span class="line">  <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å•ä¾‹æ¨¡å¼çš„å®‰å…¨æ€§</title>
      <link href="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/"/>
      <url>/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼æ˜¯æŒ‡ï¼ŒæŸä¸ªå¯¹è±¡åœ¨è¿è¡Œæ—¶ä»…å­˜åœ¨ä¸€ä¸ªï¼Œå¹¶å¯¹å¤–æä¾›ç»Ÿä¸€è®¿é—®æ–¹å¼ã€‚</p><ul><li>é¥¿æ±‰æ¨¡å¼ï¼šç±»è¢«åŠ è½½çš„æ—¶å€™å°±ç«‹å³åˆå§‹åŒ–å¹¶åˆ›å»ºå”¯ä¸€å®ä¾‹</li><li>æ‡’æ±‰æ¨¡å¼ï¼šåœ¨è¢«é¦–æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰åˆ›å»ºå”¯ä¸€å®ä¾‹ã€‚åŠ å…¥åŒé‡æ£€æŸ¥é”æœºåˆ¶èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li></ul><p>â€</p><h3 id="é¥¿æ±‰å•ä¾‹æ¨¡å¼"><a href="#é¥¿æ±‰å•ä¾‹æ¨¡å¼" class="headerlink" title="é¥¿æ±‰å•ä¾‹æ¨¡å¼"></a>é¥¿æ±‰å•ä¾‹æ¨¡å¼</h3><p>å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanContainerStaving</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">BeanContainerStaving</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanContainerStaving</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢è®¿é—®æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">BeanContainerStaving</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BeanContainerStaving <span class="title function_">getInstance</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 1 get instance&quot;</span>);</span><br><span class="line">                System.out.println(BeanContainerStaving.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 2 get instance&quot;</span>);</span><br><span class="line">                System.out.println(BeanContainerStaving.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        thread2.start();</span><br><span class="line">        thread1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœ</p><p>ä¿è¯è·å–åˆ°çš„æ˜¯å”¯ä¸€å®ä¾‹</p><p><img src="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/image-20220527094219-vqdoi4y.png" alt="image.png"></p><p>â€</p><h3 id="æ‡’æ±‰å•ä¾‹æ¨¡å¼"><a href="#æ‡’æ±‰å•ä¾‹æ¨¡å¼" class="headerlink" title="æ‡’æ±‰å•ä¾‹æ¨¡å¼"></a>æ‡’æ±‰å•ä¾‹æ¨¡å¼</h3><p>å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanContainerLazy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢æŒ‡ä»¤é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span>  BeanContainerLazy instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">BeanContainerLazy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BeanContainerLazy <span class="title function_">getInstance</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åŒé‡æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (BeanContainerLazy.class)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">BeanContainerLazy</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 1 get instance: &quot;</span> + BeanContainerLazy.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 2 get instance: &quot;</span> + BeanContainerLazy.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        thread2.start();</span><br><span class="line">        thread1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœ</p><p>æ‡’æ±‰æ¨¡å¼åŒæ ·ä¿è¯äº†å®ä¾‹åœ¨è¿è¡Œæ—¶å”¯ä¸€</p><p><img src="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/image-20220527094800-q1lz1rw.png" alt="image.png"></p><p>â€</p><h2 id="å•ä¾‹çš„å®‰å…¨æ€§"><a href="#å•ä¾‹çš„å®‰å…¨æ€§" class="headerlink" title="å•ä¾‹çš„å®‰å…¨æ€§"></a>å•ä¾‹çš„å®‰å…¨æ€§</h2><p>å°½ç®¡å•ä¾‹æ¨¡å¼å·²ç»å°†æ„é€ æ–¹æ³•è®¾ç½®ä¸º <code>private</code> ä½†æ˜¯ä¾ç„¶å­˜åœ¨è®©å•ä¾‹ä¸å”¯ä¸€çš„æ‰‹æ®µã€‚</p><ul><li>åå°„æ”»å‡»</li><li>åºåˆ—åŒ–æ”»å‡»</li></ul><p>â€</p><h3 id="åå°„æ”»å‡»"><a href="#åå°„æ”»å‡»" class="headerlink" title="åå°„æ”»å‡»"></a>åå°„æ”»å‡»</h3><p>å®ç°ï¼šé€šè¿‡åå°„åˆ›å»ºå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 1 get instance: &quot;</span> + BeanContainerLazy.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 2 get instance: &quot;</span> + BeanContainerLazy.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åå°„åˆ›å»ºæ‡’æ±‰å•ä¾‹æ¨¡å¼</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">Class</span> <span class="variable">lazyClazz</span> <span class="operator">=</span> BeanContainerLazy.class;</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    constructor = lazyClazz.getDeclaredConstructor();</span><br><span class="line">                    constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread 3 get instance: &quot;</span> + constructor.newInstance());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        thread2.start();</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœï¼šå‡ºç°äº†åœ°å€ä¸ç›¸åŒçš„å®ä¾‹ï¼Œè¡¨æ˜é€šè¿‡åå°„å¯ä»¥ç ´åå•ä¾‹æ¨¡å¼çš„å”¯ä¸€æ€§</p><p><img src="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/image-20220527150904-rey5u1e.png" alt="image.png"></p><p>â€</p><h3 id="åºåˆ—åŒ–æ”»å‡»"><a href="#åºåˆ—åŒ–æ”»å‡»" class="headerlink" title="åºåˆ—åŒ–æ”»å‡»"></a>åºåˆ—åŒ–æ”»å‡»</h3><p>æ‡’æ±‰å¼å•ï¼Œå®ç°åºåˆ—åŒ–æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å®ç°åºåˆ—åŒ–æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanContainerLazySel</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢æŒ‡ä»¤é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> BeanContainerLazySel instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">BeanContainerLazySel</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BeanContainerLazySel <span class="title function_">getInstance</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åŒé‡æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (BeanContainerLazySel.class)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">BeanContainerLazySel</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æµ‹è¯•åºåˆ—åŒ–æ”»å‡»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setObject</span><span class="params">(BeanContainerLazySel instance)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;instance&quot;</span>));</span><br><span class="line">        outputStream.writeObject(instance);</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BeanContainerLazySel <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;instance&quot;</span>));</span><br><span class="line">        <span class="type">BeanContainerLazySel</span> <span class="variable">object</span> <span class="operator">=</span> (BeanContainerLazySel)inputStream.readObject();</span><br><span class="line">        inputStream.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">BeanContainerLazySel</span> <span class="variable">instance</span> <span class="operator">=</span> BeanContainerLazySel.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        setObject(instance);</span><br><span class="line"></span><br><span class="line">        <span class="type">BeanContainerLazySel</span> <span class="variable">object</span> <span class="operator">=</span> getObject();</span><br><span class="line">        System.out.println(object);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœï¼šåœ¨æ‡’æ±‰å¼å•ä¾‹ä¸‹ï¼Œé€šè¿‡åºåˆ—åŒ–æ¥è·å–å•ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°åœ°å€ä¸ä¸€è‡´ã€‚</p><p><img src="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/image-20220529101039-2xeopat.png" alt="image.png"></p><p>â€</p><h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><h4 id="æŠµå¾¡åå°„æ”»å‡»"><a href="#æŠµå¾¡åå°„æ”»å‡»" class="headerlink" title="æŠµå¾¡åå°„æ”»å‡»"></a>æŠµå¾¡åå°„æ”»å‡»</h4><p><strong>ä½¿ç”¨æšä¸¾ç±»å‹</strong></p><p>æŠŠæ‡’æ±‰å¼å•ä¾‹å­˜æ”¾åˆ°æšä¸¾ç±»å‹ä¸­ï¼Œå¯é˜²æ­¢åå°„å’Œåºåˆ—åŒ–æ”»å‡»</p><p>ä»¥æ‡’æ±‰å¼å•ä¾‹ä¸ºä¾‹å­ï¼š</p><p>å®ç°ï¼ˆæšä¸¾ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å®ç°åºåˆ—åŒ–æ¥å£</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å­˜æ”¾åœ¨æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumBeanContainerStavingSel</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EnumBeanContainerStavingSel</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EnumBeanContainerStavingSel <span class="title function_">getInstance</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ContainerHolder.HOLDER.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> <span class="title class_">ContainerHolder</span></span><br><span class="line">    &#123;</span><br><span class="line">        HOLDER;</span><br><span class="line">        <span class="keyword">private</span> EnumBeanContainerStavingSel instance;</span><br><span class="line"></span><br><span class="line">        ContainerHolder()</span><br><span class="line">        &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">EnumBeanContainerStavingSel</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.coding.singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setObject</span><span class="params">(EnumBeanContainerStavingSel instance)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;instance&quot;</span>));</span><br><span class="line">        outputStream.writeObject(instance);</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EnumBeanContainerStavingSel <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;instance&quot;</span>));</span><br><span class="line">        <span class="type">EnumBeanContainerStavingSel</span> <span class="variable">object</span> <span class="operator">=</span> (EnumBeanContainerStavingSel)inputStream.readObject();</span><br><span class="line">        inputStream.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 1 get instance: &quot;</span> + EnumBeanContainerStavingSel.getInstance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åå°„æ”»å‡»</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> EnumBeanContainerStavingSel.class.getDeclaredConstructor();</span><br><span class="line">                    constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">EnumBeanContainerStavingSel</span> <span class="variable">enumBeanContainerStavingSel</span> <span class="operator">=</span> (EnumBeanContainerStavingSel)constructor.newInstance();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread 2 get instance: &quot;</span> + enumBeanContainerStavingSel.getInstance());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">EnumBeanContainerStavingSel</span> <span class="variable">instance</span> <span class="operator">=</span> EnumBeanContainerStavingSel.getInstance();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æŠŠå¯¹è±¡å†™å…¥åˆ°ç£ç›˜</span></span><br><span class="line">                    setObject(instance);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ä»ç£ç›˜ä¸­è¯»å–å¯¹è±¡ï¼Œå¹¶è§‚å¯Ÿæ˜¯å¦ä¸è¿è¡Œä¸­çš„å®ä¾‹ç›¸åŒ</span></span><br><span class="line">                    <span class="type">EnumBeanContainerStavingSel</span> <span class="variable">object</span> <span class="operator">=</span> getObject();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread 3 get instance: &quot;</span> + object);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        thread2.start();</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœ</p><p>å¯ä»¥çœ‹åˆ°æ”¾åœ¨æšä¸¾ä¸­çš„å®:</p><ol><li>åå°„çš„æ–¹å¼è¯»å–éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚</li><li>åºåˆ—åŒ–æ–¹å¼è¯»å–ï¼Œå´ä¸æ˜¯åŒä¸€ä¸ªç±»ï¼Œä¹Ÿå°±æ˜¯è¯´æšä¸¾ç±»å‹èƒ½å¤ŸæŠµå¾¡åå°„æ”»å‡»ï¼Œå´ä¸èƒ½æŠµå¾¡åºåˆ—åŒ–æ”»å‡»</li></ol><p><img src="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/image-20220529103748-ram6wrj.png" alt="image.png"></p><p>â€</p><h4 id="æŠµå¾¡åºåˆ—åŒ–æ”»å‡»"><a href="#æŠµå¾¡åºåˆ—åŒ–æ”»å‡»" class="headerlink" title="æŠµå¾¡åºåˆ—åŒ–æ”»å‡»"></a>æŠµå¾¡åºåˆ—åŒ–æ”»å‡»</h4><p>åœ¨ç±»ä¸­å®šä¹‰ <code>readResolve</code> çš„é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å®ç°åºåˆ—åŒ–æ¥å£</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å­˜æ”¾åœ¨æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumBeanContainerStavingSel</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EnumBeanContainerStavingSel</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EnumBeanContainerStavingSel <span class="title function_">getInstance</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ContainerHolder.HOLDER.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> <span class="title class_">ContainerHolder</span></span><br><span class="line">    &#123;</span><br><span class="line">        HOLDER;</span><br><span class="line">        <span class="keyword">private</span> EnumBeanContainerStavingSel instance;</span><br><span class="line"></span><br><span class="line">        ContainerHolder()</span><br><span class="line">        &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">EnumBeanContainerStavingSel</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(getInstance() == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EnumBeanContainerStavingSel</span>();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> ContainerHolder.HOLDER.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ä½¿ç”¨åŒæ ·çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="/2022/05/26/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/image-20220529104010-0nrheqc.png" alt="image.png"></p><p>â€</p><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><ol><li>æšä¸¾ç±»å‹å®é™…ä¸Šæ˜¯ <code>static</code> çš„ä»£ç å—ï¼Œä¼šåœ¨ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œï¼Œä¸èƒ½è¢«åå°„åˆ›å»ºã€‚æšä¸¾ç±»å‹ä¸­çš„å®ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>åœ¨åºåˆ—åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœè¦ä¿è¯å•ä¾‹ï¼Œåˆ™éœ€è¦å®ç° <code>readResolve()</code> æ–¹æ³•ä¿è¯å¯¹è±¡å”¯ä¸€ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MinIOæ­å»ºOSS</title>
      <link href="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/"/>
      <url>/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/</url>
      
        <content type="html"><![CDATA[<h1 id="MinIOæ­å»ºOSS"><a href="#MinIOæ­å»ºOSS" class="headerlink" title="MinIOæ­å»ºOSS"></a>MinIOæ­å»ºOSS</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç¯å¢ƒåŸºäºdokcerã€‚</p><p>é¦–å…ˆç¡®ä¿dockerå¯åŠ¨çŠ¶æ€ï¼Œè¾“å…¥å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull minio/minio</span><br></pre></td></tr></table></figure><p>â€</p><p>ç­‰å¾…ä¸‹è½½å®Œæ¯•åï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼šconfigå’Œdataï¼Œä½œä¸ºminIOçš„dockeræ˜ å°„æ–‡ä»¶å¤¹</p><p><img src="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/image-20210823142734-i76o6a9.png" alt="image.png"></p><p>â€</p><p>æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  -p 9000:9000 \</span><br><span class="line">  -p 9001:9001 \</span><br><span class="line">  --name minio \</span><br><span class="line">  -e <span class="string">&quot;MINIO_ROOT_USER=KALOSORA&quot;</span> \</span><br><span class="line">  -e <span class="string">&quot;MINIO_ROOT_PASSWORD=KALOSORA&quot;</span> \</span><br><span class="line">  -v /Users/kalosora/docker-reflection/minio/data:/data \</span><br><span class="line">  -v /Users/kalosora/docker-reflection/minio/config:/root/.minio \</span><br><span class="line">  minio/minio server /data --console-address <span class="string">&quot;:9001&quot;</span></span><br></pre></td></tr></table></figure><p>å‘½ä»¤è¯´æ˜ï¼š</p><ul><li>éœ€è¦æ˜ å°„ä¸¤ä¸ªç«¯å£ï¼Œä¸€ä¸ªæ˜¯apiç«¯å£ï¼Œå¦ä¸€ä¸ªæ˜¯webæ§åˆ¶å°ç«¯å£ï¼Œæœ€åè¦ç”¨ <code>--console-address</code> æŒ‡å®šæ§åˆ¶å°ï¼Œé‚£ä¹ˆæ­¤æ—¶9001è¢«æŒ‡å®šä¸ºæ§åˆ¶å°ç«¯å£ï¼Œå¦ä¸€ä¸ª9000å°±ä¼šè‡ªåŠ¨å˜æˆAPIç«¯å£</li><li>USERå’ŒPASSWORDæœ€å¥½æ˜¯çº¯è‹±æ–‡å­—ç¬¦ä¸²ï¼Œä¸è¦åŒ…å«ç‰¹æ®Šç¬¦å·ï¼Œå› ä¸ºæ›¾ç»è¯•è¿‡ç™»å½•ä»¥åJavaä¸Šä¼ ä¸äº†æ–‡ä»¶</li><li>è¿™é‡Œæ˜ å°„çš„&#x2F;dataå’Œ&#x2F;configè·¯å¾„å¯¹åº”ä¸Šé¢åˆ›å»ºçš„ä¸¤ä¸ªæ–‡ä»¶å¤¹è·¯å¾„</li></ul><p>â€</p><p>å½“dockeråå°æ˜¾ç¤ºå¦‚ä¸‹å³ä¸ºæ­å»ºå®Œæˆ</p><p><img src="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/image-20210823143155-j8ejxnc.png" alt="image.png"></p><p>â€</p><h2 id="è®¾ç½®è®¿é—®ç­–ç•¥"><a href="#è®¾ç½®è®¿é—®ç­–ç•¥" class="headerlink" title="è®¾ç½®è®¿é—®ç­–ç•¥"></a>è®¾ç½®è®¿é—®ç­–ç•¥</h2><p>ç™»é™†åˆ°æ§åˆ¶å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:9001</span><br></pre></td></tr></table></figure><p>â€</p><p>ç‚¹å‡»å³ä¸Šè§’æ·»åŠ å­˜å‚¨æ¡¶</p><p><img src="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/image-20210823143309-9r3x26w.png" alt="image.png"></p><p>â€</p><p>æ·»åŠ å®Œæ¯•åï¼Œè®¾ç½®è®¿é—®ç­–ç•¥ä¸ºpublicï¼Œè¿™æ ·å¯ä»¥é€šè¿‡ <code>http://127.0.0.1:9001/å­˜å‚¨æ¡¶åç§°/æ–‡ä»¶å</code> çš„å½¢å¼è®¿é—®</p><p><img src="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/image-20210823143432-vdi8abb.png" alt="image.png"></p><p>â€</p><p>æœ€åæ·»åŠ ä¸€ä¸ªè®¿é—®è§„åˆ™</p><p><img src="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/image-20210823143517-dmvj87d.png" alt="image.png"></p><p>â€</p><p>æŒ‰ç…§å›¾é‡Œçš„è¿›è¡Œè®¾ç½®å³å¯</p><p><img src="/2021/08/23/MinIO%E6%90%AD%E5%BB%BAOSS/image-20210823143543-6cub0ux.png" alt="image.png"></p><p>â€</p><h2 id="ç®€å•å®ä¾‹"><a href="#ç®€å•å®ä¾‹" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><p>mavenä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--           Minio     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æœ¬åœ°æ–‡ä»¶ä¸Šä¼ "><a href="#æœ¬åœ°æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æœ¬åœ°æ–‡ä»¶ä¸Šä¼ "></a>æœ¬åœ°æ–‡ä»¶ä¸Šä¼ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// MinIO OSS</span></span><br><span class="line"><span class="comment">// æµ‹è¯•æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, NoSuchAlgorithmException, InvalidKeyException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Base information</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> <span class="string">&quot;KALOSORA&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="string">&quot;KALOSORA&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serverUrl</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:9000&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;images&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a minioClient with the MinIO server playground, its access key and secret key.</span></span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span></span><br><span class="line">                MinioClient.builder()</span><br><span class="line">                        .endpoint(serverUrl)</span><br><span class="line">                        .credentials(accessKey, secretKey)</span><br><span class="line">                        .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make &#x27;asiatrip&#x27; bucket if not exist.</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span></span><br><span class="line">                minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());</span><br><span class="line">        <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">            <span class="comment">// Make a new bucket called &#x27;asiatrip&#x27;.</span></span><br><span class="line">            minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucketName).build());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Bucket already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Upload &#x27;/home/user/Photos/asiaphotos.zip&#x27; as object name &#x27;asiaphotos-2015.zip&#x27; to bucket</span></span><br><span class="line">        <span class="comment">// &#x27;asiatrip&#x27;.</span></span><br><span class="line">        minioClient.uploadObject(</span><br><span class="line">                UploadObjectArgs.builder()</span><br><span class="line">                        <span class="comment">//.contentType(&quot;image/jpg&quot;)</span></span><br><span class="line">                        .bucket(bucketName)</span><br><span class="line">                        .object(<span class="string">&quot;portal-cover.jpg&quot;</span>)</span><br><span class="line">                        .filename(<span class="string">&quot;/Users/kalosora/Desktop/portal-cover.jpg&quot;</span>)</span><br><span class="line">                        .build());</span><br><span class="line">        System.out.println(<span class="string">&quot;File has been uploaded!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MinioException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Error occurred: &quot;</span> + e);</span><br><span class="line">        System.out.println(<span class="string">&quot;HTTP trace: &quot;</span> + e.httpTrace());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ–‡ä»¶æµä¸Šä¼ "><a href="#æ–‡ä»¶æµä¸Šä¼ " class="headerlink" title="æ–‡ä»¶æµä¸Šä¼ "></a>æ–‡ä»¶æµä¸Šä¼ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, NoSuchAlgorithmException, InvalidKeyException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Base information</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> <span class="string">&quot;KALOSORA&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="string">&quot;KALOSORA&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">serverUrl</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:9000&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;article&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create a minioClient with the MinIO server playground, its access key and secret key.</span></span><br><span class="line">            <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span></span><br><span class="line">                    MinioClient.builder()</span><br><span class="line">                            .endpoint(serverUrl)</span><br><span class="line">                            .credentials(accessKey, secretKey)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Make &#x27;asiatrip&#x27; bucket if not exist.</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span></span><br><span class="line">                    minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());</span><br><span class="line">            <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">                <span class="comment">// Make a new bucket called &#x27;asiatrip&#x27;.</span></span><br><span class="line">                minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucketName).build());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Bucket &#x27;test&#x27; already exists.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€šè¿‡æ–‡ä»¶æµä¸Šä¼ </span></span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/kalosora/Downloads/tempfile/210426A9N10GBYNC_æ•°æ®ç»“æ„ - é›†åˆ.md&quot;</span>);</span><br><span class="line">            minioClient.putObject(</span><br><span class="line">                    PutObjectArgs.builder().bucket(bucketName)</span><br><span class="line">                            .object(<span class="string">&quot;kalosora/article.md&quot;</span>) <span class="comment">// è¿™é‡Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆkalosoraæ–‡ä»¶å¤¹</span></span><br><span class="line">                            .stream(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file), -<span class="number">1</span>, <span class="number">10485760</span>)</span><br><span class="line">                            .build());</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;File has been uploaded!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MinioException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Error occurred: &quot;</span> + e);</span><br><span class="line">            System.out.println(<span class="string">&quot;HTTP trace: &quot;</span> + e.httpTrace());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h2 id="Springbootæ•´åˆ"><a href="#Springbootæ•´åˆ" class="headerlink" title="Springbootæ•´åˆ"></a>Springbootæ•´åˆ</h2><p>â€</p><p>å‰ç«¯å¼•ç”¨ä¸Šä¼ åçš„å›¾ç‰‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1:9000/images/portal-cover.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Photo 1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-fluid&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>å®Œæ•´å®ä¾‹1</p><blockquote><p><a href="https://blog.csdn.net/zhuyu19911016520/article/details/109448375?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-15-109448375.pc_agg_rank_aggregation&utm_term=minio+%E5%AD%98%E5%82%A8%E8%A7%86%E9%A2%91&spm=1000.2123.3001.4430">https://blog.csdn.net/zhuyu19911016520/article/details/109448375?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-15-109448375.pc_agg_rank_aggregation&amp;utm_term=minio+å­˜å‚¨è§†é¢‘&amp;spm=1000.2123.3001.4430</a></p></blockquote><p>å®Œæ•´å®ä¾‹2</p><blockquote><p><a href="https://blog.csdn.net/qq_43230007/article/details/108701081?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-2-108701081.pc_agg_rank_aggregation&utm_term=minio%E6%96%87%E4%BB%B6%E6%B5%81&spm=1000.2123.3001.4430">https://blog.csdn.net/qq_43230007/article/details/108701081?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-2-108701081.pc_agg_rank_aggregation&amp;utm_term=minioæ–‡ä»¶æµ&amp;spm=1000.2123.3001.4430</a></p></blockquote><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeréƒ¨ç½²Eureka</title>
      <link href="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/"/>
      <url>/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/</url>
      
        <content type="html"><![CDATA[<h1 id="Dockeréƒ¨ç½²Eureka"><a href="#Dockeréƒ¨ç½²Eureka" class="headerlink" title="Dockeréƒ¨ç½²Eureka"></a>Dockeréƒ¨ç½²Eureka</h1><h2 id="SpringCloudæ‰“åŒ…"><a href="#SpringCloudæ‰“åŒ…" class="headerlink" title="SpringCloudæ‰“åŒ…"></a>SpringCloudæ‰“åŒ…</h2><p>ã€æ³¨æ„ã€‘</p><ul><li><p>å…¶ä»–å¾®æœåŠ¡ç»„ä»¶éƒ¨ç½²æ–¹å¼ç›¸åŒï¼Œå¦‚zuulä¹Ÿèƒ½è¿™æ ·éƒ¨ç½²ï¼ˆéƒ¨ç½²ä¾ç„¶å¤±è´¥ï¼‰</p></li><li><p>éƒ¨ç½²zuulè¦æŒ‡å®šæœ¬åœ°ç½‘ç»œ <code>--network=host </code></p><ul><li><blockquote><p>docker run â€“network&#x3D;host â€“name zuul-server  -d -p 7070:7070 springcloud&#x2F;zuul-server</p></blockquote></li></ul></li></ul><p>â€</p><p>1.åœ¨éœ€è¦æ‰“åŒ…çš„é¡¹ç›®çš„ <code>pom.xml</code> ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ‰“åŒ…å‚æ•° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ‰“åŒ…çš„æ–‡ä»¶åç§° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>eureka<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€</p><p>2.æ›´æ–°mavenï¼Œå¹¶å…¨å±€install</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714091040-72udekv.png" alt="image.png">  </p><p>â€</p><p>ç›´åˆ°å‡ºç°æ„å»ºæˆåŠŸå­—æ ·</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714091121-5crabt0.png" alt="image.png">  </p><p>â€</p><p>3.æ‰¾åˆ°éœ€è¦æ‰“åŒ…çš„é¡¹ç›®ï¼Œè¿™é‡Œä»¥ eureka ä¸ºä¾‹ï¼Œç‚¹å‡»package</p><p>ç›´åˆ°å‡ºç°æ‰“åŒ…æˆåŠŸå­—æ ·</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714091257-0fnxdxv.png" alt="image.png">  </p><p>â€</p><p>4.å‘½ä»¤ç»ˆç«¯è¿è¡Œï¼Œæµ‹è¯•ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿æ¥åˆ°è¯¥é¡¹ç›®</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span>eureka.<span class="keyword">jar</span></span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœå¦‚ä¸‹ï¼ˆéœ€è¦ç»ˆæ­¢æ—¶ï¼Œ<code>ctrl + c</code> æˆ– å…³é—­ç»ˆç«¯çª—å£ å³å¯ï¼‰</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714091413-79bzuse.png" alt="image.png">  </p><h2 id="jaræ„å»ºé•œåƒ"><a href="#jaræ„å»ºé•œåƒ" class="headerlink" title="jaræ„å»ºé•œåƒ"></a>jaræ„å»ºé•œåƒ</h2><p>1.æ‹‰å–jdké•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull java:8</span><br></pre></td></tr></table></figure><p>â€</p><p>2.æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶ä¸”æŠŠjaråŒ…æ”¾è¿›å»</p><p>3.åœ¨æ–°å»ºçš„ç›®å½•ä¸­ï¼Œåˆ›å»ºåä¸ºDockerfileçš„æ–‡ä»¶</p><ul><li>EXPOSEï¼šè¡¨æ˜æš´éœ²çš„ç«¯å£å·</li><li>ADDï¼šè¡¨æ˜è¦æ·»åŠ çš„jaråŒ…</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line">EXPOSE 7070</span><br><span class="line">VOLUME /tmp</span><br><span class="line">ADD eureka.jar app.jar</span><br><span class="line">RUN sh -c &#x27;touch /app.jar&#x27;</span><br><span class="line">ENV JAVA_OPTS=&quot;&quot;</span><br><span class="line">ENTRYPOINT [ &quot;sh&quot;, &quot;-c&quot;, &quot;java $JAVA_OPTS -Djava.security.egd=file:/dev/./urandom -jar /app.jar&quot; ]</span><br></pre></td></tr></table></figure><p>â€</p><p>ç›®å½•å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714100334-l0hh2wd.png" alt="image.png">  </p><p>â€</p><p>4.å‘½ä»¤ç»ˆç«¯cdè¿›å…¥è¯¥ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤</p><p>ã€æ³¨æ„ã€‘å‘½ä»¤æœ«å°¾æœ‰ä¸ª â€˜.â€™ ä»£è¡¨å½“å‰è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t springcloud/eureka .</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœï¼š</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714095258-vnft06a.png" alt="image.png">  </p><p>â€</p><p>5.åœ¨dockerä¸­æŸ¥çœ‹é•œåƒ</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>docker images</code></p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714095344-w6ih4fz.png" alt="image.png">  </p><p>â€</p><p>6.åˆ›å»ºå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 7070:7070 springcloud/eureka</span><br></pre></td></tr></table></figure><p>â€</p><p>7.è®¿é—®eureka</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:7070</span><br></pre></td></tr></table></figure><p>â€</p><p>ç»“æœå¯ä»¥çœ‹åˆ°è¿è¡ŒæˆåŠŸ</p><p><img src="/2021/07/14/Docker%E9%83%A8%E7%BD%B2Eureka/image-20210714095610-yyuntu2.png" alt="image.png">  </p><p>â€</p><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Cloud Native </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Spring </tag>
            
            <tag> Devops </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</title>
      <link href="/2021/06/18/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E4%B8%8B%E8%BD%BD/"/>
      <url>/2021/06/18/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</h1><p><strong>åŸºäºSpringboot + Vueå‰åç«¯åˆ†ç¦»</strong></p><p>é¡¹ç›®æºç ï¼š</p><ul><li>å‰ç«¯<code>springboot-file</code></li><li>åç«¯<code>springboot-file-process</code></li></ul><p>â€</p><h2 id="æµç¨‹æ¢³ç†"><a href="#æµç¨‹æ¢³ç†" class="headerlink" title="æµç¨‹æ¢³ç†"></a>æµç¨‹æ¢³ç†</h2><p><strong>æ–‡ä»¶ä¸Šä¼ </strong></p><ol><li><p>å‰ç«¯æäº¤æ–‡ä»¶ï¼Œåç«¯ä½¿ç”¨<code>MultipartFile</code>æ¥æ”¶</p></li><li><p>åç«¯æ–°å»ºFileå¹¶ä¿å­˜åˆ°å¯¹åº”çš„ç›®å½•ä¸Šï¼ˆæ­¤æ—¶æ–‡ä»¶åç«¯æœåŠ¡ä¸€èˆ¬ä¸æ–‡ä»¶å­˜å‚¨æ”¾åœ¨åŒä¸€ä¸ªlinuxæœåŠ¡å™¨ä¸Šï¼‰</p></li><li><p>å¦‚æœéœ€è¦å›æ˜¾ï¼Œå­˜å‚¨æˆåŠŸåï¼Œå‘å‰ç«¯è¿”å›æ–‡ä»¶è·¯å¾„ã€‚æ­¤æ—¶è¯¥è·¯å¾„å¿…é¡»èƒ½å¤Ÿé€šè¿‡httpç›´æ¥è®¿é—®</p><ol><li>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œè¿”å›å›¾ç‰‡çš„base64æ ¼å¼ï¼Œæ”¾åˆ°imgæ ‡ç­¾é‡Œé¢</li></ol></li></ol><p>â€</p><p><strong>æ–‡ä»¶ä¸‹è½½</strong></p><ol><li><p>å‰ç«¯æäº¤æ–‡ä»¶ååˆ°åç«¯</p></li><li><p>åç«¯æœç´¢åˆ°æ–‡ä»¶åï¼Œé€šè¿‡æ–‡ä»¶æµå†™å…¥åˆ°<code>HttpServletResponse</code>çš„<code>OutputStream</code>ä¸­</p></li><li><p>å‰ç«¯é€šè¿‡<code>window.location</code>æ¥æ”¶</p><ol><li><p>æˆ–è€…æ˜¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾ç½®å›¾ç‰‡çš„Base64ï¼Œå…¶ä¸­<code>imgurl</code>æ˜¯vueçš„åŠ¨æ€ç»‘å®šå˜é‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;&#x27;data:image/png;base64,&#x27;+imgurl&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li></ol><p>â€</p><h2 id="ä»£ç å®ä¾‹"><a href="#ä»£ç å®ä¾‹" class="headerlink" title="ä»£ç å®ä¾‹"></a>ä»£ç å®ä¾‹</h2><h3 id="å‰ç«¯ä»£ç "><a href="#å‰ç«¯ä»£ç " class="headerlink" title="å‰ç«¯ä»£ç "></a>å‰ç«¯ä»£ç </h3><p>upload.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ é¡µé¢<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;fileUploadVue&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:inlines</span>=<span class="string">&quot;text&quot;</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>é€‰æ‹©æ–‡ä»¶: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fileName&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;fileUpload&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ä¸‹è½½&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;fileDownload&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:inlines</span>=<span class="string">&quot;text&quot;</span>&gt;</span>å›¾ç‰‡ä¸Šä¼ å¹¶å›æ˜¾<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>é€‰æ‹©æ–‡ä»¶: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fileName&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;fileUploadAndShow&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;&#x27;data:image/png;base64,&#x27;+imageBase64&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;vue/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;vue/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> fileUploadVue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#fileUploadVue&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">imageBase64</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> me = <span class="variable language_">this</span>;</span></span><br><span class="line"><span class="language-javascript">            me.<span class="title function_">testPostStatus</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// æµ‹è¯•å‰åç«¯æ˜¯å¦è°ƒé€š</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">testPostStatus</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> name = <span class="string">&quot;hello&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> postTestUrl = <span class="string">&quot;http://localhost:8001/postTest?name=&quot;</span>;  <span class="comment">// è¿™é‡Œå¿…é¡»æ·»åŠ  &#x27;http://&#x27; å‰ç¼€ï¼Œå¦åˆ™ä¼šCORSè¯·æ±‚è¢«æ‹¦æˆª</span></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(postTestUrl + name).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fileUpload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> uploadFileUrl = <span class="string">&quot;http://localhost:8001/uploadFile&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">file</span>.<span class="property">files</span>[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(uploadFileUrl, formData).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (res.<span class="property">data</span> == <span class="string">&quot;SUCCESS&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fileDownload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> downloadFileUrl = <span class="string">&quot;http://localhost:8001/downloadFile&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;http://localhost:8001/downloadFile&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fileUploadAndShow</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> me = <span class="variable language_">this</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> downloadFileUrl = <span class="string">&quot;http://localhost:8001/fileUploadAndShow&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">file</span>.<span class="property">files</span>[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(downloadFileUrl, formData).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">status</span> == <span class="string">&quot;SUCCESS&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        me.<span class="property">imageBase64</span> = res.<span class="property">data</span>.<span class="property">imageBase64</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€</p><h3 id="åç«¯ä»£ç "><a href="#åç«¯ä»£ç " class="headerlink" title="åç«¯ä»£ç "></a>åç«¯ä»£ç </h3><p>SwaggerConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.file.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicate;</span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.RequestHandler;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Swagger2</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    http://localhost:8088/swagger-ui.html     åŸè·¯å¾„</span></span><br><span class="line"><span class="comment">//    http://localhost:8088/doc.html     æ–°è·¯å¾„ï¼Œgithubå¼€æºçš„swaggeré¡µé¢ï¼Œè‡ªå¸¦æ±‰åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®swagger2æ ¸å¿ƒé…ç½® docket</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        Predicate&lt;RequestHandler&gt; filePredicate = RequestHandlerSelectors.basePackage(<span class="string">&quot;com.file.controller&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)  <span class="comment">// æŒ‡å®šapiç±»å‹ä¸ºswagger2</span></span><br><span class="line">                .apiInfo(apiInfo())                 <span class="comment">// ç”¨äºå®šä¹‰apiæ–‡æ¡£æ±‡æ€»ä¿¡æ¯</span></span><br><span class="line">                .select()</span><br><span class="line">                .apis(Predicates.or(filePredicate))</span><br><span class="line">                .paths(PathSelectors.any())         <span class="comment">// æ‰€æœ‰controller</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;sora blogÂ·åšå®¢æ¥å£api&quot;</span>)                       <span class="comment">// æ–‡æ¡£é¡µæ ‡é¢˜</span></span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;sora&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;https://www.kalosora.work&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;kalosora@gmail.com&quot;</span>))                   <span class="comment">// è”ç³»äººä¿¡æ¯</span></span><br><span class="line">                .description(<span class="string">&quot;sora blogåšå®¢çš„apiæ–‡æ¡£&quot;</span>)      <span class="comment">// è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">                .version(<span class="string">&quot;1.0.0&quot;</span>)                               <span class="comment">// æ–‡æ¡£ç‰ˆæœ¬å·</span></span><br><span class="line">                .termsOfServiceUrl(<span class="string">&quot;https://www.kalosora.work&quot;</span>)     <span class="comment">// ç½‘ç«™åœ°å€</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>FileController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.file.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…è®¸è·¨åŸŸ</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;, methods = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;æ–‡ä»¶å¤„ç†ç›¸å…³Controller&quot;, tags = &#123;&quot;æ–‡ä»¶å¤„ç†ç›¸å…³Controller&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Status Code</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STATUS_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;SUCCESS&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STATUS_ERROR</span> <span class="operator">=</span> <span class="string">&quot;ERROR&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/downloadFile&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;æ–‡ä»¶ä¸‹è½½çš„æ¥å£&quot;, notes = &quot;æ–‡ä»¶ä¸‹è½½çš„æ¥å£&quot;, httpMethod = &quot;GET&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">downloadFile</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;å¸ƒå¶.jpg&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/æ¨¡æ‹Ÿä¸‹è½½/&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">downLoadFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + fileName);</span><br><span class="line">        <span class="keyword">if</span> (!downLoadFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> STATUS_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶å­˜åœ¨ï¼Œå¼€å§‹ä¸‹è½½</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + java.net.URLEncoder.encode(fileName, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰è¾“å…¥æµ</span></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            os = response.getOutputStream();</span><br><span class="line">            is = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(downLoadFile);</span><br><span class="line">            bis = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(is);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> bis.read(buffer);</span><br><span class="line">            <span class="keyword">while</span> (i != -<span class="number">1</span>) &#123;</span><br><span class="line">                os.write(buffer);</span><br><span class="line">                i = bis.read(buffer);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bis.close();</span><br><span class="line">            is.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/uploadFile&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;æ–‡ä»¶ä¸Šä¼ çš„æ¥å£&quot;, notes = &quot;æ–‡ä»¶ä¸Šä¼ çš„æ¥å£&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¿å­˜è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/æ¨¡æ‹Ÿä¸‹è½½/&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> STATUS_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–åŸæ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å: &quot;</span> + originalFileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶ç±»å‹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> originalFileName.substring(originalFileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ç±»å‹: &quot;</span> + fileType);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ–‡ä»¶ä¿å­˜åˆ°ä¸åº”ç”¨åŒä¸€ä¸ªæœåŠ¡å™¨</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">saveFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + originalFileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–°æ–‡ä»¶:&quot;</span> + saveFile.toString());</span><br><span class="line">        <span class="keyword">if</span> (!saveFile.exists()) &#123;</span><br><span class="line">            file.transferTo(saveFile);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/fileUploadAndShow&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;æ–‡ä»¶ä¸Šä¼ çš„æ¥å£&quot;, notes = &quot;æ–‡ä»¶ä¸Šä¼ çš„æ¥å£&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">fileUploadAndShow</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¿å­˜è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/æ¨¡æ‹Ÿä¸‹è½½/&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            resultMap.put(<span class="string">&quot;status&quot;</span>, STATUS_ERROR);</span><br><span class="line">            <span class="keyword">return</span> resultMap;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–åŸæ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å: &quot;</span> + originalFileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶ç±»å‹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> originalFileName.substring(originalFileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ç±»å‹: &quot;</span> + fileType);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ–‡ä»¶ä¿å­˜åˆ°ä¸åº”ç”¨åŒä¸€ä¸ªæœåŠ¡å™¨</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">saveFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + originalFileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–°æ–‡ä»¶:&quot;</span> + saveFile.toString());</span><br><span class="line">        <span class="keyword">if</span> (!saveFile.exists()) &#123;</span><br><span class="line">            file.transferTo(saveFile);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›å›¾ç‰‡Base64</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">imageBase64</span> <span class="operator">=</span> fileToBase64(saveFile);</span><br><span class="line">            resultMap.put(<span class="string">&quot;imageBase64&quot;</span>, imageBase64);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resultMap.put(<span class="string">&quot;status&quot;</span>, STATUS_SUCCESS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/postTest&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;æµ‹è¯•å‰åç«¯äº¤äº’çš„æ¥å£&quot;, notes = &quot;æµ‹è¯•å‰åç«¯äº¤äº’çš„æ¥å£&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">postTest</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶è½¬æ¢æˆBase64ç¼–ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶è½¬æ¢ä¸ºbase64</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fileToBase64</span><span class="params">(File file)</span> &#123;<span class="comment">//å°†å›¾ç‰‡æ–‡ä»¶è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„å­—ç¬¦ä¸²ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç å¤„ç†</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] fileData = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// è¯»å–æ–‡ä»¶å­—èŠ‚æ•°ç»„</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            in = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">            fileData = <span class="keyword">new</span> <span class="title class_">byte</span>[in.available()];</span><br><span class="line">            in.read(fileData);</span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹å­—èŠ‚æ•°ç»„Base64ç¼–ç å¹¶ä¸”è¿”å›</span></span><br><span class="line">        <span class="type">BASE64Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>();</span><br><span class="line">        <span class="keyword">return</span> encoder.encode(fileData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h2 id="å‚è€ƒç½‘ç«™"><a href="#å‚è€ƒç½‘ç«™" class="headerlink" title="å‚è€ƒç½‘ç«™"></a>å‚è€ƒç½‘ç«™</h2><p><a href="https://www.jianshu.com/p/be1af489551c">Springbootæ–‡ä»¶ä¸Šä¼ ä¸‹è½½</a></p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®</title>
      <link href="/2021/05/26/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AF%BC%E5%85%A5excel%E6%95%B0%E6%8D%AE/"/>
      <url>/2021/05/26/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AF%BC%E5%85%A5excel%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®"><a href="#Java-å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®" class="headerlink" title="Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®"></a>Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®</h1><p>é¡¹ç›®æºç ï¼š</p><ul><li>å‰ç«¯<code>springboo-excel</code></li><li>åç«¯<code>springboot-excel-process</code></li></ul><p>â€</p><p>æœ¬è´¨ä¸Šæ˜¯å¦‚ä½•é«˜æ•ˆåœ°å¤„ç†å¤§é‡çš„æ•°æ®é›†åˆï¼š</p><ul><li>ä»ä¸€ä¸ªæ•°æ®åº“æŠ“å–å¦ä¸€ä¸ªæ•°æ®åº“çš„å¤§é‡æ•°æ®</li><li>ä»å¤§æ–‡ä»¶Excelä¸­å¯¼å…¥åˆ°æ•°æ®åº“</li></ul><h2 id="ç›®æ ‡åˆ†è§£"><a href="#ç›®æ ‡åˆ†è§£" class="headerlink" title="ç›®æ ‡åˆ†è§£"></a>ç›®æ ‡åˆ†è§£</h2><p>ä½¿ç”¨springbootï¼Œæ–¹ä¾¿ä½¿ç”¨ä¾èµ–å’Œåç»­çš„æ–‡ä»¶ä¸Šä¼ </p><ol><li><p>ä½¿ç”¨POIç”ŸæˆExcelæ–‡ä»¶</p></li><li><p>ä½¿ç”¨POIè§£æExcelæ–‡ä»¶</p></li><li><p>å¤šçº¿ç¨‹æ‹†åˆ†Excelæ–‡ä»¶ï¼Œå¹¶å¯¼å…¥åˆ°æ•°æ®åº“ï¼Œè§‚å¯Ÿè€—æ—¶</p><ol><li>å°è¯•ä½¿ç”¨å¤šçº¿ç¨‹ä»¥é™ä½è€—æ—¶</li><li>ä½¿ç”¨ spring jdbc templateï¼Œå‰ç«¯ä½¿ç”¨MultipartFile</li><li>ç”Ÿäº§è€…è¯»å–ï¼Œæ¶ˆè´¹è€…å†™å…¥</li></ol></li></ol><p>â€</p><h2 id="Springbooté€šç”¨é…ç½®"><a href="#Springbooté€šç”¨é…ç½®" class="headerlink" title="Springbooté€šç”¨é…ç½®"></a>Springbooté€šç”¨é…ç½®</h2><p>0.<code>application.yml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: oracle</span><br></pre></td></tr></table></figure><p>â€</p><p>1.<code>application-oracle.yml</code>ï¼Œç”¨äºè¿æ¥oracleæ•°æ®åº“</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8003</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  # æ•°æ®æºçš„ç›¸å…³é…ç½®</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.zaxxer.hikari.HikariDataSource          # æ•°æ®æºç±»å‹ï¼šHikariCP</span><br><span class="line">    driver-class-name: oracle.jdbc.driver.OracleDriver</span><br><span class="line">    url: jdbc:oracle:thin:@10.38.1.101:1521:PROD</span><br><span class="line">    username: apps</span><br><span class="line">    password: It2017</span><br><span class="line">    hikari:</span><br><span class="line">      connection-timeout: 30000       # ç­‰å¾…è¿æ¥æ± åˆ†é…è¿æ¥çš„æœ€å¤§æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é•¿è¿˜æ²¡å¯ç”¨çš„è¿æ¥åˆ™å‘ç”ŸSQLExceptionï¼Œ é»˜è®¤:30ç§’</span><br><span class="line">      minimum-idle: 5                 # æœ€å°è¿æ¥æ•°</span><br><span class="line">      maximum-pool-size: 20           # æœ€å¤§è¿æ¥æ•°</span><br><span class="line">      auto-commit: true               # è‡ªåŠ¨æäº¤</span><br><span class="line">      idle-timeout: 600000            # è¿æ¥è¶…æ—¶çš„æœ€å¤§æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åˆ™è¢«é‡Šæ”¾ï¼ˆretiredï¼‰ï¼Œé»˜è®¤:10åˆ†é’Ÿ</span><br><span class="line">      pool-name: DateSourceHikariCP   # è¿æ¥æ± åå­—</span><br><span class="line">      max-lifetime: 1800000           # è¿æ¥çš„ç”Ÿå‘½æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶è€Œä¸”æ²¡è¢«ä½¿ç”¨åˆ™è¢«é‡Šæ”¾ï¼ˆretiredï¼‰ï¼Œé»˜è®¤:30åˆ†é’Ÿ 1800000ms</span><br><span class="line">      connection-test-query: SELECT 1 FROM DUAL</span><br><span class="line">  application:</span><br><span class="line">    name: spring-excel</span><br></pre></td></tr></table></figure><p>â€</p><p>2.<code>pom.xml</code> ä½¿ç”¨jdk1.8</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-excel-process<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- apache poi --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ç”¨äºæ“ä½œå¾®è½¯åŠå…¬æ–‡æ¡£ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Spring Jdbc Template --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Oralce Jdbc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle.database.jdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>12.2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- fastJson --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Java ç¼–è¯‘ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€</p><p>3.<code>swagger2.java</code>æ¥å£è°ƒè¯•é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package com.excel.config;</span><br><span class="line"></span><br><span class="line">import com.google.common.base.Predicate;</span><br><span class="line">import com.google.common.base.Predicates;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import springfox.documentation.RequestHandler;</span><br><span class="line">import springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line">import springfox.documentation.builders.PathSelectors;</span><br><span class="line">import springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line">import springfox.documentation.service.ApiInfo;</span><br><span class="line">import springfox.documentation.service.Contact;</span><br><span class="line">import springfox.documentation.spi.DocumentationType;</span><br><span class="line">import springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line">import springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableSwagger2</span><br><span class="line">public class Swagger2 &#123;</span><br><span class="line"></span><br><span class="line">//    http://localhost:8088/swagger-ui.html     åŸè·¯å¾„</span><br><span class="line">//    http://localhost:8088/doc.html     æ–°è·¯å¾„ï¼Œgithubå¼€æºçš„swaggeré¡µé¢ï¼Œè‡ªå¸¦æ±‰åŒ–</span><br><span class="line">    // é…ç½®swagger2æ ¸å¿ƒé…ç½® docket</span><br><span class="line">    @Bean</span><br><span class="line">    public Docket createRestApi() &#123;</span><br><span class="line"></span><br><span class="line">        Predicate<span class="tag">&lt;<span class="name">RequestHandler</span>&gt;</span> excelPredicate = RequestHandlerSelectors.basePackage(&quot;com.excel.controller&quot;);</span><br><span class="line"></span><br><span class="line">        return new Docket(DocumentationType.SWAGGER_2)  // æŒ‡å®šapiç±»å‹ä¸ºswagger2</span><br><span class="line">                .apiInfo(apiInfo())                 // ç”¨äºå®šä¹‰apiæ–‡æ¡£æ±‡æ€»ä¿¡æ¯</span><br><span class="line">                .select()</span><br><span class="line">                .apis(Predicates.or(excelPredicate))</span><br><span class="line">                .paths(PathSelectors.any())         // æ‰€æœ‰controller</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    private ApiInfo apiInfo() &#123;</span><br><span class="line">        return new ApiInfoBuilder()</span><br><span class="line">                .title(&quot;sora blogÂ·åšå®¢æ¥å£api&quot;)                       // æ–‡æ¡£é¡µæ ‡é¢˜</span><br><span class="line">                .contact(new Contact(&quot;sora&quot;,</span><br><span class="line">                        &quot;https://www.kalosora.work&quot;,</span><br><span class="line">                        &quot;kalosora@gmail.com&quot;))                   // è”ç³»äººä¿¡æ¯</span><br><span class="line">                .description(&quot;sora blogåšå®¢çš„apiæ–‡æ¡£&quot;)      // è¯¦ç»†ä¿¡æ¯</span><br><span class="line">                .version(&quot;1.0.0&quot;)                               // æ–‡æ¡£ç‰ˆæœ¬å·</span><br><span class="line">                .termsOfServiceUrl(&quot;https://www.kalosora.work&quot;)     // ç½‘ç«™åœ°å€</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>â€</p><h2 id="ç”ŸæˆExcelæ–‡ä»¶"><a href="#ç”ŸæˆExcelæ–‡ä»¶" class="headerlink" title="ç”ŸæˆExcelæ–‡ä»¶"></a>ç”ŸæˆExcelæ–‡ä»¶</h2><h3 id="ç”Ÿæˆç®€å•çš„Excelè¡¨æ ¼"><a href="#ç”Ÿæˆç®€å•çš„Excelè¡¨æ ¼" class="headerlink" title="ç”Ÿæˆç®€å•çš„Excelè¡¨æ ¼"></a>ç”Ÿæˆç®€å•çš„Excelè¡¨æ ¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;excel&quot;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;EXCELå¤„ç†ç›¸å…³Controller&quot;, tags = &#123;&quot;EXCELå¤„ç†ç›¸å…³Controller&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºExcelæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * ä¸€ä¸ªExcelæ–‡ä»¶ï¼ŒåŒ…æ‹¬å¤šä¸ªSheetï¼›ä¸€ä¸ªSheetåŒ…æ‹¬å¤šä¸ªCell</span></span><br><span class="line"><span class="comment">     * ä¸€ä¸ªCellåŒ…æ‹¬å¤šä¸ªColumn</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;createSampleExcel&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;åˆ›å»ºç®€å•Excelæ–‡ä»¶&quot;, notes = &quot;åˆ›å»ºç®€å•Excelæ–‡ä»¶&quot;, httpMethod = &quot;GET&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createExcel</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">excelFilePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/sample.xls&quot;</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">excelFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(excelFilePath);</span><br><span class="line">        <span class="keyword">if</span> (excelFile.exists()) &#123;</span><br><span class="line">            excelFile.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å§‹åˆ›å»ºExcel</span></span><br><span class="line">        <span class="type">HSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>();</span><br><span class="line">        <span class="type">HSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line">        <span class="comment">// ä»ç¬¬0è¡Œå¼€å§‹åˆ›å»º</span></span><br><span class="line">        <span class="type">HSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®å•å…ƒæ ¼å†…å®¹ï¼Œä»0å¼€å§‹</span></span><br><span class="line">        row.createCell(<span class="number">0</span>).setCellValue(<span class="string">&quot;å‘ç¥¨ç¼–å·&quot;</span>);</span><br><span class="line">        row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;ç»è¥å•ä½&quot;</span>);</span><br><span class="line">        row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;GLæ—¥æœŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®Excelå¤‡æ³¨ä¿¡æ¯</span></span><br><span class="line">        setExcelDesc(workbook);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™å…¥åˆ°Excel</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(excelFile);</span><br><span class="line">        workbook.write(fos);</span><br><span class="line">        workbook.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;åˆ›å»ºæˆåŠŸ!è¾“å‡ºåˆ°:&quot;</span> + excelFilePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®Excelæ–‡æ¡£ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setExcelDesc</span><span class="params">(HSSFWorkbook workbook)</span> &#123;</span><br><span class="line">        workbook.createInformationProperties();                     <span class="comment">//åˆ›å»ºæ–‡æ¡£ä¿¡æ¯</span></span><br><span class="line">        <span class="type">DocumentSummaryInformation</span> <span class="variable">dsi</span> <span class="operator">=</span> workbook.getDocumentSummaryInformation();<span class="comment">//æ‘˜è¦ä¿¡æ¯</span></span><br><span class="line">        dsi.setCategory(<span class="string">&quot;Excelæ–‡ä»¶&quot;</span>);                                <span class="comment">//ç±»åˆ«</span></span><br><span class="line">        dsi.setManager(<span class="string">&quot;kalosora&quot;</span>);                                 <span class="comment">//ç®¡ç†è€…</span></span><br><span class="line">        dsi.setCompany(<span class="string">&quot;--&quot;</span>);                                       <span class="comment">//å…¬å¸</span></span><br><span class="line">        <span class="type">SummaryInformation</span> <span class="variable">si</span> <span class="operator">=</span> workbook.getSummaryInformation();   <span class="comment">//æ‘˜è¦ä¿¡æ¯</span></span><br><span class="line">        si.setSubject(<span class="string">&quot;æµ‹è¯•æ–‡æ¡£&quot;</span>);                                   <span class="comment">//ä¸»é¢˜</span></span><br><span class="line">        si.setTitle(<span class="string">&quot;æµ‹è¯•æ–‡æ¡£&quot;</span>);                                     <span class="comment">//æ ‡é¢˜</span></span><br><span class="line">        si.setAuthor(<span class="string">&quot;kalosora&quot;</span>);                                   <span class="comment">//ä½œè€…</span></span><br><span class="line">        si.setComments(<span class="string">&quot;POIæµ‹è¯•æ–‡æ¡£&quot;</span>);                               <span class="comment">//å¤‡æ³¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ”¹è¿›ï¼šä»æ•°æ®åº“å¯¼å‡ºåˆ°excel"><a href="#æ”¹è¿›ï¼šä»æ•°æ®åº“å¯¼å‡ºåˆ°excel" class="headerlink" title="æ”¹è¿›ï¼šä»æ•°æ®åº“å¯¼å‡ºåˆ°excel"></a>æ”¹è¿›ï¼šä»æ•°æ®åº“å¯¼å‡ºåˆ°excel</h3><p>ä½¿ç”¨spring jdbc Templateå¯¼å‡ºexcelæ–‡ä»¶</p><p>Repositoryå±‚ï¼Œ<code>ApInvoiceVO.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.excel.repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘ç¥¨å®ä½“ç±»VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApInvoiceVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘ç¥¨ç¼–å·</span></span><br><span class="line">    <span class="keyword">private</span> String invoiceNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»è¥å•ä½</span></span><br><span class="line">    <span class="keyword">private</span> String orgName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ€»è´¦æ—¥æœŸ</span></span><br><span class="line">    <span class="keyword">private</span> String glDate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter &amp; setter</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInvoiceNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> invoiceNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInvoiceNum</span><span class="params">(String invoiceNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.invoiceNum = invoiceNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrgName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orgName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrgName</span><span class="params">(String orgName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orgName = orgName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGlDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> glDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGlDate</span><span class="params">(String glDate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.glDate = glDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>Serviceå±‚ï¼Œ<code>ApInvoiceService.java</code>ï¼Œä½¿ç”¨Jdbc Template</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘ç¥¨Serviceå±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApInvoiceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApInvoiceService</span><span class="params">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å‘ç¥¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ApInvoiceVO&gt; <span class="title function_">queryInvoiceInfo</span><span class="params">(String querySql)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(querySql, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(ApInvoiceVO.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>Controllerå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/createExcelFromDB&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;ä»æ•°æ®åº“å¯¼å‡ºExcelæ–‡ä»¶&quot;, notes = &quot;ä»æ•°æ®åº“å¯¼å‡ºExcelæ–‡ä»¶&quot;, httpMethod = &quot;GET&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">createExcelFromDB</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ•°æ®æº</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    sb.append(<span class="string">&quot;select aia.invoice_num,hou.name org_name,to_char(aia.gl_date,&#x27;yyyy-mm-dd hh24:mi:ss&#x27;) gl_date &quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;from ap_invoices_all aia,hr_operating_units hou &quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;where 1=1 and aia.org_id = hou.organization_id &quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;and gl_date &gt;= to_date(&#x27;2021-05-01&#x27;,&#x27;yyyy-mm-dd&#x27;)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fixmeï¼šæµ‹è¯•sqlè¯­å¥</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æŸ¥è¯¢è¯­å¥:&quot;</span> + sb.toString());</span><br><span class="line"></span><br><span class="line">    List&lt;ApInvoiceVO&gt; invoiceVOList = apInvoiceService.queryInvoiceInfo(sb.toString());</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">excelFilePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/sampleDB.xls&quot;</span>;</span><br><span class="line">    <span class="type">File</span> <span class="variable">excelFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(excelFilePath);</span><br><span class="line">    <span class="keyword">if</span> (excelFile.exists()) &#123;</span><br><span class="line">        excelFile.createNewFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹åˆ›å»ºExcel</span></span><br><span class="line">    <span class="type">HSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>();</span><br><span class="line">    <span class="type">HSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®è¡¨å¤´</span></span><br><span class="line">    <span class="type">HSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>);</span><br><span class="line">    row.createCell(<span class="number">0</span>).setCellValue(<span class="string">&quot;å‘ç¥¨ç¼–å·&quot;</span>);</span><br><span class="line">    row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;ç»è¥å•ä½&quot;</span>);</span><br><span class="line">    row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;GLæ—¥æœŸ&quot;</span>);</span><br><span class="line">    <span class="comment">// å†™å…¥åˆ°Sheet1ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; invoiceVOList.size(); i++) &#123;</span><br><span class="line">        row = sheet.createRow(i);</span><br><span class="line">        <span class="comment">// è®¾ç½®å•å…ƒæ ¼å†…å®¹ï¼Œä»0å¼€å§‹</span></span><br><span class="line">        row.createCell(<span class="number">0</span>).setCellValue(invoiceVOList.get(i).getInvoiceNum());</span><br><span class="line">        row.createCell(<span class="number">1</span>).setCellValue(invoiceVOList.get(i).getOrgName());</span><br><span class="line">        row.createCell(<span class="number">2</span>).setCellValue(invoiceVOList.get(i).getGlDate());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®Excelå¤‡æ³¨ä¿¡æ¯</span></span><br><span class="line">    setExcelDesc(workbook);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å…¥åˆ°Excel</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(excelFile);</span><br><span class="line">    workbook.write(fos);</span><br><span class="line">    workbook.close();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;åˆ›å»ºæˆåŠŸ!è¾“å‡ºåˆ°:&quot;</span> + excelFilePath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ”¹è¿›ï¼šfreemarkerå¯¼å‡ºåˆ°excel"><a href="#æ”¹è¿›ï¼šfreemarkerå¯¼å‡ºåˆ°excel" class="headerlink" title="æ”¹è¿›ï¼šfreemarkerå¯¼å‡ºåˆ°excel"></a>æ”¹è¿›ï¼šfreemarkerå¯¼å‡ºåˆ°excel</h3><p>ä¸Šä¼ sqlæ–‡ä»¶ï¼Œå¹¶ä¸”å¯¼å‡ºåˆ°excel</p><p>æ­¥éª¤åˆ†è§£</p><ol><li>ä»fileä¸­è·å–sqlè¯­å¥</li><li>è¯»å–selectåï¼Œfromå‰çš„æ‰€æœ‰å­—æ®µï¼Œç”Ÿæˆå­—èŠ‚ç ï¼ˆåŠ¨æ€ç”Ÿæˆå®ä½“ç±»ï¼‰</li><li>è¿æ¥æ•°æ®åº“ï¼Œé€šè¿‡freemarkerå¯¼å‡ºåˆ°excel</li></ol><p>â€</p><h2 id="ä»Excelå¯¼å…¥"><a href="#ä»Excelå¯¼å…¥" class="headerlink" title="ä»Excelå¯¼å…¥"></a>ä»Excelå¯¼å…¥</h2><h3 id="è§£æç®€å•çš„Excelè¡¨æ ¼"><a href="#è§£æç®€å•çš„Excelè¡¨æ ¼" class="headerlink" title="è§£æç®€å•çš„Excelè¡¨æ ¼"></a>è§£æç®€å•çš„Excelè¡¨æ ¼</h3><p>excelåŒ…å«å°‘é‡æ•°æ®ï¼Œä½¿ç”¨Spring Jdbc Templateå¤„ç†ï¼Œå¹¶åœ¨æ•°æ®åº“åˆ›å»ºè®°å½•</p><p>ã€æ³¨æ„ã€‘xlsæ ¼å¼æœ€å¤§è¡Œæ•°ä¸º65535ï¼Œä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨æ–‡ä»¶ï¼›xlsxæ ¼å¼ä»¥xmlå½¢å¼å­˜å‚¨æ–‡ä»¶ï¼Œå¯ä»¥æœ€å¤šå­˜å‚¨100w+è¡Œæ•°æ®</p><p>å‰ç«¯ï¼š<code>excel.html</code>ï¼Œä½¿ç”¨Vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Excelæ–‡ä»¶ä¸Šä¼ é¡µé¢<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;excelProcess&quot;</span>&gt;</span></span><br><span class="line">        è¯·é€‰æ‹©excelæ–‡ä»¶: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;excelUpload&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æµ‹è¯•è¿æ¥&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;testPostStatus&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./vue/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./vue/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> excelProcess = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#excelProcess&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// æµ‹è¯•å‰åç«¯è¿æ¥</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">testPostStatus</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> postUrl = <span class="string">&quot;http://localhost:8003/testPost?postMsg=&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> msg = <span class="string">&quot;ä»VUEå‘é€æ¶ˆæ¯!&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(postUrl + msg).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;è¿æ¥æœåŠ¡å™¨æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;è¿æ¥æœåŠ¡å™¨å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// ä¸Šä¼ Excelæ–‡ä»¶</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">excelUpload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> excelUploadUrl = <span class="string">&quot;http://localhost:8003/excel/readExcelIntoDB&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;excel&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">file</span>.<span class="property">files</span>[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(excelUploadUrl, formData).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">alert</span>(<span class="string">&quot;æ–‡ä»¶è§£æå¤±è´¥ï¼&quot;</span> + res.<span class="property">data</span>.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€</p><p>åç«¯ï¼Œè¿æ¥çš„æ˜¯mysqlæ•°æ®åº“</p><p><code>ExcelService.java</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.excel.service;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class ExcelService &#123;</span><br><span class="line"></span><br><span class="line">    private final JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public ExcelService(JdbcTemplate jdbcTemplate) &#123;</span><br><span class="line">        this.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void insertExcelData(String sqlStr)</span><br><span class="line">    &#123;</span><br><span class="line">        jdbcTemplate.update(sqlStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p><code>ExcelController.java</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ä»æ•°æ®åº“å¯¼å‡ºåˆ°Excel</span><br><span class="line"> *</span><br><span class="line"> * @return</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">@GetMapping(&quot;/createExcelFromDB&quot;)</span><br><span class="line">@ApiOperation(value = &quot;ä»æ•°æ®åº“å¯¼å‡ºExcelæ–‡ä»¶&quot;, notes = &quot;ä»æ•°æ®åº“å¯¼å‡ºExcelæ–‡ä»¶&quot;, httpMethod = &quot;GET&quot;)</span><br><span class="line">public String createExcelFromDB() throws IOException &#123;</span><br><span class="line"></span><br><span class="line">    // è·å–æ•°æ®æº</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    sb.append(&quot;select aia.invoice_num,hou.name org_name,to_char(aia.gl_date,&#x27;yyyy-mm-dd hh24:mi:ss&#x27;) gl_date &quot;);</span><br><span class="line">    sb.append(&quot;from ap_invoices_all aia,hr_operating_units hou &quot;);</span><br><span class="line">    sb.append(&quot;where 1=1 and aia.org_id = hou.organization_id &quot;);</span><br><span class="line">    sb.append(&quot;and gl_date &gt;= to_date(&#x27;2021-05-01&#x27;,&#x27;yyyy-mm-dd&#x27;)&quot;);</span><br><span class="line"></span><br><span class="line">    // fixmeï¼šæµ‹è¯•sqlè¯­å¥</span><br><span class="line">    System.out.println(&quot;æŸ¥è¯¢è¯­å¥:&quot; + sb.toString());</span><br><span class="line"></span><br><span class="line">    List<span class="tag">&lt;<span class="name">ApInvoiceVO</span>&gt;</span> invoiceVOList = apInvoiceService.queryInvoiceInfo(sb.toString());</span><br><span class="line"></span><br><span class="line">    String excelFilePath = &quot;/Users/kalosora/Desktop/sampleDB.xls&quot;;</span><br><span class="line">    File excelFile = new File(excelFilePath);</span><br><span class="line">    if (excelFile.exists()) &#123;</span><br><span class="line">        excelFile.createNewFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å¼€å§‹åˆ›å»ºExcel</span><br><span class="line">    HSSFWorkbook workbook = new HSSFWorkbook();</span><br><span class="line">    HSSFSheet sheet = workbook.createSheet(&quot;Sheet1&quot;);</span><br><span class="line">    // è®¾ç½®è¡¨å¤´</span><br><span class="line">    HSSFRow row = sheet.createRow(0);</span><br><span class="line">    row.createCell(0).setCellValue(&quot;å‘ç¥¨ç¼–å·&quot;);</span><br><span class="line">    row.createCell(1).setCellValue(&quot;ç»è¥å•ä½&quot;);</span><br><span class="line">    row.createCell(2).setCellValue(&quot;GLæ—¥æœŸ&quot;);</span><br><span class="line">    // å†™å…¥åˆ°Sheet1ä¸­</span><br><span class="line">    for (int i = 1; i &lt; invoiceVOList.size(); i++) &#123;</span><br><span class="line">        row = sheet.createRow(i);</span><br><span class="line">        // è®¾ç½®å•å…ƒæ ¼å†…å®¹ï¼Œä»0å¼€å§‹</span><br><span class="line">        row.createCell(0).setCellValue(invoiceVOList.get(i).getInvoiceNum());</span><br><span class="line">        row.createCell(1).setCellValue(invoiceVOList.get(i).getOrgName());</span><br><span class="line">        row.createCell(2).setCellValue(invoiceVOList.get(i).getGlDate());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è®¾ç½®Excelå¤‡æ³¨ä¿¡æ¯</span><br><span class="line">    setExcelDesc(workbook);</span><br><span class="line"></span><br><span class="line">    // å†™å…¥åˆ°Excel</span><br><span class="line">    FileOutputStream fos = new FileOutputStream(excelFile);</span><br><span class="line">    workbook.write(fos);</span><br><span class="line">    workbook.close();</span><br><span class="line"></span><br><span class="line">    return &quot;åˆ›å»ºæˆåŠŸ!è¾“å‡ºåˆ°:&quot; + excelFilePath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è§£æExcelæ–‡ä»¶ï¼Œå¹¶æ’å…¥åˆ°æ•°æ®åº“</span><br><span class="line"> *</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/readExcelIntoDB&quot;)</span><br><span class="line">@ApiOperation(value = &quot;è§£æExcelæ–‡ä»¶å¹¶æ’å…¥åˆ°æ•°æ®åº“&quot;, notes = &quot;è§£æExcelæ–‡ä»¶å¹¶æ’å…¥åˆ°æ•°æ®åº“&quot;, httpMethod = &quot;POST&quot;)</span><br><span class="line">public Map&lt;String, Object&gt; readExcelIntoDB(@RequestParam(&quot;excel&quot;) MultipartFile excel) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; resultMap = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    // æ ¡éªŒæ–‡ä»¶ç±»å‹</span><br><span class="line">    String originFile = excel.getOriginalFilename();</span><br><span class="line">    if (!originFile.contains(&quot;xls&quot;) &amp;&amp; !originFile.contains(&quot;xlsx&quot;)) &#123;</span><br><span class="line">        resultMap.put(&quot;status&quot;, -1);</span><br><span class="line">        resultMap.put(&quot;msg&quot;, &quot;æ— æ³•è§£æçš„Excelæ–‡ä»¶ç±»å‹&quot;);</span><br><span class="line">        return resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è§£æExcelæ–‡ä»¶ï¼Œxlsæ–‡ä»¶æœ€å¤§è¡Œæ•°65535ï¼Œä½¿ç”¨POIè¿›è¡Œç®€å•çš„æ•°æ®å¯¼å…¥</span><br><span class="line">    Map&lt;Integer, List<span class="tag">&lt;<span class="name">String</span>&gt;</span>&gt; excelMap = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    try &#123;</span><br><span class="line">        InputStream is = excel.getInputStream();</span><br><span class="line">        Workbook workBook = new HSSFWorkbook(is, true);</span><br><span class="line">        excelMap = processWorkBook(workBook);</span><br><span class="line"></span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        System.out.println(&quot;è·å–Excelæ–‡ä»¶å¤±è´¥ï¼š&quot; + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ‹¼æ¥Mysql SQLè¯­å¥,å½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨å®ä½“ç±»çš„æ–¹å¼ã€‚æ‹¼æ¥çš„æ–¹å¼æ¯”è¾ƒèŠ‚çœç©ºé—´</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    sb.append(&quot;insert into `sample-table` (column1,column2,column3) values &quot;);</span><br><span class="line">    // æ’å…¥åˆ°æ•°æ®åº“ï¼Œç¬¬0è¡Œä¸€èˆ¬ä¸ºæ ‡é¢˜ï¼Œæ•…å¿½ç•¥</span><br><span class="line">    for (int i = 1; i &lt; excelMap.size(); i++) &#123;</span><br><span class="line">        List<span class="tag">&lt;<span class="name">String</span>&gt;</span> columnList = excelMap.get(i);</span><br><span class="line"></span><br><span class="line">        StringJoiner joiner = new StringJoiner(&quot;,&quot;, &quot;(&quot;, &quot;),&quot;);</span><br><span class="line">        for (String column : columnList) &#123;</span><br><span class="line">            column = &quot;&#x27;&quot; + column + &quot;&#x27;&quot;;</span><br><span class="line">            joiner.add(column);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(joiner);</span><br><span class="line">    &#125;</span><br><span class="line">    String sqlStr = sb.toString();</span><br><span class="line">    sqlStr = sqlStr.substring(0, sqlStr.lastIndexOf(&quot;,&quot;));</span><br><span class="line">    System.out.println(&quot;sqlè¯­å¥:&quot; + sqlStr);</span><br><span class="line"></span><br><span class="line">    // æ’å…¥åˆ°æ•°æ®åº“</span><br><span class="line">    excelService.insertExcelData(sqlStr);</span><br><span class="line"></span><br><span class="line">    resultMap.put(&quot;status&quot;, 200);</span><br><span class="line">    return resultMap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å¤„ç†Excelæ–‡ä»¶</span><br><span class="line"> *</span><br><span class="line"> * @param workbook</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">private Map&lt;Integer, List<span class="tag">&lt;<span class="name">String</span>&gt;</span>&gt; processWorkBook(Workbook workbook) &#123;</span><br><span class="line">    Sheet sheet = workbook.getSheetAt(0);</span><br><span class="line"></span><br><span class="line">    // äºŒç»´é›†åˆå¯¹åº”ExceläºŒç»´è¡¨</span><br><span class="line">    Map&lt;Integer, List<span class="tag">&lt;<span class="name">String</span>&gt;</span>&gt; map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    int i = 0;</span><br><span class="line">    for (Row row : sheet) &#123;</span><br><span class="line">        map.put(i, new ArrayList<span class="tag">&lt;<span class="name">String</span>&gt;</span>());</span><br><span class="line">        for (Cell cell : row) &#123; // éå†å½“å‰è¡Œçš„æ‰€æœ‰cell</span><br><span class="line">            switch (cell.getCellType()) &#123;</span><br><span class="line">                case STRING:</span><br><span class="line">                    map.get(i).add(cell.getRichStringCellValue().getString()); // å¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™ä¿å­˜</span><br><span class="line">                    break;</span><br><span class="line">                case _NONE:</span><br><span class="line">                    break;</span><br><span class="line">                case NUMERIC:</span><br><span class="line">                    map.get(i).add(cell.getNumericCellValue() + &quot;&quot;); //å°†æ•°å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">                    break;</span><br><span class="line">                case BOOLEAN:</span><br><span class="line">                    break;</span><br><span class="line">                case FORMULA:</span><br><span class="line">                    break;</span><br><span class="line">                case BLANK:</span><br><span class="line">                    break;</span><br><span class="line">                case ERROR:</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>â€</p><h4 id="æ”¹è¿›ï¼šæ·»åŠ AOPå¹¶è§‚å¯Ÿå•çº¿ç¨‹è¿è¡Œé€Ÿåº¦"><a href="#æ”¹è¿›ï¼šæ·»åŠ AOPå¹¶è§‚å¯Ÿå•çº¿ç¨‹è¿è¡Œé€Ÿåº¦" class="headerlink" title="æ”¹è¿›ï¼šæ·»åŠ AOPå¹¶è§‚å¯Ÿå•çº¿ç¨‹è¿è¡Œé€Ÿåº¦"></a>æ”¹è¿›ï¼šæ·»åŠ AOPå¹¶è§‚å¯Ÿå•çº¿ç¨‹è¿è¡Œé€Ÿåº¦</h4><p>å°è¯•å¯¼å…¥10wæ¡æ•°æ®ï¼Œå¹¶è§‚å¯Ÿå¯¼å…¥çš„é€Ÿåº¦ï¼Œæ·»åŠ AOPæ‹¦æˆª</p><h5 id="AOPé…ç½®"><a href="#AOPé…ç½®" class="headerlink" title="AOPé…ç½®"></a>AOPé…ç½®</h5><p>0.ä¿®æ”¹<code>application.yml</code>é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å…è®¸ä¸Šä¼ æ–‡ä»¶çš„å°ºå¯¸</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: mariadb</span><br><span class="line">  servlet:</span><br><span class="line">    multipart:</span><br><span class="line">      max-file-size: 50MB</span><br><span class="line">      max-request-size: 50MB</span><br></pre></td></tr></table></figure><p>1.<code>pom.xml</code>å¼•å…¥AOPä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.Aspecté…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.excel.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceLogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ServiceLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * AOPé€šçŸ¥ï¼š</span></span><br><span class="line"><span class="comment">     * 1.å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * 2.åç½®é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * 3.ç¯ç»•é€šçŸ¥ï¼šè°ƒç”¨serviceä¹‹å‰å’Œä¹‹åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * 4.å¼‚å¸¸é€šçŸ¥ï¼šserviceå‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * 5.æœ€ç»ˆé€šçŸ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.excel.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordTimeOfService</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;==== å¼€å§‹æ‰§è¡Œ &#123;&#125;.&#123;&#125; ====&quot;</span>,</span><br><span class="line">                joinPoint.getTarget().getClass(),</span><br><span class="line">                joinPoint.getSignature().getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">takeTime</span> <span class="operator">=</span> end - start;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (takeTime &gt; <span class="number">3000</span>) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;å½“å‰æ‰§è¡Œè€—æ—¶ï¼š&#123;&#125;&quot;</span>, takeTime);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (takeTime &gt; <span class="number">2000</span>) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;å½“å‰æ‰§è¡Œè€—æ—¶ï¼š&#123;&#125;&quot;</span>, takeTime);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;å½“å‰æ‰§è¡Œè€—æ—¶ï¼š&#123;&#125;&quot;</span>, takeTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h5 id="æ•°æ®å¯¼å…¥æµ‹è¯•"><a href="#æ•°æ®å¯¼å…¥æµ‹è¯•" class="headerlink" title="æ•°æ®å¯¼å…¥æµ‹è¯•"></a>æ•°æ®å¯¼å…¥æµ‹è¯•</h5><p>å‡†å¤‡äº†10wè¡Œçš„xlsæ–‡æ¡£ï¼Œå¯¼å…¥åˆ°ç©ºè¡¨ï¼Œè§‚å¯Ÿæµ‹è¯•ç»“æœ</p><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210526102050-srjdrwj.png)</p><p>â€</p><p>å®é™…æµ‹è¯•å‘ç°ï¼Œä»…èƒ½å¯¼å…¥65535è¡Œï¼Œè€—æ—¶1875ms</p><p>springbootå•æœºå¯¼å…¥</p><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210526103408-jsigw9k.png)</p><p>mysqlæ•°æ®æ€»æ•°</p><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210526102956-x5hphwk.png)</p><p>â€</p><h3 id="è§£æxlsxçš„Excelè¡¨æ ¼"><a href="#è§£æxlsxçš„Excelè¡¨æ ¼" class="headerlink" title="è§£æxlsxçš„Excelè¡¨æ ¼"></a>è§£æxlsxçš„Excelè¡¨æ ¼</h3><p>pom.xmlæ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”¨äºæ“ä½œå¾®è½¯åŠå…¬æ–‡æ¡£2007 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ XLSXè§£æçš„æ–¹æ³•</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/readExcelXLSXIntoDB&quot;)</span><br><span class="line">@ApiOperation(value = &quot;è§£æxlsxæ–‡ä»¶å¹¶æ’å…¥åˆ°æ•°æ®åº“&quot;, notes = &quot;è§£æxlsxæ–‡ä»¶å¹¶æ’å…¥åˆ°æ•°æ®åº“&quot;, httpMethod = &quot;POST&quot;)</span><br><span class="line">public Map&lt;String, Object&gt; readExcelXLSXIntoDB(@RequestParam(&quot;excel&quot;) MultipartFile excel) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; resultMap = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    // æ ¡éªŒæ–‡ä»¶ç±»å‹</span><br><span class="line">    String originFile = excel.getOriginalFilename();</span><br><span class="line">    if (!originFile.contains(&quot;xls&quot;) &amp;&amp; !originFile.contains(&quot;xlsx&quot;)) &#123;</span><br><span class="line">        resultMap.put(&quot;status&quot;, -1);</span><br><span class="line">        resultMap.put(&quot;msg&quot;, &quot;æ— æ³•è§£æçš„Excelæ–‡ä»¶ç±»å‹&quot;);</span><br><span class="line">        return resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è§£æExcelæ–‡ä»¶ï¼Œxlsxæ–‡ä»¶æœ€å¤§è¡Œæ•°100w+</span><br><span class="line">    Map&lt;Integer, List<span class="tag">&lt;<span class="name">String</span>&gt;</span>&gt; excelMap = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    try &#123;</span><br><span class="line">        InputStream is = excel.getInputStream();</span><br><span class="line">        Workbook workBook = new XSSFWorkbook(is);</span><br><span class="line">        excelMap = processWorkBook(workBook);</span><br><span class="line"></span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        System.out.println(&quot;è·å–Excelæ–‡ä»¶å¤±è´¥ï¼š&quot; + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ‹¼æ¥Mysql SQLè¯­å¥,å½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨å®ä½“ç±»çš„æ–¹å¼ã€‚æ‹¼æ¥çš„æ–¹å¼æ¯”è¾ƒèŠ‚çœç©ºé—´</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    sb.append(&quot;insert into `sample-table` (column1,column2,column3) values &quot;);</span><br><span class="line">    // æ’å…¥åˆ°æ•°æ®åº“ï¼Œç¬¬0è¡Œä¸€èˆ¬ä¸ºæ ‡é¢˜ï¼Œæ•…å¿½ç•¥</span><br><span class="line">    for (int i = 1; i &lt; excelMap.size(); i++) &#123;</span><br><span class="line">        List<span class="tag">&lt;<span class="name">String</span>&gt;</span> columnList = excelMap.get(i);</span><br><span class="line"></span><br><span class="line">        StringJoiner joiner = new StringJoiner(&quot;,&quot;, &quot;(&quot;, &quot;),&quot;);</span><br><span class="line">        for (String column : columnList) &#123;</span><br><span class="line">            column = &quot;&#x27;&quot; + column + &quot;&#x27;&quot;;</span><br><span class="line">            joiner.add(column);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(joiner);</span><br><span class="line">    &#125;</span><br><span class="line">    String sqlStr = sb.toString();</span><br><span class="line">    sqlStr = sqlStr.substring(0, sqlStr.lastIndexOf(&quot;,&quot;));</span><br><span class="line">    System.out.println(&quot;sqlè¯­å¥:&quot; + sqlStr);</span><br><span class="line"></span><br><span class="line">    // æ’å…¥åˆ°æ•°æ®åº“</span><br><span class="line">    excelService.insertExcelData(sqlStr);</span><br><span class="line"></span><br><span class="line">    resultMap.put(&quot;status&quot;, 200);</span><br><span class="line">    return resultMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>å®é™…æµ‹è¯•å‘ç°ï¼Œå¯¼å…¥10Wè¡Œ</p><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210526160723-yzwn6bj.png)</p><p>â€</p><p>mysqlæ•°æ®æ€»æ•°</p><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210526160746-jrxa084.png)</p><p>â€</p><h3 id="å¤šçº¿ç¨‹å¯¼å…¥"><a href="#å¤šçº¿ç¨‹å¯¼å…¥" class="headerlink" title="å¤šçº¿ç¨‹å¯¼å…¥"></a>å¤šçº¿ç¨‹å¯¼å…¥</h3><p>åœºæ™¯ï¼šSpringboot å•çº¿ç¨‹å¯¼å…¥100wè¡ŒExcelæ•°æ®ï¼ŒæŠ¥GCæº¢å‡º</p><blockquote><p>GC Overhead Limit Exceeded Errorç®€ä»‹</p><p>OutOfMemoryErroræ˜¯java.lang.VirtualMachineErrorçš„å­ç±»ï¼Œå½“JVMèµ„æºåˆ©ç”¨å‡ºç°é—®é¢˜æ—¶æŠ›å‡ºï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºJVMèŠ±è´¹å¤ªé•¿æ—¶é—´æ‰§è¡ŒGCä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †å†…å­˜æ—¶æŠ›å‡ºçš„ã€‚æ ¹æ®Oracleå®˜æ–¹æ–‡æ¡£ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœJavaè¿›ç¨‹èŠ±è´¹98%ä»¥ä¸Šçš„æ—¶é—´æ‰§è¡ŒGCï¼Œå¹¶ä¸”æ¯æ¬¡åªæœ‰ä¸åˆ°2%çš„å †è¢«æ¢å¤ï¼Œåˆ™JVMæŠ›å‡ºæ­¤é”™è¯¯ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>è¿™æ„å‘³ç€æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‡ ä¹è€—å°½äº†æ‰€æœ‰å¯ç”¨å†…å­˜</strong>ï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±äº†å¤ªé•¿æ—¶é—´è¯•å›¾æ¸…ç†å®ƒï¼Œå¹¶å¤šæ¬¡å¤±è´¥ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¼šä½“éªŒåˆ°åº”ç”¨ç¨‹åºå“åº”éå¸¸ç¼“æ…¢ï¼Œé€šå¸¸åªéœ€è¦å‡ æ¯«ç§’å°±èƒ½å®Œæˆçš„æŸäº›æ“ä½œï¼Œæ­¤æ—¶åˆ™éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥å®Œæˆï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„CPUæ­£åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œå› æ­¤æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚</p></blockquote><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210527134344-07tmkad.png)</p><p>â€</p><h4 id="æ”¹è¿›ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"><a href="#æ”¹è¿›ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="æ”¹è¿›ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"></a>æ”¹è¿›ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h4><h5 id="æ­¥éª¤åˆ†è§£"><a href="#æ­¥éª¤åˆ†è§£" class="headerlink" title="æ­¥éª¤åˆ†è§£"></a>æ­¥éª¤åˆ†è§£</h5><ol><li><p>è·å–ä¸Šä¼ çš„æ–‡ä»¶å¹¶ä¿å­˜å‰¯æœ¬åˆ°ä¸´æ—¶ç›®å½•</p></li><li><p>ç¡®å®šé•¿åº¦</p><ol><li>æ–‡ä»¶æ€»é•¿åº¦</li><li>æ¯ä¸ªçº¿ç¨‹å¤„ç†çš„ä»»åŠ¡é•¿åº¦</li><li>ç”Ÿäº§è€…é¢„è®¡çº¿ç¨‹æ•°ï¼Œæ ¹æ®æœºå™¨æ€§èƒ½ç»™å®šï¼Œæˆ–è€…ç”¨ æ–‡ä»¶é•¿åº¦&#x2F;çº¿ç¨‹ä»»åŠ¡é•¿åº¦</li><li>æ¶ˆè´¹è€…é¢„è®¡çº¿ç¨‹æ•°ï¼Œæ ¹æ®æœºå™¨æ€§èƒ½ç»™å®šï¼Œæˆ–è€…æŒ‰æ¯”ä¾‹åˆ†é…ï¼ˆç”Ÿäº§è€…:æ¶ˆè´¹è€… &#x3D; 4:1ï¼‰</li></ol></li><li><p>æ•°æ®åˆ†ç‰‡å¤„ç†</p><ol><li><p>å¤šçº¿ç¨‹ä»»åŠ¡ä¸€èˆ¬éƒ½æ˜¯éœ€è¦è¿›è¡Œæ•°æ®åˆ†ç‰‡</p></li><li><p>ä»»åŠ¡å¼€å§‹ä½ç½®ï¼š<code>I * çº¿ç¨‹ä»»åŠ¡é•¿åº¦</code></p></li><li><p>ä»»åŠ¡ç»“æŸä½ç½®ï¼š<code>ï¼ˆI+1ï¼‰ * çº¿ç¨‹ä»»åŠ¡é•¿åº¦</code></p></li><li><p>Excelæ–‡ä»¶å¤„ç†</p><ol><li><code>sheet.getRow(startPos).getRowNum()</code>è·å–ç‰¹å®šè¡Œæ•°è¿›è¡Œè¡Œå¾ªç¯</li><li><code>Map&lt;Integer, List&lt;String&gt;&gt;</code>å®šä¹‰æ•°æ®ç»“æ„ä¿å­˜ExceläºŒç»´è¡¨</li><li><code>map.get(i).add(cell.getRichStringCellValue().getString())</code>è¿›è¡Œåˆ—å¾ªç¯å¹¶ä¿å­˜åˆ°æ•°æ®ç»“æ„ä¸­</li><li>æ‹¼æ¥æˆmysqlçš„<code>insert into</code>è¯­å¥ï¼Œå¹¶æ”¾å…¥ç”Ÿäº§è€…é˜Ÿåˆ—ä¸­</li></ol></li></ol></li><li><p>å¼€å¯å¤šçº¿ç¨‹</p><ol><li><code>ExecutorService</code>åˆ†åˆ«å¼€å¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹</li><li><code>CountDownLatch</code>è§‚å¯Ÿç”Ÿäº§è€…ä»»åŠ¡ï¼ˆè½¬æ¢mysqlè¯­å¥ï¼‰æ˜¯å¦å®Œæˆ</li><li><code>LinkedBlockingQueue</code>çº¿ç¨‹å®‰å…¨çš„æ— ç•Œé“¾é˜Ÿåˆ—ï¼Œä¿å­˜mysqlè¯­å¥ä¾›æ¶ˆè´¹è€…è°ƒç”¨</li></ol></li></ol><p>â€</p><p>å®ä¾‹ä»£ç ï¼š</p><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/readXLSXMultiIntoDB&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;å¤šçº¿ç¨‹å¯¼å…¥xlsxæ–‡ä»¶åˆ°æ•°æ®åº“&quot;, notes = &quot;å¤šçº¿ç¨‹å¯¼å…¥xlsxæ–‡ä»¶åˆ°æ•°æ®åº“&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">readXLSXMultiIntoDB</span><span class="params">(<span class="meta">@RequestParam(&quot;excel&quot;)</span> MultipartFile excel)</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO å¤šçº¿ç¨‹å¤„ç†EXCELæ—¶ï¼Œæ–‡ä»¶è¦å…ˆä¿å­˜åˆ°æœ¬åœ°</span></span><br><span class="line">    <span class="comment">// https://blog.csdn.net/bieber007/article/details/109963775</span></span><br><span class="line">    <span class="type">MultipartFile</span> <span class="variable">multipartFile</span> <span class="operator">=</span> excel;</span><br><span class="line">    <span class="type">String</span> <span class="variable">localStorePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/exceltmp/&quot;</span> + excel.getOriginalFilename();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        multipartFile.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(localStorePath));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿å­˜ä¸Šä¼ æ–‡ä»¶å¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">localFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(localStorePath);</span><br><span class="line">    <span class="type">Workbook</span> <span class="variable">workBook</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(localFile);</span><br><span class="line">        workBook = <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(is);</span><br><span class="line">        <span class="comment">// é»˜è®¤è¯»å–ç¬¬ä¸€ä¸ªè¡¨æ ¼</span></span><br><span class="line">        sheet = workBook.getSheetAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        resultMap.put(<span class="string">&quot;status&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">        resultMap.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;è§£æExcelæ–‡ä»¶å¤±è´¥: &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿå·²çŸ¥æ–‡æ¡£é•¿åº¦ï¼Œå¦‚æœè®¡ç®—çš„è¯éœ€è¦50ç§’ï¼Œè¿™é‡ŒèŠ‚çœæ€§èƒ½</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">fileLength</span> <span class="operator">=</span> <span class="number">1000000</span>;  <span class="comment">//500000ï¼Œå•ä¸ªçº¿ç¨‹å¤„ç†5000ï¼Œé€šè¿‡æµ‹è¯•ï¼Œè€—æ—¶335s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡è®¾æ¯ä¸ªçº¿ç¨‹å¤„ç†5000æ•°æ®</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">threadLength</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ç”Ÿäº§è€… &amp; æ¶ˆè´¹è€…çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">producerThreadCount</span> <span class="operator">=</span> fileLength / threadLength;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">consumerThreadCount</span> <span class="operator">=</span> producerThreadCount / <span class="number">4</span>; <span class="comment">// ç”Ÿäº§è€…:æ¶ˆè´¹è€… 4:1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    LinkedBlockingQueue&lt;String&gt; excelQueue = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(producerThreadCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœºå™¨æ€§èƒ½é™åˆ¶ï¼Œåªå¼€å¯100ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">100</span>);</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">consumerService</span> <span class="operator">=</span> Executors.newFixedThreadPool(consumerThreadCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; producerThreadCount; i++) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹å‰¯æœ¬</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">LocalI</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">localSheet</span> <span class="operator">=</span> sheet;</span><br><span class="line"></span><br><span class="line">        executorService.submit(() -&gt; &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">startPos</span> <span class="operator">=</span> LocalI * threadLength + <span class="number">1</span>;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">endPos</span> <span class="operator">=</span> (LocalI + <span class="number">1</span>) * threadLength;</span><br><span class="line">            <span class="type">CountDownLatch</span> <span class="variable">localCountDown</span> <span class="operator">=</span> latch;</span><br><span class="line"></span><br><span class="line">            processXLSXMulti(excelQueue, localCountDown, localSheet, startPos, endPos);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; consumerThreadCount; i++) &#123;</span><br><span class="line">        consumerService.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (excelQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">sqlStr</span> <span class="operator">=</span> excelQueue.poll();</span><br><span class="line">                    <span class="comment">// æ’å…¥åˆ°æ•°æ®åº“</span></span><br><span class="line">                    excelService.insertExcelData(sqlStr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        latch.await();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”Ÿäº§è€…ä»»åŠ¡å·²å®Œæˆ!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä»»åŠ¡å±éšœå¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜»å¡ï¼Œç­‰å¾…æ¶ˆè´¹è€…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç­‰å¾…æ¶ˆè´¹è€…ä»»åŠ¡ ...&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (excelQueue.size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            executorService.shutdown();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    resultMap.put(<span class="string">&quot;status&quot;</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">return</span> resultMap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…ï¼šè¯»å–XLSXæ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sheet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startPos Excelå¼€å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> endPos   Excelç»“æŸä¸ºæ­¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processXLSXMulti</span><span class="params">(LinkedBlockingQueue&lt;String&gt; excelQueue,</span></span><br><span class="line"><span class="params">                              CountDownLatch localCountDown,</span></span><br><span class="line"><span class="params">                              Sheet sheet,</span></span><br><span class="line"><span class="params">                              Integer startPos,</span></span><br><span class="line"><span class="params">                              Integer endPos)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äºŒç»´é›†åˆå¯¹åº”ExceläºŒç»´è¡¨</span></span><br><span class="line">    Map&lt;Integer, List&lt;String&gt;&gt; excelMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–èµ·æ­¢è¡Œæ•°</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">startRowNum</span> <span class="operator">=</span> sheet.getRow(startPos).getRowNum();</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">endRowNum</span> <span class="operator">=</span> sheet.getRow(endPos).getRowNum();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡Œå¾ªç¯</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> startRowNum; row &lt;= endRowNum; row++) &#123;</span><br><span class="line">        <span class="type">Row</span> <span class="variable">currentRow</span> <span class="operator">=</span> sheet.getRow(row);</span><br><span class="line">        excelMap.put(count, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ—å¾ªç¯</span></span><br><span class="line">        <span class="keyword">for</span> (Cell cell : currentRow) &#123; <span class="comment">// éå†å½“å‰è¡Œçš„æ‰€æœ‰cell</span></span><br><span class="line">            <span class="keyword">switch</span> (cell.getCellType()) &#123;</span><br><span class="line">                <span class="keyword">case</span> STRING:</span><br><span class="line">                    excelMap.get(count).add(cell.getRichStringCellValue().getString()); <span class="comment">// å¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™ä¿å­˜</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> _NONE:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> NUMERIC:</span><br><span class="line">                    excelMap.get(count).add(cell.getNumericCellValue() + <span class="string">&quot;&quot;</span>); <span class="comment">//å°†æ•°å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> FORMULA:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BLANK:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ERROR:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;[çº¿ç¨‹&quot;</span> + Thread.currentThread().getId() + <span class="string">&quot;] &quot;</span></span><br><span class="line">            + <span class="string">&quot;EXCELå¼€å§‹è¡Œæ•°: &quot;</span> + startRowNum</span><br><span class="line">            + <span class="string">&quot;ï¼ŒEXCELç»“æŸè¡Œæ•°: &quot;</span> + endRowNum</span><br><span class="line">            + <span class="string">&quot;, åˆ—è¡¨é•¿åº¦ï¼š&quot;</span> + excelMap.size());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹¼æ¥Mysql SQLè¯­å¥,å½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨å®ä½“ç±»çš„æ–¹å¼ã€‚æ‹¼æ¥çš„æ–¹å¼æ¯”è¾ƒèŠ‚çœç©ºé—´</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    sb.append(<span class="string">&quot;insert into `sample-table` (column1,column2,column3) values &quot;</span>);</span><br><span class="line">    <span class="comment">// æ’å…¥åˆ°æ•°æ®åº“ï¼Œç¬¬0è¡Œä¸€èˆ¬ä¸ºæ ‡é¢˜ï¼Œæ•…å¿½ç•¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; count; k++) &#123;</span><br><span class="line">        List&lt;String&gt; columnList = excelMap.get(k);</span><br><span class="line"></span><br><span class="line">        <span class="type">StringJoiner</span> <span class="variable">joiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;),&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String column : columnList) &#123;</span><br><span class="line">            column = <span class="string">&quot;&#x27;&quot;</span> + column + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            joiner.add(column);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(joiner);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sqlStr</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">    sqlStr = sqlStr.substring(<span class="number">0</span>, sqlStr.lastIndexOf(<span class="string">&quot;,&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»»åŠ¡å…¥é˜Ÿ</span></span><br><span class="line">    excelQueue.offer(sqlStr);</span><br><span class="line">    localCountDown.countDown();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;[çº¿ç¨‹&quot;</span> + Thread.currentThread().getId() + <span class="string">&quot;] å·²å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>Service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExcelService</span><span class="params">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertExcelData</span><span class="params">(String sqlStr)</span></span><br><span class="line">    &#123;</span><br><span class="line">        jdbcTemplate.update(sqlStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>è¿›ä¸€æ­¥ä¼˜åŒ–çš„æ–¹æ¡ˆ</p><blockquote><p>æå‡Excelå¯¼å…¥é€Ÿåº¦çš„æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨æ›´å¿«çš„ Excel è¯»å–æ¡†æ¶(æ¨èä½¿ç”¨é˜¿é‡Œ EasyExcel)</li><li>å¯¹äºéœ€è¦ä¸æ•°æ®åº“äº¤äº’çš„æ ¡éªŒã€æŒ‰ç…§ä¸šåŠ¡é€»è¾‘é€‚å½“çš„ä½¿ç”¨ç¼“å­˜ã€‚ç”¨ç©ºé—´æ¢æ—¶é—´</li><li>ä½¿ç”¨ values(),(),() æ‹¼æ¥é•¿ SQL ä¸€æ¬¡æ’å…¥å¤šè¡Œæ•°æ®</li><li>ä½¿ç”¨å¤šçº¿ç¨‹æ’å…¥æ•°æ®ï¼Œåˆ©ç”¨æ‰ç½‘ç»œIOç­‰å¾…æ—¶é—´(æ¨èä½¿ç”¨å¹¶è¡Œæµï¼Œç®€å•æ˜“ç”¨)</li><li>é¿å…åœ¨å¾ªç¯ä¸­æ‰“å°æ— ç”¨çš„æ—¥å¿—</li></ul><p><a href="https://zhuanlan.zhihu.com/p/258525453">https://zhuanlan.zhihu.com/p/258525453</a></p></blockquote><p>â€</p><h2 id="å¯¼å‡ºåˆ°Excel"><a href="#å¯¼å‡ºåˆ°Excel" class="headerlink" title="å¯¼å‡ºåˆ°Excel"></a>å¯¼å‡ºåˆ°Excel</h2><p>ä»plsqlä¸­å¯¼å‡º100wæ¡æ•°æ®ï¼Œè€—æ—¶745ç§’</p><p>å¤šçº¿ç¨‹ç›®æ ‡ï¼šå¯¼å‡º100wæ¡æ•°æ®ï¼Œè‡³å°‘ä¼˜åŒ–åˆ°400ç§’ä»¥ä¸‹</p><p>![image.png](Java å¤šçº¿ç¨‹å¯¼å…¥excelæ•°æ®&#x2F;image-20210527133017-h2hde4n.png)</p><p>æœ‰ç©ºå†åšå§â€¦</p><p>â€</p><p>â€</p><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><p><a href="https://www.zhihu.com/question/23258804">javaå¤šçº¿ç¨‹è¿›è¡Œå¤§æ‰¹é‡EXcelæ•°æ®å¯¼å…¥å®ç°æ–¹æ¡ˆ</a></p><p><a href="https://blog.csdn.net/holmofy/article/details/82532311">java POIè¯¦è§£</a></p><p><a href="https://blog.csdn.net/joycesunny/article/details/106246302">java POI å®ä¾‹</a></p><p><a href="https://github.com/alibaba/easyexcel">ä»£æ›¿POIçš„EasyExcel</a></p><p><a href="https://www.iocoder.cn/Spring-Boot/battcn/v2-orm-jdbc//">Spring Jdbc Template</a></p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8-11çš„æ–°ç‰¹æ€§</title>
      <link href="/2021/04/07/Java8-11%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/"/>
      <url>/2021/04/07/Java8-11%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="Java8-11çš„æ–°ç‰¹æ€§"><a href="#Java8-11çš„æ–°ç‰¹æ€§" class="headerlink" title="Java8-11çš„æ–°ç‰¹æ€§"></a>Java8-11çš„æ–°ç‰¹æ€§</h1><h2 id="Java8"><a href="#Java8" class="headerlink" title="Java8"></a>Java8</h2><h3 id="Lambda-Functional-Interface"><a href="#Lambda-Functional-Interface" class="headerlink" title="Lambda &amp; Functional Interface"></a>Lambda &amp; Functional Interface</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaExamples</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¯åŒºï¼š</p><ul><li>è®¤ä¸ºçš„ï¼šé€šè¿‡åŒ¿åå‡½æ•°ç”ŸæˆRunnableå¯¹è±¡ï¼Œä¼ é€’ç»™Thread</li><li>äº‹å®ä¸Šï¼šå†…éƒ¨ä¼˜åŒ–ç›´æ¥è°ƒç”¨äº†åŒ¿åå‡½æ•°ï¼ˆinvokedynamicæŒ‡ä»¤)</li></ul><h3 id="æ–¹æ³•å¼•ç”¨-æ“ä½œç¬¦"><a href="#æ–¹æ³•å¼•ç”¨-æ“ä½œç¬¦" class="headerlink" title="æ–¹æ³•å¼•ç”¨::æ“ä½œç¬¦"></a>æ–¹æ³•å¼•ç”¨<code>::</code>æ“ä½œç¬¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodReference</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">val</span> <span class="operator">=</span> List.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).stream()</span><br><span class="line">                .map(Object::toString)</span><br><span class="line">                .map(Integer::<span class="keyword">new</span>)</span><br><span class="line">                .reduce((a,b)-&gt;a+b);</span><br><span class="line">            </span><br><span class="line">        System.out.println(val);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p>ä¸€ä¸ªMonadã€‚ å‡½æ•°å¼ã€æµè®¡ç®—é‡ç£…ç‚¸å¼¹ï¼Œ<strong>è§ä¹‹å‰è®²æµå’ŒMonadéƒ¨åˆ†</strong> ã€‚</p><h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional<T></T></h3><p>ä¸€ä¸ªMonadã€‚ æµè®¡ç®—å¿…å¤‡å·¥å…·ï¼Œå‡å°‘ç©ºå€¼æ£€æŸ¥ã€‚å¦ä¸€ä¸ªè¿˜æ²¡æœ‰æ”¯æŒï¼Œä½†æ¯”è¾ƒé‡è¦çš„Monadæ˜¯Tryã€‚è¿™ä¸ªåœ¨å®ç°AOPæ¡†æ¶çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨åˆ°äº†ã€‚<strong>è§ä¹‹å‰è®²æµå’ŒMonadéƒ¨åˆ†</strong></p><h3 id="æ¥å£çš„æ–¹æ³•-static-default-private"><a href="#æ¥å£çš„æ–¹æ³•-static-default-private" class="headerlink" title="æ¥å£çš„æ–¹æ³•(static, default, private)"></a>æ¥å£çš„æ–¹æ³•(static, default, private)</h3><ul><li>static(java 8)</li><li>default(java 8)</li><li>private(java 9)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Stream</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">BaseStream</span>&lt;T, Stream&lt;T&gt;&gt; &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ¯ä¸ªStream Monadéƒ½æœ‰è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">   <span class="keyword">default</span> Stream&lt;T&gt; <span class="title function_">takeWhile</span><span class="params">(Predicate&lt;? <span class="built_in">super</span> T&gt; predicate)</span> &#123;</span><br><span class="line">   ...</span><br><span class="line">       foo(); <span class="comment">// å¯ä»¥è°ƒç”¨</span></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// å¯ä»¥é€šè¿‡Stream.empty()æ„é€ ç©ºçš„æµ</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">    ...   </span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// ä¸æ˜¯æºä»£ç ä¸­çš„ç¨‹åº</span></span><br><span class="line">   <span class="keyword">private</span> <span class="title function_">foo</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-8-Nashorn-JavaScript"><a href="#Java-8-Nashorn-JavaScript" class="headerlink" title="Java 8 Nashorn JavaScript"></a>Java 8 Nashorn JavaScript</h3><p>åœ¨Java8ä¸­å¢åŠ ï¼Œåœ¨Java11ä¸­æ ‡è®°ä¸ºDeprecatedï¼Œ åœ¨Java15ä¸­ç§»å‡ºçš„æ–°ç‰¹æ€§ã€‚æ”¯æŒjavascriptES5è¯­æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_engine</span><span class="params">()</span> <span class="keyword">throws</span> ScriptException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">jscode</span> <span class="operator">=</span> <span class="string">&quot; [1,2,3].map(function(x)&#123;return x + 1;&#125;).join(&#x27;-&#x27;);&quot;</span>;</span><br><span class="line">    <span class="type">ScriptEngineManager</span> <span class="variable">scriptEngineManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line">    <span class="type">ScriptEngine</span> <span class="variable">nashorn</span> <span class="operator">=</span> scriptEngineManager.getEngineByName(<span class="string">&quot;nashorn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> nashorn.eval(jscode);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">    <span class="comment">// 2-3-4</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è„šæœ¬è¿™ä¹ˆå¤šä¸“é—¨é€‰JSæ²¡æœ‰ä¼˜åŠ¿ã€‚</strong></p><h3 id="æœ¬åœ°åŒ–æ—¥æœŸå¤„ç†å‡çº§"><a href="#æœ¬åœ°åŒ–æ—¥æœŸå¤„ç†å‡çº§" class="headerlink" title="æœ¬åœ°åŒ–æ—¥æœŸå¤„ç†å‡çº§"></a>æœ¬åœ°åŒ–æ—¥æœŸå¤„ç†å‡çº§</h3><p>æä¾›äº†Localå’ŒZonedä¸¤ç§å¤„ç†æ—¥æœŸçš„æ–¹å¼ï¼Œåœ¨æ–°çš„APIä¸­ä¸å†å…è®¸mutableçš„æ“ä½œï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰ï¼›å¦å¤–å¯¹æ—¶åŒºé‡‡å–æ›´å¥½çš„å¤„ç†æ–¹æ³•ï¼šå¦‚æœç”¨æˆ·çš„ç³»ç»Ÿä¸è€ƒè™‘å›½é™…åŒ–ï¼Œé‚£ä¹ˆå°±ç”¨Localçš„æ—¥æœŸï¼Œå¦‚æœè€ƒè™‘å›½é™…åŒ–ï¼Œå¯ä»¥æ„é€ å¸¦æ—¶åŒºçš„DateTimeã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_date</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 2022å¹´2æœˆ22æ—¥</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.of(<span class="number">2022</span>, <span class="number">2</span>, <span class="number">22</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10:55:59</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">time</span> <span class="operator">=</span> LocalTime.of(<span class="number">10</span>, <span class="number">55</span>, <span class="number">59</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰æ—¶é—´</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">datetime</span> <span class="operator">=</span> LocalDateTime.of(date, time);</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">zoneDT</span> <span class="operator">=</span> ZonedDateTime.of(datetime, ZoneId.of(<span class="string">&quot;Asia/Shanghai&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…ç½®äº†Base64å·¥å…·"><a href="#å†…ç½®äº†Base64å·¥å…·" class="headerlink" title="å†…ç½®äº†Base64å·¥å…·"></a>å†…ç½®äº†Base64å·¥å…·</h3><p>tipsï¼š å¯¹0~255ä¹‹é—´çš„å­—ç¬¦ï¼ŒBase64ç¼–ç æ˜¯ä»¥4ä¸ªå¯è§å­—ç¬¦å»æè¿°3ä¸ªå­—ç¬¦ã€‚ä¼šå¢åŠ æ•°æ®çš„ä½“ç§¯ï¼Œä½†æ˜¯å› ä¸ºæ‰€æœ‰å­—ç¬¦éƒ½å¯ä»¥è¯»ï¼Œç”¨Base64ç¼–ç æè¿°çš„å­—ç¬¦ä¸²ï¼Œåœ¨URLã€XMLä¸­éƒ½ä¸ä¼šè¢«è½¬ä¹‰ã€‚</p><p>Base64.Decoderå’ŒBase64.Encoderç±»ã€‚</p><h2 id="Java9æ–°ç‰¹æ€§"><a href="#Java9æ–°ç‰¹æ€§" class="headerlink" title="Java9æ–°ç‰¹æ€§"></a>Java9æ–°ç‰¹æ€§</h2><h3 id="æ¨¡å—ç³»ç»Ÿ"><a href="#æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="æ¨¡å—ç³»ç»Ÿ"></a>æ¨¡å—ç³»ç»Ÿ</h3><p>å› ä¸ºå’Œåº•å±‚åŸç†çŸ¥è¯†ç»“åˆç´§å¯†ï¼Œåœ¨ClassLoaderéƒ¨åˆ†ä»‹ç»ã€‚</p><h3 id="äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒ-JShell"><a href="#äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒ-JShell" class="headerlink" title="äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒ(JShell)"></a>äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒ(JShell)</h3><p><img src="/2021/04/07/Java8-11%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/836941f89ea9634e9e7ee5506d989903-20210407221013-6a1s7eu.png" alt="image-20210219120607478"></p><p>é™¤äº†ä¸Šå›¾ä¸­çš„èƒ½åŠ›ï¼Œä¹Ÿæä¾›APIï¼Œå¯ä»¥åŠ¨æ€çš„evalç¨‹åºã€‚</p><h3 id="æ–°çš„HTTP-2-0-Clinet"><a href="#æ–°çš„HTTP-2-0-Clinet" class="headerlink" title="æ–°çš„HTTP 2.0 Clinet"></a>æ–°çš„HTTP 2.0 Clinet</h3><p>ä¸»è¦é’ˆå¯¹æ—§Clientï¼Œæä¾›Buidlerï¼Œæ–¹ä¾¿ç”¨æˆ·è®¾ç½®headerå’Œå‚æ•°ã€‚</p><p>å¦å¤–æ”¯æŒHTTP2.0ï¼ŒHTTP2.0å…¼å®¹HTTP1.1çš„èƒ½åŠ›ï¼Œä¸»è¦æ˜¯ä»æ€§èƒ½è§’åº¦è¿›è¡Œäº†è°ƒä¼˜ã€‚ç†è§£HTTP2.0ä¸»è¦æ˜¯è¿™å‡ ä¸ªç‰¹æ€§ï¼š</p><ul><li>å¤šä¸ªHTTP è¯·æ±‚&#x2F;è¿”å›åœ¨ä¸€ä¸ªTCPè¯·æ±‚ä¸Šå¤šè·¯å¤ç”¨ï¼ˆå®¢æˆ·ç«¯è¦è´Ÿè´£å®ç°å¤šè·¯å¤ç”¨ï¼‰</li><li>å¤´éƒ¨å‹ç¼©ç®—æ³•ï¼ˆå®¢æˆ·ç«¯è¦è´Ÿè´£è§£å‹ï¼‰</li><li>Server Pushï¼šæœåŠ¡å™¨å¯èƒ½ä¼šç»™å®¢æˆ·ç«¯é¢å¤–çš„æ–‡ä»¶ï¼ˆæµè§ˆå™¨è¦è´Ÿè´£è¯†åˆ«ï¼Œå¹¶ç¼“å­˜è¿™äº›æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯ä¸ä¸€å®šè¦å®ç°ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">HttpClient</span> <span class="variable">httpClient</span> </span><br><span class="line">                <span class="operator">=</span> HttpClient.newHttpClient(); </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="type">HttpRequest</span> <span class="variable">httpRequest</span> </span><br><span class="line">    <span class="operator">=</span> HttpRequest </span><br><span class="line">    .newBuilder() </span><br><span class="line">    .headers(<span class="string">&quot;x-key&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;x-name&quot;</span>, <span class="string">&quot;something&quot;</span>)</span><br><span class="line">    .uri(<span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;https://www.baidu.com&quot;</span>)) </span><br><span class="line">    .GET() </span><br><span class="line">    .build(); </span><br><span class="line"></span><br><span class="line">HttpResponse&lt;String&gt; response </span><br><span class="line">    = httpClient.send( </span><br><span class="line">    httpRequest, </span><br><span class="line">    HttpResponse.BodyHandler.asString()); </span><br><span class="line"></span><br><span class="line">System.out.println(response.statusCode());</span><br><span class="line">System.out.println(response.body());</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ”¹è¿›äº†Javadoc"><a href="#æ”¹è¿›äº†Javadoc" class="headerlink" title="æ”¹è¿›äº†Javadoc"></a>æ”¹è¿›äº†Javadoc</h3><p>å¤§å®¶å¹³æ—¶è¯»çš„å¾ˆå¤šJavaçš„æ–‡æ¡£ï¼ˆç‰¹åˆ«æ˜¯å®˜æ–¹çš„æ–‡æ¡£ï¼‰ï¼Œå°±æ˜¯ç”¨Javadocç”Ÿæˆçš„ã€‚ æ‰€ä»¥è¿™ä¹Ÿæ˜¯Javaæ–‡æ¡£â€”â€”æ¯”è¾ƒéš¾è¯»çš„åŸå› ä¹‹ä¸€ã€‚ å†™ç¨‹åºçš„äººæ³¨é‡Šå¾€å¾€æ˜¯ä¸ºäº†è®©å†…éƒ¨äººå‘˜è¯»æ‡‚ï¼Œè€Œæ–‡æ¡£æ˜¯é¢å‘å¤–éƒ¨äººå‘˜ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javadoc -d foo -html5 MyHelloWorld.java</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”Ÿæˆç¬¦åˆHTML5æ ‡å‡†çš„ç½‘é¡µã€‚</p><h3 id="æ”¯æŒmultirelease-jaråŒ…"><a href="#æ”¯æŒmultirelease-jaråŒ…" class="headerlink" title="æ”¯æŒmultirelease jaråŒ…"></a>æ”¯æŒmultirelease jaråŒ…</h3><p>é¡¹ç›®ç›®å½•ç»“æ„å¯ä»¥è¿™æ ·å®‰æ’ï¼Œä¸åŒçš„ç‰ˆæœ¬çš„ç¨‹åºåœ¨ä¸åŒçš„ç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|-java</span><br><span class="line">|   â””â”€â”€java8</span><br><span class="line">|       â””â”€â”€ hello</span><br><span class="line">|           â””â”€â”€ xxx.java</span><br><span class="line">|   â””â”€â”€java9</span><br><span class="line">|       â””â”€â”€ hello</span><br><span class="line">|           â””â”€â”€ xxx.java</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥é€šè¿‡<code>javac</code>** **ç¼–è¯‘æˆä¸åŒç‰ˆæœ¬çš„classæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac --release 9 java8/hello/xxx.java</span><br><span class="line">javac --release 8 java9/hello/xxx.java</span><br></pre></td></tr></table></figure><p>æœ€åç”¨<code>jar</code>** <strong>å¯ä»¥äº§ç”Ÿä¸åŒç‰ˆæœ¬çš„</strong>â€‹**<code>jar</code>** **åŒ…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -c -f xxx.jar -C java8 . --release 9 -C java9.</span><br></pre></td></tr></table></figure><p>è¿™æ ·<code>xxx.jar</code>** **ä¸­ä¼šåŒæ—¶æœ‰java8å’Œjava9çš„ç¨‹åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp test.jar hello <span class="comment">// ä¸åŒjavaç‰ˆæœ¬è®¿é—®ä¸åŒçš„ç±»</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåŠŸèƒ½çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>Javaå‡çº§å¤ªå¿«äº†ï¼Œå¤šç‰ˆæœ¬åŒæ—¶å‘å¸ƒï¼Œè®©ç¨‹åºçš„æä¾›è€…å¯ä»¥å…¼å®¹ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚</p><h3 id="é›†åˆçš„å·¥å‚æ–¹æ³•"><a href="#é›†åˆçš„å·¥å‚æ–¹æ³•" class="headerlink" title="é›†åˆçš„å·¥å‚æ–¹æ³•"></a>é›†åˆçš„å·¥å‚æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">set</span> <span class="operator">=</span> Set.of(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Google&quot;</span>);</span><br><span class="line"><span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> List.of(<span class="string">&quot;...&quot;</span>, <span class="string">&quot;abc&quot;</span>, <span class="number">1</span>); <span class="comment">// æŠ¥é”™ï¼Œæ€è€ƒä¸ºä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="type">var</span> <span class="variable">map</span> <span class="operator">=</span> Map.of(<span class="string">&quot;String&quot;</span>, <span class="number">5</span>, <span class="string">&quot;Integer&quot;</span>, <span class="number">6</span>); </span><br></pre></td></tr></table></figure><h3 id="å¢åŠ ProcessHandler"><a href="#å¢åŠ ProcessHandler" class="headerlink" title="å¢åŠ ProcessHandler"></a>å¢åŠ ProcessHandler</h3><p>å¢åŠ äº†ä¸€ä¸ªProcessHandlerç”¨äºæŸ¥çœ‹æŸä¸ªç‰¹å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼šå¯åŠ¨æ—¶é—´ã€å…³è”å‚æ•°ç­‰ç­‰ã€‚ç›®å‰æ˜¯åŠ å¼ºå¯¹è¿›ç¨‹çš„æ”¯æŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;ls -l&quot;</span>);</span><br><span class="line"><span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> builder.start();</span><br><span class="line">ProcessHandle.<span class="type">Info</span> <span class="variable">info</span> <span class="operator">=</span> p.info();</span><br><span class="line"></span><br><span class="line"><span class="comment">// start time</span></span><br><span class="line">info.startInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// arguments</span></span><br><span class="line">info.arguments();</span><br></pre></td></tr></table></figure><h3 id="Stream-APIå¢åŠ äº†æ–¹æ³•"><a href="#Stream-APIå¢åŠ äº†æ–¹æ³•" class="headerlink" title="Stream APIå¢åŠ äº†æ–¹æ³•"></a>Stream APIå¢åŠ äº†æ–¹æ³•</h3><p>ä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œæä¾›äº†æ›´å¤šçš„Stream APIã€‚</p><ul><li>takeWhile<br>å­—é¢æ„æ€ï¼štake while x !&#x3D; 7 is hold ï¼Œ ä¸­æ–‡æ„æ€ï¼šåœ¨x !&#x3D; 7çš„æ—¶å€™ï¼Œæ‹¿ï¼Œå¦åˆ™åœä¸‹æ¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>).takeWhile(x -&gt; x != <span class="number">7</span>)</span><br><span class="line">   .collect(Collectors.toList());</span><br><span class="line"><span class="comment">// [2,1,3]</span></span><br></pre></td></tr></table></figure><ul><li>dropWhile<br>å­—é¢æ„æ€ï¼š drop while x!&#x3D;7 is holdï¼Œ ä¸­æ–‡æ„æ€ï¼šåœ¨x!&#x3D;7çš„æ—¶å€™ï¼Œä¸¢å¼ƒï¼Œå¦åˆ™åœä¸‹æ¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>).dropWhile(x -&gt; x!=<span class="number">7</span>)</span><br><span class="line">  .collect(Collectors.toList());</span><br><span class="line"><span class="comment">//[7, 4, 6, 8, 0]</span></span><br></pre></td></tr></table></figure><ul><li>iterate</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> Stream.iterate(</span><br><span class="line">     <span class="number">10</span>,  <span class="comment">// åˆå§‹å€¼</span></span><br><span class="line">     x -&gt; x &lt; <span class="number">100</span>, <span class="comment">// ç»ˆç»“æ–­è¨€</span></span><br><span class="line">     x-&gt;x+<span class="number">2</span> <span class="comment">// é€’æ¨å‡½æ•°</span></span><br><span class="line"> ).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// [10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jshell&gt; Stream.iterate(<span class="string">&quot;i&quot;</span>, x -&gt; x.length() &lt; <span class="number">20</span>, x-&gt;x+<span class="string">&quot;i&quot;</span>).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//[i, ii, iii, iiii, iiiii, iiiiii, iiiiiii, iiiiiiii, iiiiiiiii, iiiiiiiiii, iiiiiiiiiii, iiiiiiiiiiii, iiiiiiiiiiiii, iiiiiiiiiiiiii, iiiiiiiiiiiiiii, iiiiiiiiiiiiiiii, iiiiiiiiiiiiiiiii, iiiiiiiiiiiiiiiiii, iiiiiiiiiiiiiiiiiii]</span></span><br></pre></td></tr></table></figure><ul><li>ofNullable</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.ofNullable(<span class="literal">null</span>); <span class="comment">// Stream.empty()</span></span><br></pre></td></tr></table></figure><h3 id="é’»çŸ³æ“ä½œç¬¦è¯­æ³•ä¼˜åŒ–"><a href="#é’»çŸ³æ“ä½œç¬¦è¯­æ³•ä¼˜åŒ–" class="headerlink" title="&lt;&gt;é’»çŸ³æ“ä½œç¬¦è¯­æ³•ä¼˜åŒ–"></a>&lt;&gt;é’»çŸ³æ“ä½œç¬¦è¯­æ³•ä¼˜åŒ–</h3><p>å…è®¸åŒ¿åç±»ä½¿ç”¨é’»çŸ³æ“ä½œç¬¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Iterable&lt;Integer&gt; it = <span class="keyword">new</span> <span class="title class_">Iterable</span>&lt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="CompletableFutureæ”¹è¿›"><a href="#CompletableFutureæ”¹è¿›" class="headerlink" title="CompletableFutureæ”¹è¿›"></a>CompletableFutureæ”¹è¿›</h3><p>CompletableFutureæ˜¯javaå¼‚æ­¥è®¡ç®—èƒ½åŠ›çš„æ ¸å¿ƒï¼Œä»£è¡¨ä¸€ä¸ªéœ€è¦åœ¨æœªæ¥è¢«è®¡ç®—å‡ºæ¥çš„çš„å€¼ã€‚</p><p>åœ¨ Java9ä¸­é’ˆå¯¹å·²æœ‰èƒ½åŠ›ï¼Œå¯¹CompletableFutureè¿›è¡Œäº†æå‡ã€‚</p><h4 id="å¢åŠ completeOnTimeoutæ–¹æ³•"><a href="#å¢åŠ completeOnTimeoutæ–¹æ³•" class="headerlink" title="å¢åŠ completeOnTimeoutæ–¹æ³•"></a>å¢åŠ completeOnTimeoutæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">future</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;&gt;();</span><br><span class="line">    Executors.newCachedThreadPool().submit(() -&gt; &#123;</span><br><span class="line">        <span class="comment">//Thread.sleep(1000);</span></span><br><span class="line">        <span class="comment">// future.complete(&quot;Hello&quot;);</span></span><br><span class="line">        <span class="comment">// ç­‰ä»·äº </span></span><br><span class="line">        <span class="comment">// completeOnTimeoutæ˜¯Java9æ–°è¯­æ³•</span></span><br><span class="line">        future.completeOnTimeout(<span class="string">&quot;Hello&quot;</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// sync. method blocking...</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">value</span> <span class="operator">=</span> future.get();</span><br><span class="line">    System.out.println(value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¢åŠ ç›´æ¥æˆåŠŸ-å¤±è´¥çš„futureå·¥å‚æ–¹æ³•"><a href="#å¢åŠ ç›´æ¥æˆåŠŸ-å¤±è´¥çš„futureå·¥å‚æ–¹æ³•" class="headerlink" title="å¢åŠ ç›´æ¥æˆåŠŸ&#x2F;å¤±è´¥çš„futureå·¥å‚æ–¹æ³•"></a>å¢åŠ ç›´æ¥æˆåŠŸ&#x2F;å¤±è´¥çš„futureå·¥å‚æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">successFuture</span> <span class="operator">=</span> CompletableFuture.completedFuture(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">failFuture</span> <span class="operator">=</span> CompletableFuture.failedFuture(<span class="keyword">new</span> <span class="title class_">InterruptedException</span>());</span><br><span class="line"></span><br><span class="line">    System.out.println(successFuture.get()); <span class="comment">// hello</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(failFuture.isCompletedExceptionally()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;error&quot;</span>); <span class="comment">// print</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(failFuture.get()); <span class="comment">// Exception</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ›´å¤šå‚è€ƒå¹¶å‘éƒ¨åˆ†æœ‰ä¸€èŠ‚å¯¹Futureçš„ä¸“é¡¹çªç ´è¯¾ç¨‹</strong></p><h3 id="try-with-resourcesçš„æ”¹è¿›"><a href="#try-with-resourcesçš„æ”¹è¿›" class="headerlink" title="try-with-resourcesçš„æ”¹è¿›"></a>try-with-resourcesçš„æ”¹è¿›</h3><p>Javaä¸­çš„ä¸€éƒ¨åˆ†èµ„æºå¯¹è±¡ä¼šç»§æ‰¿äºCloseableæ¥å£ï¼Œè¿™å°±å¯ä»¥ä½¿ç”¨<code>try-with-resources</code>** **èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">InputStream</span> <span class="keyword">implements</span> <span class="title class_">Closeable</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨çš„è¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException, IOException &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">fin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;somefile&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span>(fin) &#123; <span class="comment">// AutoClose</span></span><br><span class="line">        fin.read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç›´æ¥å¯¹æŸä¸ªå®ç°äº†Closeableçš„å¯¹è±¡è¿›è¡Œtryï¼Œå¹¶ä¸”ä¸»åŠ¨è§¦å‘closeèƒ½åŠ›ï¼Œ æ˜¯Java9çš„ä¸€ä¸ªä¼˜åŒ–ã€‚</p><h2 id="Java-10"><a href="#Java-10" class="headerlink" title="Java 10"></a>Java 10</h2><h3 id="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­"><a href="#å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­" class="headerlink" title="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­"></a>å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="comment">// list is LinkedList&lt;Integer&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">o</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">// o is Stream&lt;Integer&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JDKä»£ç ä»“åº“æ•´ç†"><a href="#JDKä»£ç ä»“åº“æ•´ç†" class="headerlink" title="JDKä»£ç ä»“åº“æ•´ç†"></a>JDKä»£ç ä»“åº“æ•´ç†</h3><p>æ‰€æœ‰JDKä»£ç ä¸å†ä½¿ç”¨8ä¸ªä»“åº“å­˜å‚¨ï¼šrootã€corbaã€hotspotã€jaxpã€jaxwsã€jdkã€langtoolsã€nashornã€‚</p><p>ç»Ÿä¸€æˆä¸º1ä¸ªä»“åº“ã€‚</p><p>ä¸»è¦æ˜¯è§£å†³åŸå­æäº¤çš„é—®é¢˜ï¼š1ä¸ªåŠŸèƒ½å¯èƒ½éœ€è¦æ›´æ–°å¤šä¸ªä»£ç ä»“åº“ã€‚</p><h3 id="G1å¢åŠ å¹¶è¡Œèƒ½åŠ›"><a href="#G1å¢åŠ å¹¶è¡Œèƒ½åŠ›" class="headerlink" title="G1å¢åŠ å¹¶è¡Œèƒ½åŠ›"></a>G1å¢åŠ å¹¶è¡Œèƒ½åŠ›</h3><p>åœ¨mark-sweep-compactçš„GCç®—æ³•ä¸Šï¼Œå†å¢åŠ <strong>å¹¶è¡Œ</strong> èƒ½åŠ›ã€‚</p><p>è§JVM GCéƒ¨åˆ†</p><h3 id="ä¼˜åŒ–ï¼šåº”ç”¨ç¨‹åºæ•°æ®å…±äº«ï¼ˆApplication-Data-Sharing"><a href="#ä¼˜åŒ–ï¼šåº”ç”¨ç¨‹åºæ•°æ®å…±äº«ï¼ˆApplication-Data-Sharing" class="headerlink" title="ä¼˜åŒ–ï¼šåº”ç”¨ç¨‹åºæ•°æ®å…±äº«ï¼ˆApplication Data Sharing)"></a>ä¼˜åŒ–ï¼šåº”ç”¨ç¨‹åºæ•°æ®å…±äº«ï¼ˆApplication Data Sharing)</h3><p>ADSï¼š å…è®¸å¤šä¸ªJVMå®ä¾‹å…±äº«å…±åŒç”¨åˆ°çš„ç±»ï¼Œè¿™äº›ç±»ä»¥å…±äº«å†…å­˜çš„å½¢å¼å­˜åœ¨ã€‚è¿™æ ·å¯¹äºè¿è¡Œäº†å¤šä¸ªJVMçš„æœºå™¨ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ä»¥åŠç±»çš„åŠ è½½é€Ÿåº¦ã€‚</p><h3 id="è®¡åˆ’ç§»é™¤JNIå¤´ç”Ÿæˆå·¥å…·"><a href="#è®¡åˆ’ç§»é™¤JNIå¤´ç”Ÿæˆå·¥å…·" class="headerlink" title="è®¡åˆ’ç§»é™¤JNIå¤´ç”Ÿæˆå·¥å…·"></a>è®¡åˆ’ç§»é™¤JNIå¤´ç”Ÿæˆå·¥å…·</h3><p>JNIï¼ˆJava Native Interface)æ˜¯Javaç¨‹åºå’ŒNative(C, C++)ç¨‹åºæ²Ÿé€šçš„æ¥å£ã€‚ ä¸€ä¸ªJavaç±»ï¼Œå¦‚æœè¦Nativeè°ƒç”¨ï¼Œé€šå¸¸æ˜¯åœ¨Androidå¼€å‘å½“ä¸­ï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ªC&#x2F;C++çš„å¤´æ–‡ä»¶ã€‚ä¹‹å‰å¯ä»¥ç”¨javahæ¥ç”Ÿæˆï¼Œç°åœ¨ç”¨javahå·¥å…·ç”Ÿæˆçš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€è¡Œwarningã€‚</p><p>ä»¥åJNIçš„èƒ½åŠ›ä¼šè¢«Panamaé¡¹ç›®æ›¿ä»£ï¼Œä¸€ä¸ªä¸“é—¨ä¸ºéjavaè¯­è¨€æä¾›æ¥å£çš„åº“ã€‚</p><h3 id="å¢åŠ å®éªŒæ€§çš„Graalç¼–è¯‘å™¨"><a href="#å¢åŠ å®éªŒæ€§çš„Graalç¼–è¯‘å™¨" class="headerlink" title="å¢åŠ å®éªŒæ€§çš„Graalç¼–è¯‘å™¨"></a>å¢åŠ å®éªŒæ€§çš„Graalç¼–è¯‘å™¨</h3><p>å¯ä»¥é…ç½®å‚æ•°å¼€å¯ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-XXï¼š+ UnlockExperimentalVMOptions -XXï¼š+ UseJVMCICompiler</span></span><br></pre></td></tr></table></figure><p>Graalæ˜¯ä¸€æ¬¾åŒæ—¶æ”¯æŒJITå’ŒAOTçš„ç¼–è¯‘å™¨ã€‚</p><ul><li>JIT(Just in Time)ä¸€è¾¹ç¼–è¯‘ä¸€è¾¹æ‰§è¡Œï¼Œæ‰§è¡Œå®Œç¬¬ä¸€æ¬¡ä¹‹åï¼Œä¸‹ä¸€æ¬¡ä¸éœ€è¦ç¼–è¯‘</li><li>AOT(Ahead of Time)ï¼Œç±»ä¼¼C&#x2F;C++é‚£æ ·ï¼Œå…ˆç¼–è¯‘æˆæœºå™¨ç ï¼Œå†æ‰§è¡Œã€‚ æ³¨æ„ï¼Œæ˜¯æœºå™¨ç ï¼Œè¶Šè¿‡äº†JVMçš„bytecodeã€‚</li></ul><p>ç›®å‰è¿˜æ˜¯å®éªŒé˜¶æ®µï¼Œä¸å»ºè®®ç”¨ä½œç”Ÿäº§ã€‚å·²ç»å‘ç°äº†ä¸å°‘çš„Bugï¼Œç­‰å¾…è¿›ä¸€æ­¥çš„ä¿®å¤ã€‚</p><h2 id="Java-11"><a href="#Java-11" class="headerlink" title="Java 11"></a>Java 11</h2><h3 id="å¼•å…¥NestedMembersæ¦‚å¿µ"><a href="#å¼•å…¥NestedMembersæ¦‚å¿µ" class="headerlink" title="å¼•å…¥NestedMembersæ¦‚å¿µ"></a>å¼•å…¥NestedMembersæ¦‚å¿µ</h3><p>åµŒå¥—ç±»å’Œå®ƒçš„çˆ¶äº²ä½œä¸ºä¸€ç»„NestedMembersï¼Œå¯ä»¥äº’ç›¸è®¿é—®å…ƒæ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Nested</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">            System.out.println(A.class.getDeclaredField(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">        b.bar();</span><br><span class="line">        <span class="comment">// name </span></span><br><span class="line"></span><br><span class="line">        System.out.println(Arrays.toString(A.class.getNestMembers()));</span><br><span class="line">        <span class="comment">// [Nested, A, B]</span></span><br><span class="line">    </span><br><span class="line">        System.out.println(A.class.getNestHost());</span><br><span class="line">        <span class="comment">// Nested</span></span><br><span class="line">    </span><br><span class="line">        System.out.println(Arrays.toString(B.class.getNestMembers()));</span><br><span class="line">        <span class="comment">// [Nested, A, B]</span></span><br><span class="line">    </span><br><span class="line">        System.out.println(B.class.getNestHost());</span><br><span class="line">        <span class="comment">// Nested</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¢åŠ æ— æ“ä½œGCå›æ”¶å™¨-Epsilon"><a href="#å¢åŠ æ— æ“ä½œGCå›æ”¶å™¨-Epsilon" class="headerlink" title="å¢åŠ æ— æ“ä½œGCå›æ”¶å™¨:Epsilon"></a>å¢åŠ æ— æ“ä½œGCå›æ”¶å™¨:Epsilon</h3><p>Epsilonä¸ä¼šè¿›è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼Œæ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œ å®ƒä¸è¿›è¡ŒGCã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:+UseEpsilonGC</span></span><br></pre></td></tr></table></figure><p>Epsilonè™½ç„¶ä¸GCï¼Œä½†æ˜¯ä»ç„¶æ‰¿æ‹…ç€å†…å­˜åˆ†é…çš„å·¥ä½œã€‚ï¼ˆJava çš„ GCä¹Ÿæ˜¯Javaçš„å†…å­˜ç®¡ç†å·¥å…·ï¼Œæ›´å¤šè§GCéƒ¨åˆ†ï¼‰</p><p>æœ‰ç‚¹ï¼š</p><ul><li>å¯¹äºå¼€å‘è€…æ˜ç¡®çŸ¥é“ä¸éœ€è¦GCçš„ç¨‹åºæœ‰åŠ©äºå‡å°‘å»¶è¿Ÿ</li><li>å¯¹äºæ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•åœºæ™¯ï¼Œå¯ä»¥å¿½ç•¥GCå¸¦æ¥çš„å»¶è¿Ÿ</li></ul><h3 id="Lambdaä¼˜åŒ–ï¼šå…è®¸ä½¿ç”¨-varå®šä¹‰åŒ¿åå‡½æ•°å½¢å‚"><a href="#Lambdaä¼˜åŒ–ï¼šå…è®¸ä½¿ç”¨-varå®šä¹‰åŒ¿åå‡½æ•°å½¢å‚" class="headerlink" title="Lambdaä¼˜åŒ–ï¼šå…è®¸ä½¿ç”¨ varå®šä¹‰åŒ¿åå‡½æ•°å½¢å‚"></a>Lambdaä¼˜åŒ–ï¼šå…è®¸ä½¿ç”¨ varå®šä¹‰åŒ¿åå‡½æ•°å½¢å‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@interface</span> My&#123;&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    Predicate&lt;String&gt; predicate = (<span class="meta">@My</span> <span class="keyword">var</span> a) -&gt; <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–ï¼šå¢åŠ å­—ç¬¦ä¸²èƒ½å¤„ç†å‡½æ•°"><a href="#ä¼˜åŒ–ï¼šå¢åŠ å­—ç¬¦ä¸²èƒ½å¤„ç†å‡½æ•°" class="headerlink" title="ä¼˜åŒ–ï¼šå¢åŠ å­—ç¬¦ä¸²èƒ½å¤„ç†å‡½æ•°"></a>ä¼˜åŒ–ï¼šå¢åŠ å­—ç¬¦ä¸²èƒ½å¤„ç†å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot; &quot;</span>.isBlank();                <span class="comment">// true</span></span><br><span class="line"><span class="string">&quot; Foo Bar &quot;</span>.strip();          <span class="comment">// &quot;Foo Bar&quot;</span></span><br><span class="line"><span class="string">&quot; Foo Bar &quot;</span>.stripTrailing();  <span class="comment">// &quot; Foo Bar&quot;</span></span><br><span class="line"><span class="string">&quot; Foo Bar &quot;</span>.stripLeading();   <span class="comment">// &quot;Foo Bar &quot;</span></span><br><span class="line"><span class="string">&quot;Java&quot;</span>.repeat(<span class="number">3</span>);             <span class="comment">// &quot;JavaJavaJava&quot;</span></span><br><span class="line"><span class="string">&quot;A\nB\nC&quot;</span>.lines().count();    <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåå°„ &amp; æ³¨è§£å­¦ä¹ æ€»ç»“</title>
      <link href="/2021/04/06/Java%E5%8F%8D%E5%B0%84/"/>
      <url>/2021/04/06/Java%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaåå°„-æ³¨è§£å­¦ä¹ æ€»ç»“"><a href="#Javaåå°„-æ³¨è§£å­¦ä¹ æ€»ç»“" class="headerlink" title="Javaåå°„ &amp; æ³¨è§£å­¦ä¹ æ€»ç»“"></a>Javaåå°„ &amp; æ³¨è§£å­¦ä¹ æ€»ç»“</h1><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><h3 id="æ¦‚å¿µ-ä½œç”¨"><a href="#æ¦‚å¿µ-ä½œç”¨" class="headerlink" title="æ¦‚å¿µ &amp; ä½œç”¨"></a>æ¦‚å¿µ &amp; ä½œç”¨</h3><p>åå°„(reflection)ï¼šè¿è¡Œæ—¶æŸ¥çœ‹<code>å…ƒæ•°æ®</code>ï¼Œåè§‚å¯Ÿã€ä¿®æ”¹ç¨‹åºå†…éƒ¨ç»“æ„ã€‚</p><ul><li><p>å…ƒæ•°æ®ï¼ˆMetaDataï¼‰ï¼ŒæŒ‡è¿è¡Œæ—¶çš„æ•°æ®ï¼Œå¦‚æ¨¡å—ã€ç±»ã€å‡½æ•°ã€æ³¨è§£ã€æºä»£ç </p></li><li><p>è¿è¡Œæ—¶ä¿®æ”¹ä»£ç ï¼šä¸€èˆ¬æŒ‡ä¿®æ”¹Bytecodeï¼Œbyte[]ï¼Œç”¨å·¥å…·<code>Javasist</code></p></li></ul><p>ã€æ³¨æ„ã€‘å¦‚æœåœ¨è¿è¡Œæ—¶åˆ†ææ³›å‹ç±»çš„å®ä¾‹ï¼Œå°†ä¸ä¼šå¾—åˆ°å¤ªå¤šçš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä»¬å·²ç»è¢«æ“¦é™¤äº†ã€‚</p><p>â€</p><h3 id="åå°„å®ä¾‹"><a href="#åå°„å®ä¾‹" class="headerlink" title="åå°„å®ä¾‹"></a>åå°„å®ä¾‹</h3><p>å¸¸ç”¨æ–¹æ³•</p><ul><li>Class.forName()ï¼šé€šè¿‡ç±»å…¨é™å®šåè·å–ä¸€ä¸ªclassï¼Œè¦ä¼ å…¥å…¨è·¯å¾„</li><li>getClass()ï¼šè·å–ä¸€ä¸ªå¯¹è±¡çš„è¿è¡Œæ—¶ç±»</li><li>[class].getConstructor().newInstance()ï¼šé€šè¿‡æ„é€ å™¨åˆ›å»ºä¸€ä¸ªç±»</li><li>[class].getDeclaredFields()ï¼šè·å–æ‰€æœ‰å±æ€§ï¼ŒåŒ…æ‹¬private</li><li>[class]..getDeclaredMethods()ï¼šè·å–æ‰€æœ‰æ–¹æ³•</li><li>[class].getClassLoader()ï¼šè·å–ç±»åŠ è½½å™¨</li><li>method.invoke([class])ï¼šè°ƒç”¨ä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•</li></ul><h4 id="è·å–ç±»çš„å±æ€§ã€æ–¹æ³•"><a href="#è·å–ç±»çš„å±æ€§ã€æ–¹æ³•" class="headerlink" title="è·å–ç±»çš„å±æ€§ã€æ–¹æ³•"></a>è·å–ç±»çš„å±æ€§ã€æ–¹æ³•</h4><p>å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªç±»</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="string">&quot;List&quot;</span>, <span class="string">&quot;Tree&quot;</span>, <span class="string">&quot;Array&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">randomGen</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomStringGenerator</span>(list);</span><br><span class="line">    <span class="type">var</span> <span class="variable">clazz</span> <span class="operator">=</span> randomGen.getClass();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç±»å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    System.out.println(<span class="string">&quot;class name:&quot;</span> + clazz.getName());</span><br><span class="line">    System.out.println();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ‰€æœ‰å±æ€§</span></span><br><span class="line"><span class="comment">     *    getField() åªèƒ½è·å–publicçš„ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     *    getDeclaredField() å¯ä»¥è·å–å½“å‰ç±»æ‰€æœ‰çš„å­—æ®µï¼ŒåŒ…æ‹¬privateçš„ï¼Œä½†æ˜¯ä¸èƒ½è·å–ç»§æ‰¿æ¥çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">fields</span> <span class="operator">=</span> clazz.getDeclaredFields();</span><br><span class="line">    System.out.println(<span class="string">&quot;All fields are as below: &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> field : fields)</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;field name: &quot;</span> + field.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;field type: &quot;</span> + field.getGenericType());</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">methods</span> <span class="operator">=</span> clazz.getDeclaredMethods();</span><br><span class="line">    System.out.println(<span class="string">&quot;All methods are as below: &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> method : methods)</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;method sign: &quot;</span></span><br><span class="line">                + Modifier.toString(method.getModifiers()) + <span class="string">&quot; &quot;</span></span><br><span class="line">                + method.getReturnType() + <span class="string">&quot; &quot;</span></span><br><span class="line">                + method.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="åå°„åˆ›å»ºå¯¹è±¡-è°ƒç”¨æ–¹æ³•"><a href="#åå°„åˆ›å»ºå¯¹è±¡-è°ƒç”¨æ–¹æ³•" class="headerlink" title="åå°„åˆ›å»ºå¯¹è±¡ &amp; è°ƒç”¨æ–¹æ³•"></a>åå°„åˆ›å»ºå¯¹è±¡ &amp; è°ƒç”¨æ–¹æ³•</h4><p>å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="string">&quot;List&quot;</span>, <span class="string">&quot;Tree&quot;</span>, <span class="string">&quot;Array&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„åˆ›å»ºå®ä¾‹ï¼Œå¸¦å‚æ•°çš„æ„é€ å™¨</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">clazz</span> <span class="operator">=</span> (RandomStringGenerator)Class.forName(<span class="string">&quot;com.javacoding.collection.RandomStringGenerator&quot;</span>)</span><br><span class="line">            .getConstructor(List.class).newInstance(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–mainæ–¹æ³•ï¼Œå¹¶è°ƒç”¨</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">methods</span> <span class="operator">=</span> Arrays.stream(clazz.getClass().getMethods())</span><br><span class="line">            .filter(x -&gt; x.getName().equals(<span class="string">&quot;main&quot;</span>))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¼ å‚ç±»å‹</span></span><br><span class="line">    methods.get(<span class="number">0</span>).invoke(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;test1&quot;</span>,<span class="string">&quot;test2&quot;</span>,<span class="string">&quot;test3&quot;</span>&#125;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨mainæ–¹æ³•ä¸èƒ½ç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š</span></span><br><span class="line">    <span class="comment">//methods.get(0).invoke(String[].class);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ <code>main</code> æ–¹æ³•çš„è°ƒç”¨</p><blockquote><p>java1.4æ˜¯æ²¡æœ‰å¯å˜å‚æ•°çš„ï¼Œå³Method.invoke(Obeject objecr ,Object obj[]{â€œxxâ€,â€œyyâ€});ç”¨æ•°ç»„ä¼ é€’å¤šä¸ªå‚æ•° ã€‚<br>java1.5æœ‰äº†å¯å˜å‚æ•°ï¼Œå³Method.invoke(Objet objecr,Objectâ€¦args);ç”¨å¯å˜å‚æ•°ä¼ é€’å¤šä¸ªå‚æ•°ã€‚</p><p>ç”±äºå…¼å®¹æ€§é—®é¢˜ï¼Œåœ¨JDK1.4æ²¡æœ‰å¼•å…¥å¯å˜å‚æ•°Objectâ€¦ç±»å‹ï¼Œæ‰€ä»¥ä½¿ç”¨æ•°ç»„æ¥è¡¨ç¤ºï¼Œinvokeå‡½æ•°æ¥æ”¶åˆ°Stringæ•°ç»„åä¼šè¿›è¡Œæ‹†åˆ†ï¼Œå¾—åˆ°ä¸¤ä¸ªStringå˜é‡ï¼Œä½†æ˜¯æ²¡æœ‰mainå‡½æ•°æ¥å— ä¸¤ä¸ªStringå€¼ï¼Œæ‰€ä»¥ä¸è¡Œã€‚</p><p>è€Œä¸”åªè¦å‚æ•°æ˜¯new Object[]{â€œxxxâ€,â€yyyâ€}ï¼Œjavac ä¸ºäº†å…¼å®¹1.4ï¼ŒåªæŠŠå®ƒå½“ä½œ jdk1.4 çš„è¯­æ³•è¿›è¡Œç†è§£ï¼Œè€Œä¸æŠŠå®ƒå½“ä½œ jdk1.5 çš„è¯­æ³•è§£é‡Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¼ é€’new String[]{};ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š<br>(1)ã€mainMethod.invoke(null,new Object[]{new String[]{â€œ20190212â€}});è¯¥æ–¹æ³•è¿˜æ˜¯ä¼šæŒ‰1.4å¤„ç†ï¼Œä¼šå°†å‚æ•°æ‰“æ•£ï¼Œä½†æ²¡å…³ç³»ï¼Œé‡Œé¢å°±æ˜¯å¯¹çš„å‚æ•°new String[]{â€œxxxâ€}ã€‚</p><p>(2)ã€mainMethod.invoke(null,(Object)new String[]{â€œ20190212â€}); ä¸ä¼šæ‰“æ•£ï¼Œå› ä¸ºå¼ºè½¬ä¸ºObjectäº†ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ­¤æ—¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„å‚æ•°ã€‚ä½†æ³¨æ„ä»–æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½œç”¨ä»…ä»…æ˜¯éª—è¿‡ç¼–è¯‘å™¨è€Œå·²ã€‚</p></blockquote><p>â€</p><h3 id="å®é™…åº”ç”¨-AOP"><a href="#å®é™…åº”ç”¨-AOP" class="headerlink" title="å®é™…åº”ç”¨ - AOP"></a>å®é™…åº”ç”¨ - AOP</h3><ul><li><p>å®ç°AOPï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹(å³Aspect Oriented Programming)çš„æ¡†æ¶</p><ul><li><p>å…³æ³¨ç‚¹åˆ†ç¦»åŸåˆ™ï¼ˆSoCï¼Œå³Seperation of Concernï¼‰ï¼Œå¼ºè°ƒæŠŠç¨‹åºåˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†è´Ÿè´£ç‹¬ç«‹çš„åŠŸèƒ½</p></li><li><p>ç¨‹åºæœ‰ä¸€ä¸ªä¸»å…³æ³¨ç‚¹ + å¤šä¸ªå…¶ä»–å…³æ³¨ç‚¹</p><ul><li>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šbeforeã€afterã€around</li><li>è§¦å‘ä»€ä¹ˆï¼šè°ƒç”¨å¯¹è±¡</li></ul><blockquote><p>ä¸¾ä¾‹ï¼šè®¢å•ç³»ç»Ÿä¸­çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆä¸‹å•ã€æ”¯ä»˜ï¼‰ï¼›å…¶ä»–èƒ½åŠ›ï¼ˆæ—¥å¿—ã€é€šçŸ¥ã€æŠ½å¥–ç­‰ç­‰ï¼‰</p></blockquote><p><img src="/2021/04/06/Java%E5%8F%8D%E5%B0%84/image-20210406204850-i86ssqz.png" alt="image.png"></p></li><li><p>å®ç°1ï¼šä»£ç†æ¨¡å¼ï¼ˆJavaä¸­çš„Proxyç±»ï¼‰</p><ul><li>ä»£ç†çš„ä½œç”¨ï¼Œç›¸å½“äºæ˜¯æŠŠå¤šä¸ª <code>Aspect</code> å’Œ ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œåœ¨è¿è¡Œæ—¶èåˆèµ·æ¥</li><li><img src="/2021/04/06/Java%E5%8F%8D%E5%B0%84/image-20210406204913-gez0ay1.png" alt="image.png"></li></ul></li><li><p>å®ç°2ï¼šå‡½æ•°å¼ï¼šé«˜é˜¶ç¼–ç¨‹</p><ul><li>fï¼šæ ¸å¿ƒæ–¹æ³•</li><li>gï¼šæ–¹é¢åŒ…è£…æ–¹æ³•</li><li>xï¼šæ ¸å¿ƒè¾“å…¥æ–¹æ³•</li><li>æœ€åè°ƒç”¨æ–¹æ³•ï¼šh &#x3D; fg(x)</li></ul></li><li><p>å®ç°3ï¼šJavassiståº“åŠ¨æ€æ·»åŠ æ–¹æ³•</p><ul><li>AspectJç­‰æ¡†æ¶ä¼šä½¿ç”¨</li></ul></li></ul></li><li><p>å®ç°æ³¨è§£</p></li></ul><p>â€</p><h4 id="æ‰‹å†™AOPå®ä¾‹"><a href="#æ‰‹å†™AOPå®ä¾‹" class="headerlink" title="æ‰‹å†™AOPå®ä¾‹"></a>æ‰‹å†™AOPå®ä¾‹</h4><p>Java çš„ä»£ç† <code>Proxy</code>ç±»</p><p><img src="/2021/04/06/Java%E5%8F%8D%E5%B0%84/image-20210406205011-6sfjbdm.png" alt="image.png"></p><blockquote><p>Proxy.newInstance(classloader,  interfaces, InvocationHandler);</p></blockquote><ul><li>classloaderï¼šç”¨äºåˆ›å»ºInvocationHanderå’Œä»£ç†å¯¹è±¡çš„ClassLoader</li><li>interfacesï¼š ä»£ç†å“ªäº›æ¥å£</li><li>InvocationHandlerï¼š ä»£ç†æ–¹æ³•è§¦å‘åçš„å®é™…æ‰§è¡Œè€…</li></ul><p>æœ¬è´¨ä¸Šï¼ŒProxyæ˜¯æŠŠå¤šä¸ªæ¨¡å—åŒ–çš„ <code>Aspect</code> å’Œ ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œåœ¨è¿è¡Œæ—¶èåˆèµ·æ¥ï¼Œå½“æˆæ˜¯ä¸€ä¸ªç»¼åˆå®ç°å¤šä¸ªåŠŸèƒ½çš„ç±»ã€‚</p><p>â€</p><p>1.åˆ›å»ºä¸šåŠ¡æ¥å£IOrder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ”¯ä»˜æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>2.åˆ›å»ºä¸šåŠ¡å®ç°ç±»Order</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ”¯ä»˜å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span> <span class="title class_">IOrder</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ”¯ä»˜æ—¶é—´é—´éš”</span></span><br><span class="line">        Thread.sleep(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¯ä»˜å®Œæ¯•</span></span><br><span class="line">        <span class="built_in">this</span>.state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;order state:&quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>3.åˆ›å»ºåˆ‡é¢æ¥å£Aspectï¼Œå†…ç½®é™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºProxy</p><p>è¯¥ç±»åªèƒ½é’ˆå¯¹æ¥å£åšçš„ä»£ç†</p><blockquote><p>Proxy.newInstance(classloader,  interfaces, InvocationHandler);</p></blockquote><ul><li>classloaderï¼šç”¨äºåˆ›å»ºInvocationHandlerå’Œä»£ç†å¯¹è±¡çš„ClassLoader</li><li>interfacesï¼š ä»£ç†å“ªäº›æ¥å£</li><li>InvocationHandlerï¼š ä»£ç†æ–¹æ³•è§¦å‘åçš„å®é™…æ‰§è¡Œè€…</li></ul><p>â€</p><p>æ€è€ƒï¼š</p><ul><li><p>ä¸ºä»€ä¹ˆéœ€è¦InvocationHandler?</p><ul><li>ç”¨æ¥è¡”æ¥ã€èåˆä»£ç†å¯¹è±¡å’ŒAspectå¯¹è±¡</li></ul></li><li><p>ä¸ºä»€ä¹ˆéœ€è¦ä¼ å…¥Interfaces?</p><ul><li>æ¥å£å¯èƒ½ä¼šæœ‰å¤šä¸ªï¼Œè¢«ä»£ç†çš„æ¥å£ä¼šè¢«æ‹¦æˆª</li></ul></li><li><p>ä¸ºä»€ä¹ˆéœ€è¦ClassLoader?</p><ul><li>å¯èƒ½ä¼šæœ‰å¤šä¸ªClassLoaderåšä¸åŒçš„äº‹æƒ…ï¼Œå¿…é¡»è¦æŒ‡å®š</li></ul></li></ul><p>â€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AOPæ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Aspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›é™æ€æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getProxy</span><span class="params">(Class&lt;T&gt; cls, String... aspects)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">aspectInsts</span> <span class="operator">=</span> Arrays.stream(aspects).map(name -&gt; Try.ofFailable(() -&gt; &#123;</span><br><span class="line">            <span class="type">var</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(name);</span><br><span class="line">            <span class="keyword">return</span> (Aspect) clazz.getConstructor().newInstance();</span><br><span class="line">        &#125;))</span><br><span class="line">                .filter(aspect -&gt; aspect.isSuccess())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">inst</span> <span class="operator">=</span> cls.getConstructor().newInstance();</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(cls.getClassLoader(),</span><br><span class="line">                cls.getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> aspect : aspectInsts) &#123;</span><br><span class="line">                            aspect.get().before();</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(inst);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> aspect : aspectInsts) &#123;</span><br><span class="line">                            aspect.get().after();</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">return</span> result;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>4.åˆ›å»ºä¸€ä¸ªåˆ‡é¢å®ä¾‹ï¼Œè®¡ç®—æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AOPå®ç°ï¼šç”¨äºç›‘æ§ç¨‹åºè¿è¡Œæ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeUsageAspect</span> <span class="keyword">implements</span> <span class="title class_">Aspect</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> start;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        start = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">usage</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line"></span><br><span class="line">        System.out.format(<span class="string">&quot;time usage : %dms\n&quot;</span>,usage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>5.æ–°å»ºæµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AOPæµ‹è¯•å®ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyExampleTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_Proxy</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="type">IOrder</span> <span class="variable">order</span> <span class="operator">=</span> Aspect.getProxy(Order.class,<span class="string">&quot;com.javacoding.proxy.TimeUsageAspect&quot;</span>);</span><br><span class="line">        order.pay();</span><br><span class="line">        order.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>ã€æ³¨æ„1ã€‘é™æ€æ–¹æ³•è¿”å›å€¼ä¸ºæ³›å‹çš„æ—¶å€™ä¸ºä»€ä¹ˆstaticåè¦åŠ <code>&lt;T&gt;</code>?</p><blockquote><p>è¿™ä¸ªæ˜¯javaå£°æ˜æ³›å‹æ–¹æ³•çš„å›ºå®šæ ¼å¼ï¼Œåœ¨æ–¹æ³•çš„è¿”å›å€¼å£°æ˜ä¹‹å‰çš„ä½ç½®ï¼Œ<T>å®šä¹‰è¯¥æ–¹æ³•æ‰€æ‹¥æœ‰çš„æ³›å‹æ ‡è¯†ç¬¦ï¼Œä¸ªæ•°å¯ä»¥æ˜¯å¤šä¸ªï¼Œæ¯”å¦‚</T></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static&lt;<span class="built_in">T1</span>,<span class="built_in">T2</span>,<span class="built_in">T3</span>&gt; Response&lt;<span class="built_in">T1</span>&gt; test(<span class="built_in">T2</span> <span class="built_in">t2</span>,<span class="built_in">T3</span> <span class="built_in">t3</span>)&#123;  &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨æ–¹æ³•çš„è¿”å›å€¼æˆ–è€…å…¥å‚çš„åœ°æ–¹ï¼Œå°±å¯ä»¥ä½¿ç”¨â€œTâ€è¿™ä¸ªæ³›å‹ã€‚<br>æ³›å‹æ ‡è¯†ç¬¦çš„åå­—å¯ä»¥æ˜¯ä»»æ„ç¬¦åˆjavaè§„èŒƒçš„å˜é‡åï¼Œæ¯”å¦‚Mapå°±ä½¿ç”¨&lt;K,V&gt;ä½œä¸ºå®ƒçš„keyå’Œvalueçš„æ³›å‹æ ‡è¯†ç¬¦ã€‚</p></blockquote><p>ã€æ³¨æ„2ã€‘<code>String...</code>ä¸ºå¯å˜å‚æ•°ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªæˆ–å¤šä¸ª<code>String</code>ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨å°è£…ä¸ºStringæ•°ç»„</p><p>â€</p><h2 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h2><p>æ³¨è§£å°±åƒä¸€ä¸ªæ ‡ç­¾ï¼Œæ˜¯è´´åœ¨ç¨‹åºä»£ç ä¸Šä¾›å¦ä¸€ä¸ªç¨‹åºè¯»å–çš„ã€‚å…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€äº›å¤–éƒ¨çš„é€šç”¨åŠŸèƒ½ï¼Œåœ¨è¿è¡Œæ—¶èåˆåˆ°ä¸šåŠ¡ç±»ä¸­ï¼Œä½†æ˜¯ä¼ é€’å‚æ•°çš„æ—¶å€™å˜å¾—æ›´åŠ å®¹æ˜“ã€‚æœ¬è´¨è¿˜æ˜¯ä¸ºäº†è§£è€¦å’Œæä¾›ç±»èƒ½åŠ›çš„æ‰©å±•ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œæ³¨è§£å¤šç”±ç¬¬ä¸‰æ–¹åº“æä¾›ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†<code>proxy</code>å’Œåå°„å®ç°ï¼Œæˆ–è€…æ˜¯<code>Javassist</code>åŠ¨æ€ä¿®æ”¹ç±»æ¥è¾¾åˆ°ç›®çš„ã€‚</p><p>åŸºæœ¬æµç¨‹ï¼šç¨‹åºè¯»å–æ³¨è§£ -&gt; æ‰¾åˆ°æ³¨è§£ -&gt; æ‰¾åˆ°ç±»å¹¶å®ä¾‹åŒ–</p><p><img src="/2021/04/06/Java%E5%8F%8D%E5%B0%84/image-20210408115531-7w0gzvf.png" alt="image.png"></p><p>â€</p><h3 id="åŸºæœ¬ä½¿ç”¨æ–¹æ³•"><a href="#åŸºæœ¬ä½¿ç”¨æ–¹æ³•" class="headerlink" title="åŸºæœ¬ä½¿ç”¨æ–¹æ³•"></a>åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h3><p>æ³¨è§£å£°æ˜ï¼Œæ­¤æ—¶æ³¨è§£æ²¡æœ‰ä½œç”¨åŸŸï¼Œä»…ä»…æ˜¯ä¸€ä¸ªå®šä¹‰ã€‚</p><p>æŒ‰å¦‚ä¸‹çš„å®šä¹‰ï¼Œå¯ä»¥è¿™æ ·è°ƒç”¨æ³¨è§£<code>@Aspect(name = UsageAspect.class)</code> ï¼Œç›¸å½“äºæ˜¯ç»™name()æ–¹æ³•èµ‹å€¼ï¼Œä¼ å…¥äº†ä¸€ä¸ªåä¸º <code>UsageAspect</code> çš„ç±»ï¼Œè¿™ä¸ªç±»å¯ä»¥é€šè¿‡åå°„è·å–ã€‚</p><p>åŒç†ï¼Œ<code>@Aspect(value = &quot;æµ‹è¯•&quot;)</code>å¯ä»¥ç»™value()æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™äº›å±æ€§å¯ä»¥é€šè¿‡åå°„è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Aspect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶ä¸€ä¸ªclassç±»</span></span><br><span class="line">    <span class="keyword">public</span> Class <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥å—ä¸€ä¸ªå€¼</span></span><br><span class="line">    <span class="comment">//public String value();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€æ³¨æ„ã€‘æœ¬è´¨ä¸Š<code>@interface</code>ç›¸å½“äºç»§æ‰¿äº†ä¸€ä¸ª<code>Annotation</code>æ¥å£ï¼Œè€Œæ³¨è§£é‡Œçš„æ–¹æ³•è¢«ç¼–è¯‘ä¸º<code>Abstract</code>æ–¹æ³•</p><p>â€</p><h4 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h4><p><code>@Retention</code></p><p>å£°æ˜æ³¨è§£çš„å­˜æ´»å‘¨æœŸ</p><p>ä¸€èˆ¬å¼€å‘éƒ½æ˜¯é€šè¿‡åå°„è·å–æ³¨è§£ï¼Œæ•…ä½¿ç”¨<code>@Retention(RetentionPolicy.RUNTIME)</code></p><ul><li>Retentionè‹±æ–‡æ„æ€æœ‰ä¿ç•™ã€ä¿æŒçš„æ„æ€ï¼Œå®ƒè¡¨ç¤ºæ³¨è§£å­˜åœ¨é˜¶æ®µæ˜¯ä¿ç•™åœ¨æºç ï¼ˆç¼–è¯‘æœŸï¼‰ï¼Œå­—èŠ‚ç ï¼ˆç±»åŠ è½½ï¼‰æˆ–è€…è¿è¡ŒæœŸï¼ˆJVMä¸­è¿è¡Œï¼‰ã€‚åœ¨@Retentionæ³¨è§£ä¸­ä½¿ç”¨æšä¸¾RetentionPolicyæ¥è¡¨ç¤ºæ³¨è§£ä¿ç•™æ—¶æœŸ</li><li>@Retention(RetentionPolicy.SOURCE)ï¼Œæ³¨è§£ä»…å­˜åœ¨äºæºç ä¸­ï¼Œåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒ…å«</li><li>@Retention(RetentionPolicy.CLASS)ï¼Œ é»˜è®¤çš„ä¿ç•™ç­–ç•¥ï¼Œæ³¨è§£ä¼šåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œä½†è¿è¡Œæ—¶æ— æ³•è·å¾—</li><li>@Retention(RetentionPolicy.RUNTIME)ï¼Œ æ³¨è§£ä¼šåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è·å–åˆ°</li></ul><p>â€</p><p><code>@Target</code></p><p>å£°æ˜æ³¨è§£çš„ä½œç”¨èŒƒå›´</p><p>å¸¸ç”¨<code>@Target(ElementType.TYPE)</code></p><ul><li>Targetçš„è‹±æ–‡æ„æ€æ˜¯ç›®æ ‡ï¼Œè¿™ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä½¿ç”¨@Targetå…ƒæ³¨è§£è¡¨ç¤ºæˆ‘ä»¬çš„æ³¨è§£ä½œç”¨çš„èŒƒå›´å°±æ¯”è¾ƒå…·ä½“äº†ï¼Œå¯ä»¥æ˜¯ç±»ï¼Œæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°å˜é‡ç­‰ï¼ŒåŒæ ·ä¹Ÿæ˜¯é€šè¿‡æšä¸¾ç±»ElementTypeè¡¨è¾¾ä½œç”¨ç±»å‹</li><li>@Target(ElementType.TYPE) ä½œç”¨æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£</li><li>@Target(ElementType.FIELD) ä½œç”¨å±æ€§å­—æ®µã€æšä¸¾çš„å¸¸é‡</li><li>@Target(ElementType.METHOD) ä½œç”¨æ–¹æ³•</li><li>@Target(ElementType.PARAMETER) ä½œç”¨æ–¹æ³•å‚æ•°</li><li>@Target(ElementType.CONSTRUCTOR) ä½œç”¨æ„é€ å‡½æ•°</li><li>@Target(ElementType.LOCAL_VARIABLE)ä½œç”¨å±€éƒ¨å˜é‡</li><li>@Target(ElementType.ANNOTATION_TYPE)ä½œç”¨äºæ³¨è§£ï¼ˆ@Retentionæ³¨è§£ä¸­å°±ä½¿ç”¨è¯¥å±æ€§ï¼‰</li><li>@Target(ElementType.PACKAGE) ä½œç”¨äºåŒ…</li></ul><p>â€</p><p>å…¶ä»–çš„3ä¸ªå…ƒæ³¨è§£ï¼Œç”¨åˆ°å†å†™</p><ul><li>@Document</li><li>@Inherited</li><li>@Repeatable</li></ul><p>â€</p><h3 id="æ³¨è§£å®ä¾‹"><a href="#æ³¨è§£å®ä¾‹" class="headerlink" title="æ³¨è§£å®ä¾‹"></a>æ³¨è§£å®ä¾‹</h3><h4 id="å®ä¾‹ï¼šæ³¨è§£å®ç°AOP"><a href="#å®ä¾‹ï¼šæ³¨è§£å®ç°AOP" class="headerlink" title="å®ä¾‹ï¼šæ³¨è§£å®ç°AOP"></a>å®ä¾‹ï¼šæ³¨è§£å®ç°AOP</h4><p>1.å®šä¹‰æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>  <span class="comment">// æ³¨è§£å­˜æ´»æ—¶é—´</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span>  <span class="comment">// æŒ‡å¯ä»¥ç”¨äºç±»å‹ä¸Š</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Aspect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class <span class="title function_">type</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>2.å®šä¹‰åˆ‡é¢æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>3.å®šä¹‰åˆ‡é¢å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AOPå®ç°ï¼šç”¨äºç›‘æ§ç¨‹åºè¿è¡Œæ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeUsageAspect</span> <span class="keyword">implements</span> <span class="title class_">IAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> start;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        start = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">usage</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line"></span><br><span class="line">        System.out.format(<span class="string">&quot;time usage : %dms\n&quot;</span>,usage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>4.å®šä¹‰ä¸šåŠ¡æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ”¯ä»˜æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>5.å®šä¹‰ä¸šåŠ¡å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ”¯ä»˜å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect(type=TimeUsageAspect.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span> <span class="title class_">IOrder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ”¯ä»˜æ—¶é—´é—´éš”</span></span><br><span class="line">        Thread.sleep(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¯ä»˜å®Œæ¯•</span></span><br><span class="line">        <span class="built_in">this</span>.state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;order state:&quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>6.å®šä¹‰å·¥å‚æ–¹æ³• &amp; å•å…ƒæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ”¯ä»˜å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect(type=TimeUsageAspect.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span> <span class="title class_">IOrder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ”¯ä»˜æ—¶é—´é—´éš”</span></span><br><span class="line">        Thread.sleep(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¯ä»˜å®Œæ¯•</span></span><br><span class="line">        <span class="built_in">this</span>.state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;order state:&quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="å®ä¾‹ï¼šæ³¨è§£å®ç°å±æ€§æ³¨å…¥"><a href="#å®ä¾‹ï¼šæ³¨è§£å®ç°å±æ€§æ³¨å…¥" class="headerlink" title="å®ä¾‹ï¼šæ³¨è§£å®ç°å±æ€§æ³¨å…¥"></a>å®ä¾‹ï¼šæ³¨è§£å®ç°å±æ€§æ³¨å…¥</h4><p>1.å®šä¹‰ä¸€ä¸ªæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Injection &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>2.å®šä¹‰ä¸€ä¸ªå®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hero</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Injection(value = &quot;Ashe&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Injection(value = &quot;600&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String range;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Injection(value = &quot;100&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String DPS;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hero&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, range=&#x27;&quot;</span> + range + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, DPS=&#x27;&quot;</span> + DPS + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>3.å®šä¹‰ä¸€ä¸ªé™æ€å·¥å‚ï¼Œè´Ÿè´£å±æ€§æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InjectionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Object <span class="title function_">inject</span><span class="params">(Class&lt;T&gt; cls,Class&lt;? extends Injection&gt; annotation)</span> <span class="keyword">throws</span> IllegalAccessException, NoSuchMethodException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">fields</span> <span class="operator">=</span> cls.getDeclaredFields();</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">obj</span> <span class="operator">=</span> cls.getConstructor().newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> field : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(annotation)) &#123;</span><br><span class="line">                <span class="comment">// å…è®¸è®¿é—®ç§æœ‰å±æ€§</span></span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="type">var</span> <span class="variable">value</span> <span class="operator">=</span> field.getAnnotation(annotation).value();</span><br><span class="line">                field.set(obj, value);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;å±æ€§æ³¨å…¥å®Œæˆï¼&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>4.æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInjection</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_injection</span><span class="params">()</span> <span class="keyword">throws</span> InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">obj</span> <span class="operator">=</span> (Hero) InjectionFactory.inject(Hero.class,Injection.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(obj.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>CGLib&#x2F;Javassist å®ç°åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç </p><p><img src="/2021/04/06/Java%E5%8F%8D%E5%B0%84/image-20210409135446-wlxp4t1.png" alt="image.png"></p><p>â€</p><h3 id="å…ƒç¼–ç¨‹"><a href="#å…ƒç¼–ç¨‹" class="headerlink" title="å…ƒç¼–ç¨‹"></a>å…ƒç¼–ç¨‹</h3><p>#TODO# å…ƒç¼–ç¨‹</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å‡½æ•°å¼ç¼–ç¨‹å­¦ä¹ æ€»ç»“</title>
      <link href="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
      <url>/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡½æ•°å¼ç¼–ç¨‹å­¦ä¹ æ€»ç»“"><a href="#å‡½æ•°å¼ç¼–ç¨‹å­¦ä¹ æ€»ç»“" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹å­¦ä¹ æ€»ç»“"></a>å‡½æ•°å¼ç¼–ç¨‹å­¦ä¹ æ€»ç»“</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°å¼ç¼–ç¨‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°å¼ç¼–ç¨‹"></a>ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°å¼ç¼–ç¨‹</h2><p>javaçš„æŠ½è±¡çº§åˆ«ä¸å¤Ÿï¼Œåœ¨å¤„ç†å¤§å‹æ•°æ®é›†åˆçš„æ—¶å€™ï¼Œjavaæ¬ ç¼ºé«˜æ•ˆçš„å¹¶è¡Œæ“ä½œã€‚</p><p><code>OOP</code>ï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰æ˜¯å¯¹æ•°æ®è¿›è¡ŒæŠ½è±¡ï¼Œè€Œ<code>FP</code>ï¼ˆFunctional Programmingï¼Œå‡½æ•°å¼ç¼–ç¨‹ï¼‰æ˜¯å¯¹è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ã€‚</p><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œ<strong>æ•°æ®å’Œè¡Œä¸ºå¹¶å­˜</strong>ï¼Œç¨‹åºä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› æ­¤ä¸¤ç§ç¼–ç¨‹æ–¹å¼éƒ½è¦å­¦ä¹ ã€‚</p><p>å‡½æ•°å¼ç¼–ç¨‹è¿™ç§æ–°çš„æŠ½è±¡æ–¹å¼è¿˜æœ‰å…¶ä»–å¥½å¤„ï¼šç¨‹åºå‘˜èƒ½å¤Ÿç¼–å†™å‡ºæ›´å®¹æ˜“é˜…è¯»çš„ä»£ç â€”â€”è¿™ç§ä»£ç æ›´å¤šçš„è¡¨è¾¾äº†ä¸šåŠ¡é€»è¾‘çš„æ„å›¾ï¼Œè€Œä¸æ˜¯å®ƒçš„å®ç°æœºåˆ¶ã€‚</p><h2 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h2><p>å½¢å¦‚ï¼š</p><ul><li>() -&gt; {å®ç°é€»è¾‘};</li></ul><p>lambdaè¡¨è¾¾å¼å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_lambda1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">noArguments</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;Hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">noArgumentMulti</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(noArgumentMulti);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p><strong>æ–¹æ³•å¼•ç”¨ï¼ˆFunction Referenceï¼‰</strong></p><p>è¯­æ³•ä¸ºï¼š<code>Classname::methodName</code> ï¼Œå…¶ä¸­ <code>::</code> æ“ä½œç¬¦è¢«ç§°ä¸ºæ–¹æ³•å¼•ç”¨æ“ä½œç¬¦ã€‚</p><p>å‡¡æ˜¯èƒ½å¤Ÿä½¿ç”¨lambdaæ ‡å‡†è¡¨è¾¾å¼<code>x -&gt; x.method()</code>çš„æƒ…å†µä¸‹ï¼Œéƒ½èƒ½å¤Ÿä½¿ç”¨æ–¹æ³•å¼•ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">            .map(x -&gt; x + <span class="number">2</span>)</span><br><span class="line">            .reduce(<span class="number">0</span>,Math::max);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡è¦çš„å‡½æ•°æ¥å£"><a href="#é‡è¦çš„å‡½æ•°æ¥å£" class="headerlink" title="é‡è¦çš„å‡½æ•°æ¥å£"></a>é‡è¦çš„å‡½æ•°æ¥å£</h2><p>å‡½æ•°å¼ç¼–ç¨‹æœ€é‡è¦çš„æ˜¯ <code>æ–¹æ³•ç­¾å</code> ï¼Œå®ƒå£°æ˜äº†å‡½æ•°çš„å…¥å‚å’Œå‡ºå‚ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„åŸºçŸ³ã€‚</p><ul><li>Predicate<T></T></li><li>Consumer</li><li>Function&lt;T,R&gt;</li><li>Supplier</li><li>UnaryOperator</li><li>BinaryOperator</li><li><code>@FunctionalInterface</code></li></ul><p>#TODO#</p><h2 id="æµ"><a href="#æµ" class="headerlink" title="æµ"></a>æµ</h2><h3 id="ä»€ä¹ˆæ˜¯æµ"><a href="#ä»€ä¹ˆæ˜¯æµ" class="headerlink" title="ä»€ä¹ˆæ˜¯æµ"></a>ä»€ä¹ˆæ˜¯æµ</h3><p>æµæŒ‡éšç€æ—¶é—´äº§ç”Ÿçš„æ•°æ®åºåˆ—</p><p>java8 Streamï¼šæŒ‡ä¸ºä¸€ç»„åºåˆ—æä¾›é¡ºåºã€å¹¶è¡Œçš„è®¡ç®—</p><ul><li>æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹</li><li>æä¾›ç®¡é“è¿ç®—èƒ½åŠ›</li><li>æä¾›å¹¶å‘å¹¶è¡Œï¼ˆparallelï¼‰è®¡ç®—èƒ½åŠ›</li><li>æä¾›å¤§é‡æ“ä½œ</li></ul><blockquote><p>Streamæ˜¯ç”¨å‡½æ•°å¼ç¼–ç¨‹æ–¹å¼åœ¨é›†åˆä¸Šè¿›è¡Œå¤æ‚æ“ä½œçš„å·¥å…·</p></blockquote><p>â€</p><h3 id="æƒ°æ€§æ±‚å€¼"><a href="#æƒ°æ€§æ±‚å€¼" class="headerlink" title="æƒ°æ€§æ±‚å€¼"></a>æƒ°æ€§æ±‚å€¼</h3><p>æƒ°æ€§æ±‚å€¼ï¼ˆlazy evaluationï¼‰ï¼šæœ€ç»ˆä¸äº§ç”Ÿæ–°é›†åˆï¼ˆæˆ–æ–°è¿”å›å€¼ï¼‰ï¼ŒæŒ‡æè¿°Streamçš„æ–¹æ³•ï¼Œå«æƒ°æ€§æ±‚å€¼æ–¹æ³•ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»…æè¿°Streamï¼Œè¿”å›çš„ä»æ˜¯Stream</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.stream().filter(x -&gt; x &gt;= <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>åŠæ—©æ±‚å€¼ï¼šæœ€ç»ˆä¼šä»Streamäº§ç”Ÿå€¼çš„æ–¹æ³•ï¼Œå«åšåŠæ—©æ±‚å€¼ã€‚</p><p>è¿™ç§æœ€ç»ˆäº§ç”Ÿå€¼çš„æ–¹æ³•ï¼Œç§°ä¸º<code>ç»ˆç»“æ“ä½œ/æ–¹æ³•</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»…æè¿°Streamï¼Œè¿”å›çš„ä»æ˜¯Stream</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.stream().filter(x -&gt; x &gt;= <span class="number">3</span>)</span><br><span class="line">            .count();</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>åˆ¤æ–­æ–¹æ³•ï¼š</p><p>å¦‚æœè¿”å›å€¼æ˜¯Streamï¼ˆPipe Lineï¼‰ï¼Œåˆ™æ˜¯æƒ°æ€§æ±‚å€¼ï¼›å¦‚æœè¿”å›å€¼æ˜¯å¦ä¸€ä¸ªå€¼æˆ–è€…ç©ºï¼Œåˆ™ä¸ºåŠæ—©æ±‚å€¼ã€‚</p><blockquote><p>æ•´ä¸ªè¿‡ç¨‹å’Œ<code>å»ºé€ è€…æ¨¡å¼</code>æœ‰å…±é€šä¹‹å¤„ã€‚å»ºé€ è€…æ¨¡å¼ä½¿ç”¨ä¸€ç³»åˆ—æ“ä½œè®¾ç½®å±æ€§å’Œé…ç½®ï¼Œæœ€åç”¨ä¸€ä¸ª build æ–¹æ³•ï¼Œè¿™æ—¶å¯¹è±¡æ‰è¢«çœŸæ­£åˆ›å»ºã€‚</p></blockquote><p>â€</p><h3 id="of-ä¸-Optional"><a href="#of-ä¸-Optional" class="headerlink" title="of ä¸ Optional"></a>of ä¸ Optional</h3><p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œå¯¹è±¡æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä¸€èˆ¬é€šè¿‡ <code>new</code> å…³é”®å­—æ¥åˆ›å»ºå¯¹è±¡ï¼ŒåŸºæœ¬ç±»å‹ä¹Ÿéƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»ã€‚</p><p>åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œéœ€è¦ä¸€ä¸ªä¸“å±çš„è¿”å›å€¼å’Œåˆ›å»ºæµçš„æ–¹æ³•ã€‚</p><ul><li><p>of ç”¨äºæ„é€ è‡ªå·±çš„æµï¼Œæ˜¯æµçš„<code>å·¥å‚æ–¹æ³•</code></p></li><li><p>Optional æ˜¯æµä¸­ä¸“å±çš„è¿”å›å€¼ï¼Œç”¨æ¥æ›¿æ¢ <code>null</code> å€¼</p><ul><li>æŠŠStreamä¸­çš„è¿”å›å€¼è¿›è¡Œè£…ç®±ï¼Œé˜²æ­¢å„ç§å¼‚å¸¸çš„äº§ç”Ÿï¼Œä½¿æµè®¡ç®—æ›´åŠ å®‰å…¨</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_reduce</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">            .reduce((x, y) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> x + y;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(result.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€æ³¨æ„ã€‘å¯ä»¥é€šè¿‡ <code>orElse</code> æ–¹æ³•ï¼Œé¿å…è¿”å› <code>Optional</code></p><h3 id="å¸¸ç”¨çš„æµæ“ä½œ"><a href="#å¸¸ç”¨çš„æµæ“ä½œ" class="headerlink" title="å¸¸ç”¨çš„æµæ“ä½œ"></a>å¸¸ç”¨çš„æµæ“ä½œ</h3><p>ã€æ³¨æ„ã€‘ä»¥ä¸‹ä¾‹å­å‡ä¸ºæœ€ç®€å•å®ä¾‹ï¼Œå‡å¯ä»¥åœ¨æ–¹æ³•ä¸­è°ƒç”¨è‡ªå®šä¹‰çš„å‡½æ•°ã€‚</p><h4 id="collect"><a href="#collect" class="headerlink" title="collect"></a>collect</h4><p>collectæ–¹æ³•æœ‰streamé‡Œçš„å€¼ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ª<code>åŠæ—©æ±‚å€¼æ“ä½œ</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.stream().filter(x -&gt; x &gt; <span class="number">3</span>)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥å°†ä¸€ç§ç±»å‹çš„å€¼è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œmapæ“ä½œå°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ï¼Œå°†ä¸€ä¸ªæµä¸­çš„å€¼è½¬æ¢æˆä¸€ä¸ªæ–°çš„æµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="string">&quot;ashe&quot;</span>, <span class="string">&quot;zed&quot;</span>, <span class="string">&quot;yasuo&quot;</span>)</span><br><span class="line">            .map(x -&gt; x.toUpperCase())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>éå†æ•°æ®å¹¶æ£€æŸ¥&#x2F;è¿‡æ»¤å…¶ä¸­å…ƒç´ æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨è¯¥æ–¹æ³•ã€‚è§ <code>collect</code> ä¸­çš„ä¾‹å­ç»„åˆä½¿ç”¨</p><p>â€</p><h4 id="flatmap"><a href="#flatmap" class="headerlink" title="flatmap"></a>flatmap</h4><p>flatmapæ–¹æ³•å¯ä»¥ç”¨streamæ›¿æ¢å€¼ï¼Œç„¶åå°†å¤šä¸ªstreamè¿æ¥æˆä¸€ä¸ªã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_flapmap</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">list1</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">list2</span> <span class="operator">=</span> Arrays.asList(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">togetherList</span> <span class="operator">=</span> Stream.of(list1, list2)</span><br><span class="line">            .flatMap(x -&gt; x.stream())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(togetherList);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="max-min"><a href="#max-min" class="headerlink" title="max &amp; min"></a>max &amp; min</h4><p>æ±‚æœ€å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_max</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.stream()</span><br><span class="line">            .max(Comparator.comparing(x -&gt; x))</span><br><span class="line">            .orElse(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>è¯¥æ–¹æ³•å¯ä»¥ä»ä¸€ç»„å€¼ä¸­ç”Ÿæˆä¸€ä¸ªå€¼ï¼Œå¦‚ç´¯åŠ ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_reduce</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.stream()</span><br><span class="line">            .reduce(<span class="number">0</span>, (x, y) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> x + y;</span><br><span class="line">            &#125;);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>ä½¿ç”¨sortedæ–¹æ³•èƒ½å¤Ÿä½¿æµä¸­çš„æ•°æ®æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">11</span>)</span><br><span class="line">            .sorted()</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="unordered"><a href="#unordered" class="headerlink" title="unordered"></a>unordered</h4><p>æœ‰ä¸€äº›æµçš„æ“ä½œä¼šä½¿æ•°æ®è‡ªåŠ¨æ’åºã€‚ä¸€äº›æ“ä½œåœ¨æœ‰åºçš„æµä¸Šå¼€é”€ä¼šæ›´å¤§ï¼Œè€Œä½¿ç”¨è¯¥æ–¹æ³•èƒ½æ¶ˆé™¤è¿™ç§è‡ªåŠ¨æ’åºçš„æ“ä½œã€‚</p><p>ã€æ³¨æ„ã€‘ä»¥ä¸‹å®ä¾‹ä¸­çš„mapå¹¶ä¸ä¼šå¼•èµ·æ•°æ®çš„è‡ªåŠ¨æ’åºï¼Œå®ä¾‹å¹¶ä¸æ˜¯ååˆ†å‡†ç¡®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">11</span>)</span><br><span class="line">            .map(x -&gt; x -<span class="number">1</span>)</span><br><span class="line">            .unordered()</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="partitioningBy"><a href="#partitioningBy" class="headerlink" title="partitioningBy"></a>partitioningBy</h4><p>è¯¥æ–¹æ³•ç”¨äºå°†æµåˆ†è§£ä¸ºä¸¤ä¸ªé›†åˆï¼Œä¸€éƒ¨åˆ†ä¸ºç¬¦åˆæ¡ä»¶çš„é›†åˆï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºä¸ç¬¦åˆæ¡ä»¶çš„é›†åˆã€‚</p><p>è¦æ³¨æ„çš„æ˜¯partitioningByé‡Œé¢çš„è¿”å›å€¼å¿…é¡»ä¸ºbooleanç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="string">&quot;Ashe&quot;</span>, <span class="string">&quot;Ashen one&quot;</span>, <span class="string">&quot;Zed&quot;</span>, <span class="string">&quot;Yasuo&quot;</span>)</span><br><span class="line">            .collect(Collectors.partitioningBy(x -&gt; x.substring(<span class="number">1</span>, <span class="number">2</span>).equals(<span class="string">&quot;A&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="groupingBy"><a href="#groupingBy" class="headerlink" title="groupingBy"></a>groupingBy</h4><p>è¯¥æ–¹æ³•ç”¨äºå°†æ•°æ®åˆ†å‰²ä¸ºå¤šä¸ªlist</p><blockquote><p>è¯¥æ–¹æ³•ä¸SQLä¸­çš„group byæ“ä½œè•¾ä¸ï¼Œåªæ˜¯åœ¨Streamç±»åº“ä¸­å°†å…¶å®ç°äº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_groupingBy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">map</span> <span class="operator">=</span> Stream.of(<span class="string">&quot;Ashe&quot;</span>, <span class="string">&quot;Zed&quot;</span>, <span class="string">&quot;Yasuo&quot;</span>)</span><br><span class="line">            .collect(groupingBy(x -&gt; x));</span><br><span class="line"></span><br><span class="line">    System.out.println(map.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="å¹¶è¡Œå¤„ç†"><a href="#å¹¶è¡Œå¤„ç†" class="headerlink" title="å¹¶è¡Œå¤„ç†"></a>å¹¶è¡Œå¤„ç†</h4><p>ä»¥å¹¶è¡Œè®¡ç®—ä¸ºä¾‹</p><p><img src="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20210329230548-gcdvnrt.png" alt="image.png"></p><p>â€</p><p>codingå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµå¹¶è¡Œè®¡ç®—å®ä¾‹</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_parallel</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–éšæœºæ•°ç”Ÿæˆå™¨</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ•°ç»„ä¸­è·å–æœ€å¤§å€¼</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> IntStream.range(<span class="number">0</span>, <span class="number">80_000_000</span>)</span><br><span class="line">                .map(x -&gt; r.nextInt(<span class="number">80_000_000</span>))</span><br><span class="line">                .boxed()</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸²è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">seqStartTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;Seq Max value:&quot;</span> + list.stream().reduce(<span class="number">0</span>, Math::max));</span><br><span class="line">        System.out.println(<span class="string">&quot;Seq Time:&quot;</span> + (System.currentTimeMillis() - seqStartTime));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">parStartTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;Parallel Max value:&quot;</span> + list.parallelStream().reduce(<span class="number">0</span>, Math::max));</span><br><span class="line">        System.out.println(<span class="string">&quot;Parallel Time:&quot;</span> + (System.currentTimeMillis() - parStartTime));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20210329232442-3s8hs05.png" alt="image.png"></p><p>â€</p><p>å¹¶è¡Œæµæ€§èƒ½çš„å› ç´ </p><p>1.æ€§èƒ½æŒ‡æ ‡</p><ul><li>æ•°æ®åˆ†å—çš„å¤§å°ï¼šå½“æ•°æ®è¶³å¤Ÿå¤§ï¼Œæ¯ä¸ªæ•°æ®å¤„ç†ç®¡é“èŠ±è´¹çš„æ—¶é—´è¶³å¤Ÿå¤šæ—¶ï¼Œå¹¶è¡ŒåŒ–å¤„ç†æ‰æœ‰æ„ä¹‰</li><li>è£…ç®±ï¼šå¤„ç†åŸºæœ¬ç±»å‹æ¯”å¤„ç†è£…ç®±ç±»å‹è¦å¿«ï¼Œå¦‚æœè°ƒç”¨äº†<code>box</code>æ–¹æ³•ï¼Œåˆ™ä¼šè§¦å‘è‡ªåŠ¨è£…ç®±ï¼Œè¿›è€Œå¯¼è‡´æ€§èƒ½ä¼šä¸‹é™</li><li>cpuæ ¸æ•°ï¼šæ‹¥æœ‰çš„å¯ç”¨æ ¸æ•°è¶Šå¤šï¼Œæ€§èƒ½æå‡çš„å¹…åº¦è¶Šå¤§ã€‚å¯ä»¥é€šè¿‡æ–¹æ³•<code>Runtime.getRuntime().availableProcessors()</code> æ¥è·å–å¯ç”¨æ ¸æ•°</li><li>å•å…ƒå¤„ç†å¼€é”€ï¼šèŠ±è´¹åœ¨æ¯ä¸ªå…ƒç´ ä¸Šçš„æ—¶é—´è¶Šé•¿ï¼Œå¹¶è¡Œæ“ä½œå¸¦æ¥çš„æ€§èƒ½æå‡è¶Šæ˜æ˜¾</li></ul><p>2.å¯ä»¥æ ¹æ®æ€§èƒ½çš„å¥½åï¼Œå°†å®¹å™¨ä¸­çš„é€šç”¨æ•°æ®ç»“æ„åˆ†æˆä¸‰ç»„</p><ul><li><p>æ€§èƒ½å¥½ï¼šArrayListã€æ•°ç»„</p><ul><li>æ”¯æŒéšæœºè¯»å–ï¼Œå¯ä»¥å¾ˆå¥½åœ°è¢«åˆ†å‰²</li></ul></li><li><p>æ€§èƒ½ä¸€èˆ¬ï¼šHashSetã€TreeSet</p><ul><li>ä¸æ˜“å…¬å¹³çš„è¢«åˆ†è§£ï¼Œä½†æ˜¯å¤§å¤šæ•°æ—¶å€™æ˜¯å¯èƒ½çš„</li></ul></li><li><p>æ€§èƒ½å·®ï¼šLinkedListã€Stream.lierateã€BufferedReader.lines</p><ul><li>é•¿åº¦æœªçŸ¥ã€ä¸æ”¯æŒéšæœºè¯»å–ã€éš¾ä»¥é¢„æµ‹åˆ†å‰²çš„ä½ç½®</li></ul></li></ul><p>3.å¦‚æœèƒ½é¿å¼€æœ‰çŠ¶æ€çš„æ“ä½œï¼Œé€‰ç”¨æ— çŠ¶æ€çš„æ“ä½œï¼Œèƒ½å¤Ÿè·å¾—æ›´å¥½çš„æ€§èƒ½</p><ul><li><p>æ— çŠ¶æ€æ“ä½œï¼ˆstatelessï¼‰</p><ul><li>filter</li><li>flatmap</li><li>map</li></ul></li><li><p>æœ‰çŠ¶æ€æ“ä½œï¼ˆstatefulï¼‰</p><ul><li>sorted</li><li>distinct</li><li>limit</li><li>skip</li></ul></li></ul><p>4.åœ¨å‡½æ•°å¼ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¤šä½¿ç”¨çº¯å‡½æ•°ï¼ˆpure functionï¼‰</p><ul><li><p>çº¯å‡½æ•°æŒ‡æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå³çº¯è®¡ç®—çš„ä½†ä¸€æ“ä½œï¼Œä¸æ¶‰åŠå…¶ä»–æ“ä½œçš„å‡½æ•°</p></li><li><p>éçº¯å‡½æ•°å®ä¾‹</p></li></ul><p>5.å‡½æ•°å¼ç¼–ç¨‹æ€§è´¨æ€»ç»“</p><ul><li>ä¸€èˆ¬ä½¿ç”¨çº¯å‡½æ•°ï¼ˆpure functionï¼‰ï¼Œè¦æ±‚è¾“å…¥çš„æ•°æ®ä¸å¯å˜ï¼ˆimmutableï¼‰ï¼Œä»…ä»…å¯¹è¾“å…¥çš„æ•°æ®åšæ‹·è´</li><li>æƒ°æ€§æ±‚å€¼ï¼ˆlazyï¼‰</li><li>å®‰å…¨ï¼ˆMonad - safetyï¼‰</li></ul><p>è¿™é‡Œçš„cå±äºå¤–éƒ¨å˜é‡ï¼Œä½†æ˜¯å´åœ¨å‡½æ•°å†…éƒ¨å‘ç”Ÿäº†è®¡ç®—ï¼ŒåŒæ—¶è°ƒç”¨äº†I&#x2F;Oçš„æ“ä½œï¼Œä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œéœ€è¦åŒæ—¶æ’æŸ¥å˜é‡abã€å˜é‡cã€IOè®¾å¤‡ã€‚</p><p><img src="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20210329225506-415y24x.png" alt="image.png"></p><p>â€</p><h4 id="ä¸²è¡Œå¤„ç†"><a href="#ä¸²è¡Œå¤„ç†" class="headerlink" title="ä¸²è¡Œå¤„ç†"></a>ä¸²è¡Œå¤„ç†</h4><p>å¼ºåˆ¶æµä¸²è¡Œå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>).sequential()</span><br><span class="line">            .map(x -&gt; x / <span class="number">2</span>)</span><br><span class="line">            .reduce(Math::max)</span><br><span class="line">            .orElse(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ sequential æ–¹æ³•å’Œ parallel æ–¹æ³•åŒæ—¶ä½¿ç”¨æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆã€‚ä»¥æœ€åä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•ä¸ºå‡†ã€‚</p><p>â€</p><h4 id="æ•´åˆæ“ä½œ"><a href="#æ•´åˆæ“ä½œ" class="headerlink" title="æ•´åˆæ“ä½œ"></a>æ•´åˆæ“ä½œ</h4><p>map -&gt; filter -&gt; reduce</p><p><img src="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20210329223216-cvocr8i.png" alt="image.png"></p><p>â€</p><h3 id="ä¸šåŠ¡åœºæ™¯å®ä¾‹"><a href="#ä¸šåŠ¡åœºæ™¯å®ä¾‹" class="headerlink" title="ä¸šåŠ¡åœºæ™¯å®ä¾‹"></a>ä¸šåŠ¡åœºæ™¯å®ä¾‹</h3><p>å®ä¾‹ä¸€ï¼š</p><p>æ–°æ—§å†™æ³•çš„æ¯”è¾ƒ</p><p><img src="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20210319160339-dnaavlo.png" alt="image.png"></p><p>â€</p><p>å®ä¾‹äºŒï¼š</p><p><img src="/2021/03/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20210319160415-edgolwa.png" alt="image.png"></p><p>â€</p><p>å®ä¾‹ä¸‰ï¼š</p><p>å¹¶è¡Œè®¡ç®—æœ€å¤§å€¼çš„åŒºåˆ«</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.parallelStream().max((a, b) -&gt; a - b).orElse(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> list.parallelStream().reduce(<span class="number">0</span>,Math::max);</span><br></pre></td></tr></table></figure><p>åŒºåˆ«ï¼š</p><blockquote><p>parallel()æ˜¯æŠŠä¸€ä¸ªStreamå˜æˆparallelStream</p><p>parallelStreamæ˜¯æŠŠä¸€ä¸ªéstream(å¦‚ Listï¼‰å˜æˆ parallelStream</p><p>Streamè¿˜æ˜¯ParallelStreamçš„maxæ–¹æ³•éƒ½æ˜¯ç”¨reduceå®ç°ã€‚</p><p>parallelStreamçš„reduceæ–¹æ³•æœ‰3ä¸ªå‚æ•°ï¼š(identity, accumulator, combiner)</p><ul><li>identity åˆå§‹å€¼</li><li>accumulator å•ä¸ªçº¿ç¨‹å¦‚ä½•ç´¯è®¡ï¼Œmaxå°±æ˜¯ä¸€ç›´ç®—æœ€å¤§å€¼</li><li>combinerå°±æ˜¯å¦‚ä½•åˆå¹¶å¤šä¸ªçº¿ç¨‹è®¡ç®—çš„ç»“æœs</li></ul></blockquote><p>â€</p><h2 id="å‚è€ƒä¹¦ç±"><a href="#å‚è€ƒä¹¦ç±" class="headerlink" title="å‚è€ƒä¹¦ç±"></a>å‚è€ƒä¹¦ç±</h2><p>ã€ŠJava8 å‡½æ•°å¼ç¼–ç¨‹ã€‹</p><p>ã€Šå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ã€‹</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨</title>
      <link href="/2021/03/01/Java%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/"/>
      <url>/2021/03/01/Java%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨"><a href="#Java-å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨" class="headerlink" title="Java å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨"></a>Java å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨</h1><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022201.jpg" alt="image"></p><p>åŸºæœ¬ç‰¹å¾</p><blockquote><ul><li>ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆObject-oriented programmingï¼‰å’Œè¿‡ç¨‹å¼ç¼–ç¨‹ï¼ˆProcedural programmingï¼‰å¹¶åˆ—çš„ç¼–ç¨‹èŒƒå¼ã€‚</li><li>æœ€ä¸»è¦çš„ç‰¹å¾æ˜¯ï¼Œå‡½æ•°æ˜¯<a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch2.html">ç¬¬ä¸€ç­‰å…¬æ°‘</a>ã€‚</li><li>å¼ºè°ƒå°†è®¡ç®—è¿‡ç¨‹åˆ†è§£æˆå¯å¤ç”¨çš„å‡½æ•°ï¼Œå…¸å‹ä¾‹å­å°±æ˜¯<code>map</code>æ–¹æ³•å’Œ<code>reduce</code>æ–¹æ³•ç»„åˆè€Œæˆ<a href="https://zh.wikipedia.org/wiki/MapReduce">MapReduce ç®—æ³•</a>ã€‚</li><li>åªæœ‰<a href="https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0">çº¯çš„</a>ã€æ²¡æœ‰<a href="https://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B0%E5%89%AF%E4%BD%9C%E7%94%A8">å‰¯ä½œç”¨</a>çš„å‡½æ•°ï¼Œæ‰æ˜¯åˆæ ¼çš„å‡½æ•°ã€‚</li></ul></blockquote><h2 id="ä¸€ã€èŒƒç•´è®º"><a href="#ä¸€ã€èŒƒç•´è®º" class="headerlink" title="ä¸€ã€èŒƒç•´è®º"></a>ä¸€ã€èŒƒç•´è®º</h2><p>å‡½æ•°å¼ç¼–ç¨‹çš„èµ·æºï¼Œæ˜¯ä¸€é—¨å«åšèŒƒç•´è®ºï¼ˆCategory Theoryï¼‰çš„æ•°å­¦åˆ†æ”¯ã€‚</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022205.jpg" alt="image"></p><p>ç†è§£å‡½æ•°å¼ç¼–ç¨‹çš„å…³é”®ï¼Œå°±æ˜¯ç†è§£èŒƒç•´è®ºã€‚å®ƒæ˜¯ä¸€é—¨å¾ˆå¤æ‚çš„æ•°å­¦ï¼Œè®¤ä¸ºä¸–ç•Œä¸Šæ‰€æœ‰çš„æ¦‚å¿µä½“ç³»ï¼Œéƒ½å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªä¸ªçš„â€èŒƒç•´â€ï¼ˆcategoryï¼‰ã€‚</p><h3 id="1-1-èŒƒç•´çš„æ¦‚å¿µ"><a href="#1-1-èŒƒç•´çš„æ¦‚å¿µ" class="headerlink" title="1.1 èŒƒç•´çš„æ¦‚å¿µ"></a>1.1 èŒƒç•´çš„æ¦‚å¿µ</h3><p>ä»€ä¹ˆæ˜¯èŒƒç•´å‘¢ï¼Ÿ</p><p><a href="https://en.wikipedia.org/wiki/Category_(mathematics)">ç»´åŸºç™¾ç§‘</a>çš„ä¸€å¥è¯å®šä¹‰å¦‚ä¸‹ã€‚</p><blockquote><p>â€œèŒƒç•´å°±æ˜¯ä½¿ç”¨ç®­å¤´è¿æ¥çš„ç‰©ä½“ã€‚â€ï¼ˆIn mathematics, a category is an algebraic structure that comprises â€œobjectsâ€ that are linked by â€œarrowsâ€. ï¼‰</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½¼æ­¤ä¹‹é—´å­˜åœ¨æŸç§å…³ç³»çš„æ¦‚å¿µã€äº‹ç‰©ã€å¯¹è±¡ç­‰ç­‰ï¼Œéƒ½æ„æˆâ€èŒƒç•´â€ã€‚éšä¾¿ä»€ä¹ˆä¸œè¥¿ï¼Œåªè¦èƒ½æ‰¾å‡ºå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå°±èƒ½å®šä¹‰ä¸€ä¸ªâ€èŒƒç•´â€ã€‚</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022210.jpg" alt="image"></p><p>ä¸Šå›¾ä¸­ï¼Œå„ä¸ªç‚¹ä¸å®ƒä»¬ä¹‹é—´çš„ç®­å¤´ï¼Œå°±æ„æˆä¸€ä¸ªèŒƒç•´ã€‚</p><p>ç®­å¤´è¡¨ç¤ºèŒƒç•´æˆå‘˜ä¹‹é—´çš„å…³ç³»ï¼Œæ­£å¼çš„åç§°å«åšâ€æ€å°„â€ï¼ˆmorphismï¼‰ã€‚èŒƒç•´è®ºè®¤ä¸ºï¼ŒåŒä¸€ä¸ªèŒƒç•´çš„æ‰€æœ‰æˆå‘˜ï¼Œå°±æ˜¯ä¸åŒçŠ¶æ€çš„â€å˜å½¢â€ï¼ˆtransformationï¼‰ã€‚é€šè¿‡â€æ€å°„â€ï¼Œä¸€ä¸ªæˆå‘˜å¯ä»¥å˜å½¢æˆå¦ä¸€ä¸ªæˆå‘˜ã€‚</p><h3 id="1-2-æ•°å­¦æ¨¡å‹"><a href="#1-2-æ•°å­¦æ¨¡å‹" class="headerlink" title="1.2 æ•°å­¦æ¨¡å‹"></a>1.2 æ•°å­¦æ¨¡å‹</h3><p>æ—¢ç„¶â€èŒƒç•´â€æ˜¯æ»¡è¶³æŸç§å˜å½¢å…³ç³»çš„æ‰€æœ‰å¯¹è±¡ï¼Œå°±å¯ä»¥æ€»ç»“å‡ºå®ƒçš„æ•°å­¦æ¨¡å‹ã€‚</p><blockquote><ul><li>æ‰€æœ‰æˆå‘˜æ˜¯ä¸€ä¸ªé›†åˆ</li><li>å˜å½¢å…³ç³»æ˜¯å‡½æ•°</li></ul></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒèŒƒç•´è®ºæ˜¯é›†åˆè®ºæ›´ä¸Šå±‚çš„æŠ½è±¡ï¼Œç®€å•çš„ç†è§£å°±æ˜¯â€é›†åˆ + å‡½æ•°â€ã€‚</p><p>ç†è®ºä¸Šé€šè¿‡å‡½æ•°ï¼Œå°±å¯ä»¥ä»èŒƒç•´çš„ä¸€ä¸ªæˆå‘˜ï¼Œç®—å‡ºå…¶ä»–æ‰€æœ‰æˆå‘˜ã€‚</p><h3 id="1-3-èŒƒç•´ä¸å®¹å™¨"><a href="#1-3-èŒƒç•´ä¸å®¹å™¨" class="headerlink" title="1.3 èŒƒç•´ä¸å®¹å™¨"></a>1.3 èŒƒç•´ä¸å®¹å™¨</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠâ€èŒƒç•´â€æƒ³è±¡æˆæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢åŒ…å«ä¸¤æ ·ä¸œè¥¿ã€‚</p><blockquote><ul><li>å€¼ï¼ˆvalueï¼‰</li><li>å€¼çš„å˜å½¢å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°ã€‚</li></ul></blockquote><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä»£ç ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„èŒƒç•´ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Category</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">val</span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">val</span> = val; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addOne</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Category</code>æ˜¯ä¸€ä¸ªç±»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªå€¼ï¼ˆ<code>this.val</code>ï¼‰å’Œä¸€ç§å˜å½¢å…³ç³»ï¼ˆ<code>addOne</code>ï¼‰ã€‚ä½ å¯èƒ½å·²ç»çœ‹å‡ºæ¥äº†ï¼Œè¿™é‡Œçš„èŒƒç•´ï¼Œå°±æ˜¯æ‰€æœ‰å½¼æ­¤ä¹‹é—´ç›¸å·®<code>1</code>çš„æ•°å­—ã€‚</p><p>æ³¨æ„ï¼Œæœ¬æ–‡åé¢çš„éƒ¨åˆ†ï¼Œå‡¡æ˜¯æåˆ°â€å®¹å™¨â€çš„åœ°æ–¹ï¼Œå…¨éƒ¨éƒ½æ˜¯æŒ‡â€èŒƒç•´â€ã€‚</p><h3 id="1-4-èŒƒç•´è®ºä¸å‡½æ•°å¼ç¼–ç¨‹çš„å…³ç³»"><a href="#1-4-èŒƒç•´è®ºä¸å‡½æ•°å¼ç¼–ç¨‹çš„å…³ç³»" class="headerlink" title="1.4 èŒƒç•´è®ºä¸å‡½æ•°å¼ç¼–ç¨‹çš„å…³ç³»"></a>1.4 èŒƒç•´è®ºä¸å‡½æ•°å¼ç¼–ç¨‹çš„å…³ç³»</h3><p>èŒƒç•´è®ºä½¿ç”¨å‡½æ•°ï¼Œè¡¨è¾¾èŒƒç•´ä¹‹é—´çš„å…³ç³»ã€‚</p><p>ä¼´éšç€èŒƒç•´è®ºçš„å‘å±•ï¼Œå°±å‘å±•å‡ºä¸€æ•´å¥—å‡½æ•°çš„è¿ç®—æ–¹æ³•ã€‚è¿™å¥—æ–¹æ³•èµ·åˆåªç”¨äºæ•°å­¦è¿ç®—ï¼Œåæ¥æœ‰äººå°†å®ƒåœ¨è®¡ç®—æœºä¸Šå®ç°äº†ï¼Œå°±å˜æˆäº†ä»Šå¤©çš„â€å‡½æ•°å¼ç¼–ç¨‹â€ã€‚</p><p><strong>æœ¬è´¨ä¸Šï¼Œå‡½æ•°å¼ç¼–ç¨‹åªæ˜¯èŒƒç•´è®ºçš„è¿ç®—æ–¹æ³•ï¼Œè·Ÿæ•°ç†é€»è¾‘ã€å¾®ç§¯åˆ†ã€è¡Œåˆ—å¼æ˜¯åŒä¸€ç±»ä¸œè¥¿ï¼Œéƒ½æ˜¯æ•°å­¦æ–¹æ³•ï¼Œåªæ˜¯ç¢°å·§å®ƒèƒ½ç”¨æ¥å†™ç¨‹åºã€‚</strong></p><p>æ‰€ä»¥ï¼Œä½ æ˜ç™½äº†å—ï¼Œä¸ºä»€ä¹ˆå‡½æ•°å¼ç¼–ç¨‹è¦æ±‚å‡½æ•°å¿…é¡»æ˜¯çº¯çš„ï¼Œä¸èƒ½æœ‰å‰¯ä½œç”¨ï¼Ÿå› ä¸ºå®ƒæ˜¯ä¸€ç§æ•°å­¦è¿ç®—ï¼ŒåŸå§‹ç›®çš„å°±æ˜¯æ±‚å€¼ï¼Œä¸åšå…¶ä»–äº‹æƒ…ï¼Œå¦åˆ™å°±æ— æ³•æ»¡è¶³å‡½æ•°è¿ç®—æ³•åˆ™äº†ã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå‡½æ•°å°±æ˜¯ä¸€ä¸ªç®¡é“ï¼ˆpipeï¼‰ã€‚è¿™å¤´è¿›å»ä¸€ä¸ªå€¼ï¼Œé‚£å¤´å°±ä¼šå‡ºæ¥ä¸€ä¸ªæ–°çš„å€¼ï¼Œæ²¡æœ‰å…¶ä»–ä½œç”¨ã€‚</p><h2 id="äºŒã€å‡½æ•°çš„åˆæˆä¸æŸ¯é‡ŒåŒ–"><a href="#äºŒã€å‡½æ•°çš„åˆæˆä¸æŸ¯é‡ŒåŒ–" class="headerlink" title="äºŒã€å‡½æ•°çš„åˆæˆä¸æŸ¯é‡ŒåŒ–"></a>äºŒã€å‡½æ•°çš„åˆæˆä¸æŸ¯é‡ŒåŒ–</h2><p>å‡½æ•°å¼ç¼–ç¨‹æœ‰ä¸¤ä¸ªæœ€åŸºæœ¬çš„è¿ç®—ï¼šåˆæˆå’ŒæŸ¯é‡ŒåŒ–ã€‚</p><h3 id="2-1-å‡½æ•°çš„åˆæˆ"><a href="#2-1-å‡½æ•°çš„åˆæˆ" class="headerlink" title="2.1 å‡½æ•°çš„åˆæˆ"></a>2.1 å‡½æ•°çš„åˆæˆ</h3><p>å¦‚æœä¸€ä¸ªå€¼è¦ç»è¿‡å¤šä¸ªå‡½æ•°ï¼Œæ‰èƒ½å˜æˆå¦å¤–ä¸€ä¸ªå€¼ï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰ä¸­é—´æ­¥éª¤åˆå¹¶æˆä¸€ä¸ªå‡½æ•°ï¼Œè¿™å«åšâ€å‡½æ•°çš„åˆæˆâ€ï¼ˆcomposeï¼‰ã€‚</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022204.png" alt="image"></p><p>ä¸Šå›¾ä¸­ï¼Œ<code>X</code>å’Œ<code>Y</code>ä¹‹é—´çš„å˜å½¢å…³ç³»æ˜¯å‡½æ•°<code>f</code>ï¼Œ<code>Y</code>å’Œ<code>Z</code>ä¹‹é—´çš„å˜å½¢å…³ç³»æ˜¯å‡½æ•°<code>g</code>ï¼Œé‚£ä¹ˆ<code>X</code>å’Œ<code>Z</code>ä¹‹é—´çš„å…³ç³»ï¼Œå°±æ˜¯<code>g</code>å’Œ<code>f</code>çš„åˆæˆå‡½æ•°<code>gÂ·f</code>ã€‚</p><p>ä¸‹é¢å°±æ˜¯ä»£ç å®ç°äº†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ JavaScript è¯­è¨€ã€‚æ³¨æ„ï¼Œæœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹ä»£ç éƒ½æ˜¯ç®€åŒ–è¿‡çš„ï¼Œå®Œæ•´çš„ Demo è¯·çœ‹ã€Šå‚è€ƒé“¾æ¥ã€‹éƒ¨åˆ†ã€‚</p><p>åˆæˆä¸¤ä¸ªå‡½æ•°çš„ç®€å•ä»£ç å¦‚ä¸‹ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> compose = <span class="keyword">function</span> (<span class="params">f, g</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">f</span>(<span class="title function_">g</span>(x));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>å‡½æ•°çš„åˆæˆè¿˜å¿…é¡»æ»¡è¶³ç»“åˆå¾‹ã€‚</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022209.png" alt="image"></p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(f, <span class="title function_">compose</span>(g, h))</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">compose</span>(f, g), h)</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="title function_">compose</span>(f, g, h)</span><br></pre></td></tr></table></figure></blockquote><p>åˆæˆä¹Ÿæ˜¯å‡½æ•°å¿…é¡»æ˜¯çº¯çš„ä¸€ä¸ªåŸå› ã€‚å› ä¸ºä¸€ä¸ªä¸çº¯çš„å‡½æ•°ï¼Œæ€ä¹ˆè·Ÿå…¶ä»–å‡½æ•°åˆæˆï¼Ÿæ€ä¹ˆä¿è¯å„ç§åˆæˆä»¥åï¼Œå®ƒä¼šè¾¾åˆ°é¢„æœŸçš„è¡Œä¸ºï¼Ÿ</p><p>å‰é¢è¯´è¿‡ï¼Œå‡½æ•°å°±åƒæ•°æ®çš„ç®¡é“ï¼ˆpipeï¼‰ã€‚é‚£ä¹ˆï¼Œå‡½æ•°åˆæˆå°±æ˜¯å°†è¿™äº›ç®¡é“è¿äº†èµ·æ¥ï¼Œè®©æ•°æ®ä¸€å£æ°”ä»å¤šä¸ªç®¡é“ä¸­ç©¿è¿‡ã€‚</p><h3 id="2-2-æŸ¯é‡ŒåŒ–"><a href="#2-2-æŸ¯é‡ŒåŒ–" class="headerlink" title="2.2 æŸ¯é‡ŒåŒ–"></a>2.2 æŸ¯é‡ŒåŒ–</h3><p><code>f(x)</code>å’Œ<code>g(x)</code>åˆæˆä¸º<code>f(g(x))</code>ï¼Œæœ‰ä¸€ä¸ªéšè—çš„å‰æï¼Œå°±æ˜¯<code>f</code>å’Œ<code>g</code>éƒ½åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ã€‚å¦‚æœå¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ï¼Œæ¯”å¦‚<code>f(x, y)</code>å’Œ<code>g(a, b, c)</code>ï¼Œå‡½æ•°åˆæˆå°±éå¸¸éº»çƒ¦ã€‚** **</p><p>è¿™æ—¶å°±éœ€è¦å‡½æ•°æŸ¯é‡ŒåŒ–äº†ã€‚æ‰€è°“â€æŸ¯é‡ŒåŒ–â€ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤šå‚æ•°çš„å‡½æ•°ï¼Œè½¬åŒ–ä¸ºå•å‚æ•°å‡½æ•°ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æŸ¯é‡ŒåŒ–ä¹‹å‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¯é‡ŒåŒ–ä¹‹å</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addX</span>(<span class="params">y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">addX</span>(<span class="number">2</span>)(<span class="number">1</span>) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></blockquote><p>æœ‰äº†æŸ¯é‡ŒåŒ–ä»¥åï¼Œæˆ‘ä»¬å°±èƒ½åšåˆ°ï¼Œæ‰€æœ‰å‡½æ•°åªæ¥å—ä¸€ä¸ªå‚æ•°ã€‚åæ–‡çš„å†…å®¹é™¤éå¦æœ‰è¯´æ˜ï¼Œéƒ½é»˜è®¤å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦å¤„ç†çš„é‚£ä¸ªå€¼ã€‚</p><h2 id="ä¸‰ã€å‡½å­"><a href="#ä¸‰ã€å‡½å­" class="headerlink" title="ä¸‰ã€å‡½å­"></a>ä¸‰ã€å‡½å­</h2><p>å‡½æ•°ä¸ä»…å¯ä»¥ç”¨äºåŒä¸€ä¸ªèŒƒç•´ä¹‹ä¸­å€¼çš„è½¬æ¢ï¼Œè¿˜å¯ä»¥ç”¨äºå°†ä¸€ä¸ªèŒƒç•´è½¬æˆå¦ä¸€ä¸ªèŒƒç•´ã€‚è¿™å°±æ¶‰åŠåˆ°äº†å‡½å­ï¼ˆFunctorï¼‰ã€‚</p><h3 id="3-1-å‡½å­çš„æ¦‚å¿µ"><a href="#3-1-å‡½å­çš„æ¦‚å¿µ" class="headerlink" title="3.1 å‡½å­çš„æ¦‚å¿µ"></a>3.1 å‡½å­çš„æ¦‚å¿µ</h3><p>å‡½å­æ˜¯å‡½æ•°å¼ç¼–ç¨‹é‡Œé¢æœ€é‡è¦çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯åŸºæœ¬çš„è¿ç®—å•ä½å’ŒåŠŸèƒ½å•ä½ã€‚</p><p>å®ƒé¦–å…ˆæ˜¯ä¸€ç§èŒƒç•´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨ï¼ŒåŒ…å«äº†å€¼å’Œå˜å½¢å…³ç³»ã€‚<strong>æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œå®ƒçš„å˜å½¢å…³ç³»å¯ä»¥ä¾æ¬¡ä½œç”¨äºæ¯ä¸€ä¸ªå€¼ï¼Œå°†å½“å‰å®¹å™¨å˜å½¢æˆå¦ä¸€ä¸ªå®¹å™¨ã€‚</strong></p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022203.png"></p><p>ä¸Šå›¾ä¸­ï¼Œå·¦ä¾§çš„åœ†åœˆå°±æ˜¯ä¸€ä¸ªå‡½å­ï¼Œè¡¨ç¤ºäººåçš„èŒƒç•´ã€‚å¤–éƒ¨ä¼ å…¥å‡½æ•°<code>f</code>ï¼Œä¼šè½¬æˆå³è¾¹è¡¨ç¤ºæ—©é¤çš„èŒƒç•´ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€å¼ æ›´ä¸€èˆ¬çš„å›¾ã€‚</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017022211.jpg" alt="image"></p><p>ä¸Šå›¾ä¸­ï¼Œå‡½æ•°<code>f</code>å®Œæˆå€¼çš„è½¬æ¢ï¼ˆ<code>a</code>åˆ°<code>b</code>ï¼‰ï¼Œå°†å®ƒä¼ å…¥å‡½å­ï¼Œå°±å¯ä»¥å®ç°èŒƒç•´çš„è½¬æ¢ï¼ˆ<code>Fa</code>åˆ°<code>Fb</code>ï¼‰ã€‚</p><h3 id="3-2-å‡½å­çš„ä»£ç å®ç°"><a href="#3-2-å‡½å­çš„ä»£ç å®ç°" class="headerlink" title="3.2 å‡½å­çš„ä»£ç å®ç°"></a>3.2 å‡½å­çš„ä»£ç å®ç°</h3><p>ä»»ä½•å…·æœ‰<code>map</code>æ–¹æ³•çš„æ•°æ®ç»“æ„ï¼Œéƒ½å¯ä»¥å½“ä½œå‡½å­çš„å®ç°ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Functor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">val</span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">val</span> = val; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">map</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Functor</span>(<span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">val</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Functor</code>æ˜¯ä¸€ä¸ªå‡½å­ï¼Œå®ƒçš„<code>map</code>æ–¹æ³•æ¥å—å‡½æ•°<code>f</code>ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„å‡½å­ï¼Œé‡Œé¢åŒ…å«çš„å€¼æ˜¯è¢«<code>f</code>å¤„ç†è¿‡çš„ï¼ˆ<code>f(this.val)</code>ï¼‰ã€‚</p><p><strong>ä¸€èˆ¬çº¦å®šï¼Œå‡½å­çš„æ ‡å¿—å°±æ˜¯å®¹å™¨å…·æœ‰</strong>â€‹**<code>map</code><strong>â€‹</strong>æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†å®¹å™¨é‡Œé¢çš„æ¯ä¸€ä¸ªå€¼ï¼Œæ˜ å°„åˆ°å¦ä¸€ä¸ªå®¹å™¨ã€‚**</p><p>ä¸‹é¢æ˜¯ä¸€äº›ç”¨æ³•çš„ç¤ºä¾‹ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">Functor</span>(<span class="number">2</span>)).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">two</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> two + <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Functor(4)</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">Functor</span>(<span class="string">&#x27;flamethrowers&#x27;</span>)).<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> s.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Functor(&#x27;FLAMETHROWERS&#x27;)</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">Functor</span>(<span class="string">&#x27;bombs&#x27;</span>)).<span class="title function_">map</span>(_.<span class="title function_">concat</span>(<span class="string">&#x27; away&#x27;</span>)).<span class="title function_">map</span>(_.<span class="title function_">prop</span>(<span class="string">&#x27;length&#x27;</span>));</span><br><span class="line"><span class="comment">// Functor(10)</span></span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢çš„ä¾‹å­è¯´æ˜ï¼Œå‡½æ•°å¼ç¼–ç¨‹é‡Œé¢çš„è¿ç®—ï¼Œéƒ½æ˜¯é€šè¿‡å‡½å­å®Œæˆï¼Œå³è¿ç®—ä¸ç›´æ¥é’ˆå¯¹å€¼ï¼Œè€Œæ˜¯é’ˆå¯¹è¿™ä¸ªå€¼çš„å®¹å™¨â€”-å‡½å­ã€‚å‡½å­æœ¬èº«å…·æœ‰å¯¹å¤–æ¥å£ï¼ˆ<code>map</code>æ–¹æ³•ï¼‰ï¼Œå„ç§å‡½æ•°å°±æ˜¯è¿ç®—ç¬¦ï¼Œé€šè¿‡æ¥å£æ¥å…¥å®¹å™¨ï¼Œå¼•å‘å®¹å™¨é‡Œé¢çš„å€¼çš„å˜å½¢ã€‚</p><p>å› æ­¤ï¼Œ<strong>å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯å­¦ä¹ å‡½å­çš„å„ç§è¿ç®—ã€‚</strong>  ç”±äºå¯ä»¥æŠŠè¿ç®—æ–¹æ³•å°è£…åœ¨å‡½å­é‡Œé¢ï¼Œæ‰€ä»¥åˆè¡ç”Ÿå‡ºå„ç§ä¸åŒç±»å‹çš„å‡½å­ï¼Œæœ‰å¤šå°‘ç§è¿ç®—ï¼Œå°±æœ‰å¤šå°‘ç§å‡½å­ã€‚å‡½æ•°å¼ç¼–ç¨‹å°±å˜æˆäº†è¿ç”¨ä¸åŒçš„å‡½å­ï¼Œè§£å†³å®é™…é—®é¢˜ã€‚</p><h2 id="å››ã€of-æ–¹æ³•"><a href="#å››ã€of-æ–¹æ³•" class="headerlink" title="å››ã€of æ–¹æ³•"></a>å››ã€of æ–¹æ³•</h2><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œä¸Šé¢ç”Ÿæˆæ–°çš„å‡½å­çš„æ—¶å€™ï¼Œç”¨äº†<code>new</code>å‘½ä»¤ã€‚è¿™å®åœ¨å¤ªä¸åƒå‡½æ•°å¼ç¼–ç¨‹äº†ï¼Œå› ä¸º<code>new</code>å‘½ä»¤æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ‡å¿—ã€‚</p><p><strong>å‡½æ•°å¼ç¼–ç¨‹ä¸€èˆ¬çº¦å®šï¼Œå‡½å­æœ‰ä¸€ä¸ª</strong>â€‹**<code>of</code><strong>â€‹</strong>æ–¹æ³•ï¼Œç”¨æ¥ç”Ÿæˆæ–°çš„å®¹å™¨ã€‚**</p><p>ä¸‹é¢å°±ç”¨<code>of</code>æ–¹æ³•æ›¿æ¢æ‰<code>new</code>ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Functor</span>.<span class="property">of</span> = <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Functor</span>(val);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><p>ç„¶åï¼Œå‰é¢çš„ä¾‹å­å°±å¯ä»¥æ”¹æˆä¸‹é¢è¿™æ ·ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Functor</span>.<span class="title function_">of</span>(<span class="number">2</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">two</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> two + <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Functor(4)</span></span><br></pre></td></tr></table></figure></blockquote><p>è¿™å°±æ›´åƒå‡½æ•°å¼ç¼–ç¨‹äº†ã€‚</p><h2 id="äº”ã€Maybe-å‡½å­"><a href="#äº”ã€Maybe-å‡½å­" class="headerlink" title="äº”ã€Maybe å‡½å­"></a>äº”ã€Maybe å‡½å­</h2><p>å‡½å­æ¥å—å„ç§å‡½æ•°ï¼Œå¤„ç†å®¹å™¨å†…éƒ¨çš„å€¼ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®¹å™¨å†…éƒ¨çš„å€¼å¯èƒ½æ˜¯ä¸€ä¸ªç©ºå€¼ï¼ˆæ¯”å¦‚<code>null</code>ï¼‰ï¼Œè€Œå¤–éƒ¨å‡½æ•°æœªå¿…æœ‰å¤„ç†ç©ºå€¼çš„æœºåˆ¶ï¼Œå¦‚æœä¼ å…¥ç©ºå€¼ï¼Œå¾ˆå¯èƒ½å°±ä¼šå‡ºé”™ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Functor</span>.<span class="title function_">of</span>(<span class="literal">null</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> s.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½å­é‡Œé¢çš„å€¼æ˜¯<code>null</code>ï¼Œç»“æœå°å†™å˜æˆå¤§å†™çš„æ—¶å€™å°±å‡ºé”™äº†ã€‚</p><p>Maybe å‡½å­å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€ç±»é—®é¢˜è€Œè®¾è®¡çš„ã€‚ç®€å•è¯´ï¼Œå®ƒçš„<code>map</code>æ–¹æ³•é‡Œé¢è®¾ç½®äº†ç©ºå€¼æ£€æŸ¥ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Maybe</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Functor</span> &#123;</span><br><span class="line">  <span class="title function_">map</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">val</span> ? <span class="title class_">Maybe</span>.<span class="title function_">of</span>(<span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">val</span>)) : <span class="title class_">Maybe</span>.<span class="title function_">of</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>æœ‰äº† Maybe å‡½å­ï¼Œå¤„ç†ç©ºå€¼å°±ä¸ä¼šå‡ºé”™äº†ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Maybe</span>.<span class="title function_">of</span>(<span class="literal">null</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> s.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Maybe(null)</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="å…­ã€Either-å‡½å­"><a href="#å…­ã€Either-å‡½å­" class="headerlink" title="å…­ã€Either å‡½å­"></a>å…­ã€Either å‡½å­</h2><p>æ¡ä»¶è¿ç®—<code>if...else</code>æ˜¯æœ€å¸¸è§çš„è¿ç®—ä¹‹ä¸€ï¼Œå‡½æ•°å¼ç¼–ç¨‹é‡Œé¢ï¼Œä½¿ç”¨ Either å‡½å­è¡¨è¾¾ã€‚</p><p>Either å‡½å­å†…éƒ¨æœ‰ä¸¤ä¸ªå€¼ï¼šå·¦å€¼ï¼ˆ<code>Left</code>ï¼‰å’Œå³å€¼ï¼ˆ<code>Right</code>ï¼‰ã€‚å³å€¼æ˜¯æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨çš„å€¼ï¼Œå·¦å€¼æ˜¯å³å€¼ä¸å­˜åœ¨æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Either</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Functor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">left, right</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">left</span> = left;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">right</span> = right;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">map</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">right</span> ? </span><br><span class="line">      <span class="title class_">Either</span>.<span class="title function_">of</span>(<span class="variable language_">this</span>.<span class="property">left</span>, <span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">right</span>)) :</span><br><span class="line">      <span class="title class_">Either</span>.<span class="title function_">of</span>(<span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">left</span>), <span class="variable language_">this</span>.<span class="property">right</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Either</span>.<span class="property">of</span> = <span class="keyword">function</span> (<span class="params">left, right</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Either</span>(left, right);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸‹é¢æ˜¯ç”¨æ³•ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> addOne = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Either</span>.<span class="title function_">of</span>(<span class="number">5</span>, <span class="number">6</span>).<span class="title function_">map</span>(addOne);</span><br><span class="line"><span class="comment">// Either(5, 7);</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Either</span>.<span class="title function_">of</span>(<span class="number">1</span>, <span class="literal">null</span>).<span class="title function_">map</span>(addOne);</span><br><span class="line"><span class="comment">// Either(2, null);</span></span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå³å€¼æœ‰å€¼ï¼Œå°±ä½¿ç”¨å³å€¼ï¼Œå¦åˆ™ä½¿ç”¨å·¦å€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒEither å‡½å­è¡¨è¾¾äº†æ¡ä»¶è¿ç®—ã€‚</p><p>Either å‡½å­çš„å¸¸è§ç”¨é€”æ˜¯æä¾›é»˜è®¤å€¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Either</span></span><br><span class="line">.<span class="title function_">of</span>(&#123;<span class="attr">address</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;, currentUser.<span class="property">address</span>)</span><br><span class="line">.<span class="title function_">map</span>(updateField);</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰æä¾›åœ°å€ï¼ŒEither å‡½å­å°±ä¼šä½¿ç”¨å·¦å€¼çš„é»˜è®¤åœ°å€ã€‚</p><p>Either å‡½å­çš„å¦ä¸€ä¸ªç”¨é€”æ˜¯ä»£æ›¿<code>try...catch</code>ï¼Œä½¿ç”¨å·¦å€¼è¡¨ç¤ºé”™è¯¯ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseJSON</span>(<span class="params">json</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Either</span>.<span class="title function_">of</span>(<span class="literal">null</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(json));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: <span class="title class_">Error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Either</span>.<span class="title function_">of</span>(e, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå·¦å€¼ä¸ºç©ºï¼Œå°±è¡¨ç¤ºæ²¡æœ‰å‡ºé”™ï¼Œå¦åˆ™å·¦å€¼ä¼šåŒ…å«ä¸€ä¸ªé”™è¯¯å¯¹è±¡<code>e</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€æœ‰å¯èƒ½å‡ºé”™çš„è¿ç®—ï¼Œéƒ½å¯ä»¥è¿”å›ä¸€ä¸ª Either å‡½å­ã€‚</p><h2 id="ä¸ƒã€ap-å‡½å­"><a href="#ä¸ƒã€ap-å‡½å­" class="headerlink" title="ä¸ƒã€ap å‡½å­"></a>ä¸ƒã€ap å‡½å­</h2><p>å‡½å­é‡Œé¢åŒ…å«çš„å€¼ï¼Œå®Œå…¨å¯èƒ½æ˜¯å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡è¿™æ ·ä¸€ç§æƒ…å†µï¼Œä¸€ä¸ªå‡½å­çš„å€¼æ˜¯æ•°å€¼ï¼Œå¦ä¸€ä¸ªå‡½å­çš„å€¼æ˜¯å‡½æ•°ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTwo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> A = <span class="title class_">Functor</span>.<span class="title function_">of</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> B = <span class="title class_">Functor</span>.<span class="title function_">of</span>(addTwo)</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½å­<code>A</code>å†…éƒ¨çš„å€¼æ˜¯<code>2</code>ï¼Œå‡½å­<code>B</code>å†…éƒ¨çš„å€¼æ˜¯å‡½æ•°<code>addTwo</code>ã€‚</p><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³è®©å‡½å­<code>B</code>å†…éƒ¨çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨å‡½å­<code>A</code>å†…éƒ¨çš„å€¼è¿›è¡Œè¿ç®—ã€‚è¿™æ—¶å°±éœ€è¦ç”¨åˆ° ap å‡½å­ã€‚</p><p>ap æ˜¯ applicativeï¼ˆåº”ç”¨ï¼‰çš„ç¼©å†™ã€‚å‡¡æ˜¯éƒ¨ç½²äº†<code>ap</code>æ–¹æ³•çš„å‡½å­ï¼Œå°±æ˜¯ ap å‡½å­ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Functor</span> &#123;</span><br><span class="line">  <span class="title function_">ap</span>(<span class="params">F</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Ap</span>.<span class="title function_">of</span>(<span class="variable language_">this</span>.<span class="title function_">val</span>(F.<span class="property">val</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>æ³¨æ„ï¼Œ<code>ap</code>æ–¹æ³•çš„å‚æ•°ä¸æ˜¯å‡½æ•°ï¼Œè€Œæ˜¯å¦ä¸€ä¸ªå‡½å­ã€‚</p><p>å› æ­¤ï¼Œå‰é¢ä¾‹å­å¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Ap</span>.<span class="title function_">of</span>(addTwo).<span class="title function_">ap</span>(<span class="title class_">Functor</span>.<span class="title function_">of</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// Ap(4)</span></span><br></pre></td></tr></table></figure></blockquote><p>ap å‡½å­çš„æ„ä¹‰åœ¨äºï¼Œå¯¹äºé‚£äº›å¤šå‚æ•°çš„å‡½æ•°ï¼Œå°±å¯ä»¥ä»å¤šä¸ªå®¹å™¨ä¹‹ä¸­å–å€¼ï¼Œå®ç°å‡½å­çš„é“¾å¼æ“ä½œã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ap</span>.<span class="title function_">of</span>(add).<span class="title function_">ap</span>(<span class="title class_">Maybe</span>.<span class="title function_">of</span>(<span class="number">2</span>)).<span class="title function_">ap</span>(<span class="title class_">Maybe</span>.<span class="title function_">of</span>(<span class="number">3</span>));</span><br><span class="line"><span class="comment">// Ap(5)</span></span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°<code>add</code>æ˜¯æŸ¯é‡ŒåŒ–ä»¥åçš„å½¢å¼ï¼Œä¸€å…±éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚é€šè¿‡ ap å‡½å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä»ä¸¤ä¸ªå®¹å™¨ä¹‹ä¸­å–å€¼ã€‚å®ƒè¿˜æœ‰å¦å¤–ä¸€ç§å†™æ³•ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Ap</span>.<span class="title function_">of</span>(<span class="title function_">add</span>(<span class="number">2</span>)).<span class="title function_">ap</span>(<span class="title class_">Maybe</span>.<span class="title function_">of</span>(<span class="number">3</span>));</span><br></pre></td></tr></table></figure></blockquote><h2 id="å…«ã€Monad-å‡½å­"><a href="#å…«ã€Monad-å‡½å­" class="headerlink" title="å…«ã€Monad å‡½å­"></a>å…«ã€Monad å‡½å­</h2><p>å‡½å­æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥åŒ…å«ä»»ä½•å€¼ã€‚å‡½å­ä¹‹ä¸­å†åŒ…å«ä¸€ä¸ªå‡½å­ï¼Œä¹Ÿæ˜¯å®Œå…¨åˆæ³•çš„ã€‚ä½†æ˜¯ï¼Œè¿™æ ·å°±ä¼šå‡ºç°å¤šå±‚åµŒå¥—çš„å‡½å­ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Maybe</span>.<span class="title function_">of</span>(</span><br><span class="line">  <span class="title class_">Maybe</span>.<span class="title function_">of</span>(</span><br><span class="line">    <span class="title class_">Maybe</span>.<span class="title function_">of</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;Mulburry&#x27;</span>, <span class="attr">number</span>: <span class="number">8402</span>&#125;)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢è¿™ä¸ªå‡½å­ï¼Œä¸€å…±æœ‰ä¸‰ä¸ª<code>Maybe</code>åµŒå¥—ã€‚å¦‚æœè¦å–å‡ºå†…éƒ¨çš„å€¼ï¼Œå°±è¦è¿ç»­å–ä¸‰æ¬¡<code>this.val</code>ã€‚è¿™å½“ç„¶å¾ˆä¸æ–¹ä¾¿ï¼Œå› æ­¤å°±å‡ºç°äº† Monad å‡½å­ã€‚</p><p><strong>Monad å‡½å­çš„ä½œç”¨æ˜¯ï¼Œæ€»æ˜¯è¿”å›ä¸€ä¸ªå•å±‚çš„å‡½å­ã€‚</strong>  å®ƒæœ‰ä¸€ä¸ª<code>flatMap</code>æ–¹æ³•ï¼Œä¸<code>map</code>æ–¹æ³•ä½œç”¨ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å¦‚æœç”Ÿæˆäº†ä¸€ä¸ªåµŒå¥—å‡½å­ï¼Œå®ƒä¼šå–å‡ºåè€…å†…éƒ¨çš„å€¼ï¼Œä¿è¯è¿”å›çš„æ°¸è¿œæ˜¯ä¸€ä¸ªå•å±‚çš„å®¹å™¨ï¼Œä¸ä¼šå‡ºç°åµŒå¥—çš„æƒ…å†µã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monad</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Functor</span> &#123;</span><br><span class="line">  <span class="title function_">join</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">val</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">flatMap</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">map</span>(f).<span class="title function_">join</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå‡½æ•°<code>f</code>è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½å­ï¼Œé‚£ä¹ˆ<code>this.map(f)</code>å°±ä¼šç”Ÿæˆä¸€ä¸ªåµŒå¥—çš„å‡½å­ã€‚æ‰€ä»¥ï¼Œ<code>join</code>æ–¹æ³•ä¿è¯äº†<code>flatMap</code>æ–¹æ³•æ€»æ˜¯è¿”å›ä¸€ä¸ªå•å±‚çš„å‡½å­ã€‚è¿™æ„å‘³ç€åµŒå¥—çš„å‡½å­ä¼šè¢«é“ºå¹³ï¼ˆflattenï¼‰ã€‚</p><h2 id="ä¹ã€IO-æ“ä½œ"><a href="#ä¹ã€IO-æ“ä½œ" class="headerlink" title="ä¹ã€IO æ“ä½œ"></a>ä¹ã€IO æ“ä½œ</h2><p>Monad å‡½å­çš„é‡è¦åº”ç”¨ï¼Œå°±æ˜¯å®ç° I&#x2F;O ï¼ˆè¾“å…¥è¾“å‡ºï¼‰æ“ä½œã€‚</p><p>I&#x2F;O æ˜¯ä¸çº¯çš„æ“ä½œï¼Œæ™®é€šçš„å‡½æ•°å¼ç¼–ç¨‹æ²¡æ³•åšï¼Œè¿™æ—¶å°±éœ€è¦æŠŠ IO æ“ä½œå†™æˆ<code>Monad</code>å‡½å­ï¼Œé€šè¿‡å®ƒæ¥å®Œæˆã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> readFile = <span class="keyword">function</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">IO</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> fs.<span class="title function_">readFileSync</span>(filename, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> print = <span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">IO</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¯»å–æ–‡ä»¶å’Œæ‰“å°æœ¬èº«éƒ½æ˜¯ä¸çº¯çš„æ“ä½œï¼Œä½†æ˜¯<code>readFile</code>å’Œ<code>print</code>å´æ˜¯çº¯å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬æ€»æ˜¯è¿”å› IO å‡½å­ã€‚</p><p>å¦‚æœ IO å‡½å­æ˜¯ä¸€ä¸ª<code>Monad</code>ï¼Œå…·æœ‰<code>flatMap</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title function_">readFile</span>(<span class="string">&#x27;./user.txt&#x27;</span>)</span><br><span class="line">.<span class="title function_">flatMap</span>(print)</span><br></pre></td></tr></table></figure></blockquote><p>è¿™å°±æ˜¯ç¥å¥‡çš„åœ°æ–¹ï¼Œä¸Šé¢çš„ä»£ç å®Œæˆäº†ä¸çº¯çš„æ“ä½œï¼Œä½†æ˜¯å› ä¸º<code>flatMap</code>è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª IO å‡½å­ï¼Œæ‰€ä»¥è¿™ä¸ªè¡¨è¾¾å¼æ˜¯çº¯çš„ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªçº¯çš„è¡¨è¾¾å¼ï¼Œå®Œæˆå¸¦æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œè¿™å°±æ˜¯ Monad çš„ä½œç”¨ã€‚</p><p>ç”±äºè¿”å›è¿˜æ˜¯ IO å‡½å­ï¼Œæ‰€ä»¥å¯ä»¥å®ç°é“¾å¼æ“ä½œã€‚å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°åº“é‡Œé¢ï¼Œ<code>flatMap</code>æ–¹æ³•è¢«æ”¹åæˆ<code>chain</code>ã€‚</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> tail = <span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">IO</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x[x.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">readFile</span>(<span class="string">&#x27;./user.txt&#x27;</span>)</span><br><span class="line">.<span class="title function_">flatMap</span>(tail)</span><br><span class="line">.<span class="title function_">flatMap</span>(print)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="title function_">readFile</span>(<span class="string">&#x27;./user.txt&#x27;</span>)</span><br><span class="line">.<span class="title function_">chain</span>(tail)</span><br><span class="line">.<span class="title function_">chain</span>(print)</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢ä»£ç è¯»å–äº†æ–‡ä»¶<code>user.txt</code>ï¼Œç„¶åé€‰å–æœ€åä¸€è¡Œè¾“å‡ºã€‚</p><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracleé«˜çº§PL/SQL</title>
      <link href="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/"/>
      <url>/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/</url>
      
        <content type="html"><![CDATA[<h1 id="Oracleé«˜çº§PL-SQL"><a href="#Oracleé«˜çº§PL-SQL" class="headerlink" title="Oracleé«˜çº§PL&#x2F;SQL"></a>Oracleé«˜çº§PL&#x2F;SQL</h1><h2 id="æ•°æ®çš„æ‰¹é‡å¤„ç†"><a href="#æ•°æ®çš„æ‰¹é‡å¤„ç†" class="headerlink" title="æ•°æ®çš„æ‰¹é‡å¤„ç†"></a>æ•°æ®çš„æ‰¹é‡å¤„ç†</h2><p>æ¸¸æ ‡åœ¨å¤„ç†å¤§æ‰¹é‡æ•°æ®çš„æ—¶å€™ï¼Œä»…ä»…å¯ç”¨å•æ ¸å¿ƒï¼Œä¼šå¸¦æ¥æ€§èƒ½ä¸‹é™ã€‚</p><p>é€šè¿‡å¢å¼ºå¾ªç¯è¯­å¥<code>FORALL</code>å’Œæ‰¹é‡ç»‘å®šè¯­å¥<code>BULK</code>èƒ½å¤Ÿå¤§å¹…æå‡æ€§èƒ½ã€‚</p><h3 id="æ‰¹é‡ç»‘å®š"><a href="#æ‰¹é‡ç»‘å®š" class="headerlink" title="æ‰¹é‡ç»‘å®š"></a>æ‰¹é‡ç»‘å®š</h3><p>ORACLEçš„å®˜æ–¹æ–‡æ¡£é‡Šæ„</p><blockquote><p>Oracle Database uses two engines to run PL&#x2F;SQL units. The PL&#x2F;SQL engine runs the procedural statements and the SQL engine runs the SQL statements. Every SQL statement causes a context switch between the two engines. You can greatly improve the performance of your database application by minimizing the number of context switches for each PL&#x2F;SQL unit.</p></blockquote><p>Oracleæ•°æ®åº“ä½¿ç”¨PL&#x2F;SQLå¼•æ“è§£æè¿‡ç¨‹å’Œå‡½æ•°ï¼Œä½¿ç”¨SQLå¼•æ“è§£æSQLè¯­å¥ï¼Œä¸¤ä¸ªå¼•æ“ç›¸äº’é…åˆã€‚æ¯ä¸ªSQLè¯­å¥éƒ½ä¼šå¼•èµ·ä¸¤ä¸ªå¼•æ“ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å¦‚æœèƒ½å¤Ÿé™ä½ä¸¤ä¸ªå¼•æ“ä¹‹é—´çš„é¢‘ç¹åˆ‡æ¢ï¼Œé‚£ä¹ˆå°±èƒ½æœ€å¤§é™åº¦åœ°æå‡æ€§èƒ½ï¼Œè€Œä½¿ç”¨æ‰¹é‡ç»‘å®šè¯­æ³•<code>BULK</code>æ˜¯èƒ½å®ç°ã€‚</p><p>å¥½å¤„ï¼š</p><p><code>BULK</code> æ˜¯ä¸€æ¬¡ç»‘å®šæ•´ä¸ªé›†åˆï¼Œé€šè¿‡ä¸€æ¬¡æ€§å‘é€SQLè¯­å¥ä¾›SQLå¼•æ“è§£æçš„è¯­å¥ã€‚å— SQL è¯­å¥å½±å“çš„è¡Œè¶Šå¤šï¼Œå¤§å®¹é‡ç»‘å®šå¸¦æ¥çš„æ€§èƒ½æå‡å°±è¶Šå¤§ã€‚è€ƒè™‘ä½¿ç”¨æ‰¹é‡ç»‘å®šæ¥æé«˜ DML å’Œ <code>SELECT</code> <code>INTO</code> å¼•ç”¨é›†åˆçš„è¯­å¥ä»¥åŠ <code>FOR</code> å¼•ç”¨é›†åˆå¹¶è¿”å› DML çš„å¾ªç¯çš„æ€§èƒ½ã€‚</p><p>å®ä¾‹1ï¼šé€šè¿‡bulkæ‰¹é‡æ›´æ–°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  TYPE numlist <span class="keyword">IS</span> VARRAY (<span class="number">100</span>) <span class="keyword">OF</span> NUMBER;</span><br><span class="line">  id NUMLIST :<span class="operator">=</span> NUMLIST(<span class="number">7902</span>, <span class="number">7698</span>, <span class="number">7839</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- Efficient method, using bulk bind:</span></span><br><span class="line">  </span><br><span class="line">  FORALL i <span class="keyword">IN</span> id.FIRST..id.LAST</span><br><span class="line">  <span class="keyword">UPDATE</span> EMPLOYEES</span><br><span class="line">  <span class="keyword">SET</span> SALARY <span class="operator">=</span> <span class="number">1.1</span> <span class="operator">*</span> SALARY</span><br><span class="line">  <span class="keyword">WHERE</span> MANAGER_ID <span class="operator">=</span> id(i);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">-- Slower method:</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">FOR</span> i <span class="keyword">IN</span> id.FIRST..id.LAST LOOP</span><br><span class="line">    <span class="keyword">UPDATE</span> EMPLOYEES</span><br><span class="line">    <span class="keyword">SET</span> SALARY <span class="operator">=</span> <span class="number">1.1</span> <span class="operator">*</span> SALARY</span><br><span class="line">    <span class="keyword">WHERE</span> MANAGER_ID <span class="operator">=</span> id(i);</span><br><span class="line"> <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>å®ä¾‹2ï¼šé…åˆ<code>Returning</code>å’Œ<code>FORALL</code>è¯­å¥å®ç°æ‰¹é‡æ›´æ–°</p><p>éœ€è¦è¿”å›å€¼çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>Returning</code> æŒ‡å®š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  TYPE emp_list <span class="keyword">IS</span> VARRAY(<span class="number">100</span>) <span class="keyword">OF</span> EMPLOYEES.EMPLOYEE_ID<span class="operator">%</span>TYPE;</span><br><span class="line">  empids emp_list :<span class="operator">=</span> emp_list(<span class="number">182</span>, <span class="number">187</span>, <span class="number">193</span>, <span class="number">200</span>, <span class="number">204</span>, <span class="number">206</span>);</span><br><span class="line">  </span><br><span class="line">  TYPE bonus_list <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> EMPLOYEES.SALARY<span class="operator">%</span>TYPE;</span><br><span class="line">  bonus_list_inst  bonus_list;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- Efficient method, using bulk bind:</span></span><br><span class="line"> </span><br><span class="line"> FORALL i <span class="keyword">IN</span> empids.FIRST..empids.LAST</span><br><span class="line"> <span class="keyword">UPDATE</span> EMPLOYEES</span><br><span class="line"> <span class="keyword">SET</span> SALARY <span class="operator">=</span> <span class="number">0.1</span> <span class="operator">*</span> SALARY</span><br><span class="line"> <span class="keyword">WHERE</span> EMPLOYEE_ID <span class="operator">=</span> empids(i)</span><br><span class="line"> RETURNING SALARY BULK <span class="keyword">COLLECT</span> <span class="keyword">INTO</span> bonus_list_inst;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">-- Slower method:</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">FOR</span> i <span class="keyword">IN</span> empids.FIRST..empids.LAST LOOP</span><br><span class="line">   <span class="keyword">UPDATE</span> EMPLOYEES</span><br><span class="line">   <span class="keyword">SET</span> SALARY <span class="operator">=</span> <span class="number">0.1</span> <span class="operator">*</span> SALARY</span><br><span class="line">   <span class="keyword">WHERE</span> EMPLOYEE_ID <span class="operator">=</span> empids(i)</span><br><span class="line">   RETURNING SALARY <span class="keyword">INTO</span> bonus_list_inst(i);</span><br><span class="line"> <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æ‰¹é‡æ›´æ–°"><a href="#æ•°æ®æ‰¹é‡æ›´æ–°" class="headerlink" title="æ•°æ®æ‰¹é‡æ›´æ–°"></a>æ•°æ®æ‰¹é‡æ›´æ–°</h3><p>å®ä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> cur_ap_data;</span><br><span class="line">LOOP</span><br><span class="line">  <span class="keyword">FETCH</span> cur_ap_data BULK <span class="keyword">COLLECT</span></span><br><span class="line">    <span class="keyword">INTO</span> record_update LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">  FORALL i <span class="keyword">IN</span> <span class="number">1</span> .. record_update.count</span><br><span class="line">    <span class="keyword">UPDATE</span> inf_gl_voucheritemass</span><br><span class="line">       <span class="keyword">SET</span> MD_CUSTOMER <span class="operator">=</span> <span class="keyword">NULL</span>,</span><br><span class="line">           MD_supplier <span class="operator">=</span> record_update(i).MD_CUSTOMER,</span><br><span class="line">           MD_CFITEM   <span class="operator">=</span> record_update(i).MD_CFITEM,</span><br><span class="line">           MD_INDUSTRY <span class="operator">=</span> record_update(i).MD_INDUSTRY,</span><br><span class="line">           unitcode    <span class="operator">=</span> record_update(i).unitcode,</span><br><span class="line">           vchrnum     <span class="operator">=</span> record_update(i).vchrnum</span><br><span class="line">     <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">       <span class="keyword">AND</span> id <span class="operator">=</span> record_update(i).id</span><br><span class="line">       <span class="keyword">AND</span> vchrid <span class="operator">=</span> record_update(i).vchrid;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">  EXIT <span class="keyword">WHEN</span> cur_ap_data<span class="operator">%</span>NOTFOUND;</span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">CLOSE</span> cur_ap_data;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ã€æ³¨æ„ã€‘å¯¹äºå¤´è¡Œå…³è”çš„ä¸¤å¼ è¡¨çš„æ•°æ®åŒæ­¥ï¼Œä¾ç„¶è¦ä½¿ç”¨æ¸¸æ ‡è¿›è¡Œå¤„ç†</p><p>æ­¤å¤–ï¼Œ<code>BULK INTO</code>è¿˜èƒ½ç”¨äºDMLè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">   TYPE emp_rec_type <span class="keyword">IS</span> RECORD</span><br><span class="line">   (</span><br><span class="line">      empno      emp.empno<span class="operator">%</span>TYPE,</span><br><span class="line">      ename      emp.ename<span class="operator">%</span>TYPE,</span><br><span class="line">      hiredate   emp.hiredate<span class="operator">%</span>TYPE</span><br><span class="line">   );</span><br><span class="line">   TYPE nested_emp_type <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> emp_rec_type;</span><br><span class="line">   emp_tab   nested_emp_type;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DELETE</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> deptno <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">   RETURNING empno, ename, hiredate   <span class="comment">-- ä½¿ç”¨returning è¿”å›è¿™å‡ ä¸ªåˆ—</span></span><br><span class="line">   BULK   <span class="keyword">COLLECT</span> <span class="keyword">INTO</span> emp_tab;       <span class="comment">-- å°†è¿”å›çš„åˆ—çš„æ•°æ®æ‰¹é‡æ’å…¥åˆ°é›†åˆå˜é‡</span></span><br><span class="line"></span><br><span class="line">   DBMS_OUTPUT.put_line( <span class="string">&#x27;åˆ é™¤ &#x27;</span> <span class="operator">||</span> <span class="keyword">SQL</span><span class="operator">%</span>ROWCOUNT <span class="operator">||</span> <span class="string">&#x27; è¡Œè®°å½•&#x27;</span> );</span><br><span class="line">   <span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line">   IF emp_tab.COUNT <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span>   <span class="comment">-- å½“é›†åˆå˜é‡ä¸ä¸ºç©ºæ—¶ï¼Œè¾“å‡ºæ‰€æœ‰è¢«åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">      <span class="keyword">FOR</span> i <span class="keyword">IN</span> emp_tab.FIRST .. emp_tab.LAST LOOP</span><br><span class="line">         DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;å½“å‰è®°å½•ï¼š&#x27;</span></span><br><span class="line">                    <span class="operator">||</span> emp_tab( i ).empno <span class="operator">||</span> CHR( <span class="number">9</span> )</span><br><span class="line">                    <span class="operator">||</span> emp_tab( i ).ename <span class="operator">||</span> CHR( <span class="number">9</span> )</span><br><span class="line">                    <span class="operator">||</span> emp_tab( i ).hiredate</span><br><span class="line">                    <span class="operator">||</span> <span class="string">&#x27; å·²è¢«åˆ é™¤&#x27;</span> );</span><br><span class="line">      <span class="keyword">END</span> LOOP;</span><br><span class="line">   <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ•°æ®æ‰¹é‡åˆ é™¤"><a href="#æ•°æ®æ‰¹é‡åˆ é™¤" class="headerlink" title="æ•°æ®æ‰¹é‡åˆ é™¤"></a>æ•°æ®æ‰¹é‡åˆ é™¤</h3><p>é€šè¿‡forallå¢å¼ºå¾ªç¯åˆ é™¤æœ¬åœ°å¤§é‡çš„æ•°æ®</p><p>å®ä¾‹ï¼šæ ¹æ®idæ¥åˆ é™¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_cnt   NUMBER :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  l_start NUMBER;</span><br><span class="line"></span><br><span class="line">  TYPE id_type <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> VARCHAR2(<span class="number">255</span>);</span><br><span class="line">  id_tbl id_type;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CURSOR</span> cur <span class="keyword">IS</span></span><br><span class="line">    <span class="keyword">SELECT</span> t.erp_his_id</span><br><span class="line">      <span class="keyword">FROM</span> gj_erp_bas_inv_item_his t</span><br><span class="line">     <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">       <span class="keyword">AND</span> t.creation_date <span class="operator">&lt;=</span> to_date(<span class="string">&#x27;2019-12-31&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">OPEN</span> cur;</span><br><span class="line">  LOOP</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">FETCH</span> cur BULK <span class="keyword">COLLECT</span></span><br><span class="line">      <span class="keyword">INTO</span> id_tbl LIMIT <span class="number">1000</span>;</span><br><span class="line">    EXIT <span class="keyword">WHEN</span> id_tbl.count <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">    DBMS_OUTPUT.put_line(id_tbl.count <span class="operator">||</span> <span class="string">&#x27; rows&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">    l_start :<span class="operator">=</span> DBMS_UTILITY.get_time;</span><br><span class="line">    FORALL i <span class="keyword">IN</span> id_tbl.first .. id_tbl.last</span><br><span class="line">      <span class="keyword">DELETE</span> <span class="keyword">FROM</span> gj_erp_bas_inv_item_his <span class="keyword">WHERE</span> erp_his_id <span class="operator">=</span> id_tbl(i);</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;Delete  : &#x27;</span> <span class="operator">||</span> (DBMS_UTILITY.get_time <span class="operator">-</span> l_start));</span><br><span class="line">  </span><br><span class="line">    <span class="comment">--dbms_lock.sleep(3); çº¿ç¨‹ä¼‘çœ éœ€è¦dbaæƒé™</span></span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ•°æ®æ‰¹é‡æ’å…¥"><a href="#æ•°æ®æ‰¹é‡æ’å…¥" class="headerlink" title="æ•°æ®æ‰¹é‡æ’å…¥"></a>æ•°æ®æ‰¹é‡æ’å…¥</h3><h4 id="æ€§èƒ½æ¯”è¾ƒ"><a href="#æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ"></a>æ€§èƒ½æ¯”è¾ƒ</h4><h5 id="å®éªŒ1ï¼šå¤§æ‰¹é‡å¤æ‚æŸ¥è¯¢"><a href="#å®éªŒ1ï¼šå¤§æ‰¹é‡å¤æ‚æŸ¥è¯¢" class="headerlink" title="å®éªŒ1ï¼šå¤§æ‰¹é‡å¤æ‚æŸ¥è¯¢"></a>å®éªŒ1ï¼šå¤§æ‰¹é‡å¤æ‚æŸ¥è¯¢</h5><p>ä»¥oracle ebsç¯å¢ƒä¸ºä¾‹ï¼ŒåŒæ­¥åº”ä»˜ä¼šè®¡åˆ†å½•ï¼Œæ•°æ®é›†ä¸º33ä¸‡+ï¼Œè·å–æ•°æ®é›†9ç§’&#x2F;100æ¡</p><h6 id="å¾ªç¯tableç±»å‹"><a href="#å¾ªç¯tableç±»å‹" class="headerlink" title="å¾ªç¯tableç±»å‹"></a>å¾ªç¯tableç±»å‹</h6><p>ä½¿ç”¨bulkæŠ“å–æ•°æ®åˆ°tableç±»å‹ä¸­ï¼Œç„¶åå¾ªç¯tableï¼Œæ¯2000æ¡æ•°æ®æäº¤ä¸€æ¬¡</p><p>1.å®šä¹‰tableç±»å‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TYPE l_rec_line <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> INF_GL_VOUCHERITEMASS<span class="operator">%</span>ROWTYPE;</span><br><span class="line">l_rec_line_list l_rec_line;</span><br></pre></td></tr></table></figure><p>2.æ‰§è¡Œé˜¶æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> cur_voucher_lines;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_voucher_lines BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> l_rec_line_list LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> l_rec_line_list.first .. l_rec_line_list.last</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHERITEMASS <span class="keyword">VALUES</span> l_rec_line_list (i);</span><br><span class="line">  </span><br><span class="line">      <span class="comment">-- æ¯1000æ¡æäº¤ä¸€æ¬¡</span></span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_voucher_lines<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">CLOSE</span> cur_voucher_lines;</span><br></pre></td></tr></table></figure><p>3.å®éªŒç»“æœ</p><p>è€—æ—¶1.5å°æ—¶ï¼Œå…±åŒæ­¥48000æ¡æ•°æ®ï¼Œå¹³å‡æ¯åˆ†é’Ÿ533æ¡æ•°æ®ã€‚</p><p>ã€æ³¨æ„ã€‘è¿™é‡Œéƒ½æ˜¯æŒ‰æ•´æ•°æ‰¹é‡æ’å…¥ï¼Œå¯èƒ½ä¼šå­˜åœ¨æŠ“å–æ•°æ®é›†çš„æ—¶å€™åœæ­¢åŒæ­¥çš„è¿‡ç¨‹ã€‚</p><h6 id="æ¸¸æ ‡å•è¡Œå¾ªç¯"><a href="#æ¸¸æ ‡å•è¡Œå¾ªç¯" class="headerlink" title="æ¸¸æ ‡å•è¡Œå¾ªç¯"></a>æ¸¸æ ‡å•è¡Œå¾ªç¯</h6><p>ç»å…¸æ¸¸æ ‡å•å¾ªç¯</p><p>1.å®ç°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> rec_line <span class="keyword">IN</span> cur_voucher_lines LOOP</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br></pre></td></tr></table></figure><p>2.å®éªŒç»“æœ</p><p>è€—æ—¶1.5å°æ—¶ï¼Œå…±åŒæ­¥49144æ¡æ•°æ®ï¼Œå¹³å‡æ¯åˆ†é’Ÿ546æ¡æ•°æ®ã€‚</p><h5 id="å®éªŒ2ï¼šåŒ–è§£å¤æ‚æŸ¥è¯¢"><a href="#å®éªŒ2ï¼šåŒ–è§£å¤æ‚æŸ¥è¯¢" class="headerlink" title="å®éªŒ2ï¼šåŒ–è§£å¤æ‚æŸ¥è¯¢"></a>å®éªŒ2ï¼šåŒ–è§£å¤æ‚æŸ¥è¯¢</h5><p>ä»¥oracle ebsç¯å¢ƒä¸ºä¾‹ï¼Œå¤´å’Œè¡Œçš„å…¨éƒ¨ä¼šè®¡åˆ†ç±»åŒæ­¥ã€‚</p><p>å¯¹äºè¡Œä¸Šè¦è·å–å¤´ä¸Šçš„æ•°æ®æ—¶ï¼Œé™¤äº†ä½¿ç”¨æ¸¸æ ‡è¿›è¡ŒåŒé‡å¾ªç¯æ¥ä¿è¯è¡Œä¸Šèƒ½è·å¾—å¤´ä¸Šçš„æ•°æ®ä»¥å¤–ï¼Œ</p><p>è¿˜å¯ä»¥é€šè¿‡ å…ˆåŒæ­¥è¡Œï¼Œç„¶ååŒæ­¥å¤´ï¼Œæœ€åå¤´å’Œè¡Œå…³è”ï¼Œæ‰¹é‡updateçš„æ–¹å¼è¾¾åˆ°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h6 id="æ¸¸æ ‡åŒé‡å¾ªç¯"><a href="#æ¸¸æ ‡åŒé‡å¾ªç¯" class="headerlink" title="æ¸¸æ ‡åŒé‡å¾ªç¯"></a>æ¸¸æ ‡åŒé‡å¾ªç¯</h6><p>åŒæ­¥åº”æ”¶å‘ç¥¨ã€åº”æ”¶æ”¶æ¬¾ã€åº”ä»˜å‘ç¥¨ã€åº”ä»˜ä»˜æ¬¾</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> rec_header <span class="keyword">in</span> cur_header loop</span><br><span class="line">  <span class="comment">-- åŒæ­¥å¤´æ•°æ®</span></span><br><span class="line">  ...</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> rec_line <span class="keyword">in</span> cur_line loop</span><br><span class="line">   <span class="comment">-- åŒæ­¥è¡Œæ•°æ®</span></span><br><span class="line">   ...</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span> loop;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210309093824-rhphd74-image.png" alt="image.png"></p><h6 id="æ‰¹é‡æ’å…¥ä¸æ›´æ–°"><a href="#æ‰¹é‡æ’å…¥ä¸æ›´æ–°" class="headerlink" title="æ‰¹é‡æ’å…¥ä¸æ›´æ–°"></a>æ‰¹é‡æ’å…¥ä¸æ›´æ–°</h6><p>åŒ…å®šä¹‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE gj_congl_voucher_sync_v2 <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/*==================================================</span></span><br><span class="line"><span class="comment">  Procedure Name :</span></span><br><span class="line"><span class="comment">      main</span></span><br><span class="line"><span class="comment">  Description:</span></span><br><span class="line"><span class="comment">      This procedure perform to é›†å›¢å¸ç§åŒæ­¥</span></span><br><span class="line"><span class="comment">  Argument:</span></span><br><span class="line"><span class="comment">      errbuf               : concurrent return message buffer</span></span><br><span class="line"><span class="comment">      retcode              : concurrent return status code</span></span><br><span class="line"><span class="comment">                             0 success / 1 warning / 2 error</span></span><br><span class="line"><span class="comment">      p_book_id         : è´¦ç°¿ID</span></span><br><span class="line"><span class="comment">      p_date_from       : æ—¥æœŸä»</span></span><br><span class="line"><span class="comment">      p_date_to         : è‡³</span></span><br><span class="line"><span class="comment">      p_item_from       : ç ”å‘é¡¹ç›®ä»</span></span><br><span class="line"><span class="comment">      p_item_to         : è‡³</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  History:</span></span><br><span class="line"><span class="comment">      1.00   2020-09-02  LIYIHUI   Creation</span></span><br><span class="line"><span class="comment">  ==================================================*/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> main(errbuf <span class="keyword">OUT</span> VARCHAR2, retcode <span class="keyword">OUT</span> VARCHAR2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> gj_congl_voucher_sync_v2;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŒ…å†…å®¹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE BODY gj_congl_voucher_sync_v2 <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Set Who</span></span><br><span class="line">  g_conc_request_id NUMBER :<span class="operator">=</span> fnd_global.conc_request_id;</span><br><span class="line">  g_log_msg         VARCHAR2(<span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Global Parameter</span></span><br><span class="line">  g_pkg_name VARCHAR2(<span class="number">255</span>) :<span class="operator">=</span> <span class="string">&#x27;gj_congl_voucher_sync&#x27;</span>;</span><br><span class="line">  g_error    VARCHAR2(<span class="number">20</span>) :<span class="operator">=</span> fnd_api.g_ret_sts_error;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/************************************************</span></span><br><span class="line"><span class="comment">  åç§°ï¼šoutput</span></span><br><span class="line"><span class="comment">  åŠŸèƒ½æè¿°ï¼š</span></span><br><span class="line"><span class="comment">    è¾“å‡ºæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  ä¿®è®¢è®°å½•ï¼š</span></span><br><span class="line"><span class="comment">  ç‰ˆæœ¬å·    ç¼–è¾‘æ—¶é—´    ç¼–è¾‘äºº    ä¿®æ”¹æè¿°</span></span><br><span class="line"><span class="comment">  1.0.0     2020-09-02  LIYIHUI   1.åˆ›å»º</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  å‚æ•°æè¿°ï¼š</span></span><br><span class="line"><span class="comment">  p_message    IN    ä¼ å…¥å‚æ•°1</span></span><br><span class="line"><span class="comment">  **************************************************/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> output(p_message_text VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    IF g_conc_request_id <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      fnd_file.put_line(fnd_file.log, p_message_text);</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      dbms_output.put_line(to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span></span><br><span class="line">                           <span class="string">&#x27; &gt;&gt;&gt;&gt;&gt;&gt; &#x27;</span> <span class="operator">||</span> p_message_text);</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  <span class="keyword">END</span> output;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*==================================================</span></span><br><span class="line"><span class="comment">  Procedure Name :</span></span><br><span class="line"><span class="comment">      log</span></span><br><span class="line"><span class="comment">  Description:</span></span><br><span class="line"><span class="comment">      This procedure perform to æ—¥å¿—</span></span><br><span class="line"><span class="comment">  Argument:</span></span><br><span class="line"><span class="comment">      p_message                  : æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  History:</span></span><br><span class="line"><span class="comment">      1.00   2020-09-02  LIYIHUI   Creation</span></span><br><span class="line"><span class="comment">  ==================================================*/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> <span class="built_in">log</span>(p_message_text VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    IF g_conc_request_id <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      fnd_file.put_line(fnd_file.log,</span><br><span class="line">                        to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span></span><br><span class="line">                        <span class="string">&#x27; &gt;&gt;&gt;&gt;&gt;&gt; &#x27;</span> <span class="operator">||</span> p_message_text);</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      dbms_output.put_line(to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span></span><br><span class="line">                           <span class="string">&#x27; &gt;&gt;&gt;&gt;&gt;&gt; &#x27;</span> <span class="operator">||</span> p_message_text);</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  <span class="keyword">END</span> log;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*==================================================</span></span><br><span class="line"><span class="comment">  Procedure Name :</span></span><br><span class="line"><span class="comment">      raise_exception</span></span><br><span class="line"><span class="comment">  Description:</span></span><br><span class="line"><span class="comment">      This procedure perform to æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">  Argument:</span></span><br><span class="line"><span class="comment">      x_return_status             : Input Status : E(Error)/U(Unexception)/S(Success)</span></span><br><span class="line"><span class="comment">  History:</span></span><br><span class="line"><span class="comment">      1.00   2020-09-02  LIYIHUI   Creation</span></span><br><span class="line"><span class="comment">  ==================================================*/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> raise_exception(x_return_status <span class="keyword">IN</span> VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    IF (x_return_status <span class="operator">=</span> fnd_api.g_ret_sts_unexp_error) <span class="keyword">THEN</span></span><br><span class="line">      RAISE fnd_api.g_exc_unexpected_error;</span><br><span class="line">    ELSIF (x_return_status <span class="operator">=</span> fnd_api.g_ret_sts_error) <span class="keyword">THEN</span></span><br><span class="line">      RAISE fnd_api.g_exc_error;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  <span class="keyword">END</span> raise_exception;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*==================================================</span></span><br><span class="line"><span class="comment">  Procedure Name :</span></span><br><span class="line"><span class="comment">      raise_exception</span></span><br><span class="line"><span class="comment">  Description:</span></span><br><span class="line"><span class="comment">      This procedure perform to æœŸåˆå‡­è¯åŒæ­¥</span></span><br><span class="line"><span class="comment">  Argument:</span></span><br><span class="line"><span class="comment">      x_return_status             : Input Status : E(Error)/U(Unexception)/S(Success)</span></span><br><span class="line"><span class="comment">  History:</span></span><br><span class="line"><span class="comment">      1.00   2020-11-17  LIYIHUI   Creation</span></span><br><span class="line"><span class="comment">  ==================================================*/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_nc_voucher(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                          x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                          x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;ins_sp_nc_voucher&#x27;</span>;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_nc_voucher&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- start activity to create savepoint, check compatibility</span></span><br><span class="line">    <span class="comment">-- and initialize message list, include debug message hint to enter api</span></span><br><span class="line">    x_return_status :<span class="operator">=</span> cux_api.start_activity(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                              p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                              p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name);</span><br><span class="line">    raise_exception(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHER</span><br><span class="line">      (id,</span><br><span class="line">       bookcode,</span><br><span class="line">       unitcode,</span><br><span class="line">       acctyear,</span><br><span class="line">       acctperiod,</span><br><span class="line">       vchrtypecode,</span><br><span class="line">       vchrnum,</span><br><span class="line">       creator,</span><br><span class="line">       createtime,</span><br><span class="line">       createdate,</span><br><span class="line">       postdate,</span><br><span class="line">       postor,</span><br><span class="line">       cashier,</span><br><span class="line">       cashdate,</span><br><span class="line">       attachment,</span><br><span class="line">       adjperiodflag,</span><br><span class="line">       tempflag,</span><br><span class="line">       offsetstate,</span><br><span class="line">       offsetid,</span><br><span class="line">       blueoffsetstate,</span><br><span class="line">       blueoffsetid,</span><br><span class="line">       def_01,</span><br><span class="line">       def_02,</span><br><span class="line">       def_03,</span><br><span class="line">       def_04,</span><br><span class="line">       def_05,</span><br><span class="line">       def_06,</span><br><span class="line">       def_07,</span><br><span class="line">       def_08,</span><br><span class="line">       def_09,</span><br><span class="line">       update_time)</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> INF_GL_VOUCHER_NC;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHERITEMASS</span><br><span class="line">      (id,</span><br><span class="line">       bookcode,</span><br><span class="line">       unitcode,</span><br><span class="line">       subjectcode,</span><br><span class="line">       subjectname,</span><br><span class="line">       ori_subjectcode,</span><br><span class="line">       ori_subjectname,</span><br><span class="line">       currencycode,</span><br><span class="line">       vchrid,</span><br><span class="line">       acctyear,</span><br><span class="line">       acctperiod,</span><br><span class="line">       rowflag,</span><br><span class="line">       vchrtypecode,</span><br><span class="line">       vchrnum,</span><br><span class="line">       createdate,</span><br><span class="line">       postflag,</span><br><span class="line">       debit,</span><br><span class="line">       credit,</span><br><span class="line">       orgnd,</span><br><span class="line">       orgnc,</span><br><span class="line">       qty,</span><br><span class="line">       price,</span><br><span class="line">       exchrate,</span><br><span class="line">       digest,</span><br><span class="line">       bizdate,</span><br><span class="line">       expiredate,</span><br><span class="line">       md_staff,</span><br><span class="line">       md_department,</span><br><span class="line">       md_custsupplier,</span><br><span class="line">       md_customer,</span><br><span class="line">       md_supplier,</span><br><span class="line">       md_industry,</span><br><span class="line">       md_cfitem,</span><br><span class="line">       md_marbasclass,</span><br><span class="line">       md_measurement,</span><br><span class="line">       md_bankaccount,</span><br><span class="line">       md_reason,</span><br><span class="line">       md_project,</span><br><span class="line">       md_contract,</span><br><span class="line">       md_inde_project,</span><br><span class="line">       md_fundplan,</span><br><span class="line">       md_financing,</span><br><span class="line">       def_01,</span><br><span class="line">       def_02,</span><br><span class="line">       def_03,</span><br><span class="line">       def_04,</span><br><span class="line">       def_05,</span><br><span class="line">       def_06,</span><br><span class="line">       def_07,</span><br><span class="line">       def_08,</span><br><span class="line">       def_09,</span><br><span class="line">       update_time)</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> inf_gl_voucheritemass_NC;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- API end body</span></span><br><span class="line">    <span class="comment">-- end activity, include debug message hint to exit api</span></span><br><span class="line">    x_return_status :<span class="operator">=</span> cux_api.end_activity(p_pkg_name  <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                            p_api_name  <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                            x_msg_count <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                            x_msg_data  <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> fnd_api.g_exc_error <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> cux_api.handle_exceptions(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                                   p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                                   p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       <span class="operator">=</span><span class="operator">&gt;</span> cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                                   x_msg_data       <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    <span class="keyword">WHEN</span> fnd_api.g_exc_unexpected_error <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> cux_api.handle_exceptions(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                                   p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                                   p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       <span class="operator">=</span><span class="operator">&gt;</span> cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                                   x_msg_data       <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> cux_api.handle_exceptions(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                                   p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                                   p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       <span class="operator">=</span><span class="operator">&gt;</span> cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                                   x_msg_data       <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_nc_voucher;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : åŒæ­¥ä¼šè®¡åˆ†å½•è¡Œï¼Œæ ¹æ®è¡Œçš„accounting_dateåè¿‡æ¥åŒ¹é…å¤´çš„æ•°æ®</span></span><br><span class="line"><span class="comment">  *            å¯èƒ½ä¼šå­˜åœ¨å¦‚ä¸‹æƒ…å†µ</span></span><br><span class="line"><span class="comment">  *              ap_invoices_all.gl_date &lt; 2020-01-01</span></span><br><span class="line"><span class="comment">  *            ä½†æ­¤æ—¶å­˜åœ¨å†²é”€ã€å–æ¶ˆçš„ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">  *              xla_ae_lines.accounting_date &gt; 2020-01-01</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_vchrnum_lines(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                             x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                             x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_vchrnum_lines&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    TYPE l_rec_line <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> INF_GL_VOUCHERITEMASS<span class="operator">%</span>ROWTYPE;</span><br><span class="line">    l_rec_line_list l_rec_line;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_voucher_lines <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> to_char(xal.AE_HEADER_ID) <span class="operator">||</span> LPAD(xal.AE_LINE_NUM, <span class="number">4</span>, <span class="number">0</span>) id,</span><br><span class="line">             <span class="string">&#x27;GJ_CN_01&#x27;</span> BOOKCODE,</span><br><span class="line">             <span class="string">&#x27;PENDING&#x27;</span> UNITCODE,</span><br><span class="line">             <span class="comment">--xep.LEGAL_ENTITY_IDENTIFIER UNITCODE,</span></span><br><span class="line">             (<span class="keyword">SELECT</span> t.org_coa_acc_code</span><br><span class="line">                <span class="keyword">FROM</span> gj_organization_coa_flex_value t</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> t.COA_ACC_CODE <span class="operator">=</span> gcck.segment3) SUBJECTCODE,</span><br><span class="line">             (<span class="keyword">SELECT</span> t.org_coa_acc_desc</span><br><span class="line">                <span class="keyword">FROM</span> gj_organization_coa_flex_value t</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> t.COA_ACC_CODE <span class="operator">=</span> gcck.segment3) SUBJECTNAME,</span><br><span class="line">             gcck.segment3 ORI_SUBJECTCODE,</span><br><span class="line">             gj_account_details_rpt.get_flex_description(<span class="string">&#x27;GJ_COA_ACC&#x27;</span>,</span><br><span class="line">                                                         gcck.segment3) ORI_SUBJECTNAME,</span><br><span class="line">             xal.CURRENCY_CODE CURRENCYCODE,</span><br><span class="line">             ora_hash(xte.entity_code) <span class="operator">||</span> to_char(xte.source_id_int_1) VCHRID,</span><br><span class="line">             to_number(to_char(xal.ACCOUNTING_DATE, <span class="string">&#x27;yyyy&#x27;</span>)) ACCTYEAR,</span><br><span class="line">             to_char(xal.ACCOUNTING_DATE, <span class="string">&#x27;mm&#x27;</span>) ACCTPERIOD,</span><br><span class="line">             xal.ae_line_num ROWFLAG,</span><br><span class="line">             decode(xte.entity_code,</span><br><span class="line">                    <span class="string">&#x27;AP_INVOICES&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;AP_PAYMENTS&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;RECEIPTS&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;TRANSACTIONS&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;4&#x27;</span>) vchrtypecode,</span><br><span class="line">             <span class="comment">/*(SELECT to_char(aia.voucher_num)</span></span><br><span class="line"><span class="comment">              FROM ap_invoices_all aia</span></span><br><span class="line"><span class="comment">             WHERE 1 = 1</span></span><br><span class="line"><span class="comment">               AND ora_hash(xte.entity_code) || to_char(aia.invoice_id) =</span></span><br><span class="line"><span class="comment">                   ora_hash(xte.entity_code) || to_char(xte.source_id_int_1)</span></span><br><span class="line"><span class="comment">               AND rownum = 1) vchrnum,*/</span></span><br><span class="line">             <span class="string">&#x27;PENDING&#x27;</span> vchrnum,</span><br><span class="line">             to_char(xal.ACCOUNTING_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) createdate,</span><br><span class="line">             <span class="string">&#x27;Y&#x27;</span> postflag,</span><br><span class="line">             (DECODE((<span class="keyword">SELECT</span> goc.attribute2</span><br><span class="line">                       <span class="keyword">FROM</span> gj_organization_coa_flex_value t,</span><br><span class="line">                            gj_organization_coa_flex_type  goc</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> t.org_coa_acc_code <span class="operator">=</span> goc.org_coa_code</span><br><span class="line">                        <span class="keyword">AND</span> t.COA_ACC_CODE <span class="operator">=</span> gcck.segment3</span><br><span class="line">                        <span class="keyword">AND</span> goc.attribute1 <span class="keyword">IN</span> (<span class="string">&#x27;æˆæœ¬ç±»&#x27;</span>, <span class="string">&#x27;æŸç›Šç±»&#x27;</span>)),</span><br><span class="line">                     <span class="string">&#x27;è´·æ–¹&#x27;</span>,</span><br><span class="line">                     <span class="number">0</span>,</span><br><span class="line">                     <span class="string">&#x27;å€Ÿæ–¹&#x27;</span>,</span><br><span class="line">                     nvl(xal.accounted_cr <span class="operator">*</span> <span class="number">-1</span>, <span class="number">0</span>) <span class="operator">+</span></span><br><span class="line">                     nvl(xal.accounted_dr, <span class="number">0</span>),</span><br><span class="line">                     nvl(xal.accounted_dr, <span class="number">0</span>))) DEBIT,</span><br><span class="line">             (DECODE((<span class="keyword">SELECT</span> goc.attribute2</span><br><span class="line">                       <span class="keyword">FROM</span> gj_organization_coa_flex_value t,</span><br><span class="line">                            gj_organization_coa_flex_type  goc</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> t.org_coa_acc_code <span class="operator">=</span> goc.org_coa_code</span><br><span class="line">                        <span class="keyword">AND</span> t.COA_ACC_CODE <span class="operator">=</span> gcck.segment3</span><br><span class="line">                        <span class="keyword">AND</span> goc.attribute1 <span class="keyword">IN</span> (<span class="string">&#x27;æˆæœ¬ç±»&#x27;</span>, <span class="string">&#x27;æŸç›Šç±»&#x27;</span>)),</span><br><span class="line">                     <span class="string">&#x27;å€Ÿæ–¹&#x27;</span>,</span><br><span class="line">                     <span class="number">0</span>,</span><br><span class="line">                     <span class="string">&#x27;è´·æ–¹&#x27;</span>,</span><br><span class="line">                     nvl(xal.accounted_dr <span class="operator">*</span> <span class="number">-1</span>, <span class="number">0</span>) <span class="operator">+</span></span><br><span class="line">                     nvl(xal.accounted_cr, <span class="number">0</span>),</span><br><span class="line">                     nvl(xal.accounted_cr, <span class="number">0</span>))) CREDIT,</span><br><span class="line">             (DECODE((<span class="keyword">SELECT</span> goc.attribute2</span><br><span class="line">                       <span class="keyword">FROM</span> gj_organization_coa_flex_value t,</span><br><span class="line">                            gj_organization_coa_flex_type  goc</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> t.org_coa_acc_code <span class="operator">=</span> goc.org_coa_code</span><br><span class="line">                        <span class="keyword">AND</span> t.COA_ACC_CODE <span class="operator">=</span> gcck.segment3</span><br><span class="line">                        <span class="keyword">AND</span> goc.attribute1 <span class="keyword">IN</span> (<span class="string">&#x27;æˆæœ¬ç±»&#x27;</span>, <span class="string">&#x27;æŸç›Šç±»&#x27;</span>)),</span><br><span class="line">                     <span class="string">&#x27;è´·æ–¹&#x27;</span>,</span><br><span class="line">                     <span class="number">0</span>,</span><br><span class="line">                     <span class="string">&#x27;å€Ÿæ–¹&#x27;</span>,</span><br><span class="line">                     nvl(xal.accounted_cr <span class="operator">*</span> <span class="number">-1</span>, <span class="number">0</span>) <span class="operator">+</span></span><br><span class="line">                     nvl(xal.accounted_dr, <span class="number">0</span>),</span><br><span class="line">                     nvl(xal.accounted_dr, <span class="number">0</span>))) ORGND,</span><br><span class="line">             (DECODE((<span class="keyword">SELECT</span> goc.attribute2</span><br><span class="line">                       <span class="keyword">FROM</span> gj_organization_coa_flex_value t,</span><br><span class="line">                            gj_organization_coa_flex_type  goc</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> t.org_coa_acc_code <span class="operator">=</span> goc.org_coa_code</span><br><span class="line">                        <span class="keyword">AND</span> t.COA_ACC_CODE <span class="operator">=</span> gcck.segment3</span><br><span class="line">                        <span class="keyword">AND</span> goc.attribute1 <span class="keyword">IN</span> (<span class="string">&#x27;æˆæœ¬ç±»&#x27;</span>, <span class="string">&#x27;æŸç›Šç±»&#x27;</span>)),</span><br><span class="line">                     <span class="string">&#x27;å€Ÿæ–¹&#x27;</span>,</span><br><span class="line">                     <span class="number">0</span>,</span><br><span class="line">                     <span class="string">&#x27;è´·æ–¹&#x27;</span>,</span><br><span class="line">                     nvl(xal.accounted_dr <span class="operator">*</span> <span class="number">-1</span>, <span class="number">0</span>) <span class="operator">+</span></span><br><span class="line">                     nvl(xal.accounted_cr, <span class="number">0</span>),</span><br><span class="line">                     nvl(xal.accounted_cr, <span class="number">0</span>))) ORGNC,</span><br><span class="line">             <span class="number">0</span> QTY,</span><br><span class="line">             <span class="number">0</span> PRICE,</span><br><span class="line">             decode(xal.CURRENCY_CODE,</span><br><span class="line">                    <span class="string">&#x27;CNY&#x27;</span>,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    nvl(xal.CURRENCY_CONVERSION_RATE, <span class="number">1</span>)) EXCHRATE,</span><br><span class="line">             nvl(nvl(xal.description, xah.DESCRIPTION), <span class="string">&#x27;å…¥è´¦&#x27;</span>) DIGEST,</span><br><span class="line">             to_date(xal.ACCOUNTING_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) bizdate,</span><br><span class="line">             <span class="keyword">NULL</span> expiredate,</span><br><span class="line">             <span class="keyword">NULL</span> md_staff,</span><br><span class="line">             DECODE(gcck.segment2, <span class="string">&#x27;0&#x27;</span>, <span class="keyword">NULL</span>, SUBSTR(gcck.segment2, <span class="number">1</span>, <span class="number">4</span>)) MD_DEPARTMENT,</span><br><span class="line">             <span class="keyword">NULL</span> md_custsupplier,</span><br><span class="line">             <span class="string">&#x27;PENDING&#x27;</span> MD_CUSTOMER,</span><br><span class="line">             <span class="comment">--xal.PARTY_TYPE_CODE || pv.segment1 MD_SUPPLIER,</span></span><br><span class="line">             <span class="string">&#x27;PENDING&#x27;</span> MD_SUPPLIER,</span><br><span class="line">             <span class="comment">/*DECODE((SELECT ffvs.FLEX_VALUE</span></span><br><span class="line"><span class="comment">               FROM fnd_flex_values_vl ffvs, fnd_flex_value_sets ffv</span></span><br><span class="line"><span class="comment">              WHERE 1 = 1</span></span><br><span class="line"><span class="comment">                AND ffvs.FLEX_VALUE_SET_ID = ffv.FLEX_VALUE_SET_ID</span></span><br><span class="line"><span class="comment">                AND ffv.FLEX_VALUE_SET_NAME = &#x27;GJ_INTER_VIM_INDUSTRY&#x27;</span></span><br><span class="line"><span class="comment">                AND ffvs.FLEX_VALUE = SUBSTR(gcck.segment3, 1, 4)</span></span><br><span class="line"><span class="comment">                AND ffvs.ENABLED_FLAG = &#x27;Y&#x27;</span></span><br><span class="line"><span class="comment">                AND nvl(ffvs.END_DATE_ACTIVE, SYSDATE) &gt;= SYSDATE),</span></span><br><span class="line"><span class="comment">             NULL,</span></span><br><span class="line"><span class="comment">             NULL,</span></span><br><span class="line"><span class="comment">             (SELECT flv.DESCRIPTION</span></span><br><span class="line"><span class="comment">                FROM fnd_lookup_values flv</span></span><br><span class="line"><span class="comment">               WHERE 1 = 1</span></span><br><span class="line"><span class="comment">                 AND flv.LOOKUP_TYPE = &#x27;GJ_INTER_LEGAL_TYPE&#x27;</span></span><br><span class="line"><span class="comment">                 AND flv.LANGUAGE = &#x27;ZHS&#x27;</span></span><br><span class="line"><span class="comment">                 AND flv.ENABLED_FLAG = &#x27;Y&#x27;</span></span><br><span class="line"><span class="comment">                 AND nvl(flv.END_DATE_ACTIVE, SYSDATE) &gt;= SYSDATE</span></span><br><span class="line"><span class="comment">                 AND flv.LOOKUP_CODE = xep.LEGAL_ENTITY_IDENTIFIER)) MD_INDUSTRY,*/</span></span><br><span class="line">             <span class="string">&#x27;PENDING&#x27;</span> MD_INDUSTRY,</span><br><span class="line">             <span class="comment">/*(SELECT aid.attribute1</span></span><br><span class="line"><span class="comment">              FROM ap_invoices_all aia, ap_invoice_distributions_all aid</span></span><br><span class="line"><span class="comment">             WHERE 1 = 1</span></span><br><span class="line"><span class="comment">               AND aia.invoice_id = aid.invoice_id</span></span><br><span class="line"><span class="comment">               AND ora_hash(xte.entity_code) || to_char(aia.invoice_id) =</span></span><br><span class="line"><span class="comment">                   ora_hash(xte.entity_code) || to_char(xte.source_id_int_1)</span></span><br><span class="line"><span class="comment">               AND rownum = 1) MD_CFITEM,*/</span></span><br><span class="line">             <span class="string">&#x27;PENDING&#x27;</span> MD_CFITEM,</span><br><span class="line">             DECODE((<span class="keyword">SELECT</span> ffvs.FLEX_VALUE</span><br><span class="line">                      <span class="keyword">FROM</span> fnd_flex_values_vl ffvs, fnd_flex_value_sets ffv</span><br><span class="line">                     <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                       <span class="keyword">AND</span> ffvs.FLEX_VALUE_SET_ID <span class="operator">=</span> ffv.FLEX_VALUE_SET_ID</span><br><span class="line">                       <span class="keyword">AND</span> ffv.FLEX_VALUE_SET_NAME <span class="operator">=</span></span><br><span class="line">                           <span class="string">&#x27;GJ_INTER_VIM_MARBASCLASS&#x27;</span></span><br><span class="line">                       <span class="keyword">AND</span> ffvs.FLEX_VALUE <span class="operator">=</span> SUBSTR(gcck.segment3, <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                       <span class="keyword">AND</span> ffvs.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                       <span class="keyword">AND</span> nvl(ffvs.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE),</span><br><span class="line">                    <span class="keyword">NULL</span>,</span><br><span class="line">                    <span class="keyword">NULL</span>,</span><br><span class="line">                    (<span class="keyword">SELECT</span> flv.DESCRIPTION</span><br><span class="line">                       <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_MARBASCLASS&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> nvl(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                        <span class="keyword">AND</span> flv.LOOKUP_CODE <span class="operator">=</span> gcck.segment1)) MD_MARBASCLASS,</span><br><span class="line">             <span class="keyword">NULL</span> md_measurement,</span><br><span class="line">             gcck.segment4 MD_BANKACCOUNT,</span><br><span class="line">             <span class="keyword">NULL</span> MD_REASON,</span><br><span class="line">             <span class="keyword">NULL</span> md_project,</span><br><span class="line">             <span class="keyword">NULL</span> md_contract,</span><br><span class="line">             <span class="keyword">NULL</span> md_inde_project,</span><br><span class="line">             <span class="keyword">NULL</span> MD_FUNDPLAN,</span><br><span class="line">             <span class="keyword">NULL</span> MD_FINANCING,</span><br><span class="line">             <span class="keyword">NULL</span> def_01,</span><br><span class="line">             <span class="keyword">NULL</span> def_02,</span><br><span class="line">             <span class="keyword">NULL</span> def_03,</span><br><span class="line">             <span class="keyword">NULL</span> def_04,</span><br><span class="line">             <span class="keyword">NULL</span> def_05,</span><br><span class="line">             <span class="keyword">NULL</span> def_06,</span><br><span class="line">             <span class="keyword">NULL</span> def_07,</span><br><span class="line">             <span class="keyword">NULL</span> def_08,</span><br><span class="line">             <span class="keyword">NULL</span> def_09,</span><br><span class="line">             to_date(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) update_time</span><br><span class="line">        <span class="keyword">FROM</span> xla_ae_headers               xah,</span><br><span class="line">             xla_ae_lines                 xal,</span><br><span class="line">             xla.xla_transaction_entities xte,</span><br><span class="line">             gl_code_combinations_kfv     gcck,</span><br><span class="line">             <span class="comment">--</span></span><br><span class="line">             fnd_lookup_values flv</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> xah.AE_HEADER_ID <span class="operator">=</span> xal.AE_HEADER_ID</span><br><span class="line">         <span class="keyword">AND</span> xte.ledger_id <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">         <span class="keyword">AND</span> xte.entity_id <span class="operator">=</span> xah.entity_id</span><br><span class="line">         <span class="keyword">AND</span> (nvl(accounted_cr, <span class="number">0</span>) <span class="operator">&lt;&gt;</span> <span class="number">0</span> <span class="keyword">OR</span> nvl(accounted_dr, <span class="number">0</span>) <span class="operator">&lt;&gt;</span> <span class="number">0</span> <span class="keyword">OR</span></span><br><span class="line">             fnd_profile.value(<span class="string">&#x27;XLA_SHOW_ZERO_AMT_JRNL&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">         <span class="keyword">AND</span> xte.application_id <span class="keyword">IN</span> (<span class="number">200</span>, <span class="number">222</span>) <span class="comment">--åº”ä»˜/åº”æ”¶æ¨¡å—</span></span><br><span class="line">         <span class="keyword">AND</span> xte.application_id <span class="operator">=</span> xah.application_id</span><br><span class="line">         <span class="keyword">AND</span> xte.entity_code <span class="keyword">IN</span></span><br><span class="line">             (<span class="string">&#x27;AP_INVOICES&#x27;</span>, <span class="string">&#x27;AP_PAYMENTS&#x27;</span>, <span class="string">&#x27;RECEIPTS&#x27;</span>, <span class="string">&#x27;TRANSACTIONS&#x27;</span>)</span><br><span class="line">         <span class="keyword">AND</span> xal.code_combination_id <span class="operator">=</span> gcck.code_combination_id</span><br><span class="line">            <span class="comment">--æœ€ç»ˆè¿‡è´¦</span></span><br><span class="line">         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">         <span class="keyword">AND</span> flv.VIEW_APPLICATION_ID <span class="operator">=</span> <span class="number">602</span></span><br><span class="line">         <span class="keyword">AND</span> flv.lookup_type <span class="operator">=</span> <span class="string">&#x27;XLA_ACCOUNTING_ENTRY_STATUS&#x27;</span></span><br><span class="line">         <span class="keyword">AND</span> flv.meaning <span class="operator">=</span> <span class="string">&#x27;æœ€ç»ˆ&#x27;</span></span><br><span class="line">         <span class="keyword">AND</span> flv.lookup_code <span class="operator">=</span> xah.accounting_entry_status_code</span><br><span class="line">            <span class="comment">-- å‚æ•°</span></span><br><span class="line">         <span class="keyword">AND</span> xal.ACCOUNTING_DATE <span class="operator">&gt;=</span> to_date(<span class="string">&#x27;2020-01-01&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>)</span><br><span class="line">            <span class="comment">-- åŒæ­¥çš„ouå‚æ•°</span></span><br><span class="line">         <span class="keyword">AND</span> <span class="keyword">EXISTS</span></span><br><span class="line">       (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">FROM</span> fnd_lookup_values flv, hr_operating_units hou</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_COM&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> nvl(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                 <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> hou.short_code <span class="operator">=</span> gcck.segment1);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">OPEN</span> cur_voucher_lines;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_voucher_lines BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> l_rec_line_list LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> l_rec_line_list.first .. l_rec_line_list.last</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHERITEMASS <span class="keyword">VALUES</span> l_rec_line_list (i);</span><br><span class="line">  </span><br><span class="line">      <span class="comment">-- æ¯1000æ¡æäº¤ä¸€æ¬¡</span></span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_voucher_lines<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_voucher_lines;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_vchrnum_lines;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : æ ¹æ®å·²ç»åŒæ­¥çš„ä¼šè®¡åˆ†å½•è¡Œï¼ŒåŒ¹é…åº”ä»˜å‘ç¥¨å¤´æ•°æ®</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_ap_invoice_headers(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                                  x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                                  x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_ap_invoice_headers&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    TYPE l_rec_header <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> INF_GL_VOUCHER<span class="operator">%</span>ROWTYPE;</span><br><span class="line">    l_rec_header_list l_rec_header;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_invoice_headers <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> infvhr.id,</span><br><span class="line">             <span class="string">&#x27;GJ_CN_01&#x27;</span> BOOKCODE,</span><br><span class="line">             xep.LEGAL_ENTITY_IDENTIFIER UNITCODE,</span><br><span class="line">             infvhr.ACCTYEAR,</span><br><span class="line">             infvhr.ACCTPERIOD,</span><br><span class="line">             infvhr.VCHRTYPECODE,</span><br><span class="line">             infvhr.VCHRNUM,</span><br><span class="line">             fu.USER_NAME CREATOR,</span><br><span class="line">             infvhr.CREATETIME,</span><br><span class="line">             infvhr.CREATEDATE,</span><br><span class="line">             infvhr.POSTDATE,</span><br><span class="line">             <span class="keyword">NULL</span> POSTOR,</span><br><span class="line">             <span class="keyword">NULL</span> CASHIER,</span><br><span class="line">             <span class="keyword">NULL</span> CASHDATE,</span><br><span class="line">             <span class="keyword">NULL</span> ATTACHMENT,</span><br><span class="line">             infvhr.ADJPERIODFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> TEMPFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> OFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> OFFSETID,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> BLUEOFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> BLUEOFFSETID,</span><br><span class="line">             infvhr.MD_SUPPLIER def_01,</span><br><span class="line">             infvhr.MD_CFITEM def_02,</span><br><span class="line">             <span class="keyword">NULL</span> def_03,</span><br><span class="line">             <span class="keyword">NULL</span> def_04,</span><br><span class="line">             <span class="keyword">NULL</span> def_05,</span><br><span class="line">             <span class="keyword">NULL</span> def_06,</span><br><span class="line">             <span class="keyword">NULL</span> def_07,</span><br><span class="line">             <span class="keyword">NULL</span> def_08,</span><br><span class="line">             <span class="keyword">NULL</span> def_09,</span><br><span class="line">             to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) update_time</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ora_hash(<span class="string">&#x27;AP_INVOICES&#x27;</span>) <span class="operator">||</span> aia.invoice_id ID,</span><br><span class="line">                     aia.org_id,</span><br><span class="line">                     aia.invoice_id,</span><br><span class="line">                     aia.CREATED_BY,</span><br><span class="line">                     to_number(to_char(aia.GL_DATE, <span class="string">&#x27;yyyy&#x27;</span>)) ACCTYEAR,</span><br><span class="line">                     to_char(aia.GL_DATE, <span class="string">&#x27;mm&#x27;</span>) ACCTPERIOD,</span><br><span class="line">                     (<span class="keyword">SELECT</span> flv.LOOKUP_CODE</span><br><span class="line">                        <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_MD_VCHRTYPE&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> NVL(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                         <span class="keyword">AND</span> flv.MEANING <span class="operator">=</span> <span class="string">&#x27;åº”ä»˜å‘ç¥¨&#x27;</span>) VCHRTYPECODE,</span><br><span class="line">                     nvl(to_char(aia.VOUCHER_NUM),</span><br><span class="line">                         GJ_CONGL_UTIL.get_virtual_voucher) VCHRNUM,</span><br><span class="line">                     to_char(aia.GL_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATETIME,</span><br><span class="line">                     to_char(aia.GL_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATEDATE,</span><br><span class="line">                     to_char(aia.GL_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) POSTDATE,</span><br><span class="line">                     <span class="string">&#x27;0&#x27;</span> ADJPERIODFLAG,</span><br><span class="line">                     <span class="string">&#x27;S&#x27;</span> <span class="operator">||</span> pv.segment1 MD_SUPPLIER,</span><br><span class="line">                     (<span class="keyword">SELECT</span> aid.attribute1</span><br><span class="line">                        <span class="keyword">FROM</span> ap_invoice_distributions_all aid</span><br><span class="line">                       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                         <span class="keyword">AND</span> aid.INVOICE_ID <span class="operator">=</span> aia.invoice_id</span><br><span class="line">                         <span class="keyword">AND</span> rownum <span class="operator">=</span> <span class="number">1</span>) MD_CFITEM</span><br><span class="line">                <span class="keyword">FROM</span> ap_invoices_all aia, po_vendors pv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> pv.vendor_id <span class="operator">=</span> aia.vendor_id) infvhr,</span><br><span class="line">             hr_operating_units hou,</span><br><span class="line">             xle_entity_profiles xep,</span><br><span class="line">             fnd_user fu</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> xep.LEGAL_ENTITY_ID <span class="operator">=</span> hou.default_legal_context_id</span><br><span class="line">         <span class="keyword">AND</span> hou.organization_id <span class="operator">=</span> infvhr.org_id</span><br><span class="line">         <span class="keyword">AND</span> fu.user_id <span class="operator">=</span> infvhr.created_by</span><br><span class="line">         <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS igv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> infvhr.vchrtypecode</span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrid <span class="operator">=</span> infvhr.id);</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">OPEN</span> cur_invoice_headers;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_invoice_headers BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> l_rec_header_list LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> l_rec_header_list.first .. l_rec_header_list.last</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHER <span class="keyword">VALUES</span> l_rec_header_list (i);</span><br><span class="line">  </span><br><span class="line">      <span class="comment">-- æ¯1000æ¡æäº¤ä¸€æ¬¡</span></span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_invoice_headers<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_invoice_headers;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_ap_invoice_headers;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : æ ¹æ®å·²ç»åŒæ­¥çš„ä¼šè®¡åˆ†å½•è¡Œï¼ŒåŒ¹é…åº”ä»˜ä»˜æ¬¾å¤´æ•°æ®</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_ap_payment_headers(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                                  x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                                  x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_ap_payment_headers&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    TYPE l_rec_header <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> INF_GL_VOUCHER<span class="operator">%</span>ROWTYPE;</span><br><span class="line">    l_rec_header_list l_rec_header;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_payment_headers <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> infvhr.id,</span><br><span class="line">             <span class="string">&#x27;GJ_CN_01&#x27;</span> BOOKCODE,</span><br><span class="line">             xep.LEGAL_ENTITY_IDENTIFIER UNITCODE,</span><br><span class="line">             infvhr.ACCTYEAR,</span><br><span class="line">             infvhr.ACCTPERIOD,</span><br><span class="line">             infvhr.VCHRTYPECODE,</span><br><span class="line">             infvhr.VCHRNUM,</span><br><span class="line">             fu.USER_NAME CREATOR,</span><br><span class="line">             infvhr.CREATETIME,</span><br><span class="line">             infvhr.CREATEDATE,</span><br><span class="line">             infvhr.POSTDATE,</span><br><span class="line">             <span class="keyword">NULL</span> POSTOR,</span><br><span class="line">             <span class="keyword">NULL</span> CASHIER,</span><br><span class="line">             <span class="keyword">NULL</span> CASHDATE,</span><br><span class="line">             <span class="keyword">NULL</span> ATTACHMENT,</span><br><span class="line">             infvhr.ADJPERIODFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> TEMPFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> OFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> OFFSETID,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> BLUEOFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> BLUEOFFSETID,</span><br><span class="line">             infvhr.MD_SUPPLIER def_01,</span><br><span class="line">             infvhr.MD_CFITEM def_02,</span><br><span class="line">             <span class="keyword">NULL</span> def_03,</span><br><span class="line">             <span class="keyword">NULL</span> def_04,</span><br><span class="line">             <span class="keyword">NULL</span> def_05,</span><br><span class="line">             <span class="keyword">NULL</span> def_06,</span><br><span class="line">             <span class="keyword">NULL</span> def_07,</span><br><span class="line">             <span class="keyword">NULL</span> def_08,</span><br><span class="line">             <span class="keyword">NULL</span> def_09,</span><br><span class="line">             to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) update_time</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ora_hash(<span class="string">&#x27;AP_PAYMENTS&#x27;</span>) <span class="operator">||</span> aca.check_id ID,</span><br><span class="line">                     aca.org_id,</span><br><span class="line">                     aca.check_id,</span><br><span class="line">                     aca.CREATED_BY,</span><br><span class="line">                     to_number(to_char(aca.CHECK_DATE, <span class="string">&#x27;yyyy&#x27;</span>)) ACCTYEAR,</span><br><span class="line">                     to_char(aca.CHECK_DATE, <span class="string">&#x27;mm&#x27;</span>) ACCTPERIOD,</span><br><span class="line">                     (<span class="keyword">SELECT</span> flv.LOOKUP_CODE</span><br><span class="line">                        <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_MD_VCHRTYPE&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> NVL(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                         <span class="keyword">AND</span> flv.MEANING <span class="operator">=</span> <span class="string">&#x27;åº”ä»˜ä»˜æ¬¾&#x27;</span>) VCHRTYPECODE,</span><br><span class="line">                     nvl(to_char(aca.DOC_SEQUENCE_VALUE),</span><br><span class="line">                         GJ_CONGL_UTIL.get_virtual_voucher) VCHRNUM,</span><br><span class="line">                     to_char(aca.CHECK_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATETIME,</span><br><span class="line">                     to_char(aca.CHECK_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATEDATE,</span><br><span class="line">                     to_char(aca.CHECK_DATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) POSTDATE,</span><br><span class="line">                     <span class="string">&#x27;0&#x27;</span> ADJPERIODFLAG,</span><br><span class="line">                     <span class="string">&#x27;S&#x27;</span> <span class="operator">||</span> pv.segment1 MD_SUPPLIER,</span><br><span class="line">                     aca.attribute4 MD_CFITEM</span><br><span class="line">                <span class="keyword">FROM</span> ap_checks_all acaï¼Œ po_vendors pv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> pv.VENDOR_ID <span class="operator">=</span> aca.vendor_id) infvhr,</span><br><span class="line">             hr_operating_units hou,</span><br><span class="line">             xle_entity_profiles xep,</span><br><span class="line">             fnd_user fu</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> xep.LEGAL_ENTITY_ID <span class="operator">=</span> hou.default_legal_context_id</span><br><span class="line">         <span class="keyword">AND</span> hou.organization_id <span class="operator">=</span> infvhr.org_id</span><br><span class="line">         <span class="keyword">AND</span> fu.user_id <span class="operator">=</span> infvhr.created_by</span><br><span class="line">         <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS igv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> infvhr.vchrtypecode</span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrid <span class="operator">=</span> infvhr.id);</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">OPEN</span> cur_payment_headers;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_payment_headers BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> l_rec_header_list LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> l_rec_header_list.first .. l_rec_header_list.last</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHER <span class="keyword">VALUES</span> l_rec_header_list (i);</span><br><span class="line">  </span><br><span class="line">      <span class="comment">-- æ¯1000æ¡æäº¤ä¸€æ¬¡</span></span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_payment_headers<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_payment_headers;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_ap_payment_headers;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : æ ¹æ®å·²ç»åŒæ­¥çš„ä¼šè®¡åˆ†å½•è¡Œï¼ŒåŒ¹é…åº”æ”¶å‘ç¥¨å¤´æ•°æ®</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_ar_invoice_headers(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                                  x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                                  x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_ar_invoice_headers&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    TYPE l_rec_header <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> INF_GL_VOUCHER<span class="operator">%</span>ROWTYPE;</span><br><span class="line">    l_rec_header_list l_rec_header;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_transaction_headers <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> infvhr.id,</span><br><span class="line">             <span class="string">&#x27;GJ_CN_01&#x27;</span> BOOKCODE,</span><br><span class="line">             xep.LEGAL_ENTITY_IDENTIFIER UNITCODE,</span><br><span class="line">             infvhr.ACCTYEAR,</span><br><span class="line">             infvhr.ACCTPERIOD,</span><br><span class="line">             infvhr.VCHRTYPECODE,</span><br><span class="line">             infvhr.VCHRNUM,</span><br><span class="line">             fu.USER_NAME CREATOR,</span><br><span class="line">             infvhr.CREATETIME,</span><br><span class="line">             infvhr.CREATEDATE,</span><br><span class="line">             infvhr.POSTDATE,</span><br><span class="line">             <span class="keyword">NULL</span> POSTOR,</span><br><span class="line">             <span class="keyword">NULL</span> CASHIER,</span><br><span class="line">             <span class="keyword">NULL</span> CASHDATE,</span><br><span class="line">             <span class="keyword">NULL</span> ATTACHMENT,</span><br><span class="line">             infvhr.ADJPERIODFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> TEMPFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> OFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> OFFSETID,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> BLUEOFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> BLUEOFFSETID,</span><br><span class="line">             infvhr.MD_CUSTOMER def_01,</span><br><span class="line">             infvhr.MD_CFITEM def_02,</span><br><span class="line">             <span class="keyword">NULL</span> def_03,</span><br><span class="line">             <span class="keyword">NULL</span> def_04,</span><br><span class="line">             <span class="keyword">NULL</span> def_05,</span><br><span class="line">             <span class="keyword">NULL</span> def_06,</span><br><span class="line">             <span class="keyword">NULL</span> def_07,</span><br><span class="line">             <span class="keyword">NULL</span> def_08,</span><br><span class="line">             <span class="keyword">NULL</span> def_09,</span><br><span class="line">             to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) update_time</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ora_hash(<span class="string">&#x27;TRANSACTIONS&#x27;</span>) <span class="operator">||</span> rct.CUSTOMER_TRX_ID id,</span><br><span class="line">                     rct.ORG_ID,</span><br><span class="line">                     rct.CUSTOMER_TRX_ID CUSTOMER_TRX_ID,</span><br><span class="line">                     rct.CREATED_BY,</span><br><span class="line">                     to_number(to_char((<span class="keyword">SELECT</span> rctlgd.GL_DATE</span><br><span class="line">                                         <span class="keyword">FROM</span> ra_cust_trx_line_gl_dist_all rctlgd</span><br><span class="line">                                        <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                                          <span class="keyword">AND</span> rctlgd.CUSTOMER_TRX_ID <span class="operator">=</span></span><br><span class="line">                                              rct.CUSTOMER_TRX_ID</span><br><span class="line">                                          <span class="keyword">AND</span> rctlgd.gl_date <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                                          <span class="keyword">AND</span> rownum <span class="operator">=</span> <span class="number">1</span>),</span><br><span class="line">                                       <span class="string">&#x27;yyyy&#x27;</span>)) ACCTYEAR,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> rctlgd.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> ra_cust_trx_line_gl_dist_all rctlgd</span><br><span class="line">                              <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.CUSTOMER_TRX_ID <span class="operator">=</span></span><br><span class="line">                                    rct.CUSTOMER_TRX_ID</span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.gl_date <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                                <span class="keyword">AND</span> rownum <span class="operator">=</span> <span class="number">1</span>),</span><br><span class="line">                             <span class="string">&#x27;mm&#x27;</span>) ACCTPERIOD,</span><br><span class="line">                     (<span class="keyword">SELECT</span> flv.LOOKUP_CODE</span><br><span class="line">                        <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_MD_VCHRTYPE&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> NVL(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                         <span class="keyword">AND</span> flv.MEANING <span class="operator">=</span> <span class="string">&#x27;åº”æ”¶å‘ç¥¨&#x27;</span>) VCHRTYPECODE,</span><br><span class="line">                     nvl(to_char(rct.DOC_SEQUENCE_VALUE),</span><br><span class="line">                         GJ_CONGL_UTIL.get_virtual_voucher) VCHRNUM,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> rctlgd.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> ra_cust_trx_line_gl_dist_all rctlgd</span><br><span class="line">                              <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.CUSTOMER_TRX_ID <span class="operator">=</span></span><br><span class="line">                                    rct.CUSTOMER_TRX_ID</span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.GL_DATE <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                                <span class="keyword">AND</span> rownum <span class="operator">=</span> <span class="number">1</span>),</span><br><span class="line">                             <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATETIME,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> rctlgd.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> ra_cust_trx_line_gl_dist_all rctlgd</span><br><span class="line">                              <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.CUSTOMER_TRX_ID <span class="operator">=</span></span><br><span class="line">                                    rct.CUSTOMER_TRX_ID</span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.GL_DATE <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                                <span class="keyword">AND</span> rownum <span class="operator">=</span> <span class="number">1</span>),</span><br><span class="line">                             <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATEDATE,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> rctlgd.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> ra_cust_trx_line_gl_dist_all rctlgd</span><br><span class="line">                              <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.CUSTOMER_TRX_ID <span class="operator">=</span></span><br><span class="line">                                    rct.CUSTOMER_TRX_ID</span><br><span class="line">                                <span class="keyword">AND</span> rctlgd.GL_DATE <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                                <span class="keyword">AND</span> rownum <span class="operator">=</span> <span class="number">1</span>),</span><br><span class="line">                             <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) POSTDATE,</span><br><span class="line">                     <span class="string">&#x27;0&#x27;</span> ADJPERIODFLAG,</span><br><span class="line">                     <span class="string">&#x27;C&#x27;</span> <span class="operator">||</span> hca.ACCOUNT_NUMBER MD_CUSTOMER,</span><br><span class="line">                     <span class="keyword">NULL</span> MD_CFITEM</span><br><span class="line">                <span class="keyword">FROM</span> ra_customer_trx_all rct,</span><br><span class="line">                     hz_cust_accounts    hca,</span><br><span class="line">                     hz_parties          hp</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> hca.cust_account_id <span class="operator">=</span> rct.BILL_TO_CUSTOMER_ID</span><br><span class="line">                 <span class="keyword">AND</span> hca.PARTY_ID <span class="operator">=</span> hp.PARTY_ID) infvhr,</span><br><span class="line">             hr_operating_units hou,</span><br><span class="line">             xle_entity_profiles xep,</span><br><span class="line">             fnd_user fu</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> xep.LEGAL_ENTITY_ID <span class="operator">=</span> hou.default_legal_context_id</span><br><span class="line">         <span class="keyword">AND</span> hou.organization_id <span class="operator">=</span> infvhr.org_id</span><br><span class="line">         <span class="keyword">AND</span> fu.user_id <span class="operator">=</span> infvhr.created_by</span><br><span class="line">         <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS igv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> infvhr.vchrtypecode</span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> <span class="string">&#x27;4&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrid <span class="operator">=</span> infvhr.id);</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">OPEN</span> cur_transaction_headers;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_transaction_headers BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> l_rec_header_list LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> l_rec_header_list.first .. l_rec_header_list.last</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHER <span class="keyword">VALUES</span> l_rec_header_list (i);</span><br><span class="line">  </span><br><span class="line">      <span class="comment">-- æ¯1000æ¡æäº¤ä¸€æ¬¡</span></span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_transaction_headers<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_transaction_headers;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_ar_invoice_headers;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : æ ¹æ®å·²ç»åŒæ­¥çš„ä¼šè®¡åˆ†å½•è¡Œï¼ŒåŒ¹é…åº”æ”¶æ”¶æ¬¾å¤´æ•°æ®</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_ar_receipt_headers(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                                  x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                                  x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_ar_receipt_headers&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    TYPE l_rec_header <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> INF_GL_VOUCHER<span class="operator">%</span>ROWTYPE;</span><br><span class="line">    l_rec_header_list l_rec_header;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_receipt_headers <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> infvhr.id,</span><br><span class="line">             <span class="string">&#x27;GJ_CN_01&#x27;</span> BOOKCODE,</span><br><span class="line">             xep.LEGAL_ENTITY_IDENTIFIER UNITCODE,</span><br><span class="line">             infvhr.ACCTYEAR,</span><br><span class="line">             infvhr.ACCTPERIOD,</span><br><span class="line">             infvhr.VCHRTYPECODE,</span><br><span class="line">             infvhr.VCHRNUM,</span><br><span class="line">             fu.USER_NAME CREATOR,</span><br><span class="line">             infvhr.CREATETIME,</span><br><span class="line">             infvhr.CREATEDATE,</span><br><span class="line">             infvhr.POSTDATE,</span><br><span class="line">             <span class="keyword">NULL</span> POSTOR,</span><br><span class="line">             <span class="keyword">NULL</span> CASHIER,</span><br><span class="line">             <span class="keyword">NULL</span> CASHDATE,</span><br><span class="line">             <span class="keyword">NULL</span> ATTACHMENT,</span><br><span class="line">             infvhr.ADJPERIODFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> TEMPFLAG,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> OFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> OFFSETID,</span><br><span class="line">             <span class="string">&#x27;0&#x27;</span> BLUEOFFSETSTATE,</span><br><span class="line">             <span class="keyword">NULL</span> BLUEOFFSETID,</span><br><span class="line">             infvhr.MD_CUSTOMER def_01,</span><br><span class="line">             infvhr.MD_CFITEM def_02,</span><br><span class="line">             <span class="keyword">NULL</span> def_03,</span><br><span class="line">             <span class="keyword">NULL</span> def_04,</span><br><span class="line">             <span class="keyword">NULL</span> def_05,</span><br><span class="line">             <span class="keyword">NULL</span> def_06,</span><br><span class="line">             <span class="keyword">NULL</span> def_07,</span><br><span class="line">             <span class="keyword">NULL</span> def_08,</span><br><span class="line">             <span class="keyword">NULL</span> def_09,</span><br><span class="line">             to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) update_time</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ora_hash(<span class="string">&#x27;RECEIPTS&#x27;</span>) <span class="operator">||</span> acr.CASH_RECEIPT_ID id,</span><br><span class="line">                     acr.ORG_ID,</span><br><span class="line">                     acr.CASH_RECEIPT_ID,</span><br><span class="line">                     acr.CREATED_BY,</span><br><span class="line">                     to_number(to_char((<span class="keyword">SELECT</span> acrh.GL_DATE</span><br><span class="line">                                         <span class="keyword">FROM</span> AR_CASH_RECEIPT_HISTORY_ALL acrh</span><br><span class="line">                                        <span class="keyword">WHERE</span> acrh.CASH_RECEIPT_ID <span class="operator">=</span></span><br><span class="line">                                              acr.CASH_RECEIPT_ID</span><br><span class="line">                                          <span class="keyword">AND</span> acrh.org_id <span class="operator">=</span> acr.org_id</span><br><span class="line">                                          <span class="keyword">AND</span> acrh.FIRST_POSTED_RECORD_FLAG(<span class="operator">+</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>),</span><br><span class="line">                                       <span class="string">&#x27;yyyy&#x27;</span>)) ACCTYEAR,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> acrh.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> AR_CASH_RECEIPT_HISTORY_ALL acrh</span><br><span class="line">                              <span class="keyword">WHERE</span> acrh.CASH_RECEIPT_ID <span class="operator">=</span></span><br><span class="line">                                    acr.CASH_RECEIPT_ID</span><br><span class="line">                                <span class="keyword">AND</span> acrh.org_id <span class="operator">=</span> acr.org_id</span><br><span class="line">                                <span class="keyword">AND</span> acrh.FIRST_POSTED_RECORD_FLAG(<span class="operator">+</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>),</span><br><span class="line">                             <span class="string">&#x27;mm&#x27;</span>) ACCTPERIOD,</span><br><span class="line">                     (<span class="keyword">SELECT</span> flv.LOOKUP_CODE</span><br><span class="line">                        <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_MD_VCHRTYPE&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                         <span class="keyword">AND</span> NVL(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                         <span class="keyword">AND</span> flv.MEANING <span class="operator">=</span> <span class="string">&#x27;åº”æ”¶æ”¶æ¬¾&#x27;</span>) VCHRTYPECODE,</span><br><span class="line">                     nvl(to_char(acr.DOC_SEQUENCE_VALUE),</span><br><span class="line">                         GJ_CONGL_UTIL.get_virtual_voucher) VCHRNUM,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> acrh.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> AR_CASH_RECEIPT_HISTORY_ALL acrh</span><br><span class="line">                              <span class="keyword">WHERE</span> acrh.CASH_RECEIPT_ID <span class="operator">=</span></span><br><span class="line">                                    acr.CASH_RECEIPT_ID</span><br><span class="line">                                <span class="keyword">AND</span> acrh.org_id <span class="operator">=</span> acr.org_id</span><br><span class="line">                                <span class="keyword">AND</span> acrh.FIRST_POSTED_RECORD_FLAG(<span class="operator">+</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>),</span><br><span class="line">                             <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATETIME,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> acrh.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> AR_CASH_RECEIPT_HISTORY_ALL acrh</span><br><span class="line">                              <span class="keyword">WHERE</span> acrh.CASH_RECEIPT_ID <span class="operator">=</span></span><br><span class="line">                                    acr.CASH_RECEIPT_ID</span><br><span class="line">                                <span class="keyword">AND</span> acrh.org_id <span class="operator">=</span> acr.org_id</span><br><span class="line">                                <span class="keyword">AND</span> acrh.FIRST_POSTED_RECORD_FLAG(<span class="operator">+</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>),</span><br><span class="line">                             <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) CREATEDATE,</span><br><span class="line">                     to_char((<span class="keyword">SELECT</span> acrh.GL_DATE</span><br><span class="line">                               <span class="keyword">FROM</span> AR_CASH_RECEIPT_HISTORY_ALL acrh</span><br><span class="line">                              <span class="keyword">WHERE</span> acrh.CASH_RECEIPT_ID <span class="operator">=</span></span><br><span class="line">                                    acr.CASH_RECEIPT_ID</span><br><span class="line">                                <span class="keyword">AND</span> acrh.org_id <span class="operator">=</span> acr.org_id</span><br><span class="line">                                <span class="keyword">AND</span> acrh.FIRST_POSTED_RECORD_FLAG(<span class="operator">+</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>),</span><br><span class="line">                             <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) POSTDATE,</span><br><span class="line">                     <span class="string">&#x27;0&#x27;</span> ADJPERIODFLAG,</span><br><span class="line">                     <span class="string">&#x27;C&#x27;</span> <span class="operator">||</span> hca.ACCOUNT_NUMBER MD_CUSTOMER,</span><br><span class="line">                     <span class="string">&#x27;1111&#x27;</span> MD_CFITEM</span><br><span class="line">                <span class="keyword">FROM</span> ar_cash_receipts_all acr,</span><br><span class="line">                     hz_cust_accounts     hca,</span><br><span class="line">                     hz_parties           hp</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> acr.PAY_FROM_CUSTOMER <span class="operator">=</span> hca.cust_account_id</span><br><span class="line">                 <span class="keyword">AND</span> hca.PARTY_ID <span class="operator">=</span> hp.PARTY_ID) infvhr,</span><br><span class="line">             hr_operating_units hou,</span><br><span class="line">             xle_entity_profiles xep,</span><br><span class="line">             fnd_user fu</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> xep.LEGAL_ENTITY_ID <span class="operator">=</span> hou.default_legal_context_id</span><br><span class="line">         <span class="keyword">AND</span> hou.organization_id <span class="operator">=</span> infvhr.org_id</span><br><span class="line">         <span class="keyword">AND</span> fu.user_id <span class="operator">=</span> infvhr.created_by</span><br><span class="line">         <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS igv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> infvhr.vchrtypecode</span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrtypecode <span class="operator">=</span> <span class="string">&#x27;5&#x27;</span></span><br><span class="line">                 <span class="keyword">AND</span> igv.vchrid <span class="operator">=</span> infvhr.id);</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">OPEN</span> cur_receipt_headers;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_receipt_headers BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> l_rec_header_list LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> l_rec_header_list.first .. l_rec_header_list.last</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHER <span class="keyword">VALUES</span> l_rec_header_list (i);</span><br><span class="line">  </span><br><span class="line">      <span class="comment">-- æ¯1000æ¡æäº¤ä¸€æ¬¡</span></span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_receipt_headers<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_receipt_headers;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_ar_receipt_headers;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : æ•´ç†æœ¬åœ°æ•°æ®é›†ï¼Œåˆ·æ–° PENDING çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> update_local_data(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                              x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                              x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;update_local_data&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ‰¹é‡æ›´æ–°çš„æ•°æ®ç»“æ„</span></span><br><span class="line">    TYPE record_update_type <span class="keyword">IS</span> RECORD(</span><br><span class="line">      id          inf_gl_voucheritemass.id<span class="operator">%</span>TYPE,</span><br><span class="line">      vchrid      inf_gl_voucheritemass.vchrid<span class="operator">%</span>TYPE,</span><br><span class="line">      unitcode    inf_gl_voucheritemass.unitcode<span class="operator">%</span>TYPE,</span><br><span class="line">      vchrnum     inf_gl_voucheritemass.vchrnum<span class="operator">%</span>TYPE,</span><br><span class="line">      MD_CUSTOMER inf_gl_voucheritemass.MD_CUSTOMER<span class="operator">%</span>TYPE,</span><br><span class="line">      MD_CFITEM   inf_gl_voucheritemass.MD_CFITEM<span class="operator">%</span>TYPE,</span><br><span class="line">      MD_INDUSTRY inf_gl_voucheritemass.md_industry<span class="operator">%</span>TYPE);</span><br><span class="line">    TYPE record_update_tbl <span class="keyword">IS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> record_update_type;</span><br><span class="line">    record_update record_update_tbl;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- åº”ä»˜æ•°æ®é›†</span></span><br><span class="line">    <span class="keyword">CURSOR</span> cur_ap_data <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> igvm.id,</span><br><span class="line">             igvm.vchrid,</span><br><span class="line">             igv.unitcode,</span><br><span class="line">             igv.vchrnum,</span><br><span class="line">             igv.def_01 MD_CUSTOMER,</span><br><span class="line">             igv.def_02 MD_CFITEM,</span><br><span class="line">             DECODE((<span class="keyword">SELECT</span> ffvs.FLEX_VALUE</span><br><span class="line">                      <span class="keyword">FROM</span> fnd_flex_values_vl ffvs, fnd_flex_value_sets ffv</span><br><span class="line">                     <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                       <span class="keyword">AND</span> ffvs.FLEX_VALUE_SET_ID <span class="operator">=</span> ffv.FLEX_VALUE_SET_ID</span><br><span class="line">                       <span class="keyword">AND</span> ffv.FLEX_VALUE_SET_NAME <span class="operator">=</span></span><br><span class="line">                           <span class="string">&#x27;GJ_INTER_VIM_INDUSTRY&#x27;</span></span><br><span class="line">                       <span class="keyword">AND</span> ffvs.FLEX_VALUE <span class="operator">=</span> igvm.SUBJECTCODE</span><br><span class="line">                       <span class="keyword">AND</span> ffvs.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                       <span class="keyword">AND</span> nvl(ffvs.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE),</span><br><span class="line">                    <span class="keyword">NULL</span>,</span><br><span class="line">                    <span class="keyword">NULL</span>,</span><br><span class="line">                    (<span class="keyword">SELECT</span> flv.DESCRIPTION</span><br><span class="line">                       <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_LEGAL_TYPE&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> nvl(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                        <span class="keyword">AND</span> flv.LOOKUP_CODE <span class="operator">=</span> igv.unitcode)) MD_INDUSTRY</span><br><span class="line">        <span class="keyword">FROM</span> inf_gl_voucher igv, inf_gl_voucheritemass igvm</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> igv.id <span class="operator">=</span> igvm.vchrid</span><br><span class="line">         <span class="keyword">AND</span> igv.vchrtypecode <span class="keyword">IN</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">         <span class="keyword">AND</span> igvm.vchrnum <span class="operator">=</span> <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- åº”æ”¶æ•°æ®é›†</span></span><br><span class="line">    <span class="keyword">CURSOR</span> cur_ar_data <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> igvm.id,</span><br><span class="line">             igvm.vchrid,</span><br><span class="line">             igv.unitcode,</span><br><span class="line">             igv.vchrnum,</span><br><span class="line">             igv.def_01 MD_CUSTOMER,</span><br><span class="line">             igv.def_02 MD_CFITEM,</span><br><span class="line">             DECODE((<span class="keyword">SELECT</span> ffvs.FLEX_VALUE</span><br><span class="line">                      <span class="keyword">FROM</span> fnd_flex_values_vl ffvs, fnd_flex_value_sets ffv</span><br><span class="line">                     <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                       <span class="keyword">AND</span> ffvs.FLEX_VALUE_SET_ID <span class="operator">=</span> ffv.FLEX_VALUE_SET_ID</span><br><span class="line">                       <span class="keyword">AND</span> ffv.FLEX_VALUE_SET_NAME <span class="operator">=</span></span><br><span class="line">                           <span class="string">&#x27;GJ_INTER_VIM_INDUSTRY&#x27;</span></span><br><span class="line">                       <span class="keyword">AND</span> ffvs.FLEX_VALUE <span class="operator">=</span> igvm.SUBJECTCODE</span><br><span class="line">                       <span class="keyword">AND</span> ffvs.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                       <span class="keyword">AND</span> nvl(ffvs.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE),</span><br><span class="line">                    <span class="keyword">NULL</span>,</span><br><span class="line">                    <span class="keyword">NULL</span>,</span><br><span class="line">                    (<span class="keyword">SELECT</span> flv.DESCRIPTION</span><br><span class="line">                       <span class="keyword">FROM</span> fnd_lookup_values flv</span><br><span class="line">                      <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_LEGAL_TYPE&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> flv.ENABLED_FLAG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">                        <span class="keyword">AND</span> nvl(flv.END_DATE_ACTIVE, SYSDATE) <span class="operator">&gt;=</span> SYSDATE</span><br><span class="line">                        <span class="keyword">AND</span> flv.LOOKUP_CODE <span class="operator">=</span> igv.unitcode)) MD_INDUSTRY</span><br><span class="line">        <span class="keyword">FROM</span> inf_gl_voucher igv, inf_gl_voucheritemass igvm</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> igv.id <span class="operator">=</span> igvm.vchrid</span><br><span class="line">         <span class="keyword">AND</span> igv.vchrtypecode <span class="keyword">IN</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">         <span class="keyword">AND</span> igvm.vchrnum <span class="operator">=</span> <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ›´æ–°åº”ä»˜æ•°æ®é›†</span></span><br><span class="line">    <span class="keyword">OPEN</span> cur_ap_data;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_ap_data BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> record_update LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> <span class="number">1</span> .. record_update.count</span><br><span class="line">        <span class="keyword">UPDATE</span> inf_gl_voucheritemass</span><br><span class="line">           <span class="keyword">SET</span> MD_CUSTOMER <span class="operator">=</span> <span class="keyword">NULL</span>,</span><br><span class="line">               MD_supplier <span class="operator">=</span> record_update(i).MD_CUSTOMER,</span><br><span class="line">               MD_CFITEM   <span class="operator">=</span> record_update(i).MD_CFITEM,</span><br><span class="line">               MD_INDUSTRY <span class="operator">=</span> record_update(i).MD_INDUSTRY,</span><br><span class="line">               unitcode    <span class="operator">=</span> record_update(i).unitcode,</span><br><span class="line">               vchrnum     <span class="operator">=</span> record_update(i).vchrnum</span><br><span class="line">         <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">           <span class="keyword">AND</span> id <span class="operator">=</span> record_update(i).id</span><br><span class="line">           <span class="keyword">AND</span> vchrid <span class="operator">=</span> record_update(i).vchrid;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_ap_data<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_ap_data;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ¸…ç©ºæ•°æ®é›†</span></span><br><span class="line">    record_update.delete;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ›´æ–°åº”æ”¶æ•°æ®é›†</span></span><br><span class="line">    <span class="keyword">OPEN</span> cur_ar_data;</span><br><span class="line">    LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_ar_data BULK <span class="keyword">COLLECT</span></span><br><span class="line">        <span class="keyword">INTO</span> record_update LIMIT <span class="number">1000</span>;</span><br><span class="line">  </span><br><span class="line">      FORALL i <span class="keyword">IN</span> <span class="number">1</span> .. record_update.count</span><br><span class="line">        <span class="keyword">UPDATE</span> inf_gl_voucheritemass</span><br><span class="line">           <span class="keyword">SET</span> MD_supplier <span class="operator">=</span> <span class="keyword">NULL</span>,</span><br><span class="line">               MD_CUSTOMER <span class="operator">=</span> record_update(i).MD_CUSTOMER,</span><br><span class="line">               MD_CFITEM   <span class="operator">=</span> record_update(i).MD_CFITEM,</span><br><span class="line">               MD_INDUSTRY <span class="operator">=</span> record_update(i).MD_INDUSTRY,</span><br><span class="line">               unitcode    <span class="operator">=</span> record_update(i).unitcode,</span><br><span class="line">               vchrnum     <span class="operator">=</span> record_update(i).vchrnum</span><br><span class="line">         <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">           <span class="keyword">AND</span> id <span class="operator">=</span> record_update(i).id</span><br><span class="line">           <span class="keyword">AND</span> vchrid <span class="operator">=</span> record_update(i).vchrid;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">      EXIT <span class="keyword">WHEN</span> cur_ar_data<span class="operator">%</span>NOTFOUND;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="keyword">CLOSE</span> cur_ar_data;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> update_local_data;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : å°†æœ¬åœ°æ•´ç†å¥½çš„æ•°æ®é›†æ’å…¥åˆ°ä¸­é—´åº“</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_remote_data(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                           x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                           x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_remote_data&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ’å…¥åˆ°å‡­è¯å¤´è¡¨</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHER<span class="variable">@gj_congl_middb_prod</span></span><br><span class="line">      <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> INF_GL_VOUCHER;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ’å…¥åˆ°å‡­è¯è¡Œè¡¨</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> INF_GL_VOUCHERITEMASS<span class="variable">@gj_congl_middb_prod</span></span><br><span class="line">      <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_remote_data;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : å…¨é‡åŒæ­¥ï¼Œæ¸…ç©ºæœ¬åœ°æ•°æ®é›†å’Œä¸­é—´åº“</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> sp_sync_all(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                        x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                        x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name CONSTANT VARCHAR2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_remote_data&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºå¼€å§‹&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ¸…ç©ºæœ¬åœ°æ•°æ®é›†</span></span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> INF_GL_VOUCHER;</span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ¸…ç©ºä¸­é—´åº“</span></span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> INF_GL_VOUCHER<span class="variable">@gj_congl_middb_prod</span>;</span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> INF_GL_VOUCHERITEMASS<span class="variable">@gj_congl_middb_prod</span>;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    g_log_msg :<span class="operator">=</span> to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                 l_api_name <span class="operator">||</span> <span class="string">&#x27; ç¨‹åºç»“æŸ&#x27;</span>;</span><br><span class="line">    <span class="built_in">log</span>(g_log_msg);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> g_error;</span><br><span class="line">      x_msg_data      :<span class="operator">=</span> l_api_name <span class="operator">||</span> <span class="string">&#x27;-&gt;&#x27;</span> <span class="operator">||</span> SQLERRM <span class="operator">||</span></span><br><span class="line">                         dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(x_msg_data);</span><br><span class="line">  <span class="keyword">END</span> sp_sync_all;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*==================================================</span></span><br><span class="line"><span class="comment">  Procedure Name :</span></span><br><span class="line"><span class="comment">      raise_exception</span></span><br><span class="line"><span class="comment">  Description:</span></span><br><span class="line"><span class="comment">      This procedure perform to å¤„ç†è¯·æ±‚</span></span><br><span class="line"><span class="comment">  Argument:</span></span><br><span class="line"><span class="comment">      x_return_status             : Input Status : E(Error)/U(Unexception)/S(Success)</span></span><br><span class="line"><span class="comment">  History:</span></span><br><span class="line"><span class="comment">      1.00   2020-09-02  LIYIHUI   Creation</span></span><br><span class="line"><span class="comment">  ==================================================*/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> process_request(p_init_msg_list <span class="keyword">IN</span> VARCHAR2 <span class="keyword">DEFAULT</span> fnd_api.g_false,</span><br><span class="line">                            p_commit        <span class="keyword">IN</span> VARCHAR2 <span class="keyword">DEFAULT</span> fnd_api.g_false,</span><br><span class="line">                            x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                            x_msg_count     <span class="keyword">OUT</span> NOCOPY NUMBER,</span><br><span class="line">                            x_msg_data      <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;process_request&#x27;</span>;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;sp_process_request&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    x_return_status :<span class="operator">=</span> cux_api.start_activity(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                              p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                              p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                              p_init_msg_list  <span class="operator">=</span><span class="operator">&gt;</span> p_init_msg_list);</span><br><span class="line">    raise_exception(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-------------API body start</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 0.å…¨é‡åŒæ­¥</span></span><br><span class="line">    sp_sync_all(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 1.å‡­è¯åˆ†å½•åŒæ­¥</span></span><br><span class="line">    sp_vchrnum_lines(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                     x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                     x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 2.åº”ä»˜å‘ç¥¨å‡­è¯å¤´åŒæ­¥</span></span><br><span class="line">    sp_ap_invoice_headers(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                          x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                          x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 3.åº”ä»˜ä»˜æ¬¾å‡­è¯å¤´åŒæ­¥</span></span><br><span class="line">    sp_ap_payment_headers(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                          x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                          x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 4.åº”æ”¶å‘ç¥¨å‡­è¯å¤´åŒæ­¥</span></span><br><span class="line">    sp_ar_invoice_headers(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                          x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                          x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 5.åº”æ”¶æ”¶æ¬¾å‡­è¯å¤´åŒæ­¥</span></span><br><span class="line">    sp_ar_receipt_headers(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                          x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                          x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 6.æ›´æ–°æœ¬åœ°æ•°æ®é›†</span></span><br><span class="line">    update_local_data(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                      x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                      x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 7.æœŸåˆå‡­è¯åŒæ­¥</span></span><br><span class="line">    sp_nc_voucher(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                  x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                  x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 8.æ’å…¥æ•°æ®åˆ°ä¸­é—´åº“</span></span><br><span class="line">    sp_remote_data(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> x_return_status,</span><br><span class="line">                   x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                   x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-------------API body end</span></span><br><span class="line">  </span><br><span class="line">    x_return_status :<span class="operator">=</span> cux_api.end_activity(p_pkg_name  <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                            p_api_name  <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                            p_commit    <span class="operator">=</span><span class="operator">&gt;</span> p_commit,</span><br><span class="line">                                            x_msg_count <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                            x_msg_data  <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> fnd_api.g_exc_error <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> cux_api.handle_exceptions(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                                   p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                                   p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       <span class="operator">=</span><span class="operator">&gt;</span> cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                                   x_msg_data       <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    <span class="keyword">WHEN</span> fnd_api.g_exc_unexpected_error <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> cux_api.handle_exceptions(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                                   p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                                   p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       <span class="operator">=</span><span class="operator">&gt;</span> cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                                   x_msg_data       <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> cux_api.handle_exceptions(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                                                   p_api_name       <span class="operator">=</span><span class="operator">&gt;</span> l_api_name,</span><br><span class="line">                                                   p_savepoint_name <span class="operator">=</span><span class="operator">&gt;</span> l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       <span class="operator">=</span><span class="operator">&gt;</span> cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      <span class="operator">=</span><span class="operator">&gt;</span> x_msg_count,</span><br><span class="line">                                                   x_msg_data       <span class="operator">=</span><span class="operator">&gt;</span> x_msg_data);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">END</span> process_request;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*==================================================</span></span><br><span class="line"><span class="comment">  Procedure Name :</span></span><br><span class="line"><span class="comment">      main</span></span><br><span class="line"><span class="comment">  Description:</span></span><br><span class="line"><span class="comment">      This procedure perform to æŠ¥è¡¨ä¸»å‡½æ•°</span></span><br><span class="line"><span class="comment">  Argument:</span></span><br><span class="line"><span class="comment">      errbuf               : concurrent return message buffer</span></span><br><span class="line"><span class="comment">      retcode              : concurrent return status code</span></span><br><span class="line"><span class="comment">                             0 success / 1 warning / 2 error</span></span><br><span class="line"><span class="comment">      p_book_id         : è´¦ç°¿ID</span></span><br><span class="line"><span class="comment">      p_date_from       : æ—¥æœŸä»</span></span><br><span class="line"><span class="comment">      p_date_to         : è‡³</span></span><br><span class="line"><span class="comment">      p_item_from       : ç ”å‘é¡¹ç›®ä»</span></span><br><span class="line"><span class="comment">      p_item_to         : è‡³</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  History:</span></span><br><span class="line"><span class="comment">      1.00   2020-09-02  LIYIHUI   Creation</span></span><br><span class="line"><span class="comment">  ==================================================*/</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> main(errbuf <span class="keyword">OUT</span> VARCHAR2, retcode <span class="keyword">OUT</span> VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_return_status VARCHAR2(<span class="number">1</span>);</span><br><span class="line">    l_msg_count     NUMBER;</span><br><span class="line">    l_msg_data      VARCHAR2(<span class="number">4000</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">--output header</span></span><br><span class="line">    errbuf  :<span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    retcode :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line">    cux_conc_utl.log_header;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- å¤„ç†è¯·æ±‚</span></span><br><span class="line">    process_request(p_init_msg_list <span class="operator">=</span><span class="operator">&gt;</span> fnd_api.g_true,</span><br><span class="line">                    p_commit        <span class="operator">=</span><span class="operator">&gt;</span> fnd_api.g_false,</span><br><span class="line">                    x_return_status <span class="operator">=</span><span class="operator">&gt;</span> l_return_status,</span><br><span class="line">                    x_msg_count     <span class="operator">=</span><span class="operator">&gt;</span> l_msg_count,</span><br><span class="line">                    x_msg_data      <span class="operator">=</span><span class="operator">&gt;</span> l_msg_data);</span><br><span class="line">    raise_exception(l_return_status);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">--output foot</span></span><br><span class="line">    cux_conc_utl.log_footer;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> fnd_api.g_exc_error <span class="keyword">THEN</span></span><br><span class="line">      cux_conc_utl.log_message_list;</span><br><span class="line">      retcode :<span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">      fnd_msg_pub.count_and_get(p_encoded <span class="operator">=</span><span class="operator">&gt;</span> fnd_api.g_false,</span><br><span class="line">                                p_count   <span class="operator">=</span><span class="operator">&gt;</span> l_msg_count,</span><br><span class="line">                                p_data    <span class="operator">=</span><span class="operator">&gt;</span> l_msg_data);</span><br><span class="line">      IF l_msg_count <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">        l_msg_data :<span class="operator">=</span> fnd_msg_pub.get_detail(p_msg_index <span class="operator">=</span><span class="operator">&gt;</span> fnd_msg_pub.g_first,</span><br><span class="line">                                             p_encoded   <span class="operator">=</span><span class="operator">&gt;</span> fnd_api.g_false);</span><br><span class="line">      <span class="keyword">END</span> IF;</span><br><span class="line">      errbuf :<span class="operator">=</span> l_msg_data;</span><br><span class="line">    <span class="keyword">WHEN</span> fnd_api.g_exc_unexpected_error <span class="keyword">THEN</span></span><br><span class="line">      cux_conc_utl.log_message_list;</span><br><span class="line">      retcode :<span class="operator">=</span> <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">      fnd_msg_pub.count_and_get(p_encoded <span class="operator">=</span><span class="operator">&gt;</span> fnd_api.g_false,</span><br><span class="line">                                p_count   <span class="operator">=</span><span class="operator">&gt;</span> l_msg_count,</span><br><span class="line">                                p_data    <span class="operator">=</span><span class="operator">&gt;</span> l_msg_data);</span><br><span class="line">      IF l_msg_count <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">        l_msg_data :<span class="operator">=</span> fnd_msg_pub.get_detail(p_msg_index <span class="operator">=</span><span class="operator">&gt;</span> fnd_msg_pub.g_first,</span><br><span class="line">                                             p_encoded   <span class="operator">=</span><span class="operator">&gt;</span> fnd_api.g_false);</span><br><span class="line">      <span class="keyword">END</span> IF;</span><br><span class="line">      errbuf :<span class="operator">=</span> l_msg_data;</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      fnd_msg_pub.add_exc_msg(p_pkg_name       <span class="operator">=</span><span class="operator">&gt;</span> g_pkg_name,</span><br><span class="line">                              p_procedure_name <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;MAIN&#x27;</span>,</span><br><span class="line">                              p_error_text     <span class="operator">=</span><span class="operator">&gt;</span> substrb(SQLERRM, <span class="number">1</span>, <span class="number">240</span>));</span><br><span class="line">      cux_conc_utl.log_message_list;</span><br><span class="line">      retcode :<span class="operator">=</span> <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">      errbuf  :<span class="operator">=</span> SQLERRM;</span><br><span class="line">  <span class="keyword">END</span> main;</span><br><span class="line"><span class="keyword">END</span> gj_congl_voucher_sync_v2;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><h3 id="æŸ¥çœ‹å¼‚å¸¸"><a href="#æŸ¥çœ‹å¼‚å¸¸" class="headerlink" title="æŸ¥çœ‹å¼‚å¸¸"></a>æŸ¥çœ‹å¼‚å¸¸</h3><p>1.æŸ¥è¯¢è¡¨</p><blockquote><p>SELECT * FROM user_errors;</p></blockquote><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114110305-vsys3mo-image.png" alt="image.png"></p><p>2.SQL * Plus ç¯å¢ƒä¸­</p><blockquote><p>show errors;</p></blockquote><h3 id="æŸ¥çœ‹è­¦å‘Šä¿¡æ¯"><a href="#æŸ¥çœ‹è­¦å‘Šä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è­¦å‘Šä¿¡æ¯"></a>æŸ¥çœ‹è­¦å‘Šä¿¡æ¯</h3><p>PL &#x2F; SQL è­¦å‘Šçš„æ¶ˆæ¯ä»£ç çš„æ ¼å¼ä¸º PLW- nnnnn</p><h4 id="è­¦å‘Šä¿¡æ¯ç­‰çº§"><a href="#è­¦å‘Šä¿¡æ¯ç­‰çº§" class="headerlink" title="è­¦å‘Šä¿¡æ¯ç­‰çº§"></a>è­¦å‘Šä¿¡æ¯ç­‰çº§</h4><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114111226-ptev80c-image.png" alt="image.png"></p><h4 id="æŸ¥è¯¢è­¦å‘Šä¿¡æ¯ç­‰çº§"><a href="#æŸ¥è¯¢è­¦å‘Šä¿¡æ¯ç­‰çº§" class="headerlink" title="æŸ¥è¯¢è­¦å‘Šä¿¡æ¯ç­‰çº§"></a>æŸ¥è¯¢è­¦å‘Šä¿¡æ¯ç­‰çº§</h4><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114110436-cjr1nsx-image.png" alt="image.png"></p><p>å¯ä»¥é€šè¿‡ <code>alter system</code> ä¿®æ”¹æœåŠ¡å™¨å‚æ•°æ–‡ä»¶</p><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114110950-tv4vuix-image.png" alt="image.png"></p><p>å¯ä»¥é€šè¿‡ <code>alter session</code> ä¿®æ”¹å½“å‰ä¼šè¯</p><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114110909-34wb3zz-image.png" alt="image.png"></p><h4 id="ä¿®æ”¹å¼‚å¸¸ä¿¡æ¯"><a href="#ä¿®æ”¹å¼‚å¸¸ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹å¼‚å¸¸ä¿¡æ¯"></a>ä¿®æ”¹å¼‚å¸¸ä¿¡æ¯</h4><p>å¯ç”¨éƒ¨åˆ†</p><blockquote><p>Alter session set plsql_warnings&#x3D;â€™enable:performanceâ€™, â€˜enable:severeâ€™;</p></blockquote><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114111333-shvvs9p-image.png" alt="image.png"></p><p>å¯ç”¨å…¨éƒ¨</p><blockquote><p>Alter session set plsql_warnings&#x3D;â€™enable:allâ€™;</p></blockquote><p>é’ˆå¯¹è¿‡ç¨‹&#x2F;å‡½æ•°å¯ç”¨ç¼–è¯‘è­¦å‘Š</p><blockquote><p>alter package gj_bc_vld_data_utl compile plsql_warnings &#x3D; â€˜enable:allâ€™;</p></blockquote><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114112359-krrpg5r-image.png" alt="image.png"></p><p>ç¼–è¾‘è­¦å‘Š</p><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210114112826-lh12olm-image.png" alt="image.png"></p><h3 id="å¼‚å¸¸å¤„ç†å‡†åˆ™"><a href="#å¼‚å¸¸å¤„ç†å‡†åˆ™" class="headerlink" title="å¼‚å¸¸å¤„ç†å‡†åˆ™"></a>å¼‚å¸¸å¤„ç†å‡†åˆ™</h3><ol><li>å°½å¯èƒ½ç¼–å†™å‘½åå¼‚å¸¸çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè€Œä¸è¦ä½¿ç”¨ <code>OTHERS</code> å¼‚å¸¸å¤„ç†ç¨‹åºã€‚</li><li>å¯¹äºæ¯ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè¯·ä»”ç»†å†³å®šæ˜¯è®©å®ƒæäº¤äº‹åŠ¡ï¼Œå›æ»šå®ƒè¿˜æ˜¯è®©å®ƒç»§ç»­ã€‚</li><li>æ¯ä¸ª PL &#x2F; SQL ç¨‹åºçš„é¡¶å±‚éƒ½åŒ…å«ä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œé¿å…æœªå¤„ç†çš„å¼‚å¸¸ã€‚å¹¶ä¸”åœ¨å­ç¨‹åºä¸­æ˜¾ç¤ºæŠ›å‡ºå¼‚å¸¸<code>RAISE</code> æˆ–åœ¨ <code>RAISE_APPLICATION_ERROR</code>ã€‚</li></ol><h3 id="å¼‚å¸¸å®ä¾‹"><a href="#å¼‚å¸¸å®ä¾‹" class="headerlink" title="å¼‚å¸¸å®ä¾‹"></a>å¼‚å¸¸å®ä¾‹</h3><p>1.è‡ªå®šä¹‰å¼‚å¸¸å®ä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> account_status (</span><br><span class="line">  due_date <span class="type">DATE</span>,</span><br><span class="line">  today    <span class="type">DATE</span></span><br><span class="line">) AUTHID DEFINER</span><br><span class="line"><span class="keyword">IS</span></span><br><span class="line">  past_due  EXCEPTION;  <span class="comment">-- declare exception</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  IF due_date <span class="operator">&lt;</span> today <span class="keyword">THEN</span></span><br><span class="line">    RAISE past_due;  <span class="comment">-- explicitly raise exception</span></span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line">EXCEPTION</span><br><span class="line">  <span class="keyword">WHEN</span> past_due <span class="keyword">THEN</span>  <span class="comment">-- handle exception</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE (<span class="string">&#x27;Account past due.&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  account_status (TO_DATE(<span class="string">&#x27;01-JUL-2010&#x27;</span>, <span class="string">&#x27;DD-MON-YYYY&#x27;</span>),</span><br><span class="line">                  TO_DATE(<span class="string">&#x27;09-JUL-2010&#x27;</span>, <span class="string">&#x27;DD-MON-YYYY&#x27;</span>));</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>2.ä½¿ç”¨<code>RAISE_APPLICATION_ERROR</code>è‡ªå®šä¹‰å¼‚å¸¸å®ä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> account_status (</span><br><span class="line">  due_date <span class="type">DATE</span>,</span><br><span class="line">  today    <span class="type">DATE</span></span><br><span class="line">) AUTHID DEFINER</span><br><span class="line"><span class="keyword">IS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  IF due_date <span class="operator">&lt;</span> today <span class="keyword">THEN</span>                   <span class="comment">-- explicitly raise exception</span></span><br><span class="line">    RAISE_APPLICATION_ERROR(<span class="number">-20000</span>, <span class="string">&#x27;Account past due.&#x27;</span>);</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  past_due  EXCEPTION;                       <span class="comment">-- declare exception</span></span><br><span class="line">  PRAGMA EXCEPTION_INIT (past_due, <span class="number">-20000</span>);  <span class="comment">-- assign error code to exception</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  account_status (TO_DATE(<span class="string">&#x27;01-JUL-2010&#x27;</span>, <span class="string">&#x27;DD-MON-YYYY&#x27;</span>),</span><br><span class="line">                  TO_DATE(<span class="string">&#x27;09-JUL-2010&#x27;</span>, <span class="string">&#x27;DD-MON-YYYY&#x27;</span>));   <span class="comment">-- invoke procedure</span></span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">  <span class="keyword">WHEN</span> past_due <span class="keyword">THEN</span>                         <span class="comment">-- handle exception</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(TO_CHAR(SQLERRM(<span class="number">-20000</span>)));</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>å®éªŒï¼šæ•°æ®åŒæ­¥æ¥å£ä¸ºä¾‹</p><p>packageå®šä¹‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE gj_inter_company_sync <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : è¾“å‡ºè¿è¡Œæ—¥å¿—</span></span><br><span class="line"><span class="comment">  * @Param   : p_api_name å‡½æ•°/è¿‡ç¨‹åç§°</span></span><br><span class="line"><span class="comment">  * @Param   : p_api_name æ—¥å¿—ç­‰çº§ info/debug/error</span></span><br><span class="line"><span class="comment">  * @Param   : p_log_status æ—¥å¿—çŠ¶æ€ start/end</span></span><br><span class="line"><span class="comment">  * @Param   : p_message æ—¥å¿—æ¶ˆæ¯ </span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35 </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> <span class="built_in">log</span>(p_api_name   <span class="keyword">IN</span> VARCHAR2,</span><br><span class="line">                p_log_level  <span class="keyword">IN</span> VARCHAR2,</span><br><span class="line">                p_log_status <span class="keyword">IN</span> VARCHAR2,</span><br><span class="line">                p_message    <span class="keyword">IN</span> VARCHAR2);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : è‡ªåŠ¨æ ¹æ®å¿«ç GJ_INTER_COMPANYæ›´æ–°åˆ°å®¢å•†å¼¹æ€§åŸŸä¸­</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> process_flex_sync(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                              x_return_msg    <span class="keyword">OUT</span> NOCOPY VARCHAR2);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @Author  : KALOSORA</span></span><br><span class="line"><span class="comment">  * @Purpose : ç¨‹åºå…¥å£</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„å‚æ•°çŠ¶æ€</span></span><br><span class="line"><span class="comment">  * @Param   ï¼šx_return_status è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  * @Version : 1.0</span></span><br><span class="line"><span class="comment">  * @Since   : 2021/1/19 9:12:35</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> main(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                 x_return_msg    <span class="keyword">OUT</span> NOCOPY VARCHAR2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> gj_inter_company_sync;</span><br></pre></td></tr></table></figure><p>packageå†…å®¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE BODY gj_inter_company_sync <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- ==========================================================</span></span><br><span class="line">  <span class="comment">-- æ—¥å¿—å‚æ•°</span></span><br><span class="line">  g_conc_request_id NUMBER :<span class="operator">=</span> fnd_global.conc_request_id;</span><br><span class="line">  g_log_info        VARCHAR2(<span class="number">6</span>) :<span class="operator">=</span> <span class="string">&#x27;INFO&#x27;</span>;</span><br><span class="line">  g_log_error       VARCHAR2(<span class="number">6</span>) :<span class="operator">=</span> <span class="string">&#x27;ERROR&#x27;</span>;</span><br><span class="line">  g_log_start       VARCHAR2(<span class="number">6</span>) :<span class="operator">=</span> <span class="string">&#x27;START&#x27;</span>;</span><br><span class="line">  g_log_end         VARCHAR2(<span class="number">6</span>) :<span class="operator">=</span> <span class="string">&#x27;END&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- è‡ªå®šä¹‰åº”ç”¨å¼‚å¸¸</span></span><br><span class="line">  APP_UNKNOWN_EXCEPTION EXCEPTION;</span><br><span class="line">  PRAGMA EXCEPTION_INIT(APP_UNKNOWN_EXCEPTION, <span class="number">-20000</span>);</span><br><span class="line">  <span class="comment">-- ==========================================================</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">PROCEDURE</span> <span class="built_in">log</span>(p_api_name   <span class="keyword">IN</span> VARCHAR2,</span><br><span class="line">                p_log_level  <span class="keyword">IN</span> VARCHAR2,</span><br><span class="line">                p_log_status <span class="keyword">IN</span> VARCHAR2,</span><br><span class="line">                p_message    <span class="keyword">IN</span> VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    IF g_conc_request_id <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      fnd_file.PUT_LINE(fnd_file.LOG,</span><br><span class="line">                        <span class="string">&#x27;[&#x27;</span> <span class="operator">||</span> p_api_name <span class="operator">||</span> <span class="string">&#x27;] &#x27;</span> <span class="operator">||</span> p_log_level <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                        to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                        p_log_status <span class="operator">||</span> <span class="string">&#x27; - &#x27;</span> <span class="operator">||</span> p_message);</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;[&#x27;</span> <span class="operator">||</span> p_api_name <span class="operator">||</span> <span class="string">&#x27;] &#x27;</span> <span class="operator">||</span> p_log_level <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                           to_char(SYSDATE, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span></span><br><span class="line">                           p_log_status <span class="operator">||</span> <span class="string">&#x27; - &#x27;</span> <span class="operator">||</span> p_message);</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">PROCEDURE</span> process_flex_sync(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                              x_return_msg    <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_api_name VARCHAR2(<span class="number">30</span>) :<span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;process_flex_sync&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_vendor <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> flv.LOOKUP_CODE, company.id, company.inter_company</span><br><span class="line">        <span class="keyword">FROM</span> fnd_lookup_values flv,</span><br><span class="line">             (<span class="keyword">SELECT</span> pv.vendor_id   ID,</span><br><span class="line">                     pv.vendor_name company_name,</span><br><span class="line">                     pv.attribute2  inter_company</span><br><span class="line">                <span class="keyword">FROM</span> po_vendors pv</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> pv.attribute2 <span class="keyword">IS</span> <span class="keyword">NULL</span>) company</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> company.company_name <span class="operator">=</span> flv.DESCRIPTION</span><br><span class="line">         <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_COMPANY&#x27;</span></span><br><span class="line">         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CURSOR</span> cur_customer <span class="keyword">IS</span></span><br><span class="line">      <span class="keyword">SELECT</span> flv.LOOKUP_CODE, company.id, company.inter_company</span><br><span class="line">        <span class="keyword">FROM</span> fnd_lookup_values flv,</span><br><span class="line">             (<span class="keyword">SELECT</span> hca.CUST_ACCOUNT_ID ID,</span><br><span class="line">                     hp.party_name       company_name,</span><br><span class="line">                     hca.ATTRIBUTE5      inter_company</span><br><span class="line">                <span class="keyword">FROM</span> hz_parties hp, hz_cust_accounts hca</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> hp.PARTY_ID <span class="operator">=</span> hca.PARTY_ID</span><br><span class="line">                 <span class="keyword">AND</span> hca.ATTRIBUTE5 <span class="keyword">IS</span> <span class="keyword">NULL</span>) company</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> company.company_name <span class="operator">=</span> flv.DESCRIPTION</span><br><span class="line">         <span class="keyword">AND</span> flv.LOOKUP_TYPE <span class="operator">=</span> <span class="string">&#x27;GJ_INTER_COMPANY&#x27;</span></span><br><span class="line">         <span class="keyword">AND</span> flv.LANGUAGE <span class="operator">=</span> <span class="string">&#x27;ZHS&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">  </span><br><span class="line">    <span class="built_in">log</span>(l_api_name, g_log_info, g_log_start, <span class="keyword">NULL</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 1. æ›´æ–°ä¾›åº”å•†å¼¹æ€§åŸŸ</span></span><br><span class="line">    <span class="keyword">FOR</span> rec_vendor <span class="keyword">IN</span> cur_vendor LOOP</span><br><span class="line">      <span class="keyword">UPDATE</span> po_vendors</span><br><span class="line">         <span class="keyword">SET</span> attribute2 <span class="operator">=</span> rec_vendor.LOOKUP_CODE</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> vendor_id <span class="operator">=</span> rec_vendor.id;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- 2. æ›´æ–°å®¢æˆ·å¼¹æ€§åŸŸ</span></span><br><span class="line">    <span class="keyword">FOR</span> rec_customer <span class="keyword">IN</span> cur_customer LOOP</span><br><span class="line">      <span class="keyword">UPDATE</span> hz_cust_accounts</span><br><span class="line">         <span class="keyword">SET</span> attribute5 <span class="operator">=</span> rec_customer.LOOKUP_CODE</span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> CUST_ACCOUNT_ID <span class="operator">=</span> rec_customer.id;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">log</span>(l_api_name, g_log_info, g_log_end, <span class="keyword">NULL</span>);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      x_return_status :<span class="operator">=</span> SQLCODE;</span><br><span class="line">      x_return_msg    :<span class="operator">=</span> SQLERRM <span class="operator">||</span> dbms_utility.format_error_backtrace;</span><br><span class="line">      <span class="built_in">log</span>(l_api_name, g_log_error, g_log_end, x_return_msg);</span><br><span class="line">      RAISE APP_UNKNOWN_EXCEPTION;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">PROCEDURE</span> main(x_return_status <span class="keyword">OUT</span> NOCOPY VARCHAR2,</span><br><span class="line">                 x_return_msg    <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">IS</span></span><br><span class="line">    l_return_status VARCHAR2(<span class="number">10</span>);</span><br><span class="line">    l_return_msg    VARCHAR2(<span class="number">4000</span>);</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- æ—¥å¿—å¼€å§‹</span></span><br><span class="line">    cux_conc_utl.log_header;</span><br><span class="line">  </span><br><span class="line">    process_flex_sync(x_return_status <span class="operator">=</span><span class="operator">&gt;</span> l_return_status,</span><br><span class="line">                      x_return_msg    <span class="operator">=</span><span class="operator">&gt;</span> l_return_msg);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">-- æ—¥å¿—ç»“æŸ</span></span><br><span class="line">    cux_conc_utl.log_footer;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> gj_inter_company_sync;</span><br></pre></td></tr></table></figure><p>4.å¼‚å¸¸äº‹åŠ¡å¤„ç†</p><p>ä½¿ç”¨ <code>SAVEPOINT start_transaction;</code> è®°å½•ä¿å­˜ç‚¹</p><p>ä½¿ç”¨ <code>rollback to [savepoint_name]</code> å›æ»šä¿å­˜ç‚¹</p><p>ã€æ³¨æ„ã€‘åœ¨ä½¿ç”¨savepointæœŸé—´ä¸èƒ½ä¸»åŠ¨ <code>commit</code> ï¼Œå¦åˆ™ä¿å­˜ç‚¹ä¼šæ¶ˆå¤±</p><h2 id="æ¡ä»¶ç¼–è¯‘"><a href="#æ¡ä»¶ç¼–è¯‘" class="headerlink" title="æ¡ä»¶ç¼–è¯‘"></a>æ¡ä»¶ç¼–è¯‘</h2><p>å¯ä»¥æ ¹æ®ä¸åŒçš„åˆ¤æ–­æ¡ä»¶ï¼Œç¼–è¯‘&#x2F;æ‰§è¡Œä¸åŒçš„ç¨‹åº</p><p>è¯­æ³• <code>$plsqlæ ‡è¯†ç¬¦</code>ã€‚æ³¨æ„<code>$</code>å’Œæ ‡è¯†ç¬¦ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼</p><p>å®ä¾‹ï¼šè¾“å‡ºplsqlç¯å¢ƒå‚æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;$$PLSCOPE_SETTINGS = &#x27;</span>     <span class="operator">||</span> $$PLSCOPE_SETTINGS);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;$$PLSQL_CCFLAGS = &#x27;</span>        <span class="operator">||</span> $$PLSQL_CCFLAGS);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;$$PLSQL_CODE_TYPE = &#x27;</span>      <span class="operator">||</span> $$PLSQL_CODE_TYPE);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;$$PLSQL_OPTIMIZE_LEVEL = &#x27;</span> <span class="operator">||</span> $$PLSQL_OPTIMIZE_LEVEL);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;$$PLSQL_WARNINGS = &#x27;</span>       <span class="operator">||</span> $$PLSQL_WARNINGS);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;$$NLS_LENGTH_SEMANTICS = &#x27;</span> <span class="operator">||</span> $$NLS_LENGTH_SEMANTICS);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>å®ä¾‹2ï¼šæ ¹æ®æ•°æ®åº“ç‰ˆæœ¬æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  $IF DBMS_DB_VERSION.VER_LE_10_1 $<span class="keyword">THEN</span>  <span class="comment">-- selection directive begins</span></span><br><span class="line">    $ERROR <span class="string">&#x27;unsupported database release&#x27;</span> $<span class="keyword">END</span>  <span class="comment">-- error directive</span></span><br><span class="line">  $<span class="keyword">ELSE</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE (</span><br><span class="line">      <span class="string">&#x27;Release &#x27;</span> <span class="operator">||</span> DBMS_DB_VERSION.VERSION <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span></span><br><span class="line">      DBMS_DB_VERSION.RELEASE <span class="operator">||</span> <span class="string">&#x27; is supported.&#x27;</span></span><br><span class="line">    );</span><br><span class="line">  <span class="comment">-- This COMMIT syntax is newly supported in 10.2:</span></span><br><span class="line">  <span class="keyword">COMMIT</span> WRITE IMMEDIATE NOWAIT;</span><br><span class="line">  $<span class="keyword">END</span>  <span class="comment">-- selection directive ends</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ç¯å¢ƒå˜é‡</p><p>å¯ä»¥é€šè¿‡ <code>$$[å‚æ•°åç§°]</code> ä»£æ›¿åœ¨sqlå‘½ä»¤çª—å£ä¸­çš„ <code>show parameter [å‚æ•°åç§°]</code>ï¼Œä»¥è¾¾åˆ°åœ¨plsqlå¼€å‘å·¥å…·ä¸­æŸ¥çœ‹æœåŠ¡å™¨å‚æ•°çš„æ•ˆæœ</p><ul><li><code>$$PLSQL_LINE</code>ï¼šè·å–å½“å‰package&#x2F;functionçš„è¡Œå·</li><li><code>$$PLSQL_UNIT</code>ï¼šè·å–å½“å‰ç¨‹åºåç§°</li><li><code>$$PLSQL_UNIT_OWNER</code>ï¼šè·å–å½“å‰ç¨‹åºowner</li><li><code>$$PLSQL_UNIT_TYPE</code>ï¼šè·å–å½“å‰ç¨‹åºç±»å‹</li></ul><h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><p>ç”¨åˆ°çš„æ—¶å€™å†æ¥æ€»ç»“</p><blockquote><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/adfns/regexp.html#GUID-1935FD80-A3CD-413F-BD2E-BBEFE64000B2">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/adfns/regexp.html#GUID-1935FD80-A3CD-413F-BD2E-BBEFE64000B2</a></p></blockquote><h2 id="æ•°æ®åº“é”"><a href="#æ•°æ®åº“é”" class="headerlink" title="æ•°æ®åº“é”"></a>æ•°æ®åº“é”</h2><p>åŒä¸Š</p><h2 id="é—ªå›æŠ€æœ¯"><a href="#é—ªå›æŠ€æœ¯" class="headerlink" title="é—ªå›æŠ€æœ¯"></a>é—ªå›æŠ€æœ¯</h2><p><strong>Oracle Flashback</strong></p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>æŸ¥è¯¢å®ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">OF</span> <span class="type">TIMESTAMP</span></span><br><span class="line">TO_TIMESTAMP(<span class="string">&#x27;2004-04-04 09:30:00&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD HH:MI:SS&#x27;</span>)</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Chung&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ•°æ®æ¢å¤å®ä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">AS</span> <span class="keyword">OF</span> <span class="type">TIMESTAMP</span></span><br><span class="line">  TO_TIMESTAMP(<span class="string">&#x27;2004-04-04 09:30:00&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD HH:MI:SS&#x27;</span>)</span><br><span class="line">  <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Chung&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>é—ªå›äº‹åŠ¡</p><blockquote><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/adfns/flashback.html#GUID-03D1CAAE-D940-444A-8771-B1BC636D105D">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/adfns/flashback.html#GUID-03D1CAAE-D940-444A-8771-B1BC636D105D</a></p></blockquote><h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><p><strong>Oracle AQ</strong></p><p>â€</p><h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><h2 id="ç”¨äºç®¡ç†PLSQLçš„è¡¨"><a href="#ç”¨äºç®¡ç†PLSQLçš„è¡¨" class="headerlink" title="ç”¨äºç®¡ç†PLSQLçš„è¡¨"></a>ç”¨äºç®¡ç†PLSQLçš„è¡¨</h2><p><img src="/2021/01/14/Oracle%E9%AB%98%E7%BA%A7SQL/20210121130638-toyvo67-image.png" alt="image.png"></p><h2 id="ç¼–ç¨‹è§„èŒƒ"><a href="#ç¼–ç¨‹è§„èŒƒ" class="headerlink" title="ç¼–ç¨‹è§„èŒƒ"></a>ç¼–ç¨‹è§„èŒƒ</h2><h4 id="æ­£ç¡®åœ°ä½¿ç”¨æ•°æ®ç±»å‹"><a href="#æ­£ç¡®åœ°ä½¿ç”¨æ•°æ®ç±»å‹" class="headerlink" title="æ­£ç¡®åœ°ä½¿ç”¨æ•°æ®ç±»å‹"></a>æ­£ç¡®åœ°ä½¿ç”¨æ•°æ®ç±»å‹</h4><p>å°½å¯èƒ½ç²¾ç¡®åœ°æŒ‡å®šæ•°æ®ç±»å‹</p><ul><li>æ•´æ•°æ—¶æŒ‡å®šNUMBER(n)ï¼Œè€Œä¸è¦ä½¿ç”¨NUMBERã€‚</li><li>VARCHAR2(n)çš„ç²¾åº¦å°½å¯èƒ½å‡†ç¡®ã€‚</li></ul><h2 id="å®˜æ–¹å‚è€ƒæ‰‹å†Œ"><a href="#å®˜æ–¹å‚è€ƒæ‰‹å†Œ" class="headerlink" title="å®˜æ–¹å‚è€ƒæ‰‹å†Œ"></a>å®˜æ–¹å‚è€ƒæ‰‹å†Œ</h2><p>1.SQLè¯­è¨€å‚è€ƒæ‰‹å†Œï¼Œå³<code>SQL Language Reference</code></p><blockquote><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/lnpls/dynamic-sql.html#GUID-7E2F596F-9CA3-4DC8-8333-0C117962DB73">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/lnpls/dynamic-sql.html#GUID-7E2F596F-9CA3-4DC8-8333-0C117962DB73</a></p></blockquote><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracleæ€§èƒ½åˆ†æå·¥å…·</title>
      <link href="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/"/>
      <url>/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="Oracleæ€§èƒ½åˆ†æå·¥å…·"><a href="#Oracleæ€§èƒ½åˆ†æå·¥å…·" class="headerlink" title="Oracleæ€§èƒ½åˆ†æå·¥å…·"></a>Oracleæ€§èƒ½åˆ†æå·¥å…·</h1><p>â€</p><h2 id="PL-SQLè·Ÿè¸ª"><a href="#PL-SQLè·Ÿè¸ª" class="headerlink" title="PL&#x2F;SQLè·Ÿè¸ª"></a>PL&#x2F;SQLè·Ÿè¸ª</h2><p><strong>PL&#x2F;SQL Hierarchical Profiler (HPROF)</strong></p><h3 id="HPROFå®ä¾‹"><a href="#HPROFå®ä¾‹" class="headerlink" title="HPROFå®ä¾‹"></a>HPROFå®ä¾‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 0. åœ¨ftpä¸Šåˆ›å»ºç›®å½•ï¼Œæˆ–é¦–å…ˆç¡®ä¿ç›®å½•å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. åˆ›å»ºç›®å½•å®šä¹‰</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE DIRECTORY PLSHPROF_DIR <span class="keyword">as</span> <span class="string">&#x27;/home/oratest&#x27;</span>;</span><br><span class="line"><span class="comment">-- æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰æƒé™ï¼Œå¯èƒ½éœ€è¦æˆæƒ</span></span><br><span class="line"><span class="keyword">GRANT</span> READ, WRITE <span class="keyword">ON</span> DIRECTORY PLSHPROF_DIR <span class="keyword">TO</span> APPS;</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  DBMS_HPROF.START_PROFILING(<span class="string">&#x27;PLSHPROF_DIR&#x27;</span>, <span class="string">&#x27;gjhprof_test_210121.trc&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_return_status VARCHAR2(<span class="number">1</span>);</span><br><span class="line">  l_msg_data      VARCHAR2(<span class="number">4000</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  gj_congl_voucher_sync_test.main(errbuf  <span class="operator">=</span><span class="operator">&gt;</span> l_return_status,</span><br><span class="line">                                  retcode <span class="operator">=</span><span class="operator">&gt;</span> l_msg_data);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- Stop profiling</span></span><br><span class="line">  DBMS_HPROF.STOP_PROFILING;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶è¾“å‡ºï¼š</p><p><img src="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/20210121135255-jik6qlq-image.png" alt="image.png"></p><p>ä»PLHPROFä¸­ç”Ÿæˆçš„æ˜¯plsqlè™šæ‹Ÿæœºæºä»£ç ï¼Œéš¾ä»¥è¯»æ‡‚ï¼Œä¸€èˆ¬ä¼šå†æ¬¡ä½¿ç”¨<strong>åˆ†æå™¨</strong>è½¬åŒ–æˆæ˜“è¯»çš„æ•°æ®ã€‚</p><p>ä»¥ä¸‹ä¸ºPLHPROFç”Ÿæˆçš„éƒ¨åˆ†æºä»£ç </p><p><img src="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/20210121140215-011boo9-image.png" alt="image.png"></p><p>â€</p><h3 id="ä½¿ç”¨åˆ†æå™¨"><a href="#ä½¿ç”¨åˆ†æå™¨" class="headerlink" title="ä½¿ç”¨åˆ†æå™¨"></a>ä½¿ç”¨åˆ†æå™¨</h3><p>ä¸¤ç§æ–¹å¼</p><ul><li>ç¬¬ä¸€ç§ï¼šhprofæ ¼å¼åŒ–å‘½ä»¤</li><li>ç¬¬äºŒå¼ ï¼šä½¿ç”¨<code>dbmshptab.sql</code></li></ul><h4 id="hprofæ ¼å¼åŒ–"><a href="#hprofæ ¼å¼åŒ–" class="headerlink" title="hprofæ ¼å¼åŒ–"></a>hprofæ ¼å¼åŒ–</h4><p>å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plshprof -output gjhprof_test_210121 gjhprof_test_210121.trc</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><p><img src="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/20210121144414-djmcyku-image.png" alt="image.png"></p><p>åˆ†ææŠ¥è¡¨</p><p><img src="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/20210121144436-huv3p6c-image.png" alt="image.png"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li>å®šä¹‰è·Ÿè¸ªæ–‡ä»¶ç›®å½•å¹¶æˆæƒ</li><li>å¼€å¯PLSQLç¨‹åºè·Ÿè¸ª</li><li>æ ¼å¼åŒ–æŠ¥å‘Š</li></ol><p>â€</p><h2 id="SQLè·Ÿè¸ª"><a href="#SQLè·Ÿè¸ª" class="headerlink" title="SQLè·Ÿè¸ª"></a>SQLè·Ÿè¸ª</h2><p><strong>ORACLE SQL TRACE (10046)</strong></p><p>â€</p><h3 id="è·Ÿè¸ªæ–‡ä»¶æ‰€åœ¨ä½ç½®"><a href="#è·Ÿè¸ªæ–‡ä»¶æ‰€åœ¨ä½ç½®" class="headerlink" title="è·Ÿè¸ªæ–‡ä»¶æ‰€åœ¨ä½ç½®"></a>è·Ÿè¸ªæ–‡ä»¶æ‰€åœ¨ä½ç½®</h3><p>æ–¹æ³•1ï¼šç™»é™†åˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼ŒæŸ¥æ‰¾æ—¥å¿—æ–‡ä»¶ <code>alert_PROD.log</code> çš„ç›®å½•ï¼Œå³ä¸ºtraceæ–‡ä»¶æ‰€åœ¨ç›®å½•</p><p>æ–¹æ³•2ï¼šé€šè¿‡å‘½ä»¤ <code>show parameter user_dump_dest;</code> å¯ä»¥çœ‹åˆ°æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ä½ç½®ã€‚ä¸é€‚ç”¨äºä¿®æ”¹è¿‡è·¯å¾„çš„æƒ…å†µã€‚</p><p>ä¸€èˆ¬è·¯å¾„å</p><blockquote><p>&#x2F;u01&#x2F;test&#x2F;db&#x2F;12.1.0&#x2F;admin&#x2F;TEST_erp1&#x2F;diag&#x2F;rdbms&#x2F;test&#x2F;TEST&#x2F;trace</p></blockquote><p>ä¸€èˆ¬æ ¼å¼</p><blockquote><p>$ORACLE_HOME&#x2F;admin&#x2F;TEST_erp1&#x2F;diag&#x2F;rdbms&#x2F;test&#x2F;TEST&#x2F;trace</p></blockquote><p>æ–¹æ³•3ï¼šæŸ¥çœ‹å½“å‰sessionç”Ÿæˆçš„traceæ–‡ä»¶åï¼Œç„¶ååˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸­æœç´¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> æŸ¥æ‰¾traceæ–‡ä»¶å</span><br><span class="line"><span class="keyword">SELECT</span> c.value <span class="operator">||</span> <span class="string">&#x27;/&#x27;</span> <span class="operator">||</span> d.instance_name <span class="operator">||</span> <span class="string">&#x27;_ora_&#x27;</span> <span class="operator">||</span> a.spid <span class="operator">||</span> <span class="string">&#x27;.trc&#x27;</span> trace</span><br><span class="line">  <span class="keyword">FROM</span> v$process a, v$session b, v$<span class="keyword">parameter</span> c, v$instance d</span><br><span class="line"> <span class="keyword">WHERE</span> a.addr <span class="operator">=</span> b.paddr</span><br><span class="line">   <span class="keyword">AND</span> b.audsid <span class="operator">=</span> userenv(<span class="string">&#x27;sessionid&#x27;</span>)</span><br><span class="line">   <span class="keyword">AND</span> c.name <span class="operator">=</span> <span class="string">&#x27;user_dump_dest&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼šåç¼€åä¸ºæ‰€æ±‚ï¼Œè·¯å¾„éƒ¨åˆ†ä¸ä¸€å®šå‡†ç¡®</p><p><img src="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/20210113093245-h2p2nlg-image.png" alt="image.png"></p><p>æ–¹æ³•4ï¼šå¯¹plsqlè¿›è¡Œè·Ÿè¸ª</p><p>sidå’Œserialå¯ä»¥ä»v$sessionä¸­è·å–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span> dbms_system.set_sql_trace_in_session(sidï¼Œserial#,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p><img src="/2021/01/13/Oracle%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/20210113095225-xvmw0r6-image.png" alt="image.png"></p><p>æ‰§è¡Œå®Œæ¯•å­˜å‚¨è¿‡ç¨‹å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span> dbms_system.set_sql_trace_in_session(sidï¼Œserial#,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å¯ç”¨è·Ÿè¸ª"><a href="#å¯ç”¨è·Ÿè¸ª" class="headerlink" title="å¯ç”¨è·Ÿè¸ª"></a>å¯ç”¨è·Ÿè¸ª</h3><p>ã€æ³¨æ„ã€‘è¿™é‡Œä»…ä¿®æ”¹å½“å‰ä¼šè¯è®¾ç½®</p><p>å¼€å¯è·Ÿè¸ª</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> sql_trace <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> timed_statistics <span class="operator">=</span> <span class="literal">true</span>;  <span class="operator">/</span><span class="operator">/</span>åŒæ­¥æ‰“å¼€è®¡æ—¶ä¿¡æ¯(å¯é€‰)</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œsqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> gd.iface_id,</span><br><span class="line">       gd.source_txn_id,</span><br><span class="line">       gd.po_header_id,</span><br><span class="line">       gd.po_line_id,</span><br><span class="line">       pll.line_location_id,</span><br><span class="line">       pll.receiving_routing_id,</span><br><span class="line">       pda.po_distribution_id,</span><br><span class="line">       gd.vendor_id,</span><br><span class="line">       gd.vendor_site_id,</span><br><span class="line">       gd.shipment_header_id,</span><br><span class="line">       gd.shipment_line_id,</span><br><span class="line">       gd.organization_id,</span><br><span class="line">       gd.quantity,</span><br><span class="line">       gd.item_id,</span><br><span class="line">       gd.lot_number,</span><br><span class="line">       gd.subinventory_code,</span><br><span class="line">       gd.locator_id,</span><br><span class="line">       gd.process_date,</span><br><span class="line">       pha.org_id,</span><br><span class="line">       gd.created_by</span><br><span class="line">  <span class="keyword">FROM</span> gj_bc_po_deliver_iface gd,</span><br><span class="line">       po_headers_all         pha,</span><br><span class="line">       po_lines_all           pla,</span><br><span class="line">       po_line_locations_all  pll,</span><br><span class="line">       po_distributions_all   pda</span><br><span class="line"> <span class="keyword">WHERE</span> gd.po_header_id <span class="operator">=</span> pha.po_header_id</span><br><span class="line">   <span class="keyword">AND</span> pha.po_header_id <span class="operator">=</span> pla.po_header_id</span><br><span class="line">   <span class="keyword">AND</span> pla.po_line_id <span class="operator">=</span> pll.po_line_id</span><br><span class="line">   <span class="keyword">AND</span> gd.po_line_id <span class="operator">=</span> pla.po_line_id</span><br><span class="line">   <span class="keyword">AND</span> gd.po_line_location_id <span class="operator">=</span> pll.line_location_id</span><br><span class="line">   <span class="keyword">AND</span> pll.line_location_id <span class="operator">=</span> pda.line_location_id</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> gd.po_header_id;</span><br></pre></td></tr></table></figure><p>å…³é—­sqlè·Ÿè¸ª</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> sql_trace <span class="operator">=</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ ¼å¼åŒ–è·Ÿè¸ªæ–‡ä»¶"><a href="#æ ¼å¼åŒ–è·Ÿè¸ªæ–‡ä»¶" class="headerlink" title="æ ¼å¼åŒ–è·Ÿè¸ªæ–‡ä»¶"></a>æ ¼å¼åŒ–è·Ÿè¸ªæ–‡ä»¶</h3><p>ä½¿ç”¨cpå‘½ä»¤å¤åˆ¶åˆ°æ ¹ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /u01/test/db/12.1.0/admin/TEST_erp1/diag/rdbms/test/TEST/trace/TEST_ora_31641.trc /home/oratest</span><br></pre></td></tr></table></figure><p>æ ¼å¼åŒ–è·Ÿè¸ªæ–‡ä»¶</p><p>ä½¿ç”¨tkprofå‘½ä»¤ï¼Œå¦‚æœè¦æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œéœ€è¦æä¾›å¯ä»¥è¿æ¥åˆ°æ•°æ®åº“çš„è´¦å·å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tkprof TEST_ora_31641.trc TEST_ora_31641.txt explain=apps/apps aggregate=<span class="built_in">yes</span> sys=no waits=<span class="built_in">yes</span> <span class="built_in">sort</span>=fchela</span><br></pre></td></tr></table></figure><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracleæ•°æ®åº“ç®¡ç†</title>
      <link href="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/"/>
      <url>/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Oracleæ•°æ®åº“ç®¡ç†"><a href="#Oracleæ•°æ®åº“ç®¡ç†" class="headerlink" title="Oracleæ•°æ®åº“ç®¡ç†"></a>Oracleæ•°æ®åº“ç®¡ç†</h1><h2 id="ç‰ˆæœ¬é€‚ç”¨èŒƒå›´"><a href="#ç‰ˆæœ¬é€‚ç”¨èŒƒå›´" class="headerlink" title="ç‰ˆæœ¬é€‚ç”¨èŒƒå›´"></a>ç‰ˆæœ¬é€‚ç”¨èŒƒå›´</h2><p>Oracle 12.2</p><h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>é€šè¿‡setenvæˆ–è€…exportè®¾ç½®ORACLE_HOMEå’ŒORACLE_SID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setenv ORACLE_SID orcl</span><br><span class="line">setenv ORACLE_HOME /u01/app/oracle/product/12.1.0/db_1</span><br><span class="line">setenv LD_LIBRARY_PATH $ ORACLE_HOME / libï¼š/ usr / libï¼š/ usr / dt / libï¼š/ usr / openwin / libï¼š/ usr / ccs / lib</span><br></pre></td></tr></table></figure><h2 id="è¿æ¥åˆ°æ•°æ®åº“"><a href="#è¿æ¥åˆ°æ•°æ®åº“" class="headerlink" title="è¿æ¥åˆ°æ•°æ®åº“"></a>è¿æ¥åˆ°æ•°æ®åº“</h2><p>1.æ— ç™»é™†çš„æ–¹å¼</p><blockquote><p>sqlplus &#x2F; nolog</p></blockquote><p>2.ä»¥æœ€é«˜æƒé™ç™»é™†ï¼Œæ“ä½œç³»ç»Ÿè®¤è¯çš„æ–¹å¼è¿›è¡Œè¿æ¥ï¼Œä¸éœ€è¦å¯†ç ã€‚</p><p>éœ€è¦è®¾ç½®æœ€é«˜æƒé™çš„ç”¨æˆ·ç»„ï¼Œå¹¶ä¸”åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·ä¸‹ã€‚å¤šå®ä¾‹çš„æƒ…å†µä¸‹éœ€è¦åˆ‡æ¢SID</p><blockquote><p>sqlplus &#x2F; as sysdba</p></blockquote><p>åˆ‡æ¢SID</p><blockquote><p>export ORACLE_SID&#x3D;[SID]</p></blockquote><p>3.åˆ‡æ¢è¿æ¥</p><p>è¿æ¥åˆ°sqlplusåï¼Œæ›´æ”¹ç”¨æˆ·</p><blockquote><p>conn è´¦æˆ·&#x2F;å¯†ç </p></blockquote><p>åˆ‡æ¢åˆ°è¿œç¨‹æ•°æ®åº“</p><p>connect [ç”¨æˆ·å]@â€[IP&#x2F;åŸŸå]:[ç«¯å£]&#x2F;[æ•°æ®åº“æœåŠ¡å]â€</p><blockquote><p>connect apps@â€10.38.1.140:1552&#x2F;DEVâ€</p></blockquote><p>æˆ–</p><blockquote><p>conn apps@â€10.38.1.140:1552&#x2F;DEVâ€</p></blockquote><h2 id="æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬å·"><a href="#æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬å·" class="headerlink" title="æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬å·"></a>æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬å·</h2><blockquote><p>SELECT *<br>FROM product_component_version;</p></blockquote><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112131119-2g9l1pb-image.png" alt="image.png"></p><h2 id="ORACLEå‚æ•°"><a href="#ORACLEå‚æ•°" class="headerlink" title="ORACLEå‚æ•°"></a>ORACLEå‚æ•°</h2><h3 id="åˆå§‹åŒ–å‚æ•°"><a href="#åˆå§‹åŒ–å‚æ•°" class="headerlink" title="åˆå§‹åŒ–å‚æ•°"></a>åˆå§‹åŒ–å‚æ•°</h3><h4 id="åˆå§‹åŒ–å‚æ•°æ–‡ä»¶"><a href="#åˆå§‹åŒ–å‚æ•°æ–‡ä»¶" class="headerlink" title="åˆå§‹åŒ–å‚æ•°æ–‡ä»¶"></a>åˆå§‹åŒ–å‚æ•°æ–‡ä»¶</h4><p>å¯¹äºä»»æ„å‚æ•°æ–‡ä»¶çš„ä¿®æ”¹ï¼Œéƒ½éœ€è¦é‡å¯æ•°æ®åº“å®ä¾‹åæ‰ä¼šç”Ÿæ•ˆã€‚</p><p>å‚æ•°æ–‡ä»¶å­˜æ”¾äº <code>$ORACLE_HOME/dbs</code> ç›®å½•ä¸‹ï¼Œå¹¶ä¸”æ–‡ä»¶åä¸º <code>init[SID].ora</code></p><p>å¦‚ï¼šä¸‹å›¾ï¼Œå…¶ä¸­initTest.oraæ˜¯åˆå§‹åŒ–çš„å‚æ•°æ–‡ä»¶</p><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112145658-adh2nkd-image.png" alt="image.png"></p><h4 id="æŸ¥çœ‹åˆå§‹åŒ–å‚æ•°"><a href="#æŸ¥çœ‹åˆå§‹åŒ–å‚æ•°" class="headerlink" title="æŸ¥çœ‹åˆå§‹åŒ–å‚æ•°"></a>æŸ¥çœ‹åˆå§‹åŒ–å‚æ•°</h4><blockquote><p>show parameter [å‚æ•°é€‰é¡¹]</p></blockquote><p>å¯ç”¨å‚æ•°é€‰é¡¹å¦‚ä¸‹</p><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112144807-ai95qe8-image.png" alt="image.png"></p><p>ä¾‹å¦‚ï¼šæŸ¥çœ‹é‡åšæ—¥å¿—è¡¨ç©ºé—´</p><blockquote><p>show parameter undo_tablespace</p></blockquote><h4 id="ä¿®æ”¹åˆå§‹åŒ–å‚æ•°"><a href="#ä¿®æ”¹åˆå§‹åŒ–å‚æ•°" class="headerlink" title="ä¿®æ”¹åˆå§‹åŒ–å‚æ•°"></a>ä¿®æ”¹åˆå§‹åŒ–å‚æ•°</h4><p>ä½¿ç”¨ <code>alter session set [å‚æ•°] = [å‚æ•°å€¼]</code> è¿›è¡Œå½“å‰ä¼šè¯ä¸´æ—¶ä¿®æ”¹ï¼Œä¸ä¼šå½±å“å…¶ä»–ä¼šè¯ï¼Œè¯¥å‚æ•°ä¹Ÿä¸ä¼šè¢«ä¿å­˜ã€‚</p><p>å¦‚ä¿®æ”¹å½“å‰ä¼šè¯çš„æ—¥æœŸæ ¼å¼</p><blockquote><p>ALTER SESSION SET NLS_DATE_FORMAT &#x3D; â€˜yyyy-mm-dd hh24:mi:ssâ€™;</p></blockquote><p>ä»åŠ¨æ€æ€§èƒ½è§†å›¾ä¸­æŸ¥è¯¢æ‰€æœ‰çš„åˆå§‹åŒ–å‚æ•°</p><blockquote><p>SELECT *<br>FROM v$parameter;</p></blockquote><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112151055-20tri5o-image.png" alt="image.png"></p><blockquote><p>è¯¥è§†å›¾çš„è¯´æ˜</p><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/V-PARAMETER.html#GUID-C86F3AB0-1191-447F-8EDF-4727D8693754">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/V-PARAMETER.html#GUID-C86F3AB0-1191-447F-8EDF-4727D8693754</a></p></blockquote><h3 id="æœåŠ¡å™¨å‚æ•°"><a href="#æœåŠ¡å™¨å‚æ•°" class="headerlink" title="æœåŠ¡å™¨å‚æ•°"></a>æœåŠ¡å™¨å‚æ•°</h3><h4 id="æœåŠ¡å™¨å‚æ•°æ–‡ä»¶"><a href="#æœåŠ¡å™¨å‚æ•°æ–‡ä»¶" class="headerlink" title="æœåŠ¡å™¨å‚æ•°æ–‡ä»¶"></a>æœåŠ¡å™¨å‚æ•°æ–‡ä»¶</h4><ul><li>pfileï¼šæ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹</li><li>spfileï¼šäºŒè¿›åˆ¶ä¿å­˜ï¼Œåªèƒ½é€šè¿‡å‘½ä»¤ä¿®æ”¹</li></ul><p>æŒä¹…åŒ–å­˜æ”¾åœ¨ <code>$ORACLE_HOME/dbs</code> ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ç”±åˆå§‹åŒ–å‚æ•°æ–‡ä»¶ä¸­çš„ <code>SPFILE</code> å‚æ•°æŒ‡å®šï¼Œå¹¶ä¸”æ–‡ä»¶åä¸º <code>spfile[SID].ora</code> æˆ–é»˜è®¤çš„ <code>spfile.ora</code></p><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112151628-xx3flv3-image.png" alt="image.png"></p><p><strong>Oracleå¯åŠ¨è¿‡ç¨‹</strong></p><p>åœ¨Oracleå¯åŠ¨å®ä¾‹æ—¶ï¼Œä¼šå…ˆå¯åŠ¨è¿›ç¨‹åŠ è½½å‚æ•°æ–‡ä»¶ï¼Œç„¶åæ ¹æ®å‚æ•°åŠ è½½å®ä¾‹ã€‚</p><p>å¦‚æœåˆ›å»ºäº†spfileï¼Œåˆ™oracleä¼šä½¿ç”¨å¯åŠ¨è¿›ç¨‹ï¼Œå¹¶ä»spfileä¸­åŠ è½½æ•°æ®åº“é…ç½®ï¼›å¦‚æœæ²¡æœ‰åˆ™ç›´æ¥åŠ è½½åˆå§‹åŒ–å‚æ•°æ–‡ä»¶ã€‚</p><p><strong>æŸ¥è¯¢æ˜¯å¦å¯ç”¨spfile</strong></p><p>å¦‚æœæŸ¥è¯¢ä¸ä¸ºç©ºåˆ™å¯ç”¨spfile</p><blockquote><p>SELECT name,value FROM v$parameter WHERE name&#x3D;â€™spfileâ€™;</p></blockquote><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112152043-q309olb-image.png" alt="image.png"></p><h4 id="ä¿®æ”¹å‚æ•°æ–‡ä»¶"><a href="#ä¿®æ”¹å‚æ•°æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹å‚æ•°æ–‡ä»¶"></a>ä¿®æ”¹å‚æ•°æ–‡ä»¶</h4><blockquote><p>Alter system set parameter&#x3D;value &lt;comment&#x3D;â€™textâ€™&gt; <deffered> &lt;scope&#x3D;memory|spfile|both&gt; &lt;sid&#x3D;â€™sid|*â€™&gt;</deffered></p></blockquote><h4 id="æŸ¥çœ‹å‚æ•°æ–‡ä»¶"><a href="#æŸ¥çœ‹å‚æ•°æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å‚æ•°æ–‡ä»¶"></a>æŸ¥çœ‹å‚æ•°æ–‡ä»¶</h4><p>å¦‚æœvalueä¸ä¸ºç©ºï¼Œåˆ™å¯ç”¨æœåŠ¡å™¨å‚æ•°æ–‡ä»¶</p><p><img src="/2021/01/12/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86/20210112153043-5md8d7k-image.png" alt="image.png"></p><p>è¿™ä¸ªå›¾å¯ä»¥å‘ç°ï¼Œæ²¡æœ‰æŒä¹…åŒ–æœåŠ¡å™¨å‚æ•°æ–‡ä»¶ã€‚</p><h2 id="å¸¸ç”¨è§†å›¾"><a href="#å¸¸ç”¨è§†å›¾" class="headerlink" title="å¸¸ç”¨è§†å›¾"></a>å¸¸ç”¨è§†å›¾</h2><h3 id="é™æ€æ•°æ®å­—å…¸"><a href="#é™æ€æ•°æ®å­—å…¸" class="headerlink" title="é™æ€æ•°æ®å­—å…¸"></a>é™æ€æ•°æ®å­—å…¸</h3><h4 id="æƒé™æ§åˆ¶"><a href="#æƒé™æ§åˆ¶" class="headerlink" title="æƒé™æ§åˆ¶"></a>æƒé™æ§åˆ¶</h4><ul><li>dba_[è¡¨å]ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯¹è±¡ï¼Œä»…å…è®¸æœ‰dbaæƒé™çš„ç”¨æˆ·è®¿é—®</li><li>all_[è¡¨å]ï¼šæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·ä¸‹çš„å¯¹è±¡ï¼Œå…è®¸è·¨ç”¨æˆ·è®¿é—®ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰</li><li>user_[è¡¨å]ï¼šä»…æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¸‹çš„å¯¹è±¡</li><li>cdb_[è¡¨å]ï¼šå¦‚æœå¯ç”¨å¤šç§Ÿæˆ·æ¶æ„çš„å®¹å™¨æ•°æ®åº“ï¼Œåˆ™å¯ä»¥è·¨ç§Ÿæˆ·æŸ¥çœ‹ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰</li></ul><h4 id="æ•°æ®åº“å¯¹è±¡"><a href="#æ•°æ®åº“å¯¹è±¡" class="headerlink" title="æ•°æ®åº“å¯¹è±¡"></a>æ•°æ®åº“å¯¹è±¡</h4><ul><li>ALL_ALL_TABLESï¼šå½“å‰ç”¨æˆ·å¯ä»¥è®¿é—®çš„æ‰€æœ‰è¡¨</li><li>ALL_ARGUMENTSï¼šå½“å‰ç”¨æˆ·å¯ä»¥è®¿é—®çš„æ‰€æœ‰å‡½æ•°å’Œè¿‡ç¨‹</li><li>ALL_CATALOGï¼šå½“å‰ç”¨æˆ·å¯è®¿é—®çš„è¡¨ï¼Œèšç±»ï¼Œè§†å›¾ï¼ŒåŒä¹‰è¯å’Œåºåˆ—</li><li>ALL_COL_COMMENTSï¼šå½“å‰ç”¨æˆ·ä¸‹æ‰€æœ‰å­˜åœ¨æ³¨é‡Šçš„å­—æ®µ</li><li>ALL_COLL_TYPESï¼šå½“å‰ç”¨æˆ·ä¸‹å¯è®¿é—®çš„æ‰€æœ‰é›†åˆç±»å‹</li><li>ALL_CONS_COLUMNSï¼šå½“å‰ç”¨æˆ·ä¸‹å¯ä»¥è®¿é—®çš„åŒ…å«çº¦æŸçš„å­—æ®µ</li><li>ALL_CONSTRAINTSï¼šå½“å‰ç”¨æˆ·ä¸‹å¯ä»¥è®¿é—®çš„æ‰€æœ‰è¡¨ä¸­çš„çº¦æŸ</li><li>ALL_DB_LINKSï¼šå½“å‰ç”¨æˆ·ä¸‹å¯ä»¥è®¿é—®çš„æ‰€æœ‰dblink</li><li>ALL_DEPENDENCIESï¼šå½“å‰ç”¨æˆ·ä¸‹æ‰€æœ‰çš„ä¾èµ–å…³ç³»ï¼Œæ³¨æ„æŸ¥è¯¢æ—¶ <code>referenced_link_name</code> ä¸è¦ä¸ºç©º</li><li>ALL_ERRORSï¼šæŸ¥è¯¢å½“å‰ç”¨æˆ·ä¸‹æ‰€æœ‰å¯¹è±¡çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæ ¹æ®å­—æ®µ <code>sequence</code> æ’åº</li><li>ALL_IND_COLUMNSï¼šæŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸‹åŒ…å«ç´¢å¼•çš„åˆ—</li><li>ALL_INDEXESï¼šå½“å‰ç”¨æˆ·ä¸‹å…¨éƒ¨ç´¢å¼•</li><li>ALL_JOBSï¼šå½“å‰ç”¨æˆ·ä¸‹æ‰€æœ‰å®šæ—¶ä»»åŠ¡</li><li>ALL_OBJECTSï¼šå½“å‰ç”¨æˆ·ä¸‹æ‰€æœ‰å¯¹è±¡</li><li>ALL_SOURCEï¼šæŸ¥çœ‹æ‰€æœ‰packageä¸­çš„å‡½æ•°å®šä¹‰</li></ul><h4 id="æ•°æ®åº“æ–‡ä»¶"><a href="#æ•°æ®åº“æ–‡ä»¶" class="headerlink" title="æ•°æ®åº“æ–‡ä»¶"></a>æ•°æ®åº“æ–‡ä»¶</h4><ul><li>ALL_DIRECTORIESï¼šå½“å‰ç”¨æˆ·ä¸‹å¯ä»¥è®¿é—®çš„æ–‡ä»¶ç›®å½•</li></ul><h3 id="åŠ¨æ€æ€§èƒ½è§†å›¾"><a href="#åŠ¨æ€æ€§èƒ½è§†å›¾" class="headerlink" title="åŠ¨æ€æ€§èƒ½è§†å›¾"></a>åŠ¨æ€æ€§èƒ½è§†å›¾</h3><p>åŠ¨æ€æ€§èƒ½è§†å›¾ä»¥ <code>v$</code>å¼€å¤´</p><p>åªæœ‰dbaæƒé™çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ï¼Œæ¯ä¸€ä¸ªæ€§èƒ½è§†å›¾éƒ½æ˜¯ç”±æ•°æ®åº“å®ä¾‹éƒ½æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ— æ³•è¿›è¡Œæ›´æ–°ã€‚</p><ul><li><p>V$INSTANCEï¼šå½“å‰æ•°æ®åº“å®ä¾‹</p></li><li><p>V$SGAï¼šæŸ¥çœ‹SGAä¿¡æ¯</p></li><li><p>V$SGAINFOï¼šæŸ¥çœ‹SGAè¯¦ç»†ä¿¡æ¯</p></li><li><p>V$PARAMETERï¼šæŸ¥çœ‹åˆå§‹åŒ–å‚æ•°</p></li><li><p>V$VERSIONï¼šæŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬</p></li><li><p>V$OPTIONï¼šæŸ¥çœ‹æ•°æ®åº“äº§å“ä¿¡æ¯</p></li><li><p>V$SESSIONï¼šæŸ¥çœ‹ä¼šè¯ä¿¡æ¯</p></li><li><p>V$PROCESSï¼šæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</p></li><li><p>V$LOCKï¼šæŸ¥çœ‹å æœ‰é”çš„ä¼šè¯</p></li><li><p>V$TABLESPACEï¼šè¡¨ç©ºé—´ä¿¡æ¯</p></li><li><p>v$parameterï¼šæŸ¥çœ‹æ‰€æœ‰å‚æ•°ä¿¡æ¯</p></li><li><p>æ•°æ®æ–‡ä»¶</p><ul><li>V$CONTROLFILEï¼šæ§åˆ¶æ–‡ä»¶è·¯å¾„</li><li>V$DATAFILEï¼šæ•°æ®æ–‡ä»¶è·¯å¾„</li><li>V$LOGFILEï¼šæ—¥å¿—æ–‡ä»¶è·¯å¾„</li></ul></li><li><p>SQL</p><ul><li>v$sqlï¼šæ‰§è¡Œè¿‡çš„sqlè¯¦ç»†ä¿¡æ¯</li><li>v$sqltextï¼šsqlæ–‡æœ¬ï¼Œå¯ä»¥ä¸ä¸Šé¢çš„è¡¨å…³è”</li><li>æ³¨æ„ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰çš„ SQL è¯­å¥éƒ½å¯ä»¥ä» V$SQL ä¸­æ‰¾åˆ°ï¼Œå› ä¸º ORACLE ä¼šåŠ¨æ€åœ°<br>æ›´æ–°å…±äº«æ± çš„ä¿¡æ¯ï¼Œå°†ä¸€äº›è¿‡æ—§çš„ SQL ä»å…±äº«æ± ä¸­åˆ é™¤</li></ul></li></ul><p>SQL çš„è§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠç¡¬è§£æä¹‹åçš„ SQL æ”¾åœ¨æ”¾åœ¨å…±äº«æ± ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ¸…ç©ºäº†å…±äº«æ± ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°åšç¡¬åˆ†æã€‚</p><blockquote><p>alter system flush shared_pool;</p></blockquote><h5 id="æŸ¥çœ‹sqlæ€§èƒ½"><a href="#æŸ¥çœ‹sqlæ€§èƒ½" class="headerlink" title="æŸ¥çœ‹sqlæ€§èƒ½"></a>æŸ¥çœ‹sqlæ€§èƒ½</h5><blockquote><p>select * from v$sql ;</p><p>SELECT sql_text,<br>cpu_time &#x2F; (1000 * 1000) t_cpu,<br>TRUNC (elapsed_time &#x2F; (1000 * 1000)) t_elap,<br>(cpu_time &#x2F; elapsed_time &#x2F; (1000 * 1000)) * 100 pct<br>FROM v$sql<br>WHERE sql_text LIKE â€˜SELECT OFFER_GROUP_ID_SEQ.NEXTVAL FROM DUA%â€™;</p></blockquote><p>å¯¹äºå·²ç»æ‰§è¡Œå®Œæ¯•çš„ä¼šè¯ï¼Œå¯ä»¥åœ¨ V$SQL è§†å›¾ä¸­æ‰¾åˆ°å®ƒçš„æ‰§è¡Œæ—¶é—´å’Œæ¶ˆè€—çš„ CPU æ—¶é—´ï¼Œè¿™äº›ä¿¡æ¯å¯¹æˆ‘ä»¬åˆ†æä¸€äº›æ€§èƒ½ä¸Šå­˜åœ¨é—®é¢˜çš„ SQL æœ‰ç”¨å¤„ã€‚æ¯”å¦‚å¯¹æ¯” SQL æ¶ˆè€—çš„ CPU å’Œæ‰§è¡Œæ—¶é—´ï¼Œå°±å¯ä»¥å¤§è‡´çŸ¥é“ SQL è¯­å¥æ‰§è¡Œä¸­æ˜¯å¦æœ‰é•¿æ—¶é—´çš„ç­‰å¾…äº‹ä»¶ï¼š</p><h2 id="å®˜æ–¹å‚è€ƒæ‰‹å†Œ"><a href="#å®˜æ–¹å‚è€ƒæ‰‹å†Œ" class="headerlink" title="å®˜æ–¹å‚è€ƒæ‰‹å†Œ"></a>å®˜æ–¹å‚è€ƒæ‰‹å†Œ</h2><p>1.Database Administratorâ€™s Guide</p><blockquote><p>å®˜æ–¹æ–‡æ¡£ <a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/admin/getting-started-with-database-administration.html#GUID-9563BFC5-2A73-4271-9108-B4149018B8AD">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/admin/getting-started-with-database-administration.html#GUID-9563BFC5-2A73-4271-9108-B4149018B8AD</a></p></blockquote><p>2.Database Reference</p><blockquote><p>å®˜æ–¹æ–‡æ¡£ <a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/basic-initialization-parameters.html#GUID-D75F1A77-47E2-4F35-B145-44B3A10ED85C">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/basic-initialization-parameters.html#GUID-D75F1A77-47E2-4F35-B145-44B3A10ED85C</a></p></blockquote><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OracleæŠ€æœ¯åˆ†äº« - DAY 3</title>
      <link href="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/"/>
      <url>/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/</url>
      
        <content type="html"><![CDATA[<h1 id="OracleæŠ€æœ¯åˆ†äº«-DAY-3"><a href="#OracleæŠ€æœ¯åˆ†äº«-DAY-3" class="headerlink" title="OracleæŠ€æœ¯åˆ†äº« - DAY 3"></a>OracleæŠ€æœ¯åˆ†äº« - DAY 3</h1><h2 id="å®¹å™¨æ•°æ®åº“"><a href="#å®¹å™¨æ•°æ®åº“" class="headerlink" title="å®¹å™¨æ•°æ®åº“"></a>å®¹å™¨æ•°æ®åº“</h2><p>ã€æ³¨æ„ã€‘å®¹å™¨æ•°æ®åº“ï¼ˆå¤šç§Ÿæˆ·ç»“æ„ï¼‰ä¸º19cæ–°ç‰¹æ€§</p><p>æŸ¥çœ‹å®¹å™¨æ•°æ®åº“ï¼ˆPDBï¼Œpluggable databaseï¼Œå³å¯æ’æ‹”æ•°æ®åº“ï¼‰</p><blockquote><p>show pdbs;</p></blockquote><p>æ‰§è¡Œç»“æœ</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108104034-j1u0pxb-image.png" alt="image.png"></p><ul><li>PDB$SEEDï¼šç§å­æ•°æ®åº“ï¼Œæ˜¯å…‹éš†çš„æ¨¡ç‰ˆå®¹å™¨æ•°æ®åº“</li></ul><p>å¯åŠ¨PDB</p><blockquote><p>alter pluggable database pdb open;</p></blockquote><p>å¯åŠ¨ç»“æœ</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108104323-mlrgqjo-image.png" alt="image.png"></p><p>è¿›å…¥å®¹å™¨æ•°æ®åº“</p><blockquote><p>alter session set container&#x3D;pdb;</p></blockquote><p>æŸ¥çœ‹å½“å‰å®¹å™¨</p><blockquote><p>show con_name</p></blockquote><p>ç»“æœï¼š</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108104524-bxbwmt1-image.png" alt="image.png"></p><p>åˆ‡æ¢åˆ°å®¹å™¨æ•°æ®åº“ï¼ŒæŸ¥çœ‹ç¤ºä¾‹æ•°æ®åº“</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108104912-ec6r1n5-image.png" alt="image.png"></p><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><h3 id="SQLæ‰§è¡Œé¡ºåº"><a href="#SQLæ‰§è¡Œé¡ºåº" class="headerlink" title="SQLæ‰§è¡Œé¡ºåº"></a>SQLæ‰§è¡Œé¡ºåº</h3><p>ç¤ºä¾‹sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    employee_id,</span><br><span class="line">    last_name,</span><br><span class="line">    first_name,</span><br><span class="line">    department_name</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    employees    e,</span><br><span class="line">    departments  d</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">    <span class="keyword">AND</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%T%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    last_name;</span><br></pre></td></tr></table></figure><p>from -&gt; where -&gt; select -&gt; order by</p><p>ä»ç»“æœé›†ä¸­ç­›é€‰ç»“æœï¼Œå¹¶é€‰å–ç»“æœåˆ—ï¼Œæœ€åæ’åº</p><h2 id="SQLè§£é‡Šè®¡åˆ’"><a href="#SQLè§£é‡Šè®¡åˆ’" class="headerlink" title="SQLè§£é‡Šè®¡åˆ’"></a>SQLè§£é‡Šè®¡åˆ’</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>è¯»å–åŸåˆ™ï¼šä»ä¸Šå¾€ä¸‹è¯»ï¼Œä»é‡Œå¾€å¤–è¯»ï¼Œé ä¸Šè¾¹çš„å’Œé é‡Œè¾¹çš„å…ˆæ‰§è¡Œ</p><ul><li>rowidï¼šoracleç”Ÿæˆçš„ç‰©ç†åœ°å€</li><li>FULL SCANï¼šå…¨æ‰«æ</li><li>UNIQUE SCANï¼šç´¢å¼•æ‰«æï¼ˆç´¢å¼•éƒ½æ˜¯æœ‰åºå­˜æ”¾ï¼Œéœ€è¦æ¶ˆè€—å­˜å‚¨ç©ºé—´ï¼Œä¿å­˜çš„æ˜¯ä¸åŒçš„rowidï¼‰</li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ã€æ³¨æ„ã€‘ä»sql developerä¸Šçœ‹å¯èƒ½æ˜¾ç¤ºä¼šå¥½ä¸€äº›</p><p>sql developerçš„è§£é‡Šè®¡åˆ’ç¤ºä¾‹</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108113704-iwnd7y5-image.png" alt="image.png"></p><p>plsql developerçš„è§£é‡Šè®¡åˆ’ç¤ºä¾‹</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108113428-blv9yjj-image.png" alt="image.png"></p><ul><li><p>Rowsï¼šè§£é‡Šè®¡åˆ’ç»“æœé›†é¢„ä¼°è¡Œæ•°</p></li><li><p>Costï¼šè§£é‡Šè®¡åˆ’æ­¥éª¤çš„ç³»ç»Ÿå¼€é”€</p></li><li><p>ORACLEå¤šè¡¨å…³è”æŸ¥è¯¢çš„æ–¹å¼</p><ul><li>NESTED  LOOPS ï¼šåµŒå¥—å¾ªç¯è¿æ¥ï¼ŒCBOä¸‹çš„ä¼˜åŒ–å™¨ï¼Œoracleä¼šè‡ªåŠ¨è¯„ä¼°å¤–å±‚å¾ªç¯çš„åŸºè¡¨ï¼Œå³è‡ªåŠ¨è¯„ä¼°å·¦è¿æ¥çš„åŸºè¡¨</li><li>HASH JOINï¼šä¸ºidç”Ÿæˆhashå€¼ï¼ŒæŠŠhashå€¼ç›¸åŒçš„æ•°æ®å…³è”ï¼ˆ10gä»¥åï¼‰ï¼Œé€‚åˆå¤§è¡¨ä¹‹é—´çš„è¿æ¥</li><li>Sorted Mergeï¼šæ’åºåä¸¤è¡¨åˆå¹¶</li></ul></li></ul><h5 id="STEP1-ä¿è¯ä¿¡æ¯ä¸€è‡´"><a href="#STEP1-ä¿è¯ä¿¡æ¯ä¸€è‡´" class="headerlink" title="STEP1 ä¿è¯ä¿¡æ¯ä¸€è‡´"></a>STEP1 ä¿è¯ä¿¡æ¯ä¸€è‡´</h5><p><strong>è¦ç¡®ä¿è§£é‡Šè®¡åˆ’å‡ºæ¥çš„æ•°æ®ï¼Œä¸æ•°æ®åº“ä¸­å®é™…çš„æ•°æ®ä¸€è‡´ã€‚</strong></p><p>æŸ¥çœ‹è¡¨çš„ç»Ÿè®¡ä¿¡æ¯</p><blockquote><p>SELECT table_name, num_rows, blocks FROM user_tables;</p></blockquote><p>oracleæ¯æ—¥æ™šä¸Š22ï¼š00 - å‡Œæ™¨2ï¼š00è‡ªåŠ¨æ”¶é›†ï¼Œoracleçš„æ‰§è¡Œè®¡åˆ’ä¼šæ ¹æ®æ”¶é›†çš„ç»Ÿè®¡ä¿¡æ¯æ¥è¯„ä¼°è§£é‡Šè®¡åˆ’ã€‚</p><p>å¯¹äºæ–°å»ºçš„æ•°æ®è¡¨ï¼Œç”±äºæ²¡æœ‰æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ï¼Œåœ¨è§£é‡Šè®¡åˆ’ä¸­çš„ Rows å¯èƒ½è·Ÿå®é™…æ–°å»ºçš„è¡¨ä¸ç¬¦åˆï¼Œæ­¤æ—¶è¦ä¸»åŠ¨æ”¶é›†ä¸€ä¸‹æ•°æ®åº“çš„ä¿¡æ¯ã€‚</p><p>ã€æ³¨æ„ã€‘ç»Ÿè®¡ä¿¡æ¯çš„æ”¶é›†å°½é‡ä¸è¦ä¸ä¸šåŠ¡æ—¶é—´å†²çªï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108135557-7i7j601-image.png" alt="image.png"></p><p>æ”¶é›†ç»Ÿè®¡ä¿¡æ¯</p><blockquote><p>exec dbms_stats.gather_table_status(â€˜HRâ€™,â€™Employeesâ€™);</p></blockquote><p>ã€æ³¨æ„ã€‘å¦‚æœç”±äºç»Ÿè®¡ä¸å‡†ï¼Œå¯¼è‡´é€‰é”™æ‰§è¡Œè®¡åˆ’ï¼Œä¼šå¯¼è‡´æŸ¥è¯¢å˜å¾—éå¸¸ç¼“æ…¢ã€‚</p><p>ã€æ³¨æ„ã€‘12cä»¥åï¼šæ‰§è¡Œsqlçš„æ—¶å€™æœ‰ä¸€æ¬¡æ”¹å˜æ‰§è¡Œè®¡åˆ’çš„å¯èƒ½æ€§ï¼Œå¯èƒ½ä¼šæŠŠåµŒå¥—å¾ªç¯è¿æ¥å˜æˆ Hash Joinã€‚åœ¨æ‰§è¡Œå‰ä¼šæ‰«æç´¢å¼•å¹¶æ”¶é›†ä¸€æ¬¡ä¿¡æ¯ï¼Œæ ¹æ®æŸ¥è¯¢çš„ç»“æœå’Œè§£é‡Šè®¡åˆ’è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå·®å¼‚è¾ƒå¤§åˆ™ä¼šæ”¹å˜æ‰§è¡Œè®¡åˆ’ã€‚</p><h5 id="STEP2-ä¼˜åŒ–å·¥å…·"><a href="#STEP2-ä¼˜åŒ–å·¥å…·" class="headerlink" title="STEP2 ä¼˜åŒ–å·¥å…·"></a>STEP2 ä¼˜åŒ–å·¥å…·</h5><h6 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h6><ul><li><p>ORACLE STAä¼˜åŒ–è„šæœ¬</p><ul><li>è¯­å¥æ”¹å†™</li><li>æ”¶é›†è¡¨ä¿¡æ¯</li><li>ä¿®æ”¹æ‰§è¡Œè®¡åˆ’</li><li>æ„å»ºåˆ†åŒºè¡¨</li><li>æ„å»ºç´¢å¼•</li><li>æ„å»ºç‰©åŒ–è§†å›¾</li></ul></li><li><p>AWRæŠ¥å‘Š</p></li><li><p>SQL Developer</p></li></ul><h6 id="ORACLE-STA"><a href="#ORACLE-STA" class="headerlink" title="ORACLE STA"></a>ORACLE STA</h6><p>æŸ¥æ‰¾sqlçš„idï¼Œè¯¥æŸ¥è¯¢ä¼šä»å†…å­˜ä¸­è·å–è¿‘æœŸæ‰§è¡Œçš„sqlè¯­å¥</p><blockquote><p>SELECT * FROM v$sql WHERE sql_test LIKE â€˜%%â€™;</p></blockquote><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108144306-bu3f899-image.png" alt="image.png"></p><p>ä½¿ç”¨STAå·¥å…·ä¼˜åŒ–</p><blockquote><p>@?&#x2F;rdbms&#x2F;admin&#x2F;sqltrpt.sql</p></blockquote><p>ç»“æœå¦‚ä¸‹ï¼Œä¼šæ˜¾ç¤ºè¿‘æœŸ15æ¡æœ€æ¶ˆè€—æ€§èƒ½çš„sql</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108144612-gk5uivt-image.png" alt="image.png"></p><p>æ­¤æ—¶è¾“å…¥sqlçš„idï¼Œåˆ™å¯ä»¥ç”Ÿæˆä¼˜åŒ–å»ºè®®ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°æ”¹æ­£åçš„æ‰§è¡Œè®¡åˆ’</p><p>#TODO# å»ºè®®å®é™…æ“ä½œä¸€ä¸‹</p><h6 id="SQL-Developer"><a href="#SQL-Developer" class="headerlink" title="SQL Developer"></a>SQL Developer</h6><p>1.è‡ªåŠ¨è¯Šæ–­</p><p>è·¯å¾„ï¼šæŸ¥çœ‹ -&gt; DBA -&gt; æ€§èƒ½ -&gt; è‡ªåŠ¨æ•°æ®åº“è¯Šæ–­ç›‘è§†å™¨</p><p>æ¯å°æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆæ€§èƒ½è¯Šæ–­æŠ¥å‘Š</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108145531-j8qynfz-image.png" alt="image.png"></p><p>2.å®æ—¶ç›‘æ§</p><p>è·¯å¾„ï¼šæŸ¥çœ‹ -&gt; DBA -&gt; ä¼˜åŒ– -&gt; å®æ—¶SQLç›‘è§†</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108150004-b9ymlhy-image.png" alt="image.png"></p><h6 id="AWRæŠ¥å‘Šéƒ¨åˆ†"><a href="#AWRæŠ¥å‘Šéƒ¨åˆ†" class="headerlink" title="AWRæŠ¥å‘Šéƒ¨åˆ†"></a>AWRæŠ¥å‘Šéƒ¨åˆ†</h6><p>æ‰¾åˆ° <code>ADDM Reports</code></p><h6 id="Cloud-Control"><a href="#Cloud-Control" class="headerlink" title="Cloud Control"></a>Cloud Control</h6><p><strong>Oracle Enterprise Manager Cloud Control</strong></p><p>å¯è§†åŒ–çš„oracleæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œè§è™šæ‹Ÿæœº2</p><p>â€</p><h2 id="Oracleæ€§èƒ½åˆ†æ"><a href="#Oracleæ€§èƒ½åˆ†æ" class="headerlink" title="Oracleæ€§èƒ½åˆ†æ"></a>Oracleæ€§èƒ½åˆ†æ</h2><h3 id="AWRæŠ¥å‘Š"><a href="#AWRæŠ¥å‘Š" class="headerlink" title="AWRæŠ¥å‘Š"></a>AWRæŠ¥å‘Š</h3><p>é€šè¿‡SQL Developerå¯è§†åŒ–ç”ŸæˆæŠ¥å‘Šï¼›æŠ‘æˆ–æ˜¯é‡‡ç”¨å‘½ä»¤æ–¹å¼ç”Ÿæˆã€‚</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210107144303-q5mxlcl-image.png" alt="image.png"></p><p>å‘½ä»¤æ–¹å¼</p><blockquote><p>@?&#x2F;rdbms&#x2F;admin&#x2F;awrrpt.sql</p></blockquote><p>â€</p><p>ç®€å•çš„æ€§èƒ½åˆ†æ</p><ul><li><p>Report Summary</p><ul><li>ç¡®å®šç³»ç»Ÿç±»å‹ï¼šåˆ†æ&#x2F;äº¤æ˜“ ç±»å‹</li><li>Redo Size ï¼ˆPer Secondï¼‰ï¼šRedoé‡å°ï¼Œå¯èƒ½æ˜¯åˆ†æç±»å‹çš„ç³»ç»Ÿï¼›å¦‚æœå¤§çš„è¯å¯èƒ½æ˜¯äº¤æ˜“ç±»å‹çš„ç³»ç»Ÿ</li><li>Logical readï¼ˆä»å†…å­˜é‡Œå–æ•°ç§°ä¸ºé€»è¾‘åº¦ï¼‰ï¼šå¦‚æœé‡å¤§ï¼Œåˆ™å¯èƒ½ä¸ºå¤§é‡çš„selectæŸ¥è¯¢</li><li>Transactionsï¼šæ¯ç§’äº‹åŠ¡æ•°</li></ul></li><li><p>SQL ordered by Elapsed Time</p><ul><li>Elapsed Timeï¼šåœ¨æŠ¥å‘Šç”Ÿæˆæ—¶é—´å†…æ‰§è¡Œæ€»æ—¶é—´ï¼Œç­‰äºæ‰§è¡Œæ¬¡æ•° * æ¯ç§’æ‰§è¡Œæ—¶é—´</li><li>Executionsï¼šæ‰§è¡Œæ¬¡æ•°</li><li>Elapsed Time per Execï¼ˆsï¼‰ï¼šæ¯ç§’æ‰§è¡Œæ—¶é—´</li><li>SQL Idï¼šSQLæŸ¥è¯¢idï¼Œä¸åŒçš„åº“æ˜¯ä¸€æ ·çš„ã€‚ç”Ÿæˆæ–¹å¼ï¼šæŠŠSQLè½¬æ¢æˆASCIIç ï¼Œç„¶åé’ˆå¯¹ASCIIç ç”Ÿæˆhashç ã€‚</li></ul></li><li><p>SQL ordered by Gets</p><ul><li>é€»è¾‘è¯»</li><li>Buffer Getsï¼šé€»è¾‘è¯»æ€»æ—¶é—´</li><li>Executionsï¼šæ‰§è¡Œæ¬¡æ•°</li><li>Gets per Execï¼šå•æ¬¡é€»è¾‘è¯»æ—¶é—´</li></ul></li><li><p>SQL ordered by Reads</p><ul><li>ç‰©ç†è¯»</li></ul></li><li><p>Top 5 Evnets</p><ul><li>æœ€æ¶ˆè€—æ€§èƒ½çš„5ä¸ªäº‹ä»¶</li></ul></li></ul><h3 id="é€šè¿‡SQL-Developerä¼˜åŒ–"><a href="#é€šè¿‡SQL-Developerä¼˜åŒ–" class="headerlink" title="é€šè¿‡SQL Developerä¼˜åŒ–"></a>é€šè¿‡SQL Developerä¼˜åŒ–</h3><p>æŸ¥çœ‹å®æ—¶SQLç›‘è§†</p><p>è·¯å¾„ï¼šæŸ¥çœ‹ -&gt; DBA</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210107150651-e24lbrr-image.png" alt="image.png"></p><p>æŸ¥çœ‹SQLé¡¶çº§æŠ¥å‘Š</p><p>è·¯å¾„ï¼šæŸ¥çœ‹ -&gt; æŠ¥å‘Š -&gt; æ•°æ®å­—å…¸æŠ¥å‘Š -&gt; æ•°æ®åº“ç®¡ç† -&gt; é¡¶çº§SQL</p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210107151223-xwmrbzy-image.png" alt="image.png"></p><h3 id="SQL-ä¼˜åŒ–æ‰‹å†Œ"><a href="#SQL-ä¼˜åŒ–æ‰‹å†Œ" class="headerlink" title="SQL ä¼˜åŒ–æ‰‹å†Œ"></a>SQL ä¼˜åŒ–æ‰‹å†Œ</h3><p><strong>SQL Tuning Guide</strong></p><p><strong>Database Performance Tuning Guide</strong></p><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210107151748-0hv2l22-image.png" alt="image.png"></p><ul><li><p>Shared Pool Checkï¼Œå³è½¯è§£æï¼Œå­˜æ”¾å¸¸ç”¨è§£æåçš„ç»“æœ</p></li><li><p>Soft Parseï¼Œå³è½¯è§£æï¼Œå¦‚æœè½¯è§£æè¿‡å¤§ï¼Œå¯èƒ½ä¼šå‡ºç°åœ¨ <code>Shared Pool Check</code> ä¸­å‡ºç°èµ„æºäº‰æŠ¢ï¼Œè¶…å‡ºèµ„æºé™åˆ¶çš„è¯·æ±‚å°†è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚</p></li><li><p>Hard Parseï¼Œå³ç¡¬è§£æï¼Œè¯­å¥é¦–æ¬¡æ‰§è¡Œï¼Œæ¶ˆè€—CPU</p><ul><li>OLAPï¼ˆåˆ†æç±»å‹äº‹åŠ¡ï¼‰ï¼Œå®ç°ç¡¬è§£æï¼Œä¸è¦æœ‰è½¯è§£æ</li><li>OLTPï¼ˆå¤„ç†ç±»å‹äº‹åŠ¡ï¼‰ï¼Œå°½å¯èƒ½å¤šåœ°å®ç°è½¯è§£æ</li><li>å°½å¯èƒ½åœ¨å†™SQLçš„æ—¶å€™ï¼Œä¿è¯å¤§å°å†™ï¼Œå› ä¸ºSQLè¯­å¥æ˜¯é€šè¿‡ASCIIç ç”ŸæˆhashCodeæ¥åˆ¤æ–­æ˜¯å¦å®ç°è½¯è§£æï¼Œè€Œå¤§å°å†™çš„ASCIIç ä¸åŒï¼Œä¼šå¯¼è‡´ç¡¬è§£æã€‚</li></ul></li><li><p>Optimizationï¼Œå³ä¼˜åŒ–å™¨ï¼Œå½“sqlè¿›å…¥ç¡¬è§£æçš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨ä¼šåˆ¤æ–­æ˜¯èµ°ç´¢å¼•è¿˜æ˜¯å…¨è¡¨æ‰«æã€‚</p><ul><li><p>RBOï¼Œå³rule-based optimizerï¼ŒæŒ‡åŸºäºè§„åˆ™çš„ä¼˜åŒ–</p></li><li><p>CBOï¼Œå³cost-based optimizerï¼ŒæŒ‡åŸºäºå¼€é”€çš„ä¼˜åŒ–ï¼Œéœ€è¦è€ƒè™‘è¯¸å¤šå› ç´ çš„æˆæœ¬ï¼Œç»™å‡ºæœ€ç¬¦åˆæ¡ä»¶çš„sqlç»“æœï¼ˆ10gä»¥åï¼ŒCBOä¸ºé»˜è®¤ä¼˜åŒ–æ¨¡å¼ï¼‰</p><ul><li>CPU</li><li>IO</li><li>å†…å­˜</li></ul></li></ul></li></ul><p>æŸ¥çœ‹ä¼˜åŒ–å™¨</p><blockquote><p>show parameter optimizer</p></blockquote><p><img src="/2021/01/08/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY3/20210108103708-6hwelcf-image.png" alt="image.png"></p><p>ä¿®æ”¹ä¼˜åŒ–å™¨æ¨¡å¼</p><blockquote><p>alter system set optimizer_mode &#x3D; â€˜ruleâ€™</p></blockquote><p>â€</p><h4 id="è½¯è§£æä¸ç¡¬è§£æå®ä¾‹"><a href="#è½¯è§£æä¸ç¡¬è§£æå®ä¾‹" class="headerlink" title="è½¯è§£æä¸ç¡¬è§£æå®ä¾‹"></a>è½¯è§£æä¸ç¡¬è§£æå®ä¾‹</h4><p>å®ä¾‹1ï¼š</p><blockquote><p>select count(*) from test1;  â€“ç¡¬è§£æ</p><p>select count(*) from TEST1;  â€“ä¿®æ”¹è¡¨åå†æ¬¡æ‰§è¡Œï¼Œä¹Ÿæ˜¯ç¡¬è§£æ</p></blockquote><p>å®ä¾‹2ï¼š</p><p>ä½¿ç”¨ç»‘å®šå˜é‡ï¼Œåˆ™å¤šæ¬¡æ‰§è¡Œä¹Ÿä¼šè¢«åˆ¤æ–­ä¸ºè½¯è§£æ</p><blockquote><p>select count(*) from TEST1 where id&#x3D; :x ;  â€“ä½¿ç”¨ç»‘å®šå˜é‡</p></blockquote><p>å®ä¾‹3ï¼š</p><p>åˆ†æå‹ç³»ç»Ÿï¼Œå°‘æœ‰è½¯è§£æã€‚<strong>å¦‚æœæ˜¯åˆ†æå‹æ•°æ®æ£€ç´¢å¤§é‡æ•°æ®ï¼Œå°½é‡å…¨è¡¨æ‰«æï¼Œä¸è¦èµ°ç´¢å¼•ï¼›å¦‚æœæ˜¯æ£€ç´¢å°‘é‡æ•°æ®ï¼Œèµ°ç´¢å¼•é€Ÿåº¦ä¼šæ›´å¿«ã€‚</strong></p><p>åˆ†æç±»å‹çš„æ•°æ®æ˜¯å€¾æ–œçš„ï¼ŒæŸ¥æ‰¾çš„æ•°æ®æ˜¯ä¸å®šçš„ï¼Œä¸å‡åŒ€çš„ã€‚å¦‚æœé‡‡ç”¨ç»‘å®šå˜é‡çš„æ–¹å¼ï¼Œå®ç°è½¯è§£æï¼Œé‚£ä¹ˆé¢å¯¹å€¾æ–œæ•°æ®æ—¶ï¼Œæ ¹æ®è½¯è§£æå¤ç”¨æ‰§è¡Œè®¡åˆ’ï¼Œé’ˆå¯¹åº”è¯¥èµ°ç´¢å¼•å’Œå…¨è¡¨æ‰«æçš„æŸ¥è¯¢ï¼Œéƒ½æ‰§è¡ŒåŒæ ·çš„æ‰§è¡Œè®¡åˆ’æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p><p>é™ä½åˆ†æå‹ç³»ç»Ÿï¼ˆå¦‚æ•°æ®ä»“åº“ç­‰ï¼‰å“åº”æ—¶é—´çš„æ–¹æ³•ï¼š</p><ul><li><p>ä½¿ç‰©ç†è¯»å˜ä¸ºé€»è¾‘è¯»</p></li><li><p>ä½¿ç”¨æ›´å¥½çš„å‹ç¼©æŠ€æœ¯</p></li><li><p>ä½¿ç”¨æ›´å¥½çš„å¹¶è¡ŒæŸ¥è¯¢æŠ€æœ¯ï¼Œä½¿ç”¨å¤§é‡çš„è¿›ç¨‹å¹¶è¡ŒæŸ¥è¯¢</p></li><li><p>æ›´æ¢ç¡¬ç›˜ï¼Œæé«˜IOé€Ÿåº¦</p></li><li><p>æ›´å¥½çš„æ‰«æç®—æ³•</p></li><li><p>Oracle In-Memory Databaseå†…å­˜æ•°æ®åº“ä¼šè‡ªåŠ¨åˆ é™¤ç´¢å¼•ï¼Œæ›´é€‚åˆäºåˆ†æç±»å‹ã€‚</p></li></ul><p>#TODO# å®è·µçš„æ–¹æ³•ï¼Ÿå¦‚ï¼šAWRæŠ¥å‘Šåˆ†æã€SQLä¼˜åŒ–æŠ€å·§å®æˆ˜</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OracleæŠ€æœ¯åˆ†äº« - DAY 2</title>
      <link href="/2021/01/07/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY2/"/>
      <url>/2021/01/07/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY2/</url>
      
        <content type="html"><![CDATA[<h1 id="OracleæŠ€æœ¯åˆ†äº«-DAY-2"><a href="#OracleæŠ€æœ¯åˆ†äº«-DAY-2" class="headerlink" title="OracleæŠ€æœ¯åˆ†äº« - DAY 2"></a>OracleæŠ€æœ¯åˆ†äº« - DAY 2</h1><h2 id="Oracle-Data-Guard"><a href="#Oracle-Data-Guard" class="headerlink" title="Oracle Data Guard"></a>Oracle Data Guard</h2><p>ä¸»ä»åº“æ•°æ®åŒæ­¥æŠ€æœ¯</p><ul><li>åŒæ­¥æ¨¡å¼ï¼šäº§ç”Ÿé˜»å¡ï¼Œäº‹åŠ¡å¤„ç†æ•ˆç‡å¯èƒ½ä¼šå˜ä½</li><li>å¼‚æ­¥æ¨¡å¼ï¼šå½“ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯èƒ½äº§ç”Ÿæ•°æ®ä¸¢å¤±</li></ul><h3 id="ä¿æŠ¤æ¨¡å¼"><a href="#ä¿æŠ¤æ¨¡å¼" class="headerlink" title="ä¿æŠ¤æ¨¡å¼"></a>ä¿æŠ¤æ¨¡å¼</h3><ol><li>æœ€å¤§ä¿æŠ¤æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰</li><li>æœ€å¤§æ€§èƒ½æ¨¡å¼ï¼ˆå¼‚æ­¥ï¼‰</li><li>æœ€å¤§å¯ç”¨æ¨¡å¼ï¼ˆå½“ç½‘ç»œå‡ºé—®é¢˜æ—¶åˆ‡æ¢ä¸ºæœ€å¤§æ€§èƒ½æ¨¡å¼ï¼‰</li></ol><h3 id="ADGè¯»å†™åˆ†ç¦»"><a href="#ADGè¯»å†™åˆ†ç¦»" class="headerlink" title="ADGè¯»å†™åˆ†ç¦»"></a>ADGè¯»å†™åˆ†ç¦»</h3><p>ADGï¼Œå³Active Data Guardï¼Œå±äºOracleé€‰ä»¶åŠŸèƒ½ï¼Œç”¨äºä¿æŒMasterå’ŒSlaveåº“çš„æ•°æ®åŒæ­¥ã€‚</p><blockquote><p>æ•°æ®åº“çš„å››ç§çŠ¶æ€</p><ul><li>closeï¼šæ•°æ®åº“å¤„äºå…³é—­çŠ¶æ€</li><li>nomountï¼šä»…è¯»å–spfileå‚æ•°æ–‡ä»¶</li><li>mountï¼šè¿›ä¸€æ­¥è¯»å–ctlç»“å°¾çš„æ§åˆ¶æ–‡ä»¶</li><li>openï¼šè¯»å–åˆ°äº†dbfæ•°æ®æ–‡ä»¶</li></ul></blockquote><p>åœ¨ADGçŠ¶æ€ä¸‹çš„Slaveåº“ï¼Œå¤„äº <code>open</code> ä»¥åŠ <code>read only</code> çŠ¶æ€</p><p>åœ¨DGçŠ¶æ€ä¸‹çš„Slaveåº“ï¼Œå¤„äº <code>mount</code> çŠ¶æ€ï¼Œå½“ä¸»åº“å‘ç”Ÿé—®é¢˜æ—¶ï¼Œå¤‡åº“æ‰å¯ä»¥è¯»å†™</p><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯ä¸»åº“è¿˜æ˜¯ä»åº“</p><blockquote><p>select database_role from v$database</p></blockquote><p><code>Primary</code> è¡¨ç¤ºä¸»åº“ï¼Œ<code>StandBy</code> è¡¨ç¤ºå¤‡åº“ã€‚</p><p>â€</p><h2 id="Oracle-RAC"><a href="#Oracle-RAC" class="headerlink" title="Oracle RAC"></a>Oracle RAC</h2><p>Oracle æ•°æ®åº“é›†ç¾¤ï¼ˆ10gä»¥åï¼‰</p><h3 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h3><ul><li>ASMï¼šå³Auto Storage Managementï¼Œè‡ªåŠ¨å­˜å‚¨ç®¡ç†</li><li>Oracle Voting Diskï¼šé›†ç¾¤å†³ç­–ç£ç›˜ï¼Œç”¨äºèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶çš„å†³ç­–</li><li>Oracle OCRï¼šå…±äº«å­˜å‚¨</li><li>Clusterware</li><li>æœåŠ¡é—´å¯é€šä¿¡ï¼ˆå®½å¸¦å°½å¯èƒ½å¿«ï¼‰ï¼Œå…è®¸å¿ƒè·³è¿æ¥</li></ul><h3 id="æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h3><p>RACæ¶æ„ä¸‹ï¼Œä¸€ä»½æ•°æ®æ‰€æœ‰é›†ç¾¤å…±äº«ã€‚</p><p>é›†ç¾¤å®¹æ˜“äº§ç”Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼š</p><blockquote><p>Instance A ä¿®æ”¹æ•°æ®ä¸º50</p><p>Instance B ä¿®æ”¹æ•°æ®ä¸º100</p><p>å…±äº«å­˜å‚¨åŸæ•°æ®ä¸º 20ï¼Œæ­¤æ—¶éœ€è¦ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ§åˆ¶</p></blockquote><p>RACä¸‹æ•°æ®è‡ªåŠ¨åˆ’åˆ†åŒºåŸŸï¼ŒæŠŠå¤šä¸ªæ•°æ®åº“åˆæˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ã€‚å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¹‹é—´é€šè¿‡å¿ƒè·³è¿æ¥ç›¸äº’è®¿é—®ã€‚</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>è§å®éªŒç¯å¢ƒè™šæ‹Ÿæœº2</p><p>æ£€ç´¢racä¸Šçš„æ•°æ®æ–‡ä»¶ï¼Œåªæœ‰é€šè¿‡ <code>asmcmd</code> å‘½ä»¤æ‰èƒ½è¿›å…¥racæ•°æ®æ–‡ä»¶ç›®å½•ã€‚</p><p>ç›®å½•ä¸‹å­˜æ”¾oracleçš„å…³é”®æ–‡ä»¶ï¼Œå¦‚æ•°æ®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€æ§åˆ¶æ–‡ä»¶ç­‰ã€‚</p><blockquote><p>select file_name from dba_data_files;</p><p>asmcmd</p></blockquote><p>é™¤äº† <code>asmcmd</code> å¤–ï¼Œæä¾›sqlplusçš„è¿æ¥æ–¹å¼</p><blockquote><p>sqlplus &#x2F; as sysasm</p></blockquote><p>å…¶ä»–</p><ul><li><p>RACå¯ä»¥ä¿è¯é«˜å¯ç”¨æ€§</p></li><li><p>ä¸ä¼šé¢å¤–æ¶ˆè€—IOï¼Œé€šè¿‡å¿ƒè·³è¿æ¥å‘é€ä¸åŒå®ä¾‹çš„æ•°æ®å—ï¼ˆCache FusionæŠ€æœ¯ï¼‰</p><ul><li>å½“å¤§é‡Cache Fusionäº§ç”Ÿæ—¶ï¼ˆå¤šæ¬¡è·¨å®ä¾‹è®¿é—®æ•°æ®å—ï¼‰ï¼Œä¼šå¯¼è‡´å•ä¸ªå®ä¾‹æ€§èƒ½ä¸‹é™</li><li>å¦‚æœåº”ç”¨å…è®¸åˆ†åº“åˆ†è¡¨ï¼Œä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œèƒ½å¤Ÿå¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚å³ä¸šåŠ¡æ‹†åˆ†</li></ul></li><li><p>éœ€è¦åœ¨racä¸Šè¿è¡Œåº”ç”¨è¿›è¡Œæµ‹è¯•ï¼Œä¿è¯æ€§èƒ½ä¸ä¸‹é™</p></li><li><p>é€šè¿‡Grdæä¾›ç»Ÿä¸€çš„æƒé™ç®¡ç†æœºåˆ¶ï¼Œæ‰€æœ‰æƒé™è¯·æ±‚éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚</p></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>æ•°æ®åº“æ’åå‚è€ƒ</p><blockquote><p><a href="https://db-engines.com/en/ranking">https://db-engines.com/en/ranking</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OracleæŠ€æœ¯åˆ†äº« - DAY 1</title>
      <link href="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/"/>
      <url>/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/</url>
      
        <content type="html"><![CDATA[<h1 id="OracleæŠ€æœ¯åˆ†äº«-DAY-1"><a href="#OracleæŠ€æœ¯åˆ†äº«-DAY-1" class="headerlink" title="OracleæŠ€æœ¯åˆ†äº« - DAY 1"></a>OracleæŠ€æœ¯åˆ†äº« - DAY 1</h1><p><strong>æ•°æ®åº“ç‰ˆæœ¬ Oracle 19C</strong></p><h2 id="å·¥å…·ç›¸å…³"><a href="#å·¥å…·ç›¸å…³" class="headerlink" title="å·¥å…·ç›¸å…³"></a>å·¥å…·ç›¸å…³</h2><ul><li>Enterprise Manager Cloud Control ï¼ˆB&#x2F;Sæ¶æ„ï¼‰</li><li>SQL Developer</li><li>SQL Plus</li></ul><h2 id="ç½‘é¡µç›¸å…³"><a href="#ç½‘é¡µç›¸å…³" class="headerlink" title="ç½‘é¡µç›¸å…³"></a>ç½‘é¡µç›¸å…³</h2><ul><li>æ–‡æ¡£ä¸­å¿ƒï¼šdocs.oracle.com</li><li>metalinkå¸®åŠ©ä¸­å¿ƒï¼šsupport.oracle.com</li></ul><h2 id="æ‰‹å†Œç›¸å…³"><a href="#æ‰‹å†Œç›¸å…³" class="headerlink" title="æ‰‹å†Œç›¸å…³"></a>æ‰‹å†Œç›¸å…³</h2><blockquote><p>ä»¥ä¸‹æ‰‹å†Œåå­—ï¼Œå‡æ¥è‡ª docs.oracle.com</p></blockquote><p>è¿ç»´</p><ul><li><code>Database Administrator&#39;s Guide</code> æ•°æ®åº“ç®¡ç†æ‰‹å†Œ</li><li><code>Database Reference</code> æ•°æ®åº“çŠ¶æ€ç›¸å…³ä¿¡æ¯</li></ul><p>å¼€å‘</p><ul><li><code>Database Development Guide</code>  æ•°æ®åº“å¼€å‘å‚è€ƒæ‰‹å†Œï¼ˆé‡è¦ï¼‰</li><li><code>SQL Language Reference</code> SQLè¯­è¨€å‚è€ƒæ‰‹å†Œ</li><li><code>Database PL/SQL Packages and Types Reference</code> PLSQLç¨‹åºåŒ…</li><li><code>Oracle Database Data Warehousing Guide</code> æ•°æ®ä»“åº“å‚è€ƒæ‰‹å†Œ</li><li><code>Database PL/SQL Packages and Types Reference</code> Oracleæ ‡å‡†PLSQLç¨‹åºåŒ…å‚è€ƒæ‰‹å†Œ</li></ul><p>æ•°æ®åº“åŸç†</p><ul><li><code>Database Concepts</code></li></ul><p>æ€§èƒ½ä¼˜åŒ–</p><ul><li><code>Database Performance Tuning Guide</code> æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–æŒ‡å—</li><li><code>SQL Tuning Guide</code> SQLè°ƒä¼˜æŒ‡å—</li></ul><h3 id="Database-Reference"><a href="#Database-Reference" class="headerlink" title="Database Reference"></a>Database Reference</h3><h4 id="æ•°æ®å­—å…¸"><a href="#æ•°æ®å­—å…¸" class="headerlink" title="æ•°æ®å­—å…¸"></a>æ•°æ®å­—å…¸</h4><p><strong>æŸ¥è¯¢ç»“æœæ¥è‡ªäºç£ç›˜</strong></p><ul><li><p>cdb_[table_name] (å¤šç§Ÿæˆ·ç¯å¢ƒä¸‹)</p></li><li><p>dba_[table_name]</p></li><li><p>all_[table_name]</p></li><li><p>user_[table_name]</p></li></ul><h4 id="åŠ¨æ€æ€§èƒ½"><a href="#åŠ¨æ€æ€§èƒ½" class="headerlink" title="åŠ¨æ€æ€§èƒ½"></a>åŠ¨æ€æ€§èƒ½</h4><p><strong>æŸ¥è¯¢ç»“æœæ¥è‡ªäºå†…å­˜</strong></p><ul><li>v$[table_name]</li></ul><h4 id="åˆå§‹åŒ–å‚æ•°"><a href="#åˆå§‹åŒ–å‚æ•°" class="headerlink" title="åˆå§‹åŒ–å‚æ•°"></a>åˆå§‹åŒ–å‚æ•°</h4><h2 id="åˆ›å»ºæ•°æ®åº“å®ä¾‹"><a href="#åˆ›å»ºæ•°æ®åº“å®ä¾‹" class="headerlink" title="åˆ›å»ºæ•°æ®åº“å®ä¾‹"></a>åˆ›å»ºæ•°æ®åº“å®ä¾‹</h2><h4 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h4><p>æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi .bash_profile</span><br></pre></td></tr></table></figure><p>æ·»åŠ Oracleç¯å¢ƒå˜é‡ï¼Œå¹¶ä¿å­˜é€€å‡º</p><p>ã€æ³¨æ„ã€‘å¯ä»¥ä½¿ç”¨ <code>shift + åŒå‡»zé”®</code> ï¼Œä¸<code>:wq</code> ç­‰æ•ˆ</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210106143902-t2tovtv-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>å†æ¬¡æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</p><p>ã€æ³¨æ„ã€‘ä½¿ç”¨ <code>. + ç©ºæ ¼</code> ç­‰åŒäº <code>source</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ./.bash_profile</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210106144346-qkbwbsa-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h4 id="é€šè¿‡å›¾å½¢åŒ–ç•Œé¢åˆ›å»º"><a href="#é€šè¿‡å›¾å½¢åŒ–ç•Œé¢åˆ›å»º" class="headerlink" title="é€šè¿‡å›¾å½¢åŒ–ç•Œé¢åˆ›å»º"></a>é€šè¿‡å›¾å½¢åŒ–ç•Œé¢åˆ›å»º</h4><p>ã€æ³¨æ„ã€‘ä»¥ä¸‹æ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œå‡é€‚ç”¨é»˜è®¤é…ç½®</p><p>é€‰ä¸­ <code>åˆ›å»ºæ•°æ®åº“</code> å¹¶ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p>é€‰ä¸­ <code>é«˜çº§é…ç½®</code></p><p>æ¥åˆ°å¦‚ä¸‹å›¾ç•Œé¢</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210106145800-ot0aj04-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><ul><li>ä¸€èˆ¬ç”¨é€”æˆ–äº‹åŠ¡å¤„ç†ï¼šæŒ‡OLTPç±»å‹çš„ä¸šåŠ¡ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ï¼Œäº‹åŠ¡é‡å¤§çš„æƒ…å†µã€‚</li><li>æ•°æ®ä»“åº“ï¼šå¯¹äºåˆ†æã€è¯»å–æ•°æ®éœ€æ±‚é‡å¤§çš„æƒ…å†µï¼Œå¦‚è¿è¡ŒæŠ¥è¡¨ç­‰ã€‚</li></ul><p>é€‰ä¸­<code>å®šåˆ¶æ•°æ®åº“</code>ï¼Œå¹¶ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210106150452-3gta6ry-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><ul><li>SIDï¼šæ•°æ®åº“å”¯ä¸€æ ‡ç¤º</li><li>åˆ›å»ºä¸ºå®¹å™¨æ•°æ®åº“ï¼š12Cä»¥åçš„å¤šç§Ÿæˆ·çš„æ–°ç‰¹æ€§</li></ul><p>è®¾ç½®é»˜è®¤ç«¯å£å’Œç›‘å¬</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210106152015-3vvywa8-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>æœ€ç»ˆç»“æœå¦‚ä¸‹</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210106152942-r9guqf8-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h2 id="Oracle-å†…å­˜æ•°æ®åº“"><a href="#Oracle-å†…å­˜æ•°æ®åº“" class="headerlink" title="Oracle å†…å­˜æ•°æ®åº“"></a>Oracle å†…å­˜æ•°æ®åº“</h2><p><strong>Oracle Database In-Memory</strong></p><blockquote><p>åœ¨çº¿å®éªŒå®¤ <a href="https://apexapps.oracle.com/pls/apex/dbpm/r/livelabs/home">https://apexapps.oracle.com/pls/apex/dbpm/r/livelabs/home</a></p></blockquote><p>é€‰æ‹©DBA</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109114722-sjc7bh9-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>é€‰æ‹©å†…å­˜æ•°æ®åº“</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109114803-mnskv49-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>ç‚¹å‡» Reserve WorkShop</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109114846-rdn34od-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>å¯åŠ¨puttyGenç”Ÿæˆpublic keyï¼Œç„¶åå¤åˆ¶åˆ°oracleè¡¨å•ä¸­</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109115033-8hloqxd-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>ç­‰å¾…ç¯å¢ƒåŠ è½½</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109115131-zb7n35l-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>ç‚¹å‡»æ­¤å¤„è¿›å…¥ï¼Œè·å–ç¯å¢ƒä¿¡æ¯</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109115408-mn1dvwu-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>ç¯å¢ƒä¿¡æ¯å¦‚ä¸‹ï¼Œå¹¶æŠŠipå’Œusernameå¡«å…¥xshell</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109120200-3r2tskq-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>ç„¶ååœ¨xshellä¸­å¯¼å…¥å¯†é’¥ï¼Œæ³¨æ„ç§é’¥å¿…é¡»ä¸º <code>OpenSSH</code> æ ¼å¼</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109120249-7pjpxxm-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>â€</p><h2 id="Oracleå®éªŒ"><a href="#Oracleå®éªŒ" class="headerlink" title="Oracleå®éªŒ"></a>Oracleå®éªŒ</h2><p>å¯åŠ¨æ•°æ®åº“å®ä¾‹ï¼Œå¹¶æŸ¥çœ‹å®ä¾‹çŠ¶æ€</p><blockquote><p>select status from v$instance;</p></blockquote><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107102412-3iqjzmy-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>æŸ¥çœ‹ç›‘å¬çŠ¶æ€ &amp; å¯åŠ¨ç›‘å¬</p><blockquote><p>lsnrctl status</p><p>lsnrctl start</p></blockquote><p>åˆ‡æ¢Oracle SID</p><blockquote><p>export ORACLE_SID&#x3D;TEST</p></blockquote><p>æ— éœ€ç”¨æˆ·å&amp;å¯†ç è¿›å…¥æ•°æ®åº“</p><p>å½“ä½¿ç”¨Oracleç”¨æˆ·ç»„å’ŒOracleç”¨æˆ·å®‰è£…æ•°æ®åº“æ—¶ï¼Œä»¥æœ€é«˜ç³»ç»Ÿæƒé™è¿›å…¥æ•°æ®åº“ï¼ˆæ“ä½œç³»ç»Ÿæƒé™éªŒè¯ï¼‰</p><blockquote><p>sqlplus &#x2F; as sysdba</p></blockquote><h3 id="ä½¿ç”¨SQL-Developerç®¡ç†æ’ä»¶"><a href="#ä½¿ç”¨SQL-Developerç®¡ç†æ’ä»¶" class="headerlink" title="ä½¿ç”¨SQL Developerç®¡ç†æ’ä»¶"></a>ä½¿ç”¨SQL Developerç®¡ç†æ’ä»¶</h3><h4 id="æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€"><a href="#æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€"></a>æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€</h4><p>è·¯å¾„ï¼šæŸ¥çœ‹ -&gt; DBA</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107102551-w1krc1d-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>å·¦ä¸‹è§’ä¼šå‡ºç°æ–°çš„é¡µç­¾ï¼Œç‚¹å‡»ç»¿è‰²åŠ å·æ·»åŠ æ•°æ®åº“</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107102641-mftkw1d-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107102923-7a5rfrk-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>åˆ›å»ºè¡¨ç©ºé—´</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107110233-km60pzn-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h4 id="æŸ¥çœ‹æ•°æ®åº“æŠ¥å‘Š"><a href="#æŸ¥çœ‹æ•°æ®åº“æŠ¥å‘Š" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“æŠ¥å‘Š"></a>æŸ¥çœ‹æ•°æ®åº“æŠ¥å‘Š</h4><p>è·¯å¾„ï¼šæŸ¥çœ‹ -&gt; æŠ¥å‘Š</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107103057-tp3zaj0-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>ä»¥æŸ¥çœ‹ç”¨æˆ·é”ä¸ºä¾‹</p><p>è·¯å¾„ï¼šæ•°æ®å­—å…¸æŠ¥å‘Š -&gt; æ•°æ®åº“ç®¡ç† -&gt; é”å®š -&gt; æŒ‰ç”¨æˆ·ç»Ÿè®¡çš„é”</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107103337-twtqz63-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h3 id="æ•°æ®åº“æ–‡ä»¶"><a href="#æ•°æ®åº“æ–‡ä»¶" class="headerlink" title="æ•°æ®åº“æ–‡ä»¶"></a>æ•°æ®åº“æ–‡ä»¶</h3><p>æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ï¼Œè¿›å…¥ç›®å½•</p><blockquote><p>&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;</p><p>ls</p></blockquote><p>æµ‹è¯•ç¯å¢ƒå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107104008-bi1e9ai-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h5 id="æ§åˆ¶æ–‡ä»¶"><a href="#æ§åˆ¶æ–‡ä»¶" class="headerlink" title="æ§åˆ¶æ–‡ä»¶"></a>æ§åˆ¶æ–‡ä»¶</h5><p><code>control.ctl</code></p><p>ä¸åŒçš„ç¯å¢ƒï¼Œå¯èƒ½æœ‰å¤šä¸ªæ§åˆ¶æ–‡ä»¶ï¼Œé‡‡ç”¨å¤šè·¯å¤ç”¨æŠ€æœ¯</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107104259-nidd29e-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h5 id="é‡åšæ—¥å¿—"><a href="#é‡åšæ—¥å¿—" class="headerlink" title="é‡åšæ—¥å¿—"></a>é‡åšæ—¥å¿—</h5><p><code>redo.log</code></p><p>å¤šç»„æ—¥å¿—æ–‡ä»¶æ—¥å¿—å†…å®¹éƒ½ç›¸åŒï¼Œå¾ªç¯å¤å…¥ï¼Œå†™æ»¡åˆ‡æ¢ã€‚</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107104919-rw55dvz-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><h5 id="æ•°æ®æ–‡ä»¶"><a href="#æ•°æ®æ–‡ä»¶" class="headerlink" title="æ•°æ®æ–‡ä»¶"></a>æ•°æ®æ–‡ä»¶</h5><p>ä»¥ <code>dbf</code> ç»“å°¾</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107105030-a0nllmj-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><blockquote><p>é€»è¾‘ç»“æ„</p><p>å— -&gt; åŒº -&gt; æ®µ -&gt; è¡¨ç©ºé—´ -&gt; æ•°æ®åº“</p><p>æ®µï¼šå­˜æ”¾æ•°æ®çš„å¯¹è±¡ï¼Œå¦‚è¡¨æ®µã€ç´¢å¼•æ®µç­‰</p><p>å—ï¼šOracleæ•°æ®åº“å­˜å‚¨çš„æœ€å°å•å…ƒï¼Œé»˜è®¤å¤§å°ä¸º8k</p></blockquote><h5 id="å‚æ•°æ–‡ä»¶"><a href="#å‚æ•°æ–‡ä»¶" class="headerlink" title="å‚æ•°æ–‡ä»¶"></a>å‚æ•°æ–‡ä»¶</h5><p>è¿›å…¥Oracleå®‰è£…ç›®å½•ä¸‹çš„ <code>dbs</code> ç›®å½•</p><p>ä»¥å®éªŒç¯å¢ƒä¸ºä¾‹</p><blockquote><p>cd &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;19.3.0&#x2F;dbhome_1&#x2F;dbs</p></blockquote><p>å‚æ•°æ–‡ä»¶å¦‚ä¸‹å›¾</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107110644-s4amgnn-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>åœ¨Oracleå¯åŠ¨å®ä¾‹æ—¶ï¼Œä¼šå…ˆå¯åŠ¨è¿›ç¨‹åŠ è½½å‚æ•°æ–‡ä»¶ï¼Œç„¶åæ ¹æ®å‚æ•°åŠ è½½å®ä¾‹</p><p>ã€æ³¨æ„ã€‘æœåŠ¡å™¨å‚æ•°æ–‡ä»¶å¿…é¡»ä¸ºspfile[SID].oraï¼Œå…¶ä¸­SIDå¿…é¡»ä¸€è‡´</p><p>æŸ¥çœ‹æ•°æ®åº“å®ä¾‹ï¼Œå¯ä»¥æ ¹æ®ä¸‹åˆ’çº¿ç»“å°¾ï¼Œè·å–SID</p><blockquote><p>ps -ef | grep smon</p></blockquote><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210107111220-nb8sesk-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>æ­¤æ—¶å¯ä»¥çŸ¥é“ï¼ŒSID&#x3D;TEST</p><p><strong>æœåŠ¡åå’ŒSIDçš„åŒºåˆ«ï¼Ÿ</strong></p><p>SIDæ˜¯æ•°æ®åº“å®ä¾‹çš„å”¯ä¸€è¯†åˆ«å·ã€‚å¦‚æœæ˜¯ORACLE RACä¸‹ï¼Œå¤šä¸ªå®ä¾‹å°±ä¼šæœ‰å¤šä¸ªSIDã€‚è€ŒSERVER_NAMEæ˜¯æ•°æ®åº“å®ä¾‹çš„åç§°ï¼Œç”¨äºæ ‡ç¤ºå¤–éƒ¨ç³»ç»Ÿï¼Œæˆ‘æ•°æ®åº“å«â€SERVICE_NAMEâ€ã€‚å¯¹äºå¤–éƒ¨ç³»ç»Ÿè€Œè¨€ï¼Œæ—¢å¯ä»¥ç”¨SIDè¿›è¡Œè¿æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨SERVER_NAMEè¿›è¡Œè¿æ¥ã€‚åŒä¸€ä¸ªå®ä¾‹ä¸‹ï¼ŒSIDå’ŒSERVER_NAMEæ˜¯å”¯ä¸€å¯¹åº”çš„ã€‚</p><h3 id="åœåº“æŒ‡ä»¤"><a href="#åœåº“æŒ‡ä»¤" class="headerlink" title="åœåº“æŒ‡ä»¤"></a>åœåº“æŒ‡ä»¤</h3><p>1.ç«‹å³åœæ­¢</p><blockquote><p>shutdown immediate</p></blockquote><p>2.å†…å­˜æ–­ç”µåœæ­¢</p><blockquote><p>shutdown abort</p></blockquote><p>è¿™ç§åœæ­¢æ–¹å¼ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>å†…å­˜æ•°æ®åº“ã€SQLè°ƒä¼˜</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>1.Oracleå­¦ä¹ å·¥å…·</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109120622-as3cfhr-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>2.Oracleä½“ç³»ç»“æ„</p><p><img src="/2021/01/06/Oracle%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%ABDAY1/20210109120652-9li7bxf-image.png" alt="OracleæŠ€æœ¯åˆ†äº«DAY1.png"></p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </title>
      <link href="/2020/11/28/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0/"/>
      <url>/2020/11/28/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ "><a href="#å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ " class="headerlink" title="å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ "></a>å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </h1><p>â€</p><h2 id="æ­¥éª¤æ‹†åˆ†"><a href="#æ­¥éª¤æ‹†åˆ†" class="headerlink" title="æ­¥éª¤æ‹†åˆ†"></a>æ­¥éª¤æ‹†åˆ†</h2><p>1.ä¸‹è½½æ–‡ä»¶</p><p>2.æ–­ç‚¹ç»­ä¼ </p><p>3.å¤šçº¿ç¨‹ä¸‹è½½</p><p>4.å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </p><p>â€</p><h2 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h2><h3 id="æ–­ç‚¹ç»­ä¼ ä¸‹è½½"><a href="#æ–­ç‚¹ç»­ä¼ ä¸‹è½½" class="headerlink" title="æ–­ç‚¹ç»­ä¼ ä¸‹è½½"></a>æ–­ç‚¹ç»­ä¼ ä¸‹è½½</h3><h4 id="æ­¥éª¤åˆ†è§£"><a href="#æ­¥éª¤åˆ†è§£" class="headerlink" title="æ­¥éª¤åˆ†è§£"></a>æ­¥éª¤åˆ†è§£</h4><ol><li><p>æ¨èè‡³å°‘ä¸¤ä¸ªçº¿ç¨‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸€ä¸ªHttpURLConnectionæ‰“å¼€åï¼Œè·å–å®Œæ–‡ä»¶é•¿åº¦ï¼Œå†å…³é—­ï¼›ç„¶åå†æ‰“å¼€ï¼Œç„¶åè®¾ç½®æ–‡ä»¶æ•°æ®èŒƒå›´</p><ol><li>ä¸»çº¿ç¨‹ï¼šHttpURLConnection.getContentLengthLong() è·å–æ–‡ä»¶å¤§å°</li><li>å­çº¿ç¨‹ï¼šHttpURLConnection.setRequestProperty(â€œRangeâ€, â€œbytes&#x3D;â€ + filePos + â€œ-â€œ + fileEnd) è·å–æ–‡ä»¶æ•°æ®èŒƒå›´</li></ol></li><li><p>File.length()ä¸HttpURLConnection.getContentLengthLong()æ¯”è¾ƒæ–‡ä»¶å¤§å°</p></li><li><p>RandomAccessFileå†™å…¥æ–‡ä»¶ï¼ˆå¦‚ä¸‹ï¼‰</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(fileDir, <span class="string">&quot;rws&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœç´¢ç»­ä¼ çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">        raf.seek(filePos);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶å†™å…¥</span></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">        <span class="keyword">while</span> ((length = is.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            raf.write(buffer, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        raf.close();</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.playgroud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•çº¿ç¨‹ä¸‹çš„æ–­ç‚¹ç»­ä¼ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadTest</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½çš„URL</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> String storePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">fileReqLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DownloadTest</span><span class="params">(String url, String storePath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">        <span class="built_in">this</span>.storePath = storePath;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO è€ƒè™‘è·å–ä¸åˆ°æ–‡ä»¶åçš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶å</span></span><br><span class="line">        <span class="built_in">this</span>.fileName = url.substring(url.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>, url</span><br><span class="line">                .contains(<span class="string">&quot;?&quot;</span>) ? url.lastIndexOf(<span class="string">&#x27;?&#x27;</span>) : url.length());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String url, <span class="type">long</span> fileStart, <span class="type">long</span> fileEnd)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            downloadURL = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">            connection = (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">            connection.setRequestProperty(<span class="string">&quot;Range&quot;</span>, <span class="string">&quot;bytes=&quot;</span> + fileStart + <span class="string">&quot;-&quot;</span> + fileEnd);</span><br><span class="line">            connection.connect();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å¼€å§‹æ–­ç‚¹ç»­ä¼ ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connection.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName, <span class="string">&quot;rws&quot;</span>);</span><br><span class="line">            raf.seek(fileStart);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™å…¥åˆ°æ–‡ä»¶</span></span><br><span class="line">            <span class="type">int</span> length;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">            <span class="keyword">while</span> ((length = is.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                raf.write(buffer, <span class="number">0</span>, length);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            raf.close();</span><br><span class="line">            is.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶ç»­ä¼ å¤±è´¥!&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸‹è½½å®Œæˆ!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">openHttpConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿æ¥ä¸­...&quot;</span>);</span><br><span class="line">            downloadURL = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">            connection = (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">            connection.connect();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;URLæ— æ•ˆ&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// httpè¯·æ±‚è®¾ç½®</span></span><br><span class="line">        connection.setConnectTimeout(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.connect();</span><br><span class="line">            <span class="keyword">if</span> (connection.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¿æ¥æœåŠ¡å™¨æˆåŠŸ!&quot;</span>);</span><br><span class="line"></span><br><span class="line">                fileReqLength = connection.getContentLength();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¿æ¥æœåŠ¡å™¨å¤±è´¥: &quot;</span> + connection.getResponseCode()</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span> + connection.getResponseMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿æ¥æ–‡ä»¶æœåŠ¡å™¨å¤±è´¥!&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connection.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥æ–‡ä»¶æœåŠ¡å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å¼€httpè¿æ¥ï¼Œè·å–æ–‡ä»¶æ€»å¤§å°</span></span><br><span class="line">        openHttpConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶å…¨è·¯å¾„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">downloadFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å: &quot;</span> + downloadFile.toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ç±»å‹: &quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å¤§å°: &quot;</span> + (fileReqLength / <span class="number">1024</span> / <span class="number">1024</span>) + <span class="string">&quot;MB&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!downloadFile.exists()) &#123;</span><br><span class="line">            <span class="comment">// æ–‡ä»¶ä¸å­˜åœ¨åˆ™ç›´æ¥ä¸‹è½½</span></span><br><span class="line">            download(url, <span class="number">0</span>, fileReqLength);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ¯”è¾ƒæ–‡ä»¶å¤§å°</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">fileLocalLength</span> <span class="operator">=</span> downloadFile.length();</span><br><span class="line">            <span class="keyword">if</span> (fileReqLength == fileLocalLength) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶å·²ä¸‹è½½å®Œæˆ!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶å·²è¿æ¥ï¼Œå·²ä¸‹è½½: &quot;</span> + (fileLocalLength / <span class="number">1024</span> / <span class="number">1024</span>)</span><br><span class="line">                        + <span class="string">&quot;MB&quot;</span> + <span class="string">&quot;ï¼›å‰©ä½™: &quot;</span> + (fileReqLength - fileLocalLength) / <span class="number">1024</span> / <span class="number">1024</span> + <span class="string">&quot;MB&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ–­ç‚¹ç»­ä¼ </span></span><br><span class="line">                <span class="type">long</span> <span class="variable">filePos</span> <span class="operator">=</span> fileLocalLength;</span><br><span class="line">                download(url, filePos, fileReqLength);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Main Thread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://dldir1.qq.com/qqfile/qq/QQ7.9/16621/QQ7.9.exe&quot;</span>;</span><br><span class="line">        <span class="type">DownloadTest</span> <span class="variable">downloadTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DownloadTest</span>(url, storePath);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(downloadTest);</span><br><span class="line">        t1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æ™®é€šæ–‡ä»¶ä¸‹è½½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½çš„URL</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> String storePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DownloadTest</span><span class="params">(String url, String storePath, String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">        <span class="built_in">this</span>.storePath = storePath;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">        <span class="comment">//File tempFile = new File(storePath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå•ä½ms</span></span><br><span class="line">        connection.setConnectTimeout(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶é•¿åº¦,å•ä½byte</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">fileLength</span> <span class="operator">=</span> connection.getContentLengthLong();</span><br><span class="line">        <span class="comment">// FIXME æ–‡ä»¶å¤§å°åˆ¤æ–­ä¸å‡†ç¡®</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å¤§å°: &quot;</span> + fileLength / <span class="number">1024</span> / <span class="number">1024</span> + <span class="string">&quot;MB&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO è·å–æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶å lastIndexOf</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ç±»å‹:&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨æœ¬åœ°æ–°å»ºæ–‡ä»¶</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">fileDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶è·¯å¾„:&quot;</span> + fileDir);</span><br><span class="line">        <span class="keyword">if</span>(!fileDir.exists())</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">// TODO æ–­ç‚¹ç»­ä¼ </span></span><br><span class="line"><span class="comment">//            RandomAccessFile raf = new RandomAccessFile(fileDir,&quot;rws&quot;);</span></span><br><span class="line"><span class="comment">//            raf.setLength(fileLength);</span></span><br><span class="line"><span class="comment">//            raf.close();</span></span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ä¸‹è½½ä¸­...&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(fileDir);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> length;</span><br><span class="line">            <span class="keyword">while</span> ((length = is.read(buffer)) != -<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                fos.write(buffer,<span class="number">0</span>,length);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            is.close();</span><br><span class="line">            fos.close();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸‹è½½å®Œæ¯•ï¼&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Main Thread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://dldir1.qq.com/qqfile/qq/QQ7.9/16621/QQ7.9.exe&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;QQ7.9.exe&quot;</span>;</span><br><span class="line">        <span class="type">DownloadTest</span> <span class="variable">downloadTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DownloadTest</span>(url, storePath, fileName);</span><br><span class="line"></span><br><span class="line">        downloadTest.download();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å¤šçº¿ç¨‹ä¸‹è½½"><a href="#å¤šçº¿ç¨‹ä¸‹è½½" class="headerlink" title="å¤šçº¿ç¨‹ä¸‹è½½"></a>å¤šçº¿ç¨‹ä¸‹è½½</h3><h4 id="æ­¥éª¤åˆ†è§£-1"><a href="#æ­¥éª¤åˆ†è§£-1" class="headerlink" title="æ­¥éª¤åˆ†è§£"></a>æ­¥éª¤åˆ†è§£</h4><ol><li>æ–‡ä»¶åˆ†å—ï¼Œä¸æ–‡ä»¶çš„èµ·æ­¢ä¸‹è½½ä½ç½®</li></ol><blockquote><p>1ã€æ–‡ä»¶åˆ†å—ã€‚ æ–‡ä»¶åˆ†å—å¤§å°ï¼ˆblockSizeï¼‰&#x3D; ï¼ˆæ–‡ä»¶å¤§å° +çº¿ç¨‹æ•° - 1 ï¼‰&#x2F; çº¿ç¨‹æ•° ;<br>2ã€ç¡®å®šæ¯ä¸€ä¸ªçº¿ç¨‹æ‰€è¦ä¸‹è½½çš„ æ–‡ä»¶çš„èµ·å§‹å’Œç»“æŸä½ç½®ã€‚<br>ç°å‡è®¾ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†åˆ«ç¼–å·ï¼š0ï¼Œ1ï¼Œ 2ï¼Œ3ï¼›åˆ™<br>ç¬¬ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£çš„ä¸‹è½½ä½ç½®æ˜¯ï¼š 0<em>blockSize - (0+1)</em> blockSize -1ï¼Œ<br>ç¬¬äºŒä¸ªçº¿ç¨‹è´Ÿè´£çš„ä¸‹è½½ä½ç½®æ˜¯ï¼š 1* blockSize - (1+1)<em>blockSize -1ï¼Œ</em>â€‹<em>ä»¥æ­¤ç±»æ¨ç¬¬iä¸ªçº¿ç¨‹è´Ÿè´£çš„ä¸‹è½½ä½ç½®æ˜¯ï¼ši</em> blockSize - (i+1)<em>blockSize -1ï¼›</em>â€‹<em>å³çº¿ç¨‹ï¼ˆç¼–å·ä¸ºidï¼‰ä¸‹è½½å¼€å§‹ä½ç½® start &#x3D; id</em> block;<br>å³çº¿ç¨‹ï¼ˆç¼–å·ä¸ºidï¼‰ä¸‹è½½ç»“æŸä½ç½® end &#x3D; (id+1)*block -1;</p></blockquote><ol start="2"><li>çº¿ç¨‹åŒæ­¥ï¼šä½¿ç”¨CountDownLatchåŒæ­¥å„çº¿ç¨‹çš„ä»»åŠ¡ï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆäº†ï¼Œæ‰ç®—æ‰§è¡Œå®Œæ¯•ã€‚</li></ol><p>â€</p><h4 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>æ ¸å¿ƒä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.playgroud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤šçº¿ç¨‹ä¸‹è½½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadMultiply</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½çš„URL</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> String storePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> Long fileReqLength;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½çš„çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer threadNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹åŒæ­¥å™¨</span></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     * 1.å‚æ•°è®¾ç½®ï¼šURLã€æ–‡ä»¶ä¿å­˜è·¯å¾„ã€ä¸‹è½½çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="comment">     * 2.è·å–ä¸‹è½½çš„æ–‡ä»¶åã€æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> storePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadNum</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DownloadMultiply</span><span class="params">(String url, String storePath, Integer threadNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">        <span class="built_in">this</span>.storePath = storePath;</span><br><span class="line">        <span class="built_in">this</span>.threadNum = threadNum;</span><br><span class="line">        <span class="built_in">this</span>.fileReqLength = getFileReqLength(<span class="built_in">this</span>.url);</span><br><span class="line">        <span class="built_in">this</span>.countDownLatch = <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadNum);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO è€ƒè™‘è·å–ä¸åˆ°æ–‡ä»¶åçš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶å</span></span><br><span class="line">        <span class="built_in">this</span>.fileName = url.substring(url.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>, url</span><br><span class="line">                .contains(<span class="string">&quot;?&quot;</span>) ? url.lastIndexOf(<span class="string">&#x27;?&#x27;</span>) : url.length());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸‹è½½çš„æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getFileReqLength</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">fileReqLength</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            downloadURL = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">            connection = (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">            connection.connect();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">            fileReqLength = connection.getContentLengthLong();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ— æ•ˆçš„URLé“¾æ¥: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connection.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fileReqLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸‹è½½å…¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fileDownload</span><span class="params">()</span> &#123;</span><br><span class="line">        Long threadLength;</span><br><span class="line">        Long remainLength;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºåˆå§‹åŒ–ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥ä¸­...&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (fileReqLength &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿æ¥æ–‡ä»¶æœåŠ¡å™¨æˆåŠŸ!&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å½“å‰ä»»åŠ¡ä¸‹è½½çº¿ç¨‹æ•°:&quot;</span> + threadNum);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶åä¸º:&quot;</span> + fileName + <span class="string">&quot;,å…±&quot;</span> + (fileReqLength / <span class="number">1024</span> / <span class="number">1024</span>) + <span class="string">&quot;MB&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿æ¥æ–‡ä»¶æœåŠ¡å™¨å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸‹è½½è¿‡:1.ä¸‹è½½è¿‡ä¸”æ–‡ä»¶å¤§å°ä¸€è‡´ï¼Œåˆ™æ— éœ€ä¸‹è½½ï¼›</span></span><br><span class="line">        <span class="comment">// 2.å¦‚æœæ²¡æœ‰ä¸‹è½½è¿‡æˆ–è€…ä¸‹è½½æœªå®Œæˆï¼Œåˆ™ç»§ç»­ä¸‹è½½ï¼Œä¼šå½±å“å„çº¿ç¨‹çš„ä¸‹è½½é•¿åº¦</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">fileLocal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">fileLocalLength</span> <span class="operator">=</span> fileLocal.length();</span><br><span class="line">        <span class="keyword">if</span> (fileLocalLength == fileReqLength) &#123;</span><br><span class="line">            <span class="comment">// TODO md5æ–‡ä»¶ä¸€è‡´æ€§æ ¡éªŒ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶å·²å®Œæˆä¸‹è½½ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!fileLocal.exists()) &#123;</span><br><span class="line">                <span class="comment">// è‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">                remainLength = fileReqLength;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileLocal.createNewFile();</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–‡ä»¶å¼€å§‹ä¸‹è½½...&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ä¸‹è½½æ–‡ä»¶åˆ›å»ºå¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå­˜åœ¨åˆ™è®¡ç®—å‰©ä½™çš„ä¸‹è½½é‡</span></span><br><span class="line">                remainLength = fileReqLength - fileLocalLength;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶å‰©ä½™:&quot;</span> + (remainLength / <span class="number">1024</span> / <span class="number">1024</span>) + <span class="string">&quot;MB&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶å¼€å§‹ç»­ä¼ ...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¡ç®—å•ä¸ªçº¿ç¨‹çš„ä¸‹è½½é‡</span></span><br><span class="line">            <span class="comment">//threadLength = (remainLength % threadNum == 0 ? remainLength / threadNum : remainLength / (threadNum + 1));</span></span><br><span class="line">            threadLength = (remainLength + threadNum - <span class="number">1</span>) / threadNum;</span><br><span class="line">            System.out.println(<span class="string">&quot;å•ä¸ªçº¿ç¨‹ä¸‹è½½é‡:&quot;</span> + (threadLength / <span class="number">1024</span> / <span class="number">1024</span>) + <span class="string">&quot;Mbï¼Œå³ &quot;</span> + threadLength + <span class="string">&quot; byte&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        IntStream.range(<span class="number">0</span>, threadNum).forEach(x -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            executorService.submit(<span class="keyword">new</span> <span class="title class_">downloadThread</span>(x, threadLength, countDownLatch));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            countDownLatch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹åŒæ­¥å¼‚å¸¸:&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        executorService.shutdown();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸‹è½½å®Œæˆ!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†…éƒ¨ç±»ï¼Œå¼€å¯ä¸‹è½½çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">downloadThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰çº¿ç¨‹ID</span></span><br><span class="line">        <span class="keyword">private</span> Integer threadID;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">        <span class="keyword">private</span> Long startPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„ç»“æŸä½ç½®</span></span><br><span class="line">        <span class="keyword">private</span> Long endPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„é•¿åº¦</span></span><br><span class="line">        <span class="keyword">private</span> Long threadLength;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹åŒæ­¥å™¨ï¼Œè¿è¡Œå®Œæˆåæäº¤</span></span><br><span class="line">        <span class="keyword">private</span> CountDownLatch countDownLatch;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ–‡ä»¶ä¸‹è½½çš„æ•°æ®åŒºåŸŸ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">downloadThread</span><span class="params">(Integer threadID, Long threadLength, CountDownLatch countDownLatch)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.threadID = threadID;</span><br><span class="line">            <span class="built_in">this</span>.threadLength = threadLength;</span><br><span class="line">            <span class="built_in">this</span>.countDownLatch = countDownLatch;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// TODO æœªå®ç°æ–­ç‚¹ç»­ä¼ ï¼Œä»…èƒ½å¤Ÿå¤šçº¿ç¨‹ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ éœ€è¦åˆ›å»ºä¸´æ—¶æ–‡ä»¶è®°å½•ä¸Šæ¬¡ä¸‹è½½çš„ä½ç½®</span></span><br><span class="line">            <span class="comment">// è®¡ç®—æ¯ä¸ªçº¿ç¨‹çš„ä¸‹è½½ä½ç½®</span></span><br><span class="line">            <span class="built_in">this</span>.startPos = threadID * threadLength;</span><br><span class="line">            <span class="built_in">this</span>.endPos = threadID * threadLength + threadLength - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[çº¿ç¨‹&quot;</span> + threadID + <span class="string">&quot;] ä» &quot;</span> + startPos + <span class="string">&quot; ~ &quot;</span> + endPos);</span><br><span class="line"></span><br><span class="line">            <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰“å¼€HTTPè¿æ¥</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                downloadURL = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">                connection = (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">                connection.setRequestProperty(<span class="string">&quot;Range&quot;</span>, <span class="string">&quot;bytes=&quot;</span> + startPos + <span class="string">&quot;-&quot;</span> + endPos);</span><br><span class="line">                connection.setConnectTimeout(<span class="number">100000</span>);</span><br><span class="line">                connection.connect();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[çº¿ç¨‹&quot;</span> + threadID + <span class="string">&quot;] æ— æ³•è®¿é—®URLé“¾æ¥: &quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName, <span class="string">&quot;rws&quot;</span>);</span><br><span class="line">                raf.seek(startPos);</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> length;</span><br><span class="line">                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">                <span class="keyword">while</span>((length = is.read(buffer)) != -<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    raf.write(buffer,<span class="number">0</span>,length);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                is.close();</span><br><span class="line">                raf.close();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[çº¿ç¨‹&quot;</span> + threadID + <span class="string">&quot;] è®¿é—®æ–‡ä»¶å¤±è´¥: &quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            connection.disconnect();</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><p>æµ‹è¯•ç¨‹åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">playground</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Main Thread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://dldir1.qq.com/qqfile/qq/QQ7.9/16621/QQ7.9.exe&quot;</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">threadNum</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">DownloadMultiply</span> <span class="variable">downloadMultiply</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DownloadMultiply</span>(url, storePath,threadNum);</span><br><span class="line">        downloadMultiply.fileDownload();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ -1"><a href="#å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ -1" class="headerlink" title="å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ "></a>å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </h3><p>å¯ä»¥æœ‰ä¸¤ç§å®ç°å½¢å¼ï¼š</p><ol><li>æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å°±ç”Ÿæˆå¤šå°‘ä¸ªæ–‡ä»¶ï¼Œå„è‡ªè®°å½•ä¸‹è½½çš„èµ·æ­¢ä½ç½®ï¼Œæœ€åå…¨éƒ¨åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼ˆå°è¯•å¤±è´¥ï¼Œå¤šä¸ªæ–‡ä»¶è¦å¤„ç†æ¯”è¾ƒå¤æ‚ï¼‰</li><li>ç”Ÿæˆä¸€ä¸ªç›®æ ‡æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªï¼ˆæˆ–æ ¹æ®çº¿ç¨‹æ•°ç›®ï¼‰ä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•å„ä¸ªçº¿ç¨‹çš„ä¸‹è½½ä½ç½®ï¼Œåˆ™ä¸éœ€è¦åˆå¹¶æ–‡ä»¶ï¼Œä»…æ¸…é™¤æ—¥å¿—æ–‡ä»¶ï¼ˆæ¨èï¼‰</li></ol><h4 id="æ­¥éª¤åˆ†è§£-2"><a href="#æ­¥éª¤åˆ†è§£-2" class="headerlink" title="æ­¥éª¤åˆ†è§£"></a>æ­¥éª¤åˆ†è§£</h4><ul><li><p>ä¼˜é›…ç»“æŸè¿›ç¨‹ï¼Œä»¥ä¾¿åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­è®°å½•ä¸‹è½½çš„è¿›åº¦ã€ä¸‹è½½çš„çº¿ç¨‹æ•°ã€ä¸‹è½½å¤§å°ç­‰å†…å®¹</p><ul><li>å†™å…¥ä¸€è¡Œï¼Œå°±è®°å½•ä¸€æ¬¡ä½ç½®ï¼Œè¿™æ ·å°±ä¸éœ€è¦è€ƒè™‘ä¼˜é›…ç»“æŸè¿›ç¨‹çš„é—®é¢˜ï¼›ä½†æ˜¯ä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®ä¸¢å¤±</li><li>ä¸€ç›´å†™å…¥ï¼Œåœ¨æ¥æ”¶åˆ°<code>interrupt</code>çš„æ—¶å€™ï¼Œå†è®°å½•ï¼›ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä½†æ˜¯å¤„ç†é€»è¾‘æ›´å¤æ‚ï¼ˆå°è¯•ï¼‰</li><li>ä½¿ç”¨<code>Properties</code>ç±»æ¥è®°å½•</li></ul></li><li><p>æ–‡ä»¶åˆå¹¶ï¼ˆæ–¹å¼äºŒï¼‰</p></li><li><p>æ–‡ä»¶ä¸€è‡´æ€§æ ¡éªŒ</p></li><li><p>è¿…é›·é“¾æ¥çš„è§£æ</p><ul><li>è¿…é›·çš„ç¼–ç è§„åˆ™ä¸ºï¼šåŸåœ°å€å‰é¢åŠ â€AAâ€ï¼Œåé¢åŠ â€ZZâ€ï¼Œç„¶åè¿›è¡ŒBase64ç¼–ç ï¼Œæœ€ååŠ ä¸Šè¿…é›·ä¸‹è½½åè®®â€Thunder:&#x2F;&#x2F;â€œç»„æˆå®Œæ•´çš„ä¸‹è½½é“¾æ¥</li></ul></li></ul><p>â€</p><p>å®ä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.playgroud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ€è·¯æ¢³ç†</span></span><br><span class="line"><span class="comment"> * 1.åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment"> * 1.1å¦‚æœä¸å­˜åœ¨åˆ™ç”Ÿæˆä¸€ä¸ªtmpæ–‡ä»¶ï¼Œ4ä¸ªæ—¥å¿—ï¼Œåˆ†åˆ«è®°å½•æ¯ä¸ªçº¿ç¨‹çš„ä¸‹è½½ä½ç½®</span></span><br><span class="line"><span class="comment"> * 1.2å¦‚æœtmpæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§ï¼Œå¿…é¡»æœ‰4ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ¸…ç©ºä»»åŠ¡å¹¶é‡æ–°ä¸‹è½½</span></span><br><span class="line"><span class="comment"> * 2.ç»§ç»­ä¸‹è½½çš„ä½ç½® = id*block + ï¼ˆå·²ä¸‹è½½çš„æ–‡ä»¶é•¿åº¦ï¼‰</span></span><br><span class="line"><span class="comment"> * 3.ä¸‹è½½æˆªæ­¢çš„ä½ç½® = (id+1)*block - 1</span></span><br><span class="line"><span class="comment"> * 4.æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ”¹è¿›ï¼šSpringboot å¦‚æœæ˜¯æŠŠä¸‹è½½ä½ç½®å­˜åˆ°æ•°æ®åº“ï¼Œå¹¶ä¸”å®šæ—¶åˆ·æ–°ï¼Œé‚£ä¹ˆæ˜¯å¦åªéœ€è¦ä¸€ä¸ªtmpæ–‡ä»¶å°±å¯ä»¥è§£å†³ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * 1.ç”Ÿæˆtmpæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“ä¸­ç”Ÿæˆ4æ¡è®°å½•ï¼Œå¯¹åº”4ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * 2.çº¿ç¨‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡åˆ·æ–°æ–‡ä»¶çš„å¼€å§‹ä½ç½®ï¼Œæ­¤æ—¶æˆªæ­¢ä½ç½®ä»ç„¶æ˜¯å›ºå®šçš„</span></span><br><span class="line"><span class="comment"> * 3.å¦‚æœä»»åŠ¡ä¸­æ–­ï¼Œåˆ™åªéœ€è¦é‡æ–°å¯»å€åˆ°æ•°æ®åº“è®°å½•çš„å¼€å§‹ä½ç½®ï¼Œç„¶åä¸‹è½½å³å¯</span></span><br><span class="line"><span class="comment"> * è¿™æ ·å¯ä»¥å‡å°‘æ–‡ä»¶çš„ä¸ªæ•°ï¼Œä¹Ÿèƒ½å¤Ÿé™ä½ä»»åŠ¡ä¸­æ–­å¸¦æ¥çš„é‡æ–°å¯»å€é—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadMultiCon</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½çš„URL</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> String storePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸´æ—¶æ–‡ä»¶å</span></span><br><span class="line">    <span class="keyword">private</span> String fileTemp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> Long fileReqLength;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½çš„çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer threadNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹åŒæ­¥å™¨</span></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹IDé›†åˆï¼Œæ¯æ¬¡åˆå§‹åŒ–éƒ½è®°å½•ä¸‹è½½çš„çº¿ç¨‹id</span></span><br><span class="line">    <span class="keyword">private</span> CopyOnWriteArrayList&lt;Integer&gt; threadIDList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">THREAD_NAME</span> <span class="operator">=</span> <span class="string">&quot;download-thread-&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">THREAD_TEMP_FILE</span> <span class="operator">=</span> <span class="string">&quot;download-file-&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">THREAD_TEMP_KEY</span> <span class="operator">=</span> <span class="string">&quot;download-thread-key-&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     * 1.å‚æ•°è®¾ç½®ï¼šURLã€æ–‡ä»¶ä¿å­˜è·¯å¾„ã€ä¸‹è½½çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="comment">     * 2.è·å–ä¸‹è½½çš„æ–‡ä»¶åã€æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> storePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadNum</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DownloadMultiCon</span><span class="params">(String url, String storePath, Integer threadNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">        <span class="built_in">this</span>.storePath = storePath;</span><br><span class="line">        <span class="built_in">this</span>.threadNum = threadNum;</span><br><span class="line">        <span class="built_in">this</span>.fileReqLength = getFileReqLength(<span class="built_in">this</span>.url);</span><br><span class="line">        <span class="built_in">this</span>.countDownLatch = <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadNum + <span class="number">1</span>); <span class="comment">// å¤šä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹è´Ÿè´£ä¸­æ–­ä¸‹è½½çº¿ç¨‹</span></span><br><span class="line">        <span class="built_in">this</span>.threadIDList = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO è€ƒè™‘è·å–ä¸åˆ°æ–‡ä»¶åçš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶å</span></span><br><span class="line">        <span class="built_in">this</span>.fileName = url.substring(url.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>, url</span><br><span class="line">                .contains(<span class="string">&quot;?&quot;</span>) ? url.lastIndexOf(<span class="string">&#x27;?&#x27;</span>) : url.length());</span><br><span class="line">        <span class="built_in">this</span>.fileTemp = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸‹è½½çš„æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getFileReqLength</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">fileReqLength</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            downloadURL = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">            connection = (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">            connection.connect();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">            fileReqLength = connection.getContentLengthLong();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ— æ•ˆçš„URLé“¾æ¥: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connection.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fileReqLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·çº¿ç¨‹ï¼Œå¼€å¯ä¸‹è½½çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">downloadThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰çº¿ç¨‹ID</span></span><br><span class="line">        <span class="keyword">private</span> Integer threadID;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long startPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„ç»“æŸä½ç½®</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long endPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸‹è½½çš„é•¿åº¦</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long threadLength;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹åŒæ­¥å™¨ï¼Œè¿è¡Œå®Œæˆåæäº¤</span></span><br><span class="line">        <span class="keyword">private</span> CountDownLatch countDownLatch;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹åŒæ­¥çš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">private</span> CopyOnWriteArrayList&lt;Integer&gt; threadIDList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ–‡ä»¶ä¸‹è½½çš„æ•°æ®åŒºåŸŸ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">downloadThread</span><span class="params">(Integer threadID, CountDownLatch countDownLatch, CopyOnWriteArrayList&lt;Integer&gt; threadIDList, Long threadLength)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.threadID = threadID;</span><br><span class="line">            <span class="built_in">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">            <span class="built_in">this</span>.threadIDList = threadIDList;</span><br><span class="line">            <span class="built_in">this</span>.threadLength = threadLength;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¡ç®—æ¯ä¸ªçº¿ç¨‹çš„ä¸‹è½½ä½ç½®</span></span><br><span class="line">            <span class="built_in">this</span>.startPos = threadID * threadLength;</span><br><span class="line">            <span class="built_in">this</span>.endPos = ((threadID + <span class="number">1</span>) * threadLength) - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å½“å‰çº¿ç¨‹idï¼Œå¹¶åŠ å…¥åˆ°é›†åˆä¸­</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">threadLocalID</span> <span class="operator">=</span> (<span class="type">int</span>) Thread.currentThread().getId();</span><br><span class="line">            threadIDList.add(threadLocalID);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®çº¿ç¨‹åç§°ï¼Œé€šè¿‡æˆªå–å¯ä»¥è·å¾—æ¯ä¸ªçº¿ç¨‹çš„threadIDï¼Œä»¥ä¾¿è®°å½•ä¸‹è½½è¿›åº¦</span></span><br><span class="line">            Thread.currentThread().setName(THREAD_NAME + threadID);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–propertiesæ–‡ä»¶ï¼Œè·å¾—ä¸‹è½½çš„ä½ç½®</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileThreadName</span> <span class="operator">=</span> storePath + <span class="string">&quot;/&quot;</span> + THREAD_TEMP_FILE + threadID + <span class="string">&quot;.properties&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">fileThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileThreadName);</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(fileThread);</span><br><span class="line">                prop.load(fis);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è·å–çº¿ç¨‹æ–‡ä»¶ &quot;</span> + fileThreadName + <span class="string">&quot; å¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœé…ç½®æ–‡ä»¶ä¸ºç©ºï¼Œåˆ™è®¾ç½®keyï¼Œå¦åˆ™è¯»å–key</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">propKey</span> <span class="operator">=</span> THREAD_TEMP_KEY + threadID;</span><br><span class="line">            Long realStartPos;</span><br><span class="line">            <span class="keyword">if</span> (prop.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                realStartPos = startPos;</span><br><span class="line">                prop.setProperty(propKey, String.valueOf(realStartPos));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                realStartPos = Long.valueOf(prop.getProperty(propKey));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å‰©ä½™é•¿åº¦</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">remainLength</span> <span class="operator">=</span> endPos - realStartPos;</span><br><span class="line">            System.out.println(<span class="string">&quot;[ä¸‹è½½çº¿ç¨‹&quot;</span> + threadID + <span class="string">&quot;]å¼€å§‹ä»»åŠ¡ï¼Œå‰©ä½™ &quot;</span> + remainLength + <span class="string">&quot; byte&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–ä¸‹è½½èŒƒå›´</span></span><br><span class="line">            <span class="type">URL</span> <span class="variable">downloadURL</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                downloadURL = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">                connection = (HttpURLConnection) downloadURL.openConnection();</span><br><span class="line">                connection.setConnectTimeout(<span class="number">100000</span>);</span><br><span class="line">                connection.setRequestProperty(<span class="string">&quot;Range&quot;</span>, <span class="string">&quot;bytes=&quot;</span> + realStartPos + <span class="string">&quot;-&quot;</span> + endPos);</span><br><span class="line">                connection.connect();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ‰“å¼€ä¸‹è½½é“¾æ¥å¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é“¾æ¥åˆ°æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">RandomAccessFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName, <span class="string">&quot;rws&quot;</span>);</span><br><span class="line">                file.seek(realStartPos);</span><br><span class="line"></span><br><span class="line">                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">                <span class="type">OutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(fileThreadName);</span><br><span class="line">                <span class="keyword">while</span>((length = is.read(buffer)) != -<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    file.write(buffer,<span class="number">0</span>,length);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ¯æ¬¡å†™å…¥éƒ½æ›´æ–°ä¸‹è½½çš„å¼€å§‹ä½ç½®</span></span><br><span class="line">                    realStartPos += length;</span><br><span class="line">                    prop.setProperty(propKey, String.valueOf(realStartPos));</span><br><span class="line">                    prop.store(fos,Thread.currentThread().getName() + <span class="string">&quot; - Update&quot;</span> );</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">                is.close();</span><br><span class="line">                fos.close();</span><br><span class="line">                file.close();</span><br><span class="line">                connection.disconnect();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;é“¾æ¥æœ¬åœ°æ–‡ä»¶å¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;[ä¸‹è½½çº¿ç¨‹&quot;</span> + threadID + <span class="string">&quot;] ä»»åŠ¡å®Œæˆ&quot;</span>);</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ˆæŠ¤çº¿ç¨‹ï¼Œè´Ÿè´£å¤„ç†ä¸´æ—¶æ–‡ä»¶ï¼šè®°å½•æ¯ä¸ªçº¿ç¨‹çš„ä¸‹è½½ä½ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">logDeamonThred</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[å®ˆæŠ¤çº¿ç¨‹] å¼€å§‹è¿è¡Œ&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æŠŠå®ˆæŠ¤çº¿ç¨‹æ·»åŠ åˆ°çº¿ç¨‹é›†åˆä¸­</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">threadLocalID</span> <span class="operator">=</span> (<span class="type">int</span>) Thread.currentThread().getId();</span><br><span class="line">            threadIDList.add(threadLocalID);</span><br><span class="line"></span><br><span class="line">            <span class="type">Scanner</span> <span class="variable">userScan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">            <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ä¸‹è½½ä»»åŠ¡è¿›è¡Œä¸­ï¼Œè¾“å…¥exitæš‚åœä»»åŠ¡...&quot;</span>);</span><br><span class="line">                userInput = userScan.nextLine();</span><br><span class="line">            &#125; <span class="keyword">while</span> (!userInput.equals(<span class="string">&quot;exit&quot;</span>));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·è¯·æ±‚æš‚åœä»»åŠ¡!&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// éå†çº¿ç¨‹IDï¼Œæ‰¾åˆ°ä»¥åæš‚æ—¶æŒ‚èµ·</span></span><br><span class="line">            Set&lt;Thread&gt; setOfThread = Thread.getAllStackTraces().keySet();</span><br><span class="line">            <span class="keyword">for</span> (Integer threadID : threadIDList) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Thread thread : setOfThread) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (thread.getId() == threadID) &#123;</span><br><span class="line">                        thread.interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            userScan.close();</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸‹è½½å…¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fileDownload</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">threadLength</span> <span class="operator">=</span> fileReqLength / threadNum;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">remainLength</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºåˆå§‹åŒ–ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥ä¸­...&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (fileReqLength.longValue() &gt; <span class="number">0L</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿æ¥æ–‡ä»¶æœåŠ¡å™¨æˆåŠŸ!&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å½“å‰ä»»åŠ¡ä¸‹è½½çº¿ç¨‹æ•°:&quot;</span> + threadNum);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶åä¸º:&quot;</span> + fileName + <span class="string">&quot;,å…±&quot;</span> + (fileReqLength / <span class="number">1024</span> / <span class="number">1024</span>) + <span class="string">&quot;MB&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿æ¥æ–‡ä»¶æœåŠ¡å™¨å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸‹è½½è¿‡:1.ä¸‹è½½è¿‡ä¸”æ–‡ä»¶å¤§å°ä¸€è‡´ï¼Œåˆ™æ— éœ€ä¸‹è½½ï¼›</span></span><br><span class="line">        <span class="comment">// 2.å¦‚æœæ²¡æœ‰ä¸‹è½½è¿‡æˆ–è€…ä¸‹è½½æœªå®Œæˆï¼Œåˆ™ç»§ç»­ä¸‹è½½</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">fileLocal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storePath + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">fileLocalLength</span> <span class="operator">=</span> fileLocal.length();</span><br><span class="line">        <span class="keyword">if</span> (fileLocalLength.longValue() == fileReqLength.longValue()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶å·²ç»ä¸‹è½½å®Œæˆï¼Œæ— éœ€ä¸‹è½½ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileLocalLength.longValue() &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">            <span class="keyword">if</span> (!fileLocal.exists()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileLocal.createNewFile();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// åˆ›å»ºä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadNum; i++) &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">fileThreadName</span> <span class="operator">=</span> storePath + <span class="string">&quot;/&quot;</span> + THREAD_TEMP_FILE + i + <span class="string">&quot;.properties&quot;</span>;</span><br><span class="line">                        <span class="type">File</span> <span class="variable">fileThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileThreadName);</span><br><span class="line">                        <span class="keyword">if</span> (!fileThread.exists()) &#123;</span><br><span class="line">                            fileThread.createNewFile();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–‡ä»¶åˆ›å»ºå¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// TODO è€ƒè™‘ä¸´æ—¶æ–‡ä»¶ç¼ºå¤±çš„é—®é¢˜</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¼€å¯å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">            <span class="type">Thread</span> <span class="variable">logThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">logDeamonThred</span>());</span><br><span class="line">            logThread.setDaemon(<span class="literal">true</span>);</span><br><span class="line">            logThread.start();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¼€å¯å¤šçº¿ç¨‹ï¼Œå¹¶å°†çº¿ç¨‹ä¿å­˜åœ¨é›†åˆä¸­</span></span><br><span class="line">            <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">            IntStream.range(<span class="number">0</span>, threadNum).forEach(x -&gt; &#123;</span><br><span class="line"></span><br><span class="line">                executorService.submit(<span class="keyword">new</span> <span class="title class_">downloadThread</span>(x, countDownLatch, threadIDList, threadLength));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                countDownLatch.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (</span><br><span class="line">                    InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            executorService.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">// TODO æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸‹è½½å®Œæˆ!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">playground</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Main Thread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="string">&quot;/Users/kalosora/Desktop/å¤šçº¿ç¨‹ä¸‹è½½&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://dldir1.qq.com/qqfile/qq/QQ7.9/16621/QQ7.9.exe&quot;</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">threadNum</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">DownloadMultiCon</span> <span class="variable">downloadMultiCon</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DownloadMultiCon</span>(url, storePath,threadNum);</span><br><span class="line">        downloadMultiCon.fileDownload();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h4 id="æ”¹è¿›ï¼šWebé¡¹ç›®"><a href="#æ”¹è¿›ï¼šWebé¡¹ç›®" class="headerlink" title="æ”¹è¿›ï¼šWebé¡¹ç›®"></a>æ”¹è¿›ï¼šWebé¡¹ç›®</h4><p>#TODO#</p><ul><li><p>ä¸‹è½½é€Ÿåº¦ã€è¿›åº¦çš„æ˜¾ç¤º</p></li><li><p>å¤šä¸ªä»»åŠ¡ä¸‹ï¼Œçº¿ç¨‹é—´é€Ÿåº¦çš„å‡æ‘Š</p></li><li><p>è§£æè¿…é›·ã€BTé“¾æ¥</p><ul><li>è¿…é›·çš„ç¼–ç è§„åˆ™ä¸ºï¼šåŸåœ°å€å‰é¢åŠ â€AAâ€ï¼Œåé¢åŠ â€ZZâ€ï¼Œç„¶åè¿›è¡ŒBase64ç¼–ç ï¼Œæœ€ååŠ ä¸Šè¿…é›·ä¸‹è½½åè®®â€thunder:&#x2F;&#x2F;â€œç»„æˆå®Œæ•´çš„ä¸‹è½½é“¾æ¥</li><li><a href="https://github.com/mpetazzoni/ttorrent">BitTorrent Javaå®ç°</a></li></ul></li></ul><p>â€</p><h2 id="æŠ€æœ¯ç‚¹æ€»ç»“"><a href="#æŠ€æœ¯ç‚¹æ€»ç»“" class="headerlink" title="æŠ€æœ¯ç‚¹æ€»ç»“"></a>æŠ€æœ¯ç‚¹æ€»ç»“</h2><p>å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </p><ol><li><p>æ–­ç‚¹ç»­ä¼ éœ€è¦æä¾›çš„èƒ½åŠ›ï¼š</p><ol><li><code>RandomAccessFile</code>ç±»æä¾›éšæœºæ–‡ä»¶è¯»å–ä¸å†™å…¥çš„èƒ½åŠ›</li><li><code>File</code>ç±»æä¾›æ–‡ä»¶åˆ›å»ºã€è®¡ç®—é•¿åº¦çš„èƒ½åŠ›</li><li><code>HttpURLConnection</code>ç±»æä¾›è®¿é—®httpè¯·æ±‚ã€æŸ¥æ‰¾æ•°æ®èµ„æºèŒƒå›´çš„èƒ½åŠ›</li></ol></li><li><p>å¤šçº¿ç¨‹ä¸‹è½½éœ€è¦çš„èƒ½åŠ›ï¼š</p><ol><li><p><code>ExecutorService</code>ç±»å¸®åŠ©è¿›è¡Œçº¿ç¨‹ç®¡ç†</p></li><li><p><code>CountDownLatch</code>ç±»å¸®åŠ©åŒæ­¥å­çº¿ç¨‹ä»»åŠ¡è¿›åº¦</p></li><li><p>ç›¸å…³å…¬å¼å¸®åŠ©è®¡ç®—</p><ol><li>å•ä¸ªçº¿ç¨‹çš„å—å¤§å°ï¼šblockSize &#x3D; ï¼ˆæ–‡ä»¶å¤§å° +çº¿ç¨‹æ•° - 1 ï¼‰&#x2F; çº¿ç¨‹æ•° ;</li><li>ä¸‹è½½çš„å¼€å§‹ä½ç½®ï¼šstart &#x3D; id* block;</li><li>ä¸‹è½½çš„ç»“æŸä½ç½®ï¼šend &#x3D; (id+1)*block -1;</li></ol></li></ol></li><li><p>å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ ç»¼åˆï¼š</p><ol><li><code>Properties</code>ç±»æä¾›æ—¥å¿—æ–‡ä»¶çš„è¯»å†™èƒ½åŠ›ï¼Œå­˜æ”¾å„ä¸ªçº¿ç¨‹ä¸‹è½½çš„ä¿¡æ¯</li></ol></li></ol><p>â€</p><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><p>æ–­ç‚¹ç»­ä¼ ç›¸å…³</p><p><a href="https://mp.weixin.qq.com/s/bI5xYq3jUtp-sviKlzHtNg">æ–­ç‚¹ç»­ä¼ åŸç†</a></p><p><a href="https://blog.csdn.net/Adelaide_Guo/article/details/77757132">æ–­ç‚¹ç»­ä¼ ä¸åŒæ­¥å™¨çš„ä¸€ä¸ªå®ä¾‹</a></p><p>â€</p><p>å¤šçº¿ç¨‹ç›¸å…³</p><p><a href="https://blog.csdn.net/fzy629442466/article/details/85601315">å¤šçº¿ç¨‹ä¸‹è½½æœ€ç®€å•å®ä¾‹</a></p><p>â€</p><p>å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ </p><p><a href="https://blog.csdn.net/carlislelee/article/details/52688693">å¦‚ä½•ä¼˜é›…ç»“æŸjavaè¿›ç¨‹</a></p><p><a href="https://github.com/niumoo/down-bit">æ–­ç‚¹ç»­ä¼ å®Œæ•´å®ä¾‹-æ”¯æŒè¿…é›·</a></p><p><a href="https://www.cnblogs.com/yuanyb/p/12296815.html">å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ çš„ç®€å•å®ä¾‹</a></p><p><a href="https://www.cnblogs.com/panhouye/p/6209635.html">å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ çš„è¯¦ç»†è®²è§£</a></p><p>â€</p><p>javaå¦‚ä½•å®ç°BTä¸‹è½½</p><p><a href="https://www.zhihu.com/question/67773003">ç°æˆçš„JAVA BTåº“</a></p><p><a href="http://www.meilongkui.com/archives/320">eclipse bittorrent</a></p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java æ³›å‹</title>
      <link href="/2020/11/25/Java%E6%B3%9B%E5%9E%8B/"/>
      <url>/2020/11/25/Java%E6%B3%9B%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaæ³›å‹"><a href="#Javaæ³›å‹" class="headerlink" title="Javaæ³›å‹"></a>Javaæ³›å‹</h1><h2 id="ä»€ä¹ˆæ˜¯æ³›å‹"><a href="#ä»€ä¹ˆæ˜¯æ³›å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³›å‹"></a>ä»€ä¹ˆæ˜¯æ³›å‹</h2><p>æ³›å‹ç¨‹åºè®¾è®¡ï¼Œæ„å‘³ç€ç¼–å†™çš„ä»£ç ï¼Œå¯ä»¥é’ˆå¯¹å¤šç§ä¸åŒç±»å‹çš„å¯¹è±¡è¿›è¡Œé‡ç”¨ã€‚</p><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>Java æ³›å‹ï¼ˆgenericsï¼‰æ˜¯ JDK 5 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œ æ³›å‹æä¾›äº†ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ£€æµ‹æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ç¨‹åºå‘˜åœ¨ç¼–è¯‘æ—¶æ£€æµ‹åˆ°éæ³•çš„ç±»å‹ã€‚<strong>æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ã€‚</p><p>â€</p><p>å…³äºå¤ç”¨ï¼š</p><ul><li>çºµå‘å¤ç”¨ï¼šç»§æ‰¿ã€æŠ½è±¡ç±»ï¼ˆæ¨¡æ¿ï¼‰ã€æ¥å£ï¼ˆdefaultã€staticæ–¹æ³•ï¼‰</li><li>æ¨ªå‘å¤ç”¨ï¼šæ³›å‹</li></ul><p>â€</p><h4 id="å¦‚æœæ²¡æœ‰æ³›å‹"><a href="#å¦‚æœæ²¡æœ‰æ³›å‹" class="headerlink" title="å¦‚æœæ²¡æœ‰æ³›å‹"></a>å¦‚æœæ²¡æœ‰æ³›å‹</h4><p>ä¸ä½¿ç”¨æ³›å‹çš„å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">al</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">al.add(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">al.add(<span class="string">&quot;124&quot;</span>);</span><br><span class="line">al.add(<span class="string">&quot;32L&quot;</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°å®ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œä¸ä½¿ç”¨æ³›å‹çš„æ•°ç»„ï¼Œå­˜æ”¾äº† 3 ç§ç±»å‹çš„æ•°æ®ã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦è¯»å–çš„æ—¶å€™ï¼Œå°±è¦å¯¹æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹äº†ç„¶äºèƒ¸ï¼Œå¦‚æœä¸çŸ¥é“æ•°ç»„ä¸­å…ƒç´ çš„ç±»å‹ï¼Œå°±å¯èƒ½ä¼šé‡åˆ°<code>ClassCastException</code> å¼‚å¸¸ã€‚</p><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>æ³›å‹èƒ½å¤Ÿä½¿ç¨‹åºæ›´æ˜“è¯»ï¼Œä¹Ÿæ›´å®‰å…¨</p><blockquote><p>1.æ³›å‹çš„ä¸»è¦ç›®æ ‡æ˜¯æé«˜ Java ç¨‹åºçš„ç±»å‹å®‰å…¨ã€‚ç¼–è¯‘æ—¶çš„å¼ºç±»å‹æ£€æŸ¥ï¼›é€šè¿‡çŸ¥é“ä½¿ç”¨æ³›å‹å®šä¹‰çš„å˜é‡çš„ç±»å‹é™åˆ¶ï¼Œç¼–è¯‘å™¨å¯ä»¥åœ¨ä¸€ä¸ªé«˜å¾—å¤šçš„ç¨‹åº¦ä¸ŠéªŒè¯ç±»å‹å‡è®¾ã€‚æ²¡æœ‰æ³›å‹ï¼Œè¿™äº›å‡è®¾å°±åªå­˜åœ¨äºç¨‹åºå‘˜çš„å¤´è„‘ä¸­ï¼ˆæˆ–è€…å¦‚æœå¹¸è¿çš„è¯ï¼Œè¿˜å­˜åœ¨äºä»£ç æ³¨é‡Šä¸­ï¼‰ã€‚</p><p>2.åŒæ—¶æ³›å‹è¿˜èƒ½æ¶ˆé™¤ä»£ç ä¸­çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ‰€æœ‰çš„å¼ºåˆ¶è½¬æ¢éƒ½æ˜¯è‡ªåŠ¨å’Œéšå¼çš„ã€‚</p><p>3.ä»£ç å¤ç”¨æ€§å¼ºï¼šåœ¨æ¡†æ¶è®¾è®¡æ—¶å€™ï¼Œ<code>BaseDao&lt;T&gt;</code>ã€<code>BaseService&lt;T&gt;</code>ã€<code>BaseDaoImpl&lt;T&gt;</code>ã€<code>BaseServiceImpl&lt;T&gt;</code>ç­‰ï¼›é€šè¿‡ç»§æ‰¿ï¼Œå®ç°æŠ½è±¡äº†æ‰€æœ‰å…¬å…±æ–¹æ³•ï¼Œé¿å…äº†æ¯æ¬¡éƒ½è¦å†™ç›¸åŒçš„ä»£ç ã€‚</p><p>å¦‚æœè¯´é¢å‘å¯¹è±¡æ€æƒ³æ˜¯é€šè¿‡ä»ä¸Šè‡³ä¸‹çš„ç»§æ‰¿å…³ç³»å®ç°äº†çºµå‘ç»´åº¦çš„ä»£ç å¤ç”¨ï¼›é‚£ä¹ˆä¹Ÿå¯ä»¥è¯´æ³›å‹ç¼–ç¨‹æ€æƒ³æ˜¯é€šè¿‡å°†å¹³è¡Œå…³ç³»çš„ç±»è”ç³»èµ·æ¥å®ç°äº†æ¨ªå‘ç»´åº¦çš„ä»£ç å¤ç”¨ï¼›ä¸¤è€…çš„ç»„åˆå°±å®ç°äº†æ›´å…·æœ‰è¡¨ç°åŠ›çš„äºŒç»´ç»“æ„ã€‚</p></blockquote><p>â€</p><h2 id="æ³›å‹é€šé…ç¬¦"><a href="#æ³›å‹é€šé…ç¬¦" class="headerlink" title="æ³›å‹é€šé…ç¬¦"></a>æ³›å‹é€šé…ç¬¦</h2><p>é€šé…ç¬¦ç§ç±»ï¼š</p><ul><li>ï¼Ÿ è¡¨ç¤ºä¸ç¡®å®šçš„javaç±»å‹</li><li>T (type) è¡¨ç¤ºå…·ä½“çš„ä¸€ä¸ªjavaç±»å‹</li><li>K V (key value) åˆ†åˆ«ä»£è¡¨javaé”®å€¼ä¸­çš„Key Value</li><li>E (element) ä»£è¡¨Element</li></ul><p>é€šé…ç¬¦çš„ç•Œé™</p><ul><li>ä¸Šç•Œï¼š<code>T extends [ç±»å‹]</code>ï¼šåªæœ‰ç»§æ‰¿ <code>[ç±»å‹]</code> çš„ç±»å‹æ‰èƒ½å¤Ÿä¼ å…¥</li><li>ä¸‹ç•Œï¼š<code>T super [ç±»å‹]</code>ï¼šä»»ä½•æ˜¯<code>[ç±»å‹]</code>çš„çˆ¶ç±»ç±»å‹éƒ½èƒ½å¤Ÿä¼ å…¥</li></ul><p>å®ä¾‹</p><p>è¿™é‡Œçš„ <code>Pair</code> å¯ä»¥ä¼ å…¥ä»»æ„çš„å¯¹è±¡ï¼Œå¦‚Integerã€String â€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T first;</span><br><span class="line">    <span class="keyword">private</span> T second;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Pair</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        first = <span class="literal">null</span>;</span><br><span class="line">        second = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Pair</span><span class="params">(T first,T second)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.first = first;</span><br><span class="line">        <span class="built_in">this</span>.second = second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFirst</span><span class="params">(T first)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.first = first;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getSecond</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSecond</span><span class="params">(T second)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.second = second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h2 id="æ³›å‹åŸç†"><a href="#æ³›å‹åŸç†" class="headerlink" title="æ³›å‹åŸç†"></a>æ³›å‹åŸç†</h2><h3 id="æ³›å‹æ“¦é™¤"><a href="#æ³›å‹æ“¦é™¤" class="headerlink" title="æ³›å‹æ“¦é™¤"></a>æ³›å‹æ“¦é™¤</h3><p>Java çš„æ³›å‹æ˜¯ä¼ªæ³›å‹ï¼Œè¿™æ˜¯å› ä¸º Java åœ¨ç¼–è¯‘æœŸé—´ï¼Œæ‰€æœ‰çš„æ³›å‹ä¿¡æ¯éƒ½ä¼šè¢«æ“¦æ‰ï¼Œè¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´ç±»å‹æ“¦é™¤ã€‚</p><p>å¦‚æœå­˜åœ¨è¾¹ç•Œï¼Œå¦‚<code>&lt;T extends String&gt;</code> ï¼Œåˆ™ä¼šè¿›è¡Œä»£ç è½¬æ¢</p><blockquote><p>Java çš„æ³›å‹åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ç¼–è¯‘å™¨è¿™ä¸ªå±‚æ¬¡ä¸Šå®ç°çš„ï¼Œåœ¨ç”Ÿæˆçš„å­—èŠ‚ç ä¸­æ˜¯ä¸åŒ…å«æ³›å‹ä¸­çš„ç±»å‹ä¿¡æ¯çš„ï¼Œä½¿ç”¨æ³›å‹çš„æ—¶å€™åŠ ä¸Šç±»å‹å‚æ•°ï¼Œåœ¨ç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™ä¼šå»æ‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç±»å‹æ“¦é™¤ã€‚</p><p>å¦‚ï¼šåœ¨ä»£ç ä¸­å®šä¹‰<code>List&lt;Object&gt;</code>å’Œ<code>List&lt;String&gt;</code>ç­‰ç±»å‹ï¼Œåœ¨ç¼–è¯‘åéƒ½ä¼šå˜æˆ<code>List</code>ï¼ŒJVM çœ‹åˆ°çš„åªæ˜¯ Listï¼Œè€Œç”±æ³›å‹é™„åŠ çš„ç±»å‹ä¿¡æ¯å¯¹ JVM æ˜¯çœ‹ä¸åˆ°çš„ã€‚Java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶å°½å¯èƒ½çš„å‘ç°å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•åœ¨è¿è¡Œæ—¶åˆ»å‡ºç°çš„ç±»å‹è½¬æ¢å¼‚å¸¸çš„æƒ…å†µï¼Œç±»å‹æ“¦é™¤ä¹Ÿæ˜¯ Java çš„æ³›å‹ä¸ C++ æ¨¡æ¿æœºåˆ¶å®ç°æ–¹å¼ä¹‹é—´çš„é‡è¦åŒºåˆ«ã€‚</p></blockquote><h4 id="å®ä¾‹ï¼šé€šè¿‡åå°„å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®"><a href="#å®ä¾‹ï¼šé€šè¿‡åå°„å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®" class="headerlink" title="å®ä¾‹ï¼šé€šè¿‡åå°„å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®"></a>å®ä¾‹ï¼šé€šè¿‡åå°„å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.interview.javabasic.generics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsEraseDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡åå°„ï¼Œä¸ºæ³›å‹å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> SecurityException </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchMethodException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeGenericsByReflection</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, SecurityException</span><br><span class="line">&#123;</span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">list.add(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡åå°„æœºåˆ¶ï¼Œè·å–æ³›å‹</span></span><br><span class="line">Class&lt;? <span class="keyword">extends</span> <span class="title class_">List</span>&gt; clazz = list.getClass();</span><br><span class="line"><span class="comment">// è·å–æ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">add</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;add&quot;</span>, Object.class);</span><br><span class="line"><span class="comment">// åå°„è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">add.invoke(list, <span class="string">&quot;Test&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•æ³›å‹çš„è‡ªåŠ¨å¼ºåˆ¶è½¬æ¢</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">testStr</span> <span class="operator">=</span> list.get(<span class="number">1</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">newTestStr</span> <span class="operator">=</span> (String)testStr;</span><br><span class="line">System.out.println(<span class="string">&quot;æ³›å‹è¯»å–: &quot;</span> + newTestStr);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;æ•°ç»„ä¸­æ•°æ®ä¸º: &quot;</span> + list.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">writeGenericsByReflection();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="/2020/11/25/Java%E6%B3%9B%E5%9E%8B/20201125155618-t3dankh-image-20210403104218-3xw6puf.png" alt="Javaæ³›å‹.png"><br><img src="/2020/11/25/Java%E6%B3%9B%E5%9E%8B/20201125150548-vvwzh34-image-20210403104218-i3q436l.png" alt="Javaæ³›å‹.png"></p><p>ç”±æ­¤å¯è§ï¼Œåœ¨ç¼–è¯‘æœŸé—´ï¼Œæ‰€æœ‰çš„æ³›å‹ä¿¡æ¯éƒ½ä¼šè¢«æ“¦æ‰ï¼Œæ‰€ä»¥ä¸Šè¿°çš„ä¾‹å­æ²¡æœ‰é‡åˆ° <code>IllegalArgumentException</code>ï¼Œèƒ½å¤Ÿå†™å…¥ä¸åŒç±»å‹çš„æ•°æ®åˆ°æ³›å‹ä¸­ã€‚åŒæ—¶ä¹Ÿè¯´æ˜å¯ä»¥é€šè¿‡åå°„çš„æ–¹æ³•ï¼Œç»•è¿‡ç¼–è¯‘æ—¶æ³›å‹çš„ç±»å‹é™åˆ¶ã€‚</p><h4 id="å®ä¾‹ï¼šæ¯”è¾ƒæ³›å‹"><a href="#å®ä¾‹ï¼šæ¯”è¾ƒæ³›å‹" class="headerlink" title="å®ä¾‹ï¼šæ¯”è¾ƒæ³›å‹"></a>å®ä¾‹ï¼šæ¯”è¾ƒæ³›å‹</h4><p>åœ¨ä¸Šè¿°å®ä¾‹ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå¹¶æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯”è¾ƒæ³›å‹æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰åˆ™è¯´æ˜å‚æ•°ç±»å‹è¢«æ“¦å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">equalGenerics</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">List&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">list1.add(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line">List&lt;Integer&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">list2.add(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(list1.getClass() == list2.getClass())</span><br><span class="line">System.out.println(<span class="string">&quot;å‚æ•°ç±»å‹ç›¸ç­‰&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">System.out.println(<span class="string">&quot;å‚æ•°ç±»å‹ä¸ç›¸ç­‰&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="/2020/11/25/Java%E6%B3%9B%E5%9E%8B/20201125151658-6u1f0ql-image-20210403104218-3z665iz.png" alt="Javaæ³›å‹.png"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ª<code>ArrayList</code>æ•°ç»„ï¼Œä¸è¿‡ä¸€ä¸ªæ˜¯<code>ArrayList&lt;String&gt;</code>æ³›å‹ç±»å‹çš„ï¼Œåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼›ä¸€ä¸ªæ˜¯<code>ArrayList&lt;Integer&gt;</code>æ³›å‹ç±»å‹çš„ï¼Œåªèƒ½å­˜å‚¨æ•´æ•°ï¼Œæœ€åï¼Œé€šè¿‡<code>list1</code>å¯¹è±¡å’Œ<code>list2</code>å¯¹è±¡çš„<code>getClass()</code>æ–¹æ³•è·å–ä»–ä»¬çš„ç±»çš„ä¿¡æ¯ï¼Œæœ€åå‘ç°ç»“æœä¸º<code>true</code>ã€‚è¯´æ˜æ³›å‹ç±»å‹<code>String</code>å’Œ<code>Integer</code>éƒ½è¢«æ“¦é™¤æ‰äº†ï¼Œåªå‰©ä¸‹åŸå§‹ç±»å‹ã€‚</p><h3 id="ç±»å‹æ“¦é™¤åä¿ç•™çš„åŸå§‹ç±»å‹"><a href="#ç±»å‹æ“¦é™¤åä¿ç•™çš„åŸå§‹ç±»å‹" class="headerlink" title="ç±»å‹æ“¦é™¤åä¿ç•™çš„åŸå§‹ç±»å‹"></a>ç±»å‹æ“¦é™¤åä¿ç•™çš„åŸå§‹ç±»å‹</h3><p>åœ¨ä¸Šé¢ï¼Œæåˆ°äº†åŸå§‹ç±»å‹ï¼Œä»€ä¹ˆæ˜¯åŸå§‹ç±»å‹ï¼Ÿ</p><p><strong>åŸå§‹ç±»å‹</strong> å°±æ˜¯æ“¦é™¤å»äº†æ³›å‹ä¿¡æ¯ï¼Œæœ€ååœ¨å­—èŠ‚ç ä¸­çš„ç±»å‹å˜é‡çš„çœŸæ­£ç±»å‹ï¼Œæ— è®ºä½•æ—¶å®šä¹‰ä¸€ä¸ªæ³›å‹ï¼Œç›¸åº”çš„åŸå§‹ç±»å‹éƒ½ä¼šè¢«è‡ªåŠ¨æä¾›ï¼Œç±»å‹å˜é‡æ“¦é™¤ï¼Œå¹¶ä½¿ç”¨å…¶é™å®šç±»å‹ï¼ˆæ— é™å®šçš„å˜é‡ç”¨ Objectï¼‰æ›¿æ¢ã€‚</p><p>åŸå§‹ç±»å‹ Object</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> T value;  </span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T  value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>Pair çš„åŸå§‹ç±»å‹ä¸ºï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Object value;  </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object  value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºåœ¨<code>Pair&lt;T&gt;</code>ä¸­ï¼ŒT æ˜¯ä¸€ä¸ªæ— é™å®šçš„ç±»å‹å˜é‡ï¼Œæ‰€ä»¥ç”¨<code>Object</code>æ›¿æ¢ï¼Œå…¶ç»“æœå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå¦‚åŒæ³›å‹åŠ å…¥ Java è¯­è¨€ä¹‹å‰çš„å·²ç»å®ç°çš„æ ·å­ã€‚åœ¨ç¨‹åºä¸­å¯ä»¥åŒ…å«ä¸åŒç±»å‹çš„<code>Pair</code>ï¼Œå¦‚<code>Pair&lt;String&gt;</code>æˆ–<code>Pair&lt;Integer&gt;</code>ï¼Œä½†æ˜¯æ“¦é™¤ç±»å‹åä»–ä»¬çš„å°±æˆä¸ºåŸå§‹çš„<code>Pair</code>ç±»å‹äº†ï¼ŒåŸå§‹ç±»å‹éƒ½æ˜¯<code>Object</code>ã€‚</p><p>ä»ä¸Šé¢çš„ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜ç™½<code>ArrayList&lt;Integer&gt;</code>è¢«æ“¦é™¤ç±»å‹åï¼ŒåŸå§‹ç±»å‹ä¹Ÿå˜ä¸º<code>Object</code>ï¼Œæ‰€ä»¥é€šè¿‡åå°„æˆ‘ä»¬å°±å¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²äº†ã€‚</p><p>å¦‚æœç±»å‹å˜é‡æœ‰é™å®šï¼Œé‚£ä¹ˆåŸå§‹ç±»å‹å°±ç”¨ç¬¬ä¸€ä¸ªè¾¹ç•Œçš„ç±»å‹å˜é‡ç±»æ›¿æ¢ã€‚</p><p>æ¯”å¦‚ï¼š Pair è¿™æ ·å£°æ˜çš„è¯</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåŸå§‹ç±»å‹å°±æ˜¯<code>Comparable</code>ã€‚</p><h4 id="å®ä¾‹ï¼šåŸå§‹ç±»å‹"><a href="#å®ä¾‹ï¼šåŸå§‹ç±»å‹" class="headerlink" title="å®ä¾‹ï¼šåŸå§‹ç±»å‹"></a>å®ä¾‹ï¼šåŸå§‹ç±»å‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsOrigionalTypeDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line"></span><br><span class="line">        <span class="comment">/**ä¸æŒ‡å®šæ³›å‹çš„æ—¶å€™*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> GenericsOrigionalTypeDemo.add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Integerï¼Œæ‰€ä»¥Tä¸ºIntegerç±»å‹  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">f</span> <span class="operator">=</span> GenericsOrigionalTypeDemo.add(<span class="number">1</span>, <span class="number">1.2</span>); <span class="comment">//è¿™ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯Integerï¼Œä»¥é£æ ¼æ˜¯Floatï¼Œæ‰€ä»¥å–åŒä¸€çˆ¶ç±»çš„æœ€å°çº§ï¼Œä¸ºNumber  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> GenericsOrigionalTypeDemo.add(<span class="number">1</span>, <span class="string">&quot;asd&quot;</span>); <span class="comment">//è¿™ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯Integerï¼Œä»¥é£æ ¼æ˜¯Floatï¼Œæ‰€ä»¥å–åŒä¸€çˆ¶ç±»çš„æœ€å°çº§ï¼Œä¸ºObject  </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**æŒ‡å®šæ³›å‹çš„æ—¶å€™*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> GenericsOrigionalTypeDemo.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//æŒ‡å®šäº†Integerï¼Œæ‰€ä»¥åªèƒ½ä¸ºIntegerç±»å‹æˆ–è€…å…¶å­ç±»  </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> GenericsOrigionalTypeDemo.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//ç¼–è¯‘é”™è¯¯ï¼ŒæŒ‡å®šäº†Integerï¼Œä¸èƒ½ä¸ºFloat  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">c</span> <span class="operator">=</span> GenericsOrigionalTypeDemo.&lt;Number&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//æŒ‡å®šä¸ºNumberï¼Œæ‰€ä»¥å¯ä»¥ä¸ºIntegerå’ŒFloat  </span></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ³›å‹æ–¹æ³•  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">add</span><span class="params">(T x,T y)</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> y;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p>æ ¹æ®è¿”å›å€¼ç±»å‹ï¼Œæ¥æŒ‡å®šåŸå§‹ç±»å‹</p><p><img src="/2020/11/25/Java%E6%B3%9B%E5%9E%8B/20201125153031-nnf34xp-image-20210403104218-xsso34p.png" alt="Javaæ³›å‹.png"></p><h4 id="å®ä¾‹ï¼šObject-æ³›å‹"><a href="#å®ä¾‹ï¼šObject-æ³›å‹" class="headerlink" title="å®ä¾‹ï¼šObject æ³›å‹"></a>å®ä¾‹ï¼šObject æ³›å‹</h4><p>åœ¨æ³›å‹ä¸­ï¼Œå¦‚æœæŒ‡å®šäº†ç±»å‹ä¸º <code>Object</code> ï¼Œç›¸å½“äºä¸æŒ‡å®šç±»å‹ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„çš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsObjectDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">System.out.println(<span class="string">&quot;Objectæ³›å‹: &quot;</span> + list.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="/2020/11/25/Java%E6%B3%9B%E5%9E%8B/20201125153528-mjkxtgh-image-20210403104218-h5wsomx.png" alt="Javaæ³›å‹.png"></p><h3 id="ç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"><a href="#ç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜åŠè§£å†³æ–¹æ³•" class="headerlink" title="ç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"></a>ç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜åŠè§£å†³æ–¹æ³•</h3><blockquote><p>è½¬è½½è‡ª cnblogs</p><p><a href="https://www.cnblogs.com/wuqinglong/p/9456193.html">https://www.cnblogs.com/wuqinglong/p/9456193.html</a></p></blockquote><p>å› ä¸ºç§ç§åŸå› ï¼ŒJava ä¸èƒ½å®ç°çœŸæ­£çš„æ³›å‹ï¼Œåªèƒ½ä½¿ç”¨ç±»å‹æ“¦é™¤æ¥å®ç°ä¼ªæ³›å‹ï¼Œè¿™æ ·è™½ç„¶ä¸ä¼šæœ‰ç±»å‹è†¨èƒ€é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿå¼•èµ·æ¥è®¸å¤šæ–°é—®é¢˜ï¼Œæ‰€ä»¥ï¼ŒSUN å¯¹è¿™äº›é—®é¢˜åšå‡ºäº†ç§ç§é™åˆ¶ï¼Œé¿å…æˆ‘ä»¬å‘ç”Ÿå„ç§é”™è¯¯ã€‚</p><h4 id="1-å…ˆæ£€æŸ¥ï¼Œå†ç¼–è¯‘ä»¥åŠç¼–è¯‘çš„å¯¹è±¡å’Œå¼•ç”¨ä¼ é€’é—®é¢˜"><a href="#1-å…ˆæ£€æŸ¥ï¼Œå†ç¼–è¯‘ä»¥åŠç¼–è¯‘çš„å¯¹è±¡å’Œå¼•ç”¨ä¼ é€’é—®é¢˜" class="headerlink" title="1.å…ˆæ£€æŸ¥ï¼Œå†ç¼–è¯‘ä»¥åŠç¼–è¯‘çš„å¯¹è±¡å’Œå¼•ç”¨ä¼ é€’é—®é¢˜"></a>1.å…ˆæ£€æŸ¥ï¼Œå†ç¼–è¯‘ä»¥åŠç¼–è¯‘çš„å¯¹è±¡å’Œå¼•ç”¨ä¼ é€’é—®é¢˜</h4><p>Q: æ—¢ç„¶è¯´ç±»å‹å˜é‡ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™æ“¦é™¤æ‰ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾€ ArrayList åˆ›å»ºçš„å¯¹è±¡ä¸­æ·»åŠ æ•´æ•°ä¼šæŠ¥é”™å‘¢ï¼Ÿä¸æ˜¯è¯´æ³›å‹å˜é‡ String ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™å˜ä¸º Object ç±»å‹å—ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½å­˜åˆ«çš„ç±»å‹å‘¢ï¼Ÿæ—¢ç„¶ç±»å‹æ“¦é™¤äº†ï¼Œå¦‚ä½•ä¿è¯æˆ‘ä»¬åªèƒ½ä½¿ç”¨æ³›å‹å˜é‡é™å®šçš„ç±»å‹å‘¢ï¼Ÿ</p><p>A: Java ç¼–è¯‘å™¨æ˜¯é€šè¿‡å…ˆæ£€æŸ¥ä»£ç ä¸­æ³›å‹çš„ç±»å‹ï¼Œç„¶ååœ¨è¿›è¡Œç±»å‹æ“¦é™¤ï¼Œå†è¿›è¡Œç¼–è¯‘ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line"></span><br><span class="line">    ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">    list.add(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">    list.add(<span class="number">123</span>);<span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œä½¿ç”¨<code>add</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªæ•´å‹ï¼Œåœ¨ IDE ä¸­ï¼Œç›´æ¥ä¼šæŠ¥é”™ï¼Œè¯´æ˜è¿™å°±æ˜¯åœ¨ç¼–è¯‘ä¹‹å‰çš„æ£€æŸ¥ï¼Œå› ä¸ºå¦‚æœæ˜¯åœ¨ç¼–è¯‘ä¹‹åæ£€æŸ¥ï¼Œç±»å‹æ“¦é™¤åï¼ŒåŸå§‹ç±»å‹ä¸º<code>Object</code>ï¼Œæ˜¯åº”è¯¥å…è®¸ä»»æ„å¼•ç”¨ç±»å‹æ·»åŠ çš„ã€‚å¯å®é™…ä¸Šå´ä¸æ˜¯è¿™æ ·çš„ï¼Œè¿™æ°æ°è¯´æ˜äº†å…³äºæ³›å‹å˜é‡çš„ä½¿ç”¨ï¼Œæ˜¯ä¼šåœ¨ç¼–è¯‘ä¹‹å‰æ£€æŸ¥çš„ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ªç±»å‹æ£€æŸ¥æ˜¯é’ˆå¯¹è°çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹å‚æ•°åŒ–ç±»å‹å’ŒåŸå§‹ç±»å‹çš„å…¼å®¹ã€‚</p><p>ä»¥ ArrayList ä¸¾ä¾‹å­ï¼Œä»¥å‰çš„å†™æ³•ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br></pre></td></tr></table></figure><p>ç°åœ¨çš„å†™æ³•ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä¸ä»¥å‰çš„ä»£ç å…¼å®¹ï¼Œå„ç§å¼•ç”¨ä¼ å€¼ä¹‹é—´ï¼Œå¿…ç„¶ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); <span class="comment">//ç¬¬ä¸€ç§ æƒ…å†µ</span></span><br><span class="line"><span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//ç¬¬äºŒç§ æƒ…å†µ</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æ˜¯æ²¡æœ‰é”™è¯¯çš„ï¼Œä¸è¿‡ä¼šæœ‰ä¸ªç¼–è¯‘æ—¶è­¦å‘Šã€‚</p><p>ä¸è¿‡åœ¨ç¬¬ä¸€ç§æƒ…å†µï¼Œå¯ä»¥å®ç°ä¸å®Œå…¨ä½¿ç”¨æ³›å‹å‚æ•°ä¸€æ ·çš„æ•ˆæœï¼Œç¬¬äºŒç§åˆ™æ²¡æœ‰æ•ˆæœã€‚</p><p>å› ä¸ºç±»å‹æ£€æŸ¥å°±æ˜¯ç¼–è¯‘æ—¶å®Œæˆçš„ï¼Œ<code>new ArrayList()</code>åªæ˜¯åœ¨å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹å¯¹è±¡ï¼Œè€ŒçœŸæ­£è®¾è®¡ç±»å‹æ£€æŸ¥çš„æ˜¯å®ƒçš„å¼•ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨å®ƒå¼•ç”¨<code>list1</code>æ¥è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´è°ƒç”¨<code>add</code>æ–¹æ³•ï¼Œæ‰€ä»¥<code>list1</code>å¼•ç”¨èƒ½å®Œæˆæ³›å‹ç±»å‹çš„æ£€æŸ¥ã€‚è€Œå¼•ç”¨<code>list2</code>æ²¡æœ‰ä½¿ç”¨æ³›å‹ï¼Œæ‰€ä»¥ä¸è¡Œã€‚</p><p>ä¸¾ä¾‹å­ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br><span class="line">        list1.add(<span class="string">&quot;1&quot;</span>); <span class="comment">//ç¼–è¯‘é€šè¿‡  </span></span><br><span class="line">        list1.add(<span class="number">1</span>); <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> list1.get(<span class="number">0</span>); <span class="comment">//è¿”å›ç±»å‹å°±æ˜¯String  </span></span><br><span class="line"></span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">        list2.add(<span class="string">&quot;1&quot;</span>); <span class="comment">//ç¼–è¯‘é€šè¿‡  </span></span><br><span class="line">        list2.add(<span class="number">1</span>); <span class="comment">//ç¼–è¯‘é€šè¿‡  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> list2.get(<span class="number">0</span>); <span class="comment">//è¿”å›ç±»å‹å°±æ˜¯Object  </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="string">&quot;11&quot;</span>); <span class="comment">//ç¼–è¯‘é€šè¿‡  </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="number">22</span>); <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().get(<span class="number">0</span>); <span class="comment">//è¿”å›ç±»å‹å°±æ˜¯String  </span></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç™½ï¼Œç±»å‹æ£€æŸ¥å°±æ˜¯é’ˆå¯¹å¼•ç”¨çš„ï¼Œè°æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œç”¨è¿™ä¸ªå¼•ç”¨è°ƒç”¨æ³›å‹æ–¹æ³•ï¼Œå°±ä¼šå¯¹è¿™ä¸ªå¼•ç”¨è°ƒç”¨çš„æ–¹æ³•è¿›è¡Œç±»å‹æ£€æµ‹ï¼Œè€Œæ— å…³å®ƒçœŸæ­£å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>æ³›å‹ä¸­å‚æ•°è¯ç±»å‹ä¸ºä»€ä¹ˆä¸è€ƒè™‘ç»§æ‰¿å…³ç³»ï¼Ÿ</p><p>åœ¨ Java ä¸­ï¼Œåƒä¸‹é¢å½¢å¼çš„å¼•ç”¨ä¼ é€’æ˜¯ä¸å…è®¸çš„ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;(); <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">ArrayList&lt;Object&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸€ç§æƒ…å†µï¼Œå°†ç¬¬ä¸€ç§æƒ…å†µæ‹“å±•æˆä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Object&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">Object</span>());  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">Object</span>());  </span><br><span class="line">ArrayList&lt;String&gt; list2 = list1; <span class="comment">//ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œåœ¨ç¬¬ 4 è¡Œä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰ç¼–è¯‘é”™è¯¯ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆå‡è®¾å®ƒç¼–è¯‘æ²¡é”™ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨<code>list2</code>å¼•ç”¨ç”¨<code>get()</code>æ–¹æ³•å–å€¼çš„æ—¶å€™ï¼Œè¿”å›çš„éƒ½æ˜¯<code>String</code>ç±»å‹çš„å¯¹è±¡ï¼ˆä¸Šé¢æåˆ°äº†ï¼Œç±»å‹æ£€æµ‹æ˜¯æ ¹æ®å¼•ç”¨æ¥å†³å®šçš„ï¼‰ï¼Œå¯æ˜¯å®ƒé‡Œé¢å®é™…ä¸Šå·²ç»è¢«æˆ‘ä»¬å­˜æ”¾äº†<code>Object</code>ç±»å‹çš„å¯¹è±¡ï¼Œè¿™æ ·å°±ä¼šæœ‰<code>ClassCastException</code>äº†ã€‚æ‰€ä»¥ä¸ºäº†é¿å…è¿™ç§ææ˜“å‡ºç°çš„é”™è¯¯ï¼ŒJava ä¸å…è®¸è¿›è¡Œè¿™æ ·çš„å¼•ç”¨ä¼ é€’ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯æ³›å‹å‡ºç°çš„åŸå› ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½è¿èƒŒå®ƒçš„åˆè¡·ï¼‰ã€‚</p><p>å†çœ‹ç¬¬äºŒç§æƒ…å†µï¼Œå°†ç¬¬äºŒç§æƒ…å†µæ‹“å±•æˆä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">String</span>());  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">String</span>());</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Object&gt; list2 = list1; <span class="comment">//ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œè¿™æ ·çš„æƒ…å†µæ¯”ç¬¬ä¸€ç§æƒ…å†µå¥½çš„å¤šï¼Œæœ€èµ·ç ï¼Œåœ¨æˆ‘ä»¬ç”¨<code>list2</code>å–å€¼çš„æ—¶å€™ä¸ä¼šå‡ºç°<code>ClassCastException</code>ï¼Œå› ä¸ºæ˜¯ä»<code>String</code>è½¬æ¢ä¸º<code>Object</code>ã€‚å¯æ˜¯ï¼Œè¿™æ ·åšæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Œæ³›å‹å‡ºç°çš„åŸå› ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ç±»å‹è½¬æ¢çš„é—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨äº†æ³›å‹ï¼Œåˆ°å¤´æ¥ï¼Œè¿˜æ˜¯è¦è‡ªå·±å¼ºè½¬ï¼Œè¿èƒŒäº†æ³›å‹è®¾è®¡çš„åˆè¡·ã€‚æ‰€ä»¥ Java ä¸å…è®¸è¿™ä¹ˆå¹²ã€‚å†è¯´ï¼Œä½ å¦‚æœåˆç”¨<code>list2</code>å¾€é‡Œé¢<code>add()</code>æ–°çš„å¯¹è±¡ï¼Œé‚£ä¹ˆåˆ°æ—¶å€™å–å¾—æ—¶å€™ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“æˆ‘å–å‡ºæ¥çš„åˆ°åº•æ˜¯<code>String</code>ç±»å‹çš„ï¼Œè¿˜æ˜¯<code>Object</code>ç±»å‹çš„å‘¢ï¼Ÿ</p><p><strong>æ‰€ä»¥ï¼Œè¦æ ¼å¤–æ³¨æ„ï¼Œæ³›å‹ä¸­çš„å¼•ç”¨ä¼ é€’çš„é—®é¢˜ã€‚</strong></p><h4 id="2-è‡ªåŠ¨ç±»å‹è½¬æ¢"><a href="#2-è‡ªåŠ¨ç±»å‹è½¬æ¢" class="headerlink" title="2.è‡ªåŠ¨ç±»å‹è½¬æ¢"></a>2.è‡ªåŠ¨ç±»å‹è½¬æ¢</h4><p>å› ä¸ºç±»å‹æ“¦é™¤çš„é—®é¢˜ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ³›å‹ç±»å‹å˜é‡æœ€åéƒ½ä¼šè¢«æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ã€‚</p><p>æ—¢ç„¶éƒ½è¢«æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è·å–çš„æ—¶å€™ï¼Œä¸éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢å‘¢ï¼Ÿ</p><p>çœ‹ä¸‹<code>ArrayList.get()</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;  </span><br><span class="line"></span><br><span class="line">    RangeCheck(index);  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (E) elementData[index];  </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>return</code>ä¹‹å‰ï¼Œä¼šæ ¹æ®æ³›å‹å˜é‡è¿›è¡Œå¼ºè½¬ã€‚å‡è®¾æ³›å‹ç±»å‹å˜é‡ä¸º<code>Date</code>ï¼Œè™½ç„¶æ³›å‹ä¿¡æ¯ä¼šè¢«æ“¦é™¤æ‰ï¼Œä½†æ˜¯ä¼šå°†<code>(E) elementData[index]</code>ï¼Œç¼–è¯‘ä¸º<code>(Date)elementData[index]</code>ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸ç”¨è‡ªå·±è¿›è¡Œå¼ºè½¬ã€‚å½“å­˜å–ä¸€ä¸ªæ³›å‹åŸŸæ—¶ä¹Ÿä¼šè‡ªåŠ¨æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚å‡è®¾<code>Pair</code>ç±»çš„<code>value</code>åŸŸæ˜¯<code>public</code>çš„ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> pair.value;</span><br></pre></td></tr></table></figure><p>ä¹Ÿä¼šè‡ªåŠ¨åœ°åœ¨ç»“æœå­—èŠ‚ç ä¸­æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p><h4 id="3-ç±»å‹æ“¦é™¤ä¸å¤šæ€çš„å†²çªå’Œè§£å†³æ–¹æ³•"><a href="#3-ç±»å‹æ“¦é™¤ä¸å¤šæ€çš„å†²çªå’Œè§£å†³æ–¹æ³•" class="headerlink" title="3.ç±»å‹æ“¦é™¤ä¸å¤šæ€çš„å†²çªå’Œè§£å†³æ–¹æ³•"></a>3.ç±»å‹æ“¦é™¤ä¸å¤šæ€çš„å†²çªå’Œè§£å†³æ–¹æ³•</h4><p>ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ³›å‹ç±»ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T value;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªå­ç±»ç»§æ‰¿å®ƒã€‚</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DateInter</span> <span class="keyword">extends</span> <span class="title class_">Pair</span>&lt;Date&gt; &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>.setValue(value);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå­ç±»ä¸­ï¼Œæˆ‘ä»¬è®¾å®šçˆ¶ç±»çš„æ³›å‹ç±»å‹ä¸º<code>Pair&lt;Date&gt;</code>ï¼Œåœ¨å­ç±»ä¸­ï¼Œæˆ‘ä»¬è¦†ç›–äº†çˆ¶ç±»çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬çš„åŸæ„æ˜¯è¿™æ ·çš„ï¼šå°†çˆ¶ç±»çš„æ³›å‹ç±»å‹é™å®šä¸º<code>Date</code>ï¼Œé‚£ä¹ˆçˆ¶ç±»é‡Œé¢çš„ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½ä¸º<code>Date</code>ç±»å‹ã€‚</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> value;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> &#123;  </span><br><span class="line">    <span class="built_in">this</span>.value = value;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å­ç±»ä¸­é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ä¸€ç‚¹é—®é¢˜ä¹Ÿæ²¡æœ‰ï¼Œå®é™…ä¸Šï¼Œä»ä»–ä»¬çš„<code>@Override</code>æ ‡ç­¾ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä¸€ç‚¹é—®é¢˜ä¹Ÿæ²¡æœ‰ï¼Œå®é™…ä¸Šæ˜¯è¿™æ ·çš„å—ï¼Ÿ</p><p>åˆ†æï¼šå®é™…ä¸Šï¼Œç±»å‹æ“¦é™¤åï¼Œçˆ¶ç±»çš„çš„æ³›å‹ç±»å‹å…¨éƒ¨å˜ä¸ºäº†åŸå§‹ç±»å‹<code>Object</code>ï¼Œæ‰€ä»¥çˆ¶ç±»ç¼–è¯‘ä¹‹åä¼šå˜æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Object value;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object  value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>å†çœ‹å­ç±»çš„ä¸¤ä¸ªé‡å†™çš„æ–¹æ³•çš„ç±»å‹ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>.setValue(value);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥åˆ†æ<code>setValue</code>æ–¹æ³•ï¼Œçˆ¶ç±»çš„ç±»å‹æ˜¯<code>Object</code>ï¼Œè€Œå­ç±»çš„ç±»å‹æ˜¯<code>Date</code>ï¼Œå‚æ•°ç±»å‹ä¸ä¸€æ ·ï¼Œè¿™å¦‚æœå®åœ¨æ™®é€šçš„ç»§æ‰¿å…³ç³»ä¸­ï¼Œæ ¹æœ¬å°±ä¸ä¼šæ˜¯é‡å†™ï¼Œè€Œæ˜¯é‡è½½ã€‚<br>ã€€ã€€<br>æˆ‘ä»¬åœ¨ä¸€ä¸ª main æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;  </span><br><span class="line">        <span class="type">DateInter</span> <span class="variable">dateInter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateInter</span>();  </span><br><span class="line">        dateInter.setValue(<span class="keyword">new</span> <span class="title class_">Date</span>());    </span><br><span class="line">        dateInter.setValue(<span class="keyword">new</span> <span class="title class_">Object</span>()); <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é‡è½½ï¼Œé‚£ä¹ˆå­ç±»ä¸­ä¸¤ä¸ª<code>setValue</code>æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å‚æ•°<code>Object</code>ç±»å‹ï¼Œä¸€ä¸ªæ˜¯<code>Date</code>ç±»å‹ï¼Œå¯æ˜¯æˆ‘ä»¬å‘ç°ï¼Œæ ¹æœ¬å°±æ²¡æœ‰è¿™æ ·çš„ä¸€ä¸ªå­ç±»ç»§æ‰¿è‡ªçˆ¶ç±»çš„ Object ç±»å‹å‚æ•°çš„æ–¹æ³•ã€‚æ‰€ä»¥è¯´ï¼Œå´æ˜¯æ˜¯é‡å†™äº†ï¼Œè€Œä¸æ˜¯é‡è½½äº†ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p><p>åŸå› æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬ä¼ å…¥çˆ¶ç±»çš„æ³›å‹ç±»å‹æ˜¯<code>Dateï¼ŒPair&lt;Date&gt;</code>ï¼Œæˆ‘ä»¬çš„æœ¬æ„æ˜¯å°†æ³›å‹ç±»å˜ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Date value;  </span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†å­ç±»ä¸­é‡å†™å‚æ•°ç±»å‹ä¸º Date çš„é‚£ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ç°ç»§æ‰¿ä¸­çš„å¤šæ€ã€‚</p><p>å¯æ˜¯ç”±äºç§ç§åŸå› ï¼Œè™šæ‹Ÿæœºå¹¶ä¸èƒ½å°†æ³›å‹ç±»å‹å˜ä¸º<code>Date</code>ï¼Œåªèƒ½å°†ç±»å‹æ“¦é™¤æ‰ï¼Œå˜ä¸ºåŸå§‹ç±»å‹<code>Object</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„æœ¬æ„æ˜¯è¿›è¡Œé‡å†™ï¼Œå®ç°å¤šæ€ã€‚å¯æ˜¯ç±»å‹æ“¦é™¤åï¼Œåªèƒ½å˜ä¸ºäº†é‡è½½ã€‚è¿™æ ·ï¼Œç±»å‹æ“¦é™¤å°±å’Œå¤šæ€æœ‰äº†å†²çªã€‚JVM çŸ¥é“ä½ çš„æœ¬æ„å—ï¼ŸçŸ¥é“ï¼ï¼ï¼å¯æ˜¯å®ƒèƒ½ç›´æ¥å®ç°å—ï¼Œä¸èƒ½ï¼ï¼ï¼å¦‚æœçœŸçš„ä¸èƒ½çš„è¯ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆå»é‡å†™æˆ‘ä»¬æƒ³è¦çš„<code>Date</code>ç±»å‹å‚æ•°çš„æ–¹æ³•å•Šã€‚</p><p>äºæ˜¯ JVM é‡‡ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•ï¼Œæ¥å®Œæˆè¿™é¡¹åŠŸèƒ½ï¼Œé‚£å°±æ˜¯æ¡¥æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨<code>javap -c className</code>çš„æ–¹å¼åç¼–è¯‘ä¸‹<code>DateInter</code>å­ç±»çš„å­—èŠ‚ç ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">class com.tao.test.DateInter extends com.tao.test.Pair&lt;java.util.Date&gt; &#123;  </span><br><span class="line">  com.tao.test.DateInter();  </span><br><span class="line">    Code:  </span><br><span class="line">       0: aload_0  </span><br><span class="line">       1: invokespecial #8                  // Method com/tao/test/Pair.&quot;&lt;init&gt;&quot;:()V  </span><br><span class="line">       4: return  </span><br><span class="line"></span><br><span class="line">  public void setValue(java.util.Date);  //æˆ‘ä»¬é‡å†™çš„setValueæ–¹æ³•  </span><br><span class="line">    Code:  </span><br><span class="line">       0: aload_0  </span><br><span class="line">       1: aload_1  </span><br><span class="line">       2: invokespecial #16                 // Method com/tao/test/Pair.setValue:(Ljava/lang/Object;)V  </span><br><span class="line">       5: return  </span><br><span class="line"></span><br><span class="line">  public java.util.Date getValue();    //æˆ‘ä»¬é‡å†™çš„getValueæ–¹æ³•  </span><br><span class="line">    Code:  </span><br><span class="line">       0: aload_0  </span><br><span class="line">       1: invokespecial #23                 // Method com/tao/test/Pair.getValue:()Ljava/lang/Object;  </span><br><span class="line">       4: checkcast     #26                 // class java/util/Date  </span><br><span class="line">       7: areturn  </span><br><span class="line"></span><br><span class="line">  public java.lang.Object getValue();     //ç¼–è¯‘æ—¶ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„å·§æ–¹æ³•  </span><br><span class="line">    Code:  </span><br><span class="line">       0: aload_0  </span><br><span class="line">       1: invokevirtual #28                 // Method getValue:()Ljava/util/Date å»è°ƒç”¨æˆ‘ä»¬é‡å†™çš„getValueæ–¹æ³•;  </span><br><span class="line">       4: areturn  </span><br><span class="line"></span><br><span class="line">  public void setValue(java.lang.Object);   //ç¼–è¯‘æ—¶ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„å·§æ–¹æ³•  </span><br><span class="line">    Code:  </span><br><span class="line">       0: aload_0  </span><br><span class="line">       1: aload_1  </span><br><span class="line">       2: checkcast     #26                 // class java/util/Date  </span><br><span class="line">       5: invokevirtual #30                 // Method setValue:(Ljava/util/Date; å»è°ƒç”¨æˆ‘ä»¬é‡å†™çš„setValueæ–¹æ³•)V  </span><br><span class="line">       8: return  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ç¼–è¯‘çš„ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬æœ¬æ„é‡å†™<code>setValue</code>å’Œ<code>getValue</code>æ–¹æ³•çš„å­ç±»ï¼Œç«Ÿç„¶æœ‰ 4 ä¸ªæ–¹æ³•ï¼Œå…¶å®ä¸ç”¨æƒŠå¥‡ï¼Œæœ€åçš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç¼–è¯‘å™¨è‡ªå·±ç”Ÿæˆçš„æ¡¥æ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°æ¡¥æ–¹æ³•çš„å‚æ•°ç±»å‹éƒ½æ˜¯ Objectï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»ä¸­çœŸæ­£è¦†ç›–çˆ¶ç±»ä¸¤ä¸ªæ–¹æ³•çš„å°±æ˜¯è¿™ä¸¤ä¸ªæˆ‘ä»¬çœ‹ä¸åˆ°çš„æ¡¥æ–¹æ³•ã€‚è€Œæ‰“åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„<code>setvalue</code>å’Œ<code>getValue</code>æ–¹æ³•ä¸Šé¢çš„<code>@Oveerride</code>åªä¸è¿‡æ˜¯å‡è±¡ã€‚è€Œæ¡¥æ–¹æ³•çš„å†…éƒ¨å®ç°ï¼Œå°±åªæ˜¯å»è°ƒç”¨æˆ‘ä»¬è‡ªå·±é‡å†™çš„é‚£ä¸¤ä¸ªæ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œè™šæ‹Ÿæœºå·§å¦™çš„ä½¿ç”¨äº†æ¡¥æ–¹æ³•ï¼Œæ¥è§£å†³äº†ç±»å‹æ“¦é™¤å’Œå¤šæ€çš„å†²çªã€‚</p><p>ä¸è¿‡ï¼Œè¦æåˆ°ä¸€ç‚¹ï¼Œè¿™é‡Œé¢çš„<code>setValue</code>å’Œ<code>getValue</code>è¿™ä¸¤ä¸ªæ¡¥æ–¹æ³•çš„æ„ä¹‰åˆæœ‰ä¸åŒã€‚</p><p><code>setValue</code>æ–¹æ³•æ˜¯ä¸ºäº†è§£å†³ç±»å‹æ“¦é™¤ä¸å¤šæ€ä¹‹é—´çš„å†²çªã€‚</p><p>è€Œ<code>getValue</code>å´æœ‰æ™®éçš„æ„ä¹‰ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„ç»§æ‰¿å…³ç³»ï¼š</p><p>é‚£ä¹ˆçˆ¶ç±»çš„<code>setValue</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ObjectgetValue</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå­ç±»é‡å†™çš„æ–¹æ³•æ˜¯ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™åœ¨æ™®é€šçš„ç±»ç»§æ‰¿ä¸­ä¹Ÿæ˜¯æ™®éå­˜åœ¨çš„é‡å†™ï¼Œè¿™å°±æ˜¯â€åå˜â€[^1]</p><p>å¹¶ä¸”ï¼Œè¿˜æœ‰ä¸€ç‚¹ä¹Ÿè®¸ä¼šæœ‰ç–‘é—®ï¼Œå­ç±»ä¸­çš„å·§æ–¹æ³•<code>Object getValue()</code>å’Œ<code>Date getValue()</code>æ˜¯åŒ æ—¶å­˜åœ¨çš„ï¼Œå¯æ˜¯å¦‚æœæ˜¯å¸¸è§„çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä»–ä»¬çš„æ–¹æ³•ç­¾åæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è™šæ‹Ÿæœºæ ¹æœ¬ä¸èƒ½åˆ†åˆ«è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™ Java ä»£ç ï¼Œè¿™æ ·çš„ä»£ç æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥çš„ï¼Œä½†æ˜¯è™šæ‹Ÿæœºå´æ˜¯å…è®¸è¿™æ ·åšçš„ï¼Œå› ä¸ºè™šæ‹Ÿæœºé€šè¿‡å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹æ¥ç¡®å®šä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¸ºäº†å®ç°æ³›å‹çš„å¤šæ€å…è®¸è‡ªå·±åšè¿™ä¸ªçœ‹èµ·æ¥â€œä¸åˆæ³•â€çš„äº‹æƒ…ï¼Œç„¶åäº¤ç»™è™šæ‹Ÿå™¨å»åŒºåˆ«ã€‚</p><h4 id="4-æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹"><a href="#4-æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="4.æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹"></a>4.æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹</h4><p>ä¸èƒ½ç”¨ç±»å‹å‚æ•°æ›¿æ¢åŸºæœ¬ç±»å‹ã€‚å°±æ¯”å¦‚ï¼Œæ²¡æœ‰<code>ArrayList&lt;double&gt;</code>ï¼Œåªæœ‰<code>ArrayList&lt;Double&gt;</code>ã€‚å› ä¸ºå½“ç±»å‹æ“¦é™¤åï¼Œ<code>ArrayList</code>çš„åŸå§‹ç±»å‹å˜ä¸º<code>Object</code>ï¼Œä½†æ˜¯<code>Object</code>ç±»å‹ä¸èƒ½å­˜å‚¨<code>double</code>å€¼ï¼Œåªèƒ½å¼•ç”¨<code>Double</code>çš„å€¼ã€‚</p><h4 id="5-ç¼–è¯‘æ—¶é›†åˆçš„-instanceof"><a href="#5-ç¼–è¯‘æ—¶é›†åˆçš„-instanceof" class="headerlink" title="5.ç¼–è¯‘æ—¶é›†åˆçš„ instanceof"></a>5.ç¼–è¯‘æ—¶é›†åˆçš„ instanceof</h4><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br></pre></td></tr></table></figure><p>å› ä¸ºç±»å‹æ“¦é™¤ä¹‹åï¼Œ<code>ArrayList&lt;String&gt;</code>åªå‰©ä¸‹åŸå§‹ç±»å‹ï¼Œæ³›å‹ä¿¡æ¯<code>String</code>ä¸å­˜åœ¨äº†ã€‚</p><p>é‚£ä¹ˆï¼Œç¼–è¯‘æ—¶è¿›è¡Œç±»å‹æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ˜¯é”™è¯¯çš„</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( arrayList <span class="keyword">instanceof</span> ArrayList&lt;String&gt;)</span><br></pre></td></tr></table></figure><h4 id="6-æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜"><a href="#6-æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜" class="headerlink" title="6.æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜"></a>6.æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜</h4><p>æ³›å‹ç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å˜é‡ä¸å¯ä»¥ä½¿ç”¨æ³›å‹ç±»æ‰€å£°æ˜çš„æ³›å‹ç±»å‹å‚æ•°</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span>&lt;T&gt; &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> T one;   <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  T <span class="title function_">show</span><span class="params">(T one)</span>&#123; <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ³›å‹ç±»ä¸­çš„æ³›å‹å‚æ•°çš„å®ä¾‹åŒ–æ˜¯åœ¨å®šä¹‰å¯¹è±¡çš„æ—¶å€™æŒ‡å®šçš„ï¼Œè€Œé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ä¸éœ€è¦ä½¿ç”¨å¯¹è±¡æ¥è°ƒç”¨ã€‚å¯¹è±¡éƒ½æ²¡æœ‰åˆ›å»ºï¼Œå¦‚ä½•ç¡®å®šè¿™ä¸ªæ³›å‹å‚æ•°æ˜¯ä½•ç§ç±»å‹ï¼Œæ‰€ä»¥å½“ç„¶æ˜¯é”™è¯¯çš„ã€‚</p><p>ä½†æ˜¯è¦æ³¨æ„åŒºåˆ†ä¸‹é¢çš„ä¸€ç§æƒ…å†µï¼š</p><figure class="highlight java"><figcaption><span>hljs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span>&lt;T&gt; &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T &gt;T <span class="title function_">show</span><span class="params">(T one)</span>&#123; <span class="comment">//è¿™æ˜¯æ­£ç¡®çš„  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œåœ¨æ³›å‹æ–¹æ³•ä¸­ä½¿ç”¨çš„ T æ˜¯è‡ªå·±åœ¨æ–¹æ³•ä¸­å®šä¹‰çš„ Tï¼Œè€Œä¸æ˜¯æ³›å‹ç±»ä¸­çš„ Tã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»BIEE 12çœ‹æ•°æ®ä»“åº“</title>
      <link href="/2020/06/19/%E4%BB%8EBIEE%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"/>
      <url>/2020/06/19/%E4%BB%8EBIEE%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»-BIEE-12-çœ‹æ•°æ®ä»“åº“"><a href="#ä»-BIEE-12-çœ‹æ•°æ®ä»“åº“" class="headerlink" title="ä» BIEE 12 çœ‹æ•°æ®ä»“åº“"></a>ä» BIEE 12 çœ‹æ•°æ®ä»“åº“</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h4 id="OLTP"><a href="#OLTP" class="headerlink" title="OLTP"></a>OLTP</h4><ul><li>OLTP å³è”æœºäº‹åŠ¡å¤„ç†(On-Line Transaction Processing)ï¼Œä¸»è¦æŒ‡å‘ç”Ÿåœ¨<strong>æ“ä½œå‹ç³»ç»Ÿ</strong>ä¸Šçš„é¢å‘äº‹åŠ¡çš„æ“ä½œï¼Œè¿™é‡Œçš„äº‹åŠ¡ç‰¹æŒ‡ä¸šåŠ¡ä¸Šçš„ç»Ÿä¸€ä¸”ä¸å¯åˆ†å‰²çš„ä¸€ç³»åˆ—æ“ä½œï¼Œè€Œä¸æ˜¯æ•°æ®åº“ä¸­å¢åˆ æ”¹æŸ¥çš„å•ä¸ªåŸå­æ“ä½œã€‚</li><li>OLTP ç»å¸¸è§¦å‘ CRUD æ“ä½œï¼ˆCRUD æ˜¯æŒ‡åœ¨åšè®¡ç®—å¤„ç†æ—¶çš„å¢åŠ (Create)ã€è¯»å–æŸ¥è¯¢(Retrieve)ã€æ›´æ–°(Update)å’Œåˆ é™¤(Delete)ï¼‰ï¼Œæ˜¯æ’å…¥å’Œæ›´æ–°å¯†é›†å‹æ“ä½œï¼Œè¦æ±‚ï¼ˆè¶…ï¼‰é«˜å¹¶å‘ï¼Œå“åº”å¿«ã€‚<strong>ORCALE EBS</strong>ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼šç”¨æˆ·åœ¨è®¢å•ç®¡ç†å™¨åˆ›å»ºè®¢å•ï¼Œä¾›åº”å•†çš„å¯ç”¨ä½™é¢æ‰£å‡ï¼Œåº“å­˜çš„å¯ç”¨é‡ä¹ŸåŒæ—¶æ‰£å‡ã€‚ä»æ•°æ®åº“è§’åº¦ä¸Šçœ‹ï¼Œæ¶‰åŠåˆ°ä¸¤ä¸ªè¡¨ï¼ˆç®€åŒ–æ¨¡å‹ï¼Œå®é™…æ¶‰åŠå¤šå¼ è¡¨ï¼‰çš„æ›´æ–°æ“ä½œï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†ä¸¤ä¸ªå•ç‹¬çš„ updateï¼›ä½†æ˜¯ä»ä¸šåŠ¡çš„è§’åº¦ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå³æ›´æ–°ä¾›åº”å•†ä½™é¢å’Œæ‰£å‡åº“å­˜å¿…é¡»åŒæ—¶æˆåŠŸï¼Œå…¶ä¸­ä¸€ä¸ªå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å¿…é¡»å›æ»šåˆ°å¤„ç†å‰çš„ç»“æœã€‚</li></ul><h4 id="OLAP"><a href="#OLAP" class="headerlink" title="OLAP"></a>OLAP</h4><ul><li>OLAP å³è”æœºåˆ†æå¤„ç†(On-Line Analytical Processing)ï¼Œä¸»è¦æŒ‡å‘ç”Ÿåœ¨<strong>åˆ†æå‹ç³»ç»Ÿ</strong>ä¸Šçš„é¢å‘å¤šç»´åº¦æŸ¥è¯¢æ“ä½œï¼Œé€šå¸¸åœ¨è£…è½½æ•°æ®å‰éœ€è¦æ¸…æ´—å’Œè½¬æ¢ã€‚</li><li>OLAP å¤„ç†çš„äº‹åŠ¡ç›¸å¯¹<strong>æ“ä½œå‹ç³»ç»Ÿ</strong>æ¥è¯´è¾ƒå°‘ï¼Œä½†æ˜¯æŸ¥è¯¢é€šå¸¸å¯¹å†å²çš„ã€å½’æ¡£çš„æ•°æ®è¿›è¡Œéå¸¸å¤æ‚çš„é€»è¾‘ï¼Œå¦‚èšåˆè®¡ç®—ï¼Œå¤§é‡è¡¨å…³è”ç­‰ï¼Œå±äºæŸ¥è¯¢å¯†é›†å‹æ“ä½œï¼Œè¦æ±‚èƒ½å¤Ÿä½“ç°å¤šç»´åº¦ï¼Œå¤šä¸»é¢˜ï¼Œé«˜æ•´åˆåº¦ï¼Œèƒ½å¤Ÿåæ˜ å˜åŒ–è¶‹åŠ¿çš„æ•°æ®ã€‚<strong>Oracle BIEE</strong>ä¸Šå±•ç°æŠ¥è¡¨è¯¸å¦‚<strong>åº“å­˜è´¦é¾„ã€è¿½æº¯åº“å­˜å†å²ã€ç°é‡‘æµ</strong>ç­‰ï¼Œæ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“ä¸šåŠ¡æ•°æ®çš„é«˜åº¦æ£€ç´¢ï¼Œèƒ½å¤Ÿåæ˜ å‡ºä¸šåŠ¡æ•°æ®çš„åŒæ¯”ï¼ˆå»å¹´åŒæœŸï¼‰å’Œç¯æ¯”(åŒå¹´ä¸åŒå­£)ã€‚</li></ul><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>OLAP</th><th>OLTP</th></tr></thead><tbody><tr><td>æ•°æ®æº</td><td>å¯èƒ½æ¥æºäºå¤šä¸ªä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œä¸»è¦æ˜¯å†å²ã€å½’æ¡£çš„æ•°æ®</td><td>å½“å‰ç³»ç»Ÿä¸šåŠ¡æ“ä½œçš„æ‰€æœ‰æ˜ç»†è®°å½•éƒ½è¦ä¿å­˜</td></tr><tr><td>æ“ä½œ</td><td>æ³¨é‡äºå¤§é‡è¡¨çš„æŸ¥è¯¢å’Œèšåˆè®¡ç®—ï¼Œæ•°æ®è£…è½½é‡å¤§</td><td>æ³¨é‡æ›´æ–°å’Œæ’å…¥ï¼Œè¦æ±‚æ‰§è¡Œé€Ÿåº¦å¿«ï¼Œå¹¶å‘é‡å¤§</td></tr><tr><td>åº”ç”¨</td><td>å†³ç­–æ”¯æŒç³»ç»Ÿï¼ŒæŠ¥è¡¨åˆ†æç³»ç»Ÿ</td><td>åœ¨çº¿çš„äº¤æ˜“ã€ç®¡ç†ç³»ç»Ÿ</td></tr><tr><td>ç”¨æˆ·</td><td>ç®¡ç†äººå‘˜ã€åˆ†æäººå‘˜</td><td>ç»ˆç«¯ç”¨æˆ·</td></tr><tr><td>æ•°æ®æ¨¡å‹</td><td>é›ªèŠ±å‹æˆ–æ˜Ÿå‹æ¨¡å‹</td><td>å®ä½“å…³ç³»æ¨¡å‹</td></tr><tr><td>å¤‡ä»½</td><td>æŒ‰å¤©å¢é‡åŒæ­¥ï¼Œè‹¥æ•°æ®ä¸¢å¤±éœ€è¦ä»æ“ä½œå‹ç³»ç»Ÿé‡æ–°è£…è½½</td><td>å…¨é‡å®šæœŸå¤‡ä»½ï¼Œæ•°æ®ä¸å¯ä¸¢å¤±</td></tr><tr><td>æ—¶é—´</td><td>ä»¥å¹´ä¸ºå•ä½</td><td>ä»å¤©åˆ°å¹´</td></tr><tr><td>ç©ºé—´è¦æ±‚</td><td>å­˜æ”¾å¤šä¸ªç³»ç»Ÿçš„æ•°æ®çš„æ•°æ®ä»“åº“ï¼Œç©ºé—´è¦æ±‚å¤§</td><td>ä»…å­˜æ”¾å½“å‰æ“ä½œæ•°æ®ï¼Œç©ºé—´è¦æ±‚å°</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="æ•°æ®ä»“åº“å®šä¹‰"><a href="#æ•°æ®ä»“åº“å®šä¹‰" class="headerlink" title="æ•°æ®ä»“åº“å®šä¹‰"></a>æ•°æ®ä»“åº“å®šä¹‰</h4><p>æ•°æ®ä»“åº“æè¿°ä¸ºä¸€ä¸ªé¢å‘ä¸»é¢˜çš„ã€é›†æˆçš„ã€éšæ—¶é—´å˜åŒ–çš„ã€éæ˜“å¤±çš„æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒç®¡ç†è€…çš„å†³ç­–è¿‡ç¨‹ã€‚æ•°æ®ä»“åº“é€šè¿‡æŠ½å–ä¸€ä¸ªæˆ–å¤šä¸ªç³»ç»Ÿçš„æ•°æ®ï¼Œç»è¿‡æ¸…æ´—ã€è½¬æ¢è£…è½½åˆ°æ–°çš„æ•°æ®åº“ä¸­ï¼Œå®ƒæ˜¯ OLAP çš„åŸºç¡€ã€‚</p><h5 id="æ•°æ®ä»“åº“çš„å¿…è¦æ€§"><a href="#æ•°æ®ä»“åº“çš„å¿…è¦æ€§" class="headerlink" title="æ•°æ®ä»“åº“çš„å¿…è¦æ€§"></a>æ•°æ®ä»“åº“çš„å¿…è¦æ€§</h5><ul><li>æ•°æ®çš„ç±»å‹éå¸¸å¤šï¼Œé™¤äº†ä¸åŒæ•°æ®åº“éœ€è¦ç‰¹å®šçš„ä¸€ä¸ªä»“åº“å…¼å®¹ä»¥å¤–ï¼Œè¿˜æœ‰å„ç§å„æ ·çš„æ–‡ä»¶ç±»å‹ï¼ˆå¦‚ xlsã€CSVã€HTMLã€XML ç­‰ï¼‰</li><li>å‡ºäºæƒé™æ§åˆ¶çš„è¦æ±‚ï¼Œä¸€ä¸ªç”¨æˆ·ä¸èƒ½åŒæ—¶è®¿é—®å¤šä¸ªç³»ç»Ÿæˆ–å¤šä¸ªæ•°æ®è¡¨</li><li>ç”¨æˆ·éœ€è¦çœ‹çš„å­—æ®µï¼Œåœ¨æ•°æ®åº“ä¸­å¯èƒ½éœ€è¦ä¸€å®šçš„è½¬æ¢æ‰èƒ½å‘ˆç°ï¼Œè€Œæ¯æ¬¡å‘ç”Ÿä¸šåŠ¡å˜æ›´åå¯èƒ½éƒ½éœ€è¦é¢å¤–ç¼–å†™è¿™äº›å­—æ®µï¼Œå¯¼è‡´å·¥ä½œé‡å¤</li><li>ç³»ç»Ÿä»¥è”æœºäº‹åŠ¡å¤„ç†ä¸ºä¸»ï¼Œé¢‘ç¹è®¿é—®åˆ†ææ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½å˜å·®</li></ul><h5 id="æ•°æ®ä»“åº“çš„ç‰¹æ€§"><a href="#æ•°æ®ä»“åº“çš„ç‰¹æ€§" class="headerlink" title="æ•°æ®ä»“åº“çš„ç‰¹æ€§"></a>æ•°æ®ä»“åº“çš„ç‰¹æ€§</h5><ul><li>é¢å‘ä¸»é¢˜ï¼šæ‹¥æœ‰é€šè¿‡åˆ’åˆ†ä¸»é¢˜å®šä¹‰æ•°æ®ä»“åº“çš„èƒ½åŠ›</li><li>é›†æˆï¼šå³é¢å¯¹å¤šä¸ªç³»ç»Ÿã€å¤šä¸ªæ•°æ®åº“ï¼Œèƒ½å¤Ÿç»Ÿä¸€è½¬æ¢åå­˜æ”¾åœ¨ä¸€èµ·ã€‚åŒæ—¶èƒ½å¤Ÿè§£å†³å‘½åå†²çªçš„é—®é¢˜</li><li>éšæ—¶é—´å˜åŒ–ï¼šæ•°æ®ä»“åº“å…³æ³¨çš„æ˜¯æ•°æ®éšæ—¶é—´å˜åŒ–çš„æƒ…å†µï¼Œå¹¶ä¸”èƒ½åæ˜ åœ¨è¿‡å»æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®æ˜¯æ€æ ·çš„ã€‚</li><li>ç¨³å®šï¼šä¸€æ—¦è¿›å…¥åˆ°æ•°æ®ä»“åº“ä¸­ï¼Œæ•°æ®å°±ä¸åº”è¯¥å†æœ‰æ”¹å˜ã€‚</li><li>ç²’åº¦ï¼šç²’åº¦ä¹‹æ‰€ä»¥æ˜¯æ•°æ®ä»“åº“ç¯å¢ƒçš„å…³é”®è®¾è®¡é—®é¢˜ï¼Œæ˜¯å› ä¸ºå®ƒæå¤§åœ°å½±å“æ•°æ®ä»“åº“çš„æ•°æ®é‡å’Œå¯ä»¥è¿›è¡Œçš„æŸ¥è¯¢ç±»å‹ã€‚ç²’åº¦çº§åˆ«è¶Šä½ï¼Œæ•°æ®é‡è¶Šå¤§ï¼ŒæŸ¥è¯¢çš„ç»†èŠ‚ç¨‹åº¦è¶Šé«˜ï¼ŒæŸ¥è¯¢èŒƒå›´è¶Šå¹¿æ³›ï¼Œåä¹‹äº¦ç„¶ã€‚</li></ul><h2 id="æ•°æ®ä»“åº“æ¦‚å¿µè®¾è®¡"><a href="#æ•°æ®ä»“åº“æ¦‚å¿µè®¾è®¡" class="headerlink" title="æ•°æ®ä»“åº“æ¦‚å¿µè®¾è®¡"></a>æ•°æ®ä»“åº“æ¦‚å¿µè®¾è®¡</h2><h4 id="åŸºæœ¬æ¶æ„"><a href="#åŸºæœ¬æ¶æ„" class="headerlink" title="åŸºæœ¬æ¶æ„"></a>åŸºæœ¬æ¶æ„</h4><p><img src="/2020/06/19/%E4%BB%8EBIEE%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/20201023090140-167pjok-image.png" alt="image.png"></p><h4 id="æ•°æ®éœ€æ±‚"><a href="#æ•°æ®éœ€æ±‚" class="headerlink" title="æ•°æ®éœ€æ±‚"></a>æ•°æ®éœ€æ±‚</h4><h5 id="äº‹å®å’Œç»´åº¦"><a href="#äº‹å®å’Œç»´åº¦" class="headerlink" title="äº‹å®å’Œç»´åº¦"></a>äº‹å®å’Œç»´åº¦</h5><ol><li>æ˜ç¡®ä¸šåŠ¡èŒƒå›´ï¼Œæƒ³æ¸…æ¥šè¦è®¾ç«‹çš„ä¸»é¢˜æœ‰å“ªäº›ï¼Œä¸»é¢˜ä¸‹é¢çš„åˆ†æè¡¨æœ‰å¤šå°‘ï¼Œç„¶åç¡®å®šè£…è½½æ•°æ®çš„ ER å®ä½“å…³ç³»ï¼Œæ¯ä¸€ä¸ªå®ä½“å…³ç³»å°±æ˜¯ä¸€ä¸ªäº‹å®ã€‚</li><li>æ˜ç¡®ç»´åº¦æŒ‡æ ‡çš„èŒƒå›´ï¼Œç»´åº¦çš„èŒƒå›´éšç€ä¸šåŠ¡èŒƒå›´æ”¹å˜è€Œæ”¹å˜ã€‚<br>è´¢åŠ¡ä¸»é¢˜å¸¸ç”¨çš„ç»´åº¦ä¸€èˆ¬æœ‰è´¦é¾„ã€å¸ç°¿ã€æˆæœ¬ä¸­å¿ƒã€ä¼šè®¡ç§‘ç›®ã€æ³•äººã€ç»è¥å•ä½ã€å®¢æˆ·ã€ä¾›åº”å•†ã€ä¾›åº”å•†åœ°ç‚¹ã€ä½ç½®ã€é”€å”®å‘˜ç­‰ï¼›<br>åº“å­˜ä¸»é¢˜å¸¸ç”¨çš„ç»´åº¦ä¸€èˆ¬æœ‰ç‰©æ–™ã€åº“å­˜ç»„ç»‡ã€å­åº“å­˜ã€è´§ä½ã€æ‰¹æ¬¡å·ã€ç‰©æ–™è´¦é¾„ç­‰ï¼›<br>é€šç”¨çš„ç»´åº¦ä¸€èˆ¬æœ‰æ—¶é—´ç»´åº¦ï¼ŒæŒ‰å¹´æœˆæ—¥å­˜æ”¾ã€‚</li><li>æ˜ç¡®äº‹å®è¡¨æ‰€é€‰ç”¨çš„æ•°æ®æ¨¡å‹ï¼Œä¸€èˆ¬ä»æ˜Ÿå‹å’Œå’Œé›ªèŠ±å‹ä¸­é€‰æ‹©ã€‚åœ¨é›ªèŠ±æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªç»´åº¦è¢«è§„èŒƒåŒ–æˆå¤šä¸ªå…³è”çš„è¡¨ï¼Œè€Œåœ¨æ˜Ÿå‹æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªç»´åº¦ç”±ä¸€ä¸ªå•ä¸€çš„ç»´åº¦è¡¨æ‰€è¡¨ç¤ºã€‚<br>ä¾‹å¦‚ï¼šå•ä¸€çš„æ—¶é—´ç»´åº¦ï¼Œåœ¨æ˜Ÿå‹æ¨¡å‹ä¸­ï¼ŒåŒ…å«å¹´ä»½ã€æœˆä»½ã€å¤©ï¼Œéƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªè¡¨é‡Œï¼Œè€Œé›ªèŠ±å‹ä¸­åŒºåˆ†ä¸ºå¹´ä»½ç»´ï¼Œæœˆä»½ç»´å’Œå¤©æ•°ç»´ï¼›äº§å“ç»´åº¦åˆ†è§£æˆäº§å“åˆ†ç±»ã€äº§å“ä¸¤ä¸ªè¡¨ã€‚</li></ol><h5 id="æ•°æ®éœ€æ±‚-1"><a href="#æ•°æ®éœ€æ±‚-1" class="headerlink" title="æ•°æ®éœ€æ±‚"></a>æ•°æ®éœ€æ±‚</h5><ol><li>æ—¶æ•ˆæ€§ï¼šæ˜ç¡®æ—¶é—´ç²’åº¦ï¼Œå¯¹äºæ—¶æ•ˆæ€§è¾ƒå¼ºçš„æ•°æ®ï¼ŒæŠ“å–çš„æ•°æ®é¢‘ç‡è¦æé«˜ï¼Œä½†æ˜¯å¯¹äºåˆ†æå‹ç³»ç»Ÿè€Œè¨€ä¸€èˆ¬ä¸éœ€è¦å¾ˆå¼ºçš„å®æ—¶æ€§ï¼Œä¸€èˆ¬æŠŠæŠ“å–æ•°æ®çš„é¢‘ç‡å®šä¸ºä»¥ä¸€å¤©ä¸ºç²’åº¦ã€‚</li><li>è¿½æº¯æ€§ï¼šä»ä¸šåŠ¡ç³»ç»Ÿä¸­ç”Ÿæˆåˆ° BIEE çš„åˆ†æè¡¨è¦æ ¹æ®å®é™…æƒ…å†µï¼Œéƒ¨åˆ†åˆ†æè¡¨ä¼šæœ‰æŸ¥è¯¢åˆ°æŸä¸€å†å²äº‹ä»¶ç‚¹çš„éœ€æ±‚ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> ORACLE BIEE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DATAWARE HOUSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BIEE ClientæŠ¥è¡¨å¼€å‘</title>
      <link href="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/"/>
      <url>/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="BIEE-Client-æŠ¥è¡¨å¼€å‘"><a href="#BIEE-Client-æŠ¥è¡¨å¼€å‘" class="headerlink" title="BIEE Client æŠ¥è¡¨å¼€å‘"></a>BIEE Client æŠ¥è¡¨å¼€å‘</h1><h2 id="ä»¥å¼€å‘â€åº“å­˜è´¦é¾„æŠ¥è¡¨â€ä¸ºä¾‹"><a href="#ä»¥å¼€å‘â€åº“å­˜è´¦é¾„æŠ¥è¡¨â€ä¸ºä¾‹" class="headerlink" title="ä»¥å¼€å‘â€åº“å­˜è´¦é¾„æŠ¥è¡¨â€ä¸ºä¾‹"></a>ä»¥å¼€å‘â€åº“å­˜è´¦é¾„æŠ¥è¡¨â€ä¸ºä¾‹</h2><h3 id="SRC-å±‚å…ƒæ•°æ®"><a href="#SRC-å±‚å…ƒæ•°æ®" class="headerlink" title="SRC å±‚å…ƒæ•°æ®"></a>SRC å±‚å…ƒæ•°æ®</h3><h5 id="å…ˆæ‰“å¼€-erp-çš„æŠ¥è¡¨-packageï¼Œæ‰¾åˆ°æ‰€æœ‰éœ€è¦çš„æŠ¥è¡¨"><a href="#å…ˆæ‰“å¼€-erp-çš„æŠ¥è¡¨-packageï¼Œæ‰¾åˆ°æ‰€æœ‰éœ€è¦çš„æŠ¥è¡¨" class="headerlink" title="å…ˆæ‰“å¼€ erp çš„æŠ¥è¡¨ packageï¼Œæ‰¾åˆ°æ‰€æœ‰éœ€è¦çš„æŠ¥è¡¨"></a>å…ˆæ‰“å¼€ erp çš„æŠ¥è¡¨ packageï¼Œæ‰¾åˆ°æ‰€æœ‰éœ€è¦çš„æŠ¥è¡¨</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mtl_system_items_b           msi,</span><br><span class="line">mtl_safety_stocks            ms,</span><br><span class="line">mtl_onhand_quantities_detail moq,</span><br><span class="line">mtl_material_transactions    mmt,</span><br><span class="line">mtl_transaction_lot_numbers  mtln</span><br></pre></td></tr></table></figure><h5 id="åœ¨-SRC-å±‚å¤åˆ¶ç›¸åŒçš„ä¸€ä»½è¡¨ç»“æ„ï¼Œå‘½åä¸º-S-XXXXXã€‚è¿™é‡Œæ˜¯åœ¨-BI-SRC-ç”¨æˆ·ä¸‹åˆ›å»ºå¦‚ä¸‹è¡¨"><a href="#åœ¨-SRC-å±‚å¤åˆ¶ç›¸åŒçš„ä¸€ä»½è¡¨ç»“æ„ï¼Œå‘½åä¸º-S-XXXXXã€‚è¿™é‡Œæ˜¯åœ¨-BI-SRC-ç”¨æˆ·ä¸‹åˆ›å»ºå¦‚ä¸‹è¡¨" class="headerlink" title="åœ¨ SRC å±‚å¤åˆ¶ç›¸åŒçš„ä¸€ä»½è¡¨ç»“æ„ï¼Œå‘½åä¸º S_XXXXXã€‚è¿™é‡Œæ˜¯åœ¨ BI_SRC ç”¨æˆ·ä¸‹åˆ›å»ºå¦‚ä¸‹è¡¨"></a>åœ¨ SRC å±‚å¤åˆ¶ç›¸åŒçš„ä¸€ä»½è¡¨ç»“æ„ï¼Œå‘½åä¸º S_XXXXXã€‚è¿™é‡Œæ˜¯åœ¨ BI_SRC ç”¨æˆ·ä¸‹åˆ›å»ºå¦‚ä¸‹è¡¨</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BI_SRC.s_mtl_system_items_b           msi,</span><br><span class="line">BI_SRC.s_mtl_safety_stocks            ms,</span><br><span class="line">BI_SRC.s_mtl_onhand_quantities_detail moq,</span><br><span class="line">BI_SRC.s_mtl_material_transactions    mmt,</span><br><span class="line">BI_SRC.mtl_transaction_lot_numbers    mtln</span><br></pre></td></tr></table></figure><h6 id="åˆ›å»ºæ–¹å¼"><a href="#åˆ›å»ºæ–¹å¼" class="headerlink" title="åˆ›å»ºæ–¹å¼"></a>åˆ›å»ºæ–¹å¼</h6><p>ä»¥ mtl_safety_stocks ä¸ºä¾‹ï¼Œæ‰¾åˆ°åŸºè¡¨ inv.mtl_safety_stocksï¼Œå³é”®-&gt; ç¼–è¾‘-&gt; åˆ—-&gt; æŸ¥çœ‹ SQL</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091055-1sjn1mw-image.png" alt="image.png"></p><p>å¤åˆ¶ create table è¯­å¥<img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091108-ukhqfd1-image.png" alt="image.png"></p><p>å¯¹åº”çš„ SQL è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¿®æ”¹åçš„è¯­å¥</span></span><br><span class="line"><span class="comment">-- ä¿®æ”¹è¡¨å</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> BI_SRC.S_MTL_SAFETY_STOCKS</span><br><span class="line">(</span><br><span class="line">  inventory_item_id      NUMBER <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  organization_id        NUMBER <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  effectivity_date       <span class="type">DATE</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  last_update_date       <span class="type">DATE</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  last_updated_by        NUMBER <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  creation_date          <span class="type">DATE</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  created_by             NUMBER <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  last_update_login      NUMBER,</span><br><span class="line">  safety_stock_code      NUMBER,</span><br><span class="line">  safety_stock_quantity  NUMBER <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  safety_stock_percent   NUMBER,</span><br><span class="line">  service_level          NUMBER,</span><br><span class="line">  attribute_category     VARCHAR2(<span class="number">30</span>),</span><br><span class="line">  attribute1             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute2             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute3             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute4             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute5             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute6             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute7             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute8             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute9             VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute10            VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute11            VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute12            VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute13            VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute14            VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  attribute15            VARCHAR2(<span class="number">150</span>),</span><br><span class="line">  request_id             NUMBER,</span><br><span class="line">  program_application_id NUMBER,</span><br><span class="line">  program_id             NUMBER,</span><br><span class="line">  program_update_date    <span class="type">DATE</span>,</span><br><span class="line">  forecast_designator    VARCHAR2(<span class="number">10</span>),</span><br><span class="line">  project_id             NUMBER,</span><br><span class="line">  task_id                NUMBER,</span><br><span class="line">  <span class="comment">--æ–°å¢ä¿®æ”¹æ—¥æœŸå­—æ®µ</span></span><br><span class="line">  UPDATE_DT              <span class="type">DATE</span></span><br><span class="line">)</span><br><span class="line">tablespace BI_SRC_DAT   <span class="comment">--ä¿®æ”¹è¡¨ç©ºé—´</span></span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">10</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">128</span>K</span><br><span class="line">    next <span class="number">128</span>K</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">    pctincrease <span class="number">0</span></span><br><span class="line">  );</span><br><span class="line"><span class="comment">-- ä¿®æ”¹ç´¢å¼•åç§°</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index BI_SRC.S_MTL_SAFETY_STOCKS_U1 <span class="keyword">on</span> BI_SRC.S_MTL_SAFETY_STOCKS (INVENTORY_ITEM_ID, ORGANIZATION_ID, EFFECTIVITY_DATE, PROJECT_ID, TASK_ID)</span><br><span class="line">  tablespace BI_SRC_DIX  <span class="comment">--ä¿®æ”¹ç´¢å¼•ç©ºé—´</span></span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">11</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">128</span>K</span><br><span class="line">    next <span class="number">128</span>K</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">    pctincrease <span class="number">0</span></span><br><span class="line">  )</span><br><span class="line">  NOLOGGING;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ kettleï¼Œæ–°å»ºä¸€ä¸ªè½¬æ¢ï¼Œé…ç½®å¥½ EBS æ•°æ®åº“å’Œ SRC æ•°æ®åº“ä¿¡æ¯</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091346-bgv7dty-image.png" alt="image.png"></p><p>åœ¨â€æ ¸å¿ƒå¯¹è±¡-&gt; è¾“å…¥â€é€‰å¥½â€œè¡¨è¾“å…¥â€ï¼Œåœ¨â€æ ¸å¿ƒå¯¹è±¡-&gt; è¾“å‡ºâ€é€‰å¥½â€œè¡¨è¾“å‡ºâ€ã€‚åœ¨è¡¨è¾“å…¥æŒ‰ä½ shift æ‹–åŠ¨åˆ°è¡¨è¾“å‡ºï¼Œä¼šæœ‰ä¸­é—´çš„è“è‰²çº¿ï¼ŒæŠŠå®ƒä»¬è¿èµ·æ¥</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091357-99julig-image.png" alt="image.png"></p><p>åŒå‡»â€œè¡¨è¾“å‡ºâ€é…ç½®è¡¨è¾“å‡ºä¿¡æ¯ã€æ³¨ï¼šè¿™é‡Œå‹¾é€‰è£å‰ªè¡¨ï¼Œä¼šå¯¼è‡´å…¨é‡åŒæ­¥ã€‘</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091419-1hcj9re-image.png" alt="image.png"></p><p>å³é”®åŸæœ‰çš„ ebs åŸºè¡¨-&gt; æè¿°ï¼Œå¦‚ INV.MTL_SAFETY_STOCKSï¼Œé€‰æ‹©â€œé€—å·åˆ†éš”å¤åˆ¶â€</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091431-pytxbod-image.png" alt="image.png"></p><p>æ•´ç†ä»¥åå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> inventory_item_id,</span><br><span class="line">       organization_id,</span><br><span class="line">       effectivity_date,</span><br><span class="line">       last_update_date,</span><br><span class="line">       last_updated_by,</span><br><span class="line">       creation_date,</span><br><span class="line">       created_by,</span><br><span class="line">       last_update_login,</span><br><span class="line">       safety_stock_code,</span><br><span class="line">       safety_stock_quantity,</span><br><span class="line">       safety_stock_percent,</span><br><span class="line">       service_level,</span><br><span class="line">       attribute_category,</span><br><span class="line">       attribute1,</span><br><span class="line">       attribute2,</span><br><span class="line">       attribute3,</span><br><span class="line">       attribute4,</span><br><span class="line">       attribute5,</span><br><span class="line">       attribute6,</span><br><span class="line">       attribute7,</span><br><span class="line">       attribute8,</span><br><span class="line">       attribute9,</span><br><span class="line">       attribute10,</span><br><span class="line">       attribute11,</span><br><span class="line">       attribute12,</span><br><span class="line">       attribute13,</span><br><span class="line">       attribute14,</span><br><span class="line">       attribute15,</span><br><span class="line">       request_id,</span><br><span class="line">       program_application_id,</span><br><span class="line">       program_id,</span><br><span class="line">       program_update_date,</span><br><span class="line">       forecast_designator,</span><br><span class="line">       project_id,</span><br><span class="line">       task_id</span><br><span class="line">  <span class="keyword">FROM</span> INV.MTL_SAFETY_STOCKS</span><br></pre></td></tr></table></figure><p>ç„¶ååŒå‡»â€œè¡¨è¾“å…¥â€é…ç½®è¡¨è¾“å…¥ä¿¡æ¯ï¼ŒæŠŠæ•´ç†å¥½çš„ä»£ç ç²˜è´´è¿›å»</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091507-vju1spg-image.png" alt="image.png"></p><p>ä¿å­˜è¯¥è½¬æ¢ï¼Œå‘½åä¸º S_MTL_SAFETY_STOCKS</p><p>è¿è¡Œè¯¥è½¬æ¢ï¼Œå¦‚æœæŠ¥é”™æŸ¥çœ‹â€æ—¥å¿—â€ï¼Œè¿™é‡Œæç¤ºè¡¨æˆ–è§†å›¾ä¸å­˜åœ¨ï¼ŒæŠŠè¡¨è¾“å‡ºé…ç½®æ”¹ä¸€ä¸‹å³å¯</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091522-mlrxxep-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091528-t5z3ryn-image.png" alt="image.png"></p><p>ç¡®è®¤ç»“æœ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091537-77mvupl-image.png" alt="image.png"></p><p><strong>åŒä¸€ä¸ªæŠ¥è¡¨çš„å…¶ä»–åŸºè¡¨æŒ‰ç…§æ­¤æ–¹æ³•å…ˆåŒæ­¥æ•°æ®åˆ° BI_SRC å±‚å³å¯</strong></p><h3 id="DIM-å±‚ç»´åº¦è¡¨"><a href="#DIM-å±‚ç»´åº¦è¡¨" class="headerlink" title="DIM å±‚ç»´åº¦è¡¨"></a>DIM å±‚ç»´åº¦è¡¨</h3><p>è¿™ä¸€å±‚ä¸€èˆ¬å­˜æ”¾åˆ†æä½¿ç”¨çš„ç»´åº¦è¡¨</p><p>æ–°å»ºåº“å­˜ç»„ç»‡ã€è´§ä½ã€å­åº“å­˜ã€ç‰©æ–™çš„ç»´åº¦ã€‚è¿™å››å¼ è¡¨è¦å…ˆåŒæ­¥åŸºè¡¨åˆ° BI_SRC å±‚ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inv.mtl_secondary_inventories</span><br><span class="line">inv.mtl_item_locations</span><br><span class="line">Inv.mtl_system_items_b  </span><br><span class="line">HR.HR_ALL_ORGANIZATION_UNITS  </span><br><span class="line"></span><br><span class="line"><span class="comment">--ç”±äºè¿™ä¸ªæŠ¥è¡¨æ˜¯åº“å­˜è´¦é¾„è¡¨ï¼Œè¿˜éœ€è¦ä¸€å¼ è´¦é¾„åŒºé—´çš„ç»´åº¦è¡¨</span></span><br><span class="line">BI_DIM.DIM_AGE  </span><br></pre></td></tr></table></figure><p>æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚åˆ’åˆ†è´¦é¾„åŒºé—´</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091629-gi6s3qi-image.png" alt="image.png"></p><p>è´¦é¾„ç»´åº¦è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Create table</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> BI_DIM.DIM_AGE</span><br><span class="line">(</span><br><span class="line">  age_wid  NUMBER(<span class="number">10</span>),</span><br><span class="line">  age_name VARCHAR2(<span class="number">100</span>),</span><br><span class="line">  age_low  NUMBER,</span><br><span class="line">  age_high NUMBER</span><br><span class="line">)</span><br><span class="line">tablespace BI_DW_DAT</span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">1</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">64</span>K</span><br><span class="line">    next <span class="number">1</span>M</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">  )</span><br><span class="line">nologging;</span><br><span class="line"><span class="comment">-- Add comments to the table </span></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> BI_DIM.DIM_AGE</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;è´¦é¾„æ®µ;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºç»´åº¦å­˜å‚¨è¿‡ç¨‹ï¼Œè¿™é‡Œä»¥è´§ä½ä¸ºä¾‹</p><p>ç¼–å†™æ‰€éœ€çš„å­—æ®µ SQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.inventory_location_id,</span><br><span class="line">           t.segment1 <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> t.segment2 <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> t.segment3,</span><br><span class="line">           t.description,</span><br><span class="line">           t.segment1,</span><br><span class="line">           t.segment2,</span><br><span class="line">           t.segment3,</span><br><span class="line">           t.organization_id,</span><br><span class="line">           t.inventory_item_id,</span><br><span class="line">           t.subinventory_code</span><br><span class="line">      <span class="keyword">FROM</span> bi_src.s_mtl_item_locations t</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¹æ® SQLï¼Œåœ¨ BI_DIM å±‚åˆ›å»ºç»´åº¦è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Create table</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> DIM_ITEM_LOCATION</span><br><span class="line">(</span><br><span class="line">  location_wid          NUMBER(<span class="number">10</span>),</span><br><span class="line">  inventory_location_id NUMBER,</span><br><span class="line">  locator_name          VARCHAR2(<span class="number">255</span>),</span><br><span class="line">  locator_desc          VARCHAR2(<span class="number">500</span>),</span><br><span class="line">  segment1              VARCHAR2(<span class="number">255</span>),</span><br><span class="line">  segment2              VARCHAR2(<span class="number">255</span>),</span><br><span class="line">  segment3              VARCHAR2(<span class="number">255</span>),</span><br><span class="line">  organization_id       NUMBER,</span><br><span class="line">  inventory_item_id     NUMBER,</span><br><span class="line">  subinventory_code     VARCHAR2(<span class="number">255</span>),</span><br><span class="line">  effective_from_dt     <span class="type">DATE</span>,</span><br><span class="line">  effective_to_dt       <span class="type">DATE</span>,</span><br><span class="line">  delete_flg            <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">  current_flg           <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">  w_insert_dt           <span class="type">DATE</span>,</span><br><span class="line">  w_update_dt           <span class="type">DATE</span>,</span><br><span class="line">  datasource_num_id     NUMBER,</span><br><span class="line">  etl_proc_id           VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  etl_proc_name         VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  integration_id        VARCHAR2(<span class="number">500</span>),</span><br><span class="line">  x_custom              VARCHAR2(<span class="number">50</span>)</span><br><span class="line">)</span><br><span class="line">tablespace BI_DW_DAT</span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">1</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">64</span>K</span><br><span class="line">    next <span class="number">1</span>M</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">  )</span><br><span class="line">nologging;</span><br><span class="line"><span class="comment">-- Add comments to the table </span></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> DIM_ITEM_LOCATION</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;ç‰©æ–™è´§ä½ç»´;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> SP_DIM_ITEM_LOCATION(P_START_DAY <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                                 P_END_DAY   <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                                 P_PROC_ID   <span class="keyword">IN</span> NUMBER) <span class="keyword">IS</span></span><br><span class="line">  V_START_DAY  NUMBER(<span class="number">10</span>) :<span class="operator">=</span> P_START_DAY;</span><br><span class="line">  V_END_DAY    NUMBER(<span class="number">10</span>) :<span class="operator">=</span> P_END_DAY;</span><br><span class="line">  V_PROC_ID    NUMBER(<span class="number">8</span>) :<span class="operator">=</span> P_PROC_ID;</span><br><span class="line">  V_MAX_ROWNUM NUMBER(<span class="number">10</span>);</span><br><span class="line">  V_START_TIME <span class="type">TIMESTAMP</span>; <span class="comment">--å¼€å§‹æ—¶é—´</span></span><br><span class="line">  V_END_TIME   <span class="type">TIMESTAMP</span>; <span class="comment">--ç»“æŸæ—¶é—´</span></span><br><span class="line">  L_LOG        BI_DW.W_ETL_LOG<span class="operator">%</span>ROWTYPE; <span class="comment">--æ—¥å¿—è¡¨æ¸¸æ ‡</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--è®°å½•ç¨‹åºå¼€å§‹æ—¶é—´</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">INTO</span> V_START_TIME <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line">  <span class="comment">--è®°å½•æ—¥å¿—</span></span><br><span class="line">  L_LOG.PROC_NAME       :<span class="operator">=</span> <span class="string">&#x27;SP_DIM_ITEM_LOCATION&#x27;</span>; <span class="comment">--è¿‡ç¨‹åç§°</span></span><br><span class="line">  L_LOG.TABLE_TYPE      :<span class="operator">=</span> <span class="string">&#x27;D&#x27;</span>; <span class="comment">--è¡¨ç±»å‹</span></span><br><span class="line">  L_LOG.TABLE_NAME      :<span class="operator">=</span> <span class="string">&#x27;DIM_ITEM_LOCATION&#x27;</span>; <span class="comment">--è¡¨åç§°</span></span><br><span class="line">  L_LOG.MEASURE_ID      :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line">  L_LOG.ETL_INTERVAL    :<span class="operator">=</span> V_START_DAY <span class="operator">||</span> <span class="string">&#x27;~&#x27;</span> <span class="operator">||</span> V_END_DAY; <span class="comment">--æŠ½æ•°åŒºé—´</span></span><br><span class="line">  L_LOG.PROC_ID         :<span class="operator">=</span> V_PROC_ID; <span class="comment">--è¿‡ç¨‹D</span></span><br><span class="line">  L_LOG.START_TIME      :<span class="operator">=</span> V_START_TIME; <span class="comment">--å¼€å§‹æ—¶é—´</span></span><br><span class="line">  L_LOG.ETL_RECORD_LOAD :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ¶‰åŠè®°å½•æ•°</span></span><br><span class="line">  L_LOG.ETL_RECORD_INS  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--å®é™…æ’å…¥çš„è®°å½•æ•°</span></span><br><span class="line">  L_LOG.ETL_RECORD_UPD  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ›´æ–°çš„è®°å½•æ•°ï¼Œå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹æœ‰æ›´æ–°éƒ¨åˆ†ï¼Œåˆ™ä¸ç­‰äºé›¶</span></span><br><span class="line">  L_LOG.ETL_RECORD_DEL  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ’å…¥å‰æ¸…ç†ç›®æ ‡æ—¶çš„åˆ é™¤è®°å½•æ•°</span></span><br><span class="line">  <span class="comment">--åŠ è½½è®°å½•æ•°</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> L_LOG.ETL_RECORD_LOAD <span class="keyword">FROM</span> DIM_ITEM_LOCATION T;</span><br><span class="line">  <span class="comment">--å–ç›®å‰æœ€å¤§OW_WID</span></span><br><span class="line">  <span class="keyword">SELECT</span> NVL(<span class="built_in">MAX</span>(T.Location_Wid), <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">INTO</span> V_MAX_ROWNUM</span><br><span class="line">    <span class="keyword">FROM</span> DIM_ITEM_LOCATION T;</span><br><span class="line"></span><br><span class="line">  <span class="comment">--æ’å…¥1è®°å½•æ•°</span></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> DIM_ITEM_LOCATION</span><br><span class="line">    (location_wid,</span><br><span class="line">     inventory_location_id,</span><br><span class="line">     locator_name,</span><br><span class="line">     locator_desc,</span><br><span class="line">     segment1,</span><br><span class="line">     segment2,</span><br><span class="line">     segment3,</span><br><span class="line">     organization_id,</span><br><span class="line">     inventory_item_id,</span><br><span class="line">     subinventory_code,</span><br><span class="line">     effective_from_dt,</span><br><span class="line">     effective_to_dt,</span><br><span class="line">     delete_flg,</span><br><span class="line">     current_flg,</span><br><span class="line">     w_insert_dt,</span><br><span class="line">     w_update_dt,</span><br><span class="line">     datasource_num_id,</span><br><span class="line">     etl_proc_id,</span><br><span class="line">     etl_proc_name,</span><br><span class="line">     integration_id,</span><br><span class="line">     x_custom)</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">-1</span>,</span><br><span class="line">           <span class="number">-1</span>,</span><br><span class="line">           <span class="string">&#x27;æœªçŸ¥,</span></span><br><span class="line"><span class="string">           &#x27;</span>æœªçŸ¥,</span><br><span class="line">           <span class="string">&#x27;æœªçŸ¥,</span></span><br><span class="line"><span class="string">           &#x27;</span>æœªçŸ¥,</span><br><span class="line">           <span class="string">&#x27;æœªçŸ¥,</span></span><br><span class="line"><span class="string">           -1,</span></span><br><span class="line"><span class="string">           -1,</span></span><br><span class="line"><span class="string">           &#x27;</span>æœªçŸ¥,</span><br><span class="line">           TO_DATE(<span class="string">&#x27;19000101&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD&#x27;</span>),</span><br><span class="line">           TO_DATE(<span class="string">&#x27;99990101&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD&#x27;</span>),</span><br><span class="line">           <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">           SYSDATE,</span><br><span class="line">           SYSDATE,</span><br><span class="line">           <span class="number">9</span>,</span><br><span class="line">           V_PROC_ID,</span><br><span class="line">           L_LOG.PROC_NAME,</span><br><span class="line">           <span class="number">-1</span>,</span><br><span class="line">           <span class="number">-1</span></span><br><span class="line">      <span class="keyword">FROM</span> DUAL</span><br><span class="line">     <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">     (<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> DIM_ITEM_LOCATION T1 <span class="keyword">WHERE</span> T1.Location_Wid <span class="operator">=</span> <span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  <span class="comment">--INTEGRATION_IDä¸ä¸€æ ·çš„æ’å…¥</span></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> DIM_ITEM_LOCATION</span><br><span class="line">    (location_wid,</span><br><span class="line">     inventory_location_id,</span><br><span class="line">     locator_name,</span><br><span class="line">     locator_desc,</span><br><span class="line">     segment1,</span><br><span class="line">     segment2,</span><br><span class="line">     segment3,</span><br><span class="line">     organization_id,</span><br><span class="line">     inventory_item_id,</span><br><span class="line">     subinventory_code,</span><br><span class="line">     effective_from_dt,</span><br><span class="line">     effective_to_dt,</span><br><span class="line">     delete_flg,</span><br><span class="line">     current_flg,</span><br><span class="line">     w_insert_dt,</span><br><span class="line">     w_update_dt,</span><br><span class="line">     datasource_num_id,</span><br><span class="line">     etl_proc_id,</span><br><span class="line">     etl_proc_name,</span><br><span class="line">     integration_id)</span><br><span class="line">    <span class="keyword">SELECT</span> ROWNUM <span class="operator">+</span> V_MAX_ROWNUM <span class="keyword">AS</span> LOCATION_WID,</span><br><span class="line">           t.inventory_location_id,</span><br><span class="line">           t.segment1 <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> t.segment2 <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> t.segment3,</span><br><span class="line">           t.description,</span><br><span class="line">           t.segment1,</span><br><span class="line">           t.segment2,</span><br><span class="line">           t.segment3,</span><br><span class="line">           t.organization_id,</span><br><span class="line">           t.inventory_item_id,</span><br><span class="line">           t.subinventory_code,</span><br><span class="line">           TO_DATE(<span class="string">&#x27;19000101&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD&#x27;</span>) <span class="keyword">AS</span> EFFECTIVE_FROM_DT,</span><br><span class="line">           TO_DATE(<span class="string">&#x27;99990101&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD&#x27;</span>) <span class="keyword">AS</span> EFFECTIVE_TO_DT,</span><br><span class="line">           <span class="string">&#x27;N&#x27;</span> <span class="keyword">AS</span> DELETE_FLG,</span><br><span class="line">           <span class="string">&#x27;T&#x27;</span> <span class="keyword">AS</span> CURRENT_FLG,</span><br><span class="line">           SYSDATE <span class="keyword">AS</span> W_INSERT_DT,</span><br><span class="line">           SYSDATE <span class="keyword">AS</span> W_UPDATE_DT,</span><br><span class="line">           <span class="number">1</span> <span class="keyword">AS</span> DATASOURCE_NUM_ID,</span><br><span class="line">           V_PROC_ID <span class="keyword">AS</span> ETL_PROC_ID,</span><br><span class="line">           L_LOG.PROC_NAME ETL_PROC_NAME,</span><br><span class="line">           t.inventory_location_id</span><br><span class="line">      <span class="keyword">FROM</span> bi_src.s_mtl_item_locations t</span><br><span class="line">     <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">              <span class="keyword">FROM</span> DIM_ITEM_LOCATION T1</span><br><span class="line">             <span class="keyword">WHERE</span> T1.Location_Wid <span class="operator">=</span> t.inventory_location_id);</span><br><span class="line"></span><br><span class="line">  <span class="comment">--æ’å…¥è®°å½•æ•°</span></span><br><span class="line">  L_LOG.ETL_RECORD_INS :<span class="operator">=</span> <span class="keyword">SQL</span><span class="operator">%</span>ROWCOUNT <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  <span class="comment">--ç¼“æ…¢å˜åŒ–å¤„ç†</span></span><br><span class="line">  <span class="comment">--æ›´æ–°æ—§è®°å½•</span></span><br><span class="line">  <span class="keyword">UPDATE</span> DIM_ITEM_LOCATION T</span><br><span class="line">     <span class="keyword">SET</span> T.EFFECTIVE_TO_DT <span class="operator">=</span> TO_DATE(V_END_DAY, <span class="string">&#x27;YYYYMMDD&#x27;</span>),</span><br><span class="line">         T.CURRENT_FLG     <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span></span><br><span class="line">   <span class="keyword">WHERE</span> T.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">     <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">FROM</span> DIM_ITEM_LOCATION T1</span><br><span class="line">           <span class="keyword">WHERE</span> T1.Location_Wid <span class="operator">=</span> T.Location_Wid</span><br><span class="line">             <span class="keyword">AND</span> T1.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;T&#x27;</span>);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  <span class="comment">--æ›´æ–°æ–°è®°å½•</span></span><br><span class="line">  <span class="keyword">UPDATE</span> DIM_ITEM_LOCATION T</span><br><span class="line">     <span class="keyword">SET</span> T.EFFECTIVE_FROM_DT <span class="operator">=</span> TO_DATE(V_END_DAY, <span class="string">&#x27;YYYYMMDD&#x27;</span>)</span><br><span class="line">   <span class="keyword">WHERE</span> T.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;T&#x27;</span></span><br><span class="line">     <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">FROM</span> DIM_ITEM_LOCATION T1</span><br><span class="line">           <span class="keyword">WHERE</span> T1.Location_Wid <span class="operator">=</span> T.Location_Wid</span><br><span class="line">             <span class="keyword">AND</span> T1.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  <span class="comment">--æ›´æ–°æ–°è®°å½•</span></span><br><span class="line">  <span class="keyword">UPDATE</span> DIM_ITEM_LOCATION T</span><br><span class="line">     <span class="keyword">SET</span> T.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">   <span class="keyword">WHERE</span> T.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;T&#x27;</span>;</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  <span class="comment">--ç¨‹åºç»“æŸæ—¶é—´</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">INTO</span> V_END_TIME <span class="keyword">FROM</span> DUAL;</span><br><span class="line">  <span class="comment">--æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">  <span class="keyword">SELECT</span> TRUNC(TO_NUMBER(TO_CHAR(V_END_TIME, <span class="string">&#x27;YYYYMMDDHH24MISSXFF&#x27;</span>)), <span class="number">2</span>) <span class="operator">-</span></span><br><span class="line">         TRUNC(TO_NUMBER(TO_CHAR(V_START_TIME, <span class="string">&#x27;YYYYMMDDHH24MISSXFF&#x27;</span>)), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">INTO</span> L_LOG.ETL_DURATION</span><br><span class="line">    <span class="keyword">FROM</span> DUAL;</span><br><span class="line">  L_LOG.END_TIME   :<span class="operator">=</span> V_END_TIME;</span><br><span class="line">  L_LOG.ETL_STATUS :<span class="operator">=</span> <span class="string">&#x27;SUCCESS&#x27;</span>;</span><br><span class="line">  <span class="comment">--è°ƒç”¨æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line">  BI_DW.SP_W_ETL_LOG(L_LOG);</span><br><span class="line">EXCEPTION</span><br><span class="line">  <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span>;</span><br><span class="line">    L_LOG.ETL_STATUS :<span class="operator">=</span> <span class="string">&#x27;FAILURE&#x27;</span>;</span><br><span class="line">    L_LOG.ERR_MSG    :<span class="operator">=</span> SUBSTR(SQLERRM, <span class="number">1</span>, <span class="number">2000</span>);</span><br><span class="line">    BI_DW.SP_W_ETL_LOG(L_LOG);</span><br><span class="line"><span class="keyword">END</span> SP_DIM_ITEM_LOCATION;</span><br></pre></td></tr></table></figure><p><strong>å…³äºç¼“æ…¢å˜åŒ–å¤„ç†ï¼š</strong></p><p>ç®€å•ä¸¾ä¸ªä¾‹å­ï¼šå¼ ä¸‰ 2020 å¹´ 5 æœˆä¹‹å‰ï¼Œåœ¨è¿è¥éƒ¨åšé”€å”®ã€‚åˆ°äº† 2020 å¹´ 6 æœˆ 1 æ—¥ï¼Œå¼ ä¸‰åˆ°é¡¹ç›®éƒ¨åšé”€å”®ã€‚é‚£ä¹ˆä½“ç°åœ¨æ•°æ®çš„å˜åŒ–ä¸Šï¼Œå°±åº”è¯¥æ˜¯å¼ ä¸‰ï¼Œæœ‰ä¸¤ä¸ªæˆæœ¬ä¸­å¿ƒã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å§“å  å¯ç”¨æ—¥æœŸä»      å¯ç”¨æ—¥æœŸè‡³   æˆæœ¬ä¸­å¿ƒ  æˆæœ¬ä¸­å¿ƒç¼–ç   è§’è‰²id</span><br><span class="line">å¼ ä¸‰  <span class="number">1973</span>        <span class="operator">-</span> <span class="number">2020</span><span class="number">-04</span><span class="number">-30</span>  è¿è¥éƒ¨    <span class="number">1013</span>        <span class="number">1198</span></span><br><span class="line">å¼ ä¸‰  <span class="number">2020</span><span class="number">-05</span><span class="number">-01</span>  <span class="operator">-</span> Now         é¡¹ç›®éƒ¨    <span class="number">1015</span>        <span class="number">1198</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°æ®åº“é‡Œé¢åº”è¯¥æœ‰ä¸¤æ¡è®°å½•ï¼Œå¹¶ä¸”é¡¹ç›®éƒ¨çš„è¿™æ¡è®°å½•æ˜¯å½“å‰æ­£åœ¨ä½¿ç”¨çš„è®°å½•ã€‚åœ¨æ ¸ç®—å¼ ä¸‰ä¸šç»©çš„æ—¶å€™ï¼Œåº”è¯¥ä»¥ 2020-05-01 ä¸ºåˆ†ç•Œç‚¹ï¼Œåˆ†å±äºä¸åŒçš„ä¸¤ä¸ªéƒ¨é—¨ã€‚ä»æ•°æ®åº“è§’åº¦æ¥è¯´ï¼Œç¼“æ…¢å˜åŒ–ä¹Ÿå¯ä»¥ç†è§£ä¸ºè®°å½•æ¯ä¸€æ¬¡çš„å˜åŠ¨ã€‚</p><p>åœ¨ DIM å±‚å¯ç”¨ç¼“æ…¢å˜åŒ–ï¼Œå…³é”®å­—æ®µæ˜¯ integration_idï¼Œè¿™ä¸ªå­—æ®µå¿…é¡»æ˜¯æ•´ä¸ªæ•°æ®åº“ä¸­å”¯ä¸€çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢è¿è¥éƒ¨çš„ integration_id åº”è¯¥æ˜¯ 11981013ï¼ŒæŸ¥è¯¢é¡¹ç›®éƒ¨çš„ integration_id åº”è¯¥æ˜¯ 11981015ã€‚åœ¨è¿™é‡Œ integration_id æ˜¯è§’è‰² id å’Œæˆæœ¬ä¸­å¿ƒç¼–ç çš„ç»„åˆï¼Œå› ä¸ºåªæœ‰è¿™ä¸¤ä¸ªå­—æ®µçš„ç»„åˆæ‰èƒ½å¤Ÿä¿è¯è®°å½•çš„å”¯ä¸€æ€§ã€‚</p><p>åœ¨å¯ç”¨äº†ç¼“æ…¢å˜åŒ–ä»¥åï¼Œä¸‹åˆ—çš„ Location_Wid éƒ½è¦æ”¹æˆ integration_id</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ç¼“æ…¢å˜åŒ–å¤„ç†</span></span><br><span class="line">  <span class="comment">--æ›´æ–°æ—§è®°å½•çš„å¤±æ•ˆæ—¥æœŸ</span></span><br><span class="line">  <span class="keyword">UPDATE</span> DIM_ITEM_LOCATION T</span><br><span class="line">     <span class="keyword">SET</span> T.EFFECTIVE_TO_DT <span class="operator">=</span> TO_DATE(V_END_DAY, <span class="string">&#x27;YYYYMMDD&#x27;</span>),</span><br><span class="line">         T.CURRENT_FLG     <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span></span><br><span class="line">   <span class="keyword">WHERE</span> T.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">     <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">FROM</span> DIM_ITEM_LOCATION T1</span><br><span class="line">           <span class="keyword">WHERE</span> T1.Location_Wid <span class="operator">=</span> T.Location_Wid  <span class="comment">--integration_id</span></span><br><span class="line">             <span class="keyword">AND</span> T1.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;T&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">--æ›´æ–°æ–°è®°å½•çš„å¯ç”¨æ—¥æœŸ</span></span><br><span class="line">  <span class="keyword">UPDATE</span> DIM_ITEM_LOCATION T</span><br><span class="line">     <span class="keyword">SET</span> T.EFFECTIVE_FROM_DT <span class="operator">=</span> TO_DATE(V_END_DAY, <span class="string">&#x27;YYYYMMDD&#x27;</span>)</span><br><span class="line">   <span class="keyword">WHERE</span> T.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;T&#x27;</span></span><br><span class="line">     <span class="keyword">AND</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">FROM</span> DIM_ITEM_LOCATION T1</span><br><span class="line">           <span class="keyword">WHERE</span> T1.Location_Wid <span class="operator">=</span> T.Location_Wid</span><br><span class="line">             <span class="keyword">AND</span> T1.CURRENT_FLG <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å…³äºç»´åº¦å­—æ®µï¼šä¸€èˆ¬æ˜¯æŒ‡ç”¨äºåˆ†æçš„å­—æ®µï¼Œæˆ–è€…è¯´æ˜¯ erp è¿‡æ»¤æ•°æ®çš„å‚æ•°</p><p>è®¾ç½® kettle è¿è¡Œå­˜å‚¨è¿‡ç¨‹</p><p>è®¾ç½®å˜é‡ï¼Œè¿™é‡Œçš„å˜é‡ä¸ªæ•°å’Œç±»å‹è¦ä¸å­˜å‚¨è¿‡ç¨‹ä¸€è‡´</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091927-3olk5hl-image.png" alt="image.png"></p><p>è®¾ç½®å­˜å‚¨è¿‡ç¨‹ï¼Œè¿™é‡Œçš„å‚æ•°åç§°ï¼Œè¦åŒâ€œè·å–å˜é‡â€</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023091936-afswmar-image.png" alt="image.png"></p><p><strong>ç‚¹å‡»è¿è¡Œï¼Œåˆ°æ•°æ®åº“æŸ¥çœ‹ç»“æœå³å¯ã€‚å‰©ä¸‹çš„è´§ä½ã€ç‰©æ–™ç»´åº¦ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯ç‰©æ–™ç»´åº¦å»ºè®®æ·»åŠ æ ‡å‡†æˆæœ¬å’Œå®é™…æˆæœ¬ã€‚</strong></p><h3 id="DW-å±‚äº‹å®è¡¨"><a href="#DW-å±‚äº‹å®è¡¨" class="headerlink" title="DW å±‚äº‹å®è¡¨"></a>DW å±‚äº‹å®è¡¨</h3><p>å†™å‡ºæŠ¥è¡¨çš„ SQL è„šæœ¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> hou.organization_name,</span><br><span class="line">       hou.organization_short_code,</span><br><span class="line">       msi.segment1 item_number,</span><br><span class="line">       msi.DESCRIPTION item_desc,</span><br><span class="line">       msi.PRIMARY_UOM_CODE,</span><br><span class="line">       moq.SUBINVENTORY_CODE,</span><br><span class="line">       dil.locator_name,</span><br><span class="line">       moq.LOT_NUMBER,</span><br><span class="line">       NVL(ms.SAFETY_STOCK_QUANTITY, <span class="number">0</span>) safety_stock,</span><br><span class="line">       nvl(moq.TRANSACTION_QUANTITY, <span class="number">0</span>) onhand_qty,</span><br><span class="line">       hou.organization_wid,</span><br><span class="line">       di.inventory_wid,</span><br><span class="line">       dil.location_wid,</span><br><span class="line">       dim.item_wid</span><br><span class="line">  <span class="keyword">FROM</span> BI_SRC.S_mtl_system_items_b           msi,</span><br><span class="line">       BI_SRC.S_mtl_safety_stocks            ms,</span><br><span class="line">       BI_SRC.S_mtl_onhand_quantities_detail moq,</span><br><span class="line">       BI_DIM.DIM_ORGANIZATION_UNITS         hou,</span><br><span class="line">       BI_DIM.DIM_INVENTORIES                di,</span><br><span class="line">       BI_DIM.DIM_ITEM_LOCATION              dil,</span><br><span class="line">       BI_DIM.DIM_ITEM                       dim</span><br><span class="line"> <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">   <span class="keyword">AND</span> ms.INVENTORY_ITEM_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.INVENTORY_ITEM_ID</span><br><span class="line">   <span class="keyword">AND</span> ms.ORGANIZATION_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.ORGANIZATION_ID</span><br><span class="line">   <span class="keyword">AND</span> moq.INVENTORY_ITEM_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.INVENTORY_ITEM_ID</span><br><span class="line">   <span class="keyword">AND</span> moq.ORGANIZATION_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.ORGANIZATION_ID</span><br><span class="line">   <span class="keyword">AND</span> hou.organization_id <span class="operator">=</span> msi.organization_id</span><br><span class="line">   <span class="keyword">AND</span> di.secondary_inventory_name <span class="operator">=</span> nvl(moq.SUBINVENTORY_CODE,<span class="number">-1</span>)</span><br><span class="line">   <span class="keyword">AND</span> di.organization_id <span class="operator">=</span> nvl(moq.organization_id,<span class="number">-1</span>)</span><br><span class="line">   <span class="keyword">AND</span> dil.inventory_location_id <span class="operator">=</span> nvl(moq.locator_id,<span class="number">-1</span>)</span><br><span class="line">   <span class="keyword">AND</span> dim.item_id <span class="operator">=</span> msi.INVENTORY_ITEM_ID</span><br><span class="line">   <span class="keyword">AND</span> dim.organization_id <span class="operator">=</span> msi.organization_id</span><br><span class="line">   <span class="keyword">AND</span> moq.SUBINVENTORY_CODE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%ç»“ç®—&#x27;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®æ‰€éœ€å­—æ®µï¼Œåˆ›å»º dw äº‹å®è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Create table</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> DW_INV_AGACCOUNT</span><br><span class="line">(</span><br><span class="line">  organization_name       VARCHAR2(<span class="number">100</span>),</span><br><span class="line">  organization_short_code VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  item_number             VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  item_desc               VARCHAR2(<span class="number">255</span>),</span><br><span class="line">  primary_uom_code        VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  subinventory_code       VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  locator_name            VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  lot_number              VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  safety_stock            NUMBER,</span><br><span class="line">  onhand_qty              NUMBER,</span><br><span class="line">  transaction_date        <span class="type">DATE</span>,</span><br><span class="line">  organization_wid        NUMBER,</span><br><span class="line">  inventory_wid           NUMBER,</span><br><span class="line">  location_wid            NUMBER,</span><br><span class="line">  item_wid                NUMBER,</span><br><span class="line">  w_insert_dt             <span class="type">DATE</span>,</span><br><span class="line">  w_update_dt             <span class="type">DATE</span>,</span><br><span class="line">  datasource_num_id       NUMBER,</span><br><span class="line">  etl_proc_id             VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  etl_proc_name           VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  line_id                 VARCHAR2(<span class="number">100</span>)</span><br><span class="line">)</span><br><span class="line">tablespace BI_DW_DAT</span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">1</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">64</span>K</span><br><span class="line">    next <span class="number">1</span>M</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">  )</span><br><span class="line">nologging;</span><br><span class="line"><span class="comment">-- Add comments to the table </span></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> DW_INV_AGACCOUNT</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;åº“å­˜ç‰©æ–™æ˜ç»†;</span></span><br><span class="line"><span class="string">-- Add comments to the columns </span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.organization_name</span></span><br><span class="line"><span class="string">  is &#x27;</span>åº“å­˜ç»„ç»‡åç§°;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.organization_short_code</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;åº“å­˜ç»„ç»‡ä»£ç ;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.item_number</span></span><br><span class="line"><span class="string">  is &#x27;</span>ç‰©æ–™ç¼–ç ;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.item_desc</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;ç‰©æ–™æè¿°;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.primary_uom_code</span></span><br><span class="line"><span class="string">  is &#x27;</span>å•ä½;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.subinventory_code</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;å­åº“å­˜;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.locator_name</span></span><br><span class="line"><span class="string">  is &#x27;</span>è´§ä½åç§°;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.lot_number</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;æ‰¹æ¬¡å·;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.safety_stock</span></span><br><span class="line"><span class="string">  is &#x27;</span>å®‰å…¨åº“å­˜;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.onhand_qty</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;ç°æœ‰é‡;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.transaction_date</span></span><br><span class="line"><span class="string">  is &#x27;</span>äº‹åŠ¡å¤„ç†æ—¥æœŸ;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.w_insert_dt</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;æ’å…¥æ—¶é—´;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.w_update_dt</span></span><br><span class="line"><span class="string">  is &#x27;</span>æ›´æ–°æ—¶é—´;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> DW_INV_AGACCOUNT.datasource_num_id</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;æ•°æ®æ¥æº;</span></span><br><span class="line"><span class="string">comment on column DW_INV_AGACCOUNT.etl_proc_name</span></span><br><span class="line"><span class="string">  is &#x27;</span>ETLç¨‹åº;</span><br></pre></td></tr></table></figure><p>åˆ›å»º dw å±‚å­˜å‚¨è¿‡ç¨‹ï¼Œä¼ è¾“åº“å­˜æ˜ç»†æ•°æ®</p><p>package å®šä¹‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE PKG_DW_INV_AGACCOUNT <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">--è·å–äº‹åŠ¡å¤„ç†æ—¥æœŸ</span></span><br><span class="line">  <span class="keyword">FUNCTION</span> get_transaction_date(p_lot_control_code <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                p_organization_id  <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                p_item_id          <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                p_lot_number       <span class="keyword">IN</span> VARCHAR2) <span class="keyword">RETURN</span> <span class="type">DATE</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Author  : LYH</span></span><br><span class="line">  <span class="comment">-- Created : 2020-5-27 ä¸Šåˆ1:21:01</span></span><br><span class="line">  <span class="comment">-- Purpose : åº“å­˜æ˜ç»†</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> SP_DW_INV_AGACCOUNT(P_START_DAY <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_END_DAY   <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_PROC_ID   <span class="keyword">IN</span> NUMBER);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> PKG_DW_INV_AGACCOUNT;</span><br></pre></td></tr></table></figure><p>package å†…å®¹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE BODY PKG_DW_INV_AGACCOUNT <span class="keyword">IS</span></span><br><span class="line">  <span class="comment">--è·å–äº‹åŠ¡å¤„ç†æ—¥æœŸ</span></span><br><span class="line">  <span class="keyword">FUNCTION</span> get_transaction_date(p_lot_control_code <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                p_organization_id  <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                p_item_id          <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                p_lot_number       <span class="keyword">IN</span> VARCHAR2) <span class="keyword">RETURN</span> <span class="type">DATE</span> <span class="keyword">IS</span></span><br><span class="line">    l_transaction_date <span class="type">DATE</span>;</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">--ä¸å¯ç”¨æ‰¹æ¬¡æ§åˆ¶</span></span><br><span class="line">    IF p_lot_control_code <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">SELECT</span> t.TRANSACTION_DATE</span><br><span class="line">        <span class="keyword">INTO</span> l_transaction_date</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> mmt.INVENTORY_ITEM_ID,</span><br><span class="line">                     mmt.ORGANIZATION_ID,</span><br><span class="line">                     mmt.TRANSACTION_DATE</span><br><span class="line">                <span class="keyword">FROM</span> BI_SRC.S_mtl_material_transactions mmt</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> p_item_id <span class="operator">=</span> mmt.INVENTORY_ITEM_ID</span><br><span class="line">                 <span class="keyword">AND</span> p_organization_id <span class="operator">=</span> mmt.ORGANIZATION_ID</span><br><span class="line">               <span class="keyword">ORDER</span> <span class="keyword">BY</span> mmt.TRANSACTION_DATE <span class="keyword">ASC</span>) t <span class="comment">-- æ‰¹æ¬¡æ§åˆ¶æ¥åˆ¤æ–­msi.Lot_Control_Code</span></span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> ROWNUM <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      <span class="comment">--å¯ç”¨æ‰¹æ¬¡æ§åˆ¶</span></span><br><span class="line">      <span class="keyword">SELECT</span> t.TRANSACTION_DATE</span><br><span class="line">        <span class="keyword">INTO</span> l_transaction_date</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> mmt.INVENTORY_ITEM_ID,</span><br><span class="line">                     mmt.ORGANIZATION_ID,</span><br><span class="line">                     mmt.TRANSACTION_DATE,</span><br><span class="line">                     mtln.LOT_NUMBER</span><br><span class="line">                <span class="keyword">FROM</span> BI_SRC.S_mtl_material_transactions   mmt,</span><br><span class="line">                     BI_SRC.S_mtl_transaction_lot_numbers mtln</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> mmt.TRANSACTION_ID <span class="operator">=</span> mtln.TRANSACTION_ID</span><br><span class="line">                 <span class="keyword">AND</span> mtln.lot_number <span class="operator">=</span> p_lot_number</span><br><span class="line">                 <span class="keyword">AND</span> p_item_id <span class="operator">=</span> mmt.INVENTORY_ITEM_ID</span><br><span class="line">                 <span class="keyword">AND</span> p_organization_id <span class="operator">=</span> mmt.ORGANIZATION_ID</span><br><span class="line">               <span class="keyword">ORDER</span> <span class="keyword">BY</span> mmt.TRANSACTION_DATE <span class="keyword">ASC</span>) t <span class="comment">-- æ‰¹æ¬¡æ§åˆ¶æ¥åˆ¤æ–­msi.Lot_Control_Code</span></span><br><span class="line">       <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">AND</span> ROWNUM <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">RETURN</span> l_transaction_date;</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">RETURN</span> <span class="keyword">NULL</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">END</span> get_transaction_date;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">PROCEDURE</span> SP_DW_INV_AGACCOUNT(P_START_DAY <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_END_DAY   <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_PROC_ID   <span class="keyword">IN</span> NUMBER) <span class="keyword">IS</span></span><br><span class="line">    V_START_DAY  NUMBER(<span class="number">10</span>) :<span class="operator">=</span> P_START_DAY;</span><br><span class="line">    V_END_DAY    NUMBER(<span class="number">10</span>) :<span class="operator">=</span> P_END_DAY;</span><br><span class="line">    V_PROC_ID    NUMBER(<span class="number">8</span>) :<span class="operator">=</span> P_PROC_ID;</span><br><span class="line">    V_START_TIME <span class="type">TIMESTAMP</span>; <span class="comment">--å¼€å§‹æ—¶é—´</span></span><br><span class="line">    V_END_TIME   <span class="type">TIMESTAMP</span>; <span class="comment">--ç»“æŸæ—¶é—´</span></span><br><span class="line">    L_LOG        BI_DW.W_ETL_LOG<span class="operator">%</span>ROWTYPE; <span class="comment">--æ—¥å¿—è¡¨æ¸¸æ ‡</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">--è®°å½•ç¨‹åºå¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">INTO</span> V_START_TIME <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    <span class="comment">--è®°å½•æ—¥å¿—</span></span><br><span class="line">    L_LOG.PROC_NAME       :<span class="operator">=</span> <span class="string">&#x27;SP_DW_INV_AGACCOUNT&#x27;</span>; <span class="comment">--è¿‡ç¨‹åç§°</span></span><br><span class="line">    L_LOG.TABLE_TYPE      :<span class="operator">=</span> <span class="string">&#x27;F&#x27;</span>; <span class="comment">--è¡¨ç±»å‹</span></span><br><span class="line">    L_LOG.TABLE_NAME      :<span class="operator">=</span> <span class="string">&#x27;DW_INV_AGACCOUNT&#x27;</span>; <span class="comment">--è¡¨åç§°</span></span><br><span class="line">    L_LOG.MEASURE_ID      :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line">    L_LOG.ETL_INTERVAL    :<span class="operator">=</span> V_START_DAY <span class="operator">||</span> <span class="string">&#x27;~&#x27;</span> <span class="operator">||</span> V_END_DAY; <span class="comment">--æŠ½æ•°åŒºé—´</span></span><br><span class="line">    L_LOG.PROC_ID         :<span class="operator">=</span> V_PROC_ID; <span class="comment">--è¿‡ç¨‹D</span></span><br><span class="line">    L_LOG.START_TIME      :<span class="operator">=</span> V_START_TIME; <span class="comment">--å¼€å§‹æ—¶é—´</span></span><br><span class="line">    L_LOG.ETL_RECORD_LOAD :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ¶‰åŠè®°å½•æ•°</span></span><br><span class="line">    L_LOG.ETL_RECORD_INS  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--å®é™…æ’å…¥çš„è®°å½•æ•°</span></span><br><span class="line">    L_LOG.ETL_RECORD_UPD  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ›´æ–°çš„è®°å½•æ•°ï¼Œå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹æœ‰æ›´æ–°éƒ¨åˆ†ï¼Œåˆ™ä¸ç­‰äºé›¶</span></span><br><span class="line">    L_LOG.ETL_RECORD_DEL  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ’å…¥å‰æ¸…ç†ç›®æ ‡æ—¶çš„åˆ é™¤è®°å½•æ•°</span></span><br><span class="line">    <span class="comment">--åŠ è½½è®°å½•æ•°</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> L_LOG.ETL_RECORD_LOAD <span class="keyword">FROM</span> DW_INV_AGACCOUNT T;</span><br><span class="line">    <span class="comment">--åˆ é™¤è®°å½•</span></span><br><span class="line">    <span class="comment">/*DELETE DW_INV_AGACCOUNT F</span></span><br><span class="line"><span class="comment">     WHERE F.DAY_WID &gt;= V_START_DAY</span></span><br><span class="line"><span class="comment">       AND F.DAY_WID &lt;= V_END_DAY;</span></span><br><span class="line"><span class="comment">    COMMIT;*/</span></span><br><span class="line">    <span class="keyword">EXECUTE</span> IMMEDIATE <span class="string">&#x27;TRUNCATE TABLE DW_INV_AGACCOUNT&#x27;</span>;</span><br><span class="line">    <span class="comment">--åŠ è½½æ•°æ®</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> DW_INV_AGACCOUNT</span><br><span class="line">      (organization_name,</span><br><span class="line">       organization_short_code,</span><br><span class="line">       item_number,</span><br><span class="line">       item_desc,</span><br><span class="line">       primary_uom_code,</span><br><span class="line">       subinventory_code,</span><br><span class="line">       locator_name,</span><br><span class="line">       lot_number,</span><br><span class="line">       safety_stock,</span><br><span class="line">       onhand_qty,</span><br><span class="line">       transaction_date,</span><br><span class="line">       organization_wid,</span><br><span class="line">       inventory_wid,</span><br><span class="line">       location_wid,</span><br><span class="line">       item_wid,</span><br><span class="line">       w_insert_dt,</span><br><span class="line">       w_update_dt,</span><br><span class="line">       datasource_num_id,</span><br><span class="line">       etl_proc_id,</span><br><span class="line">       etl_proc_name,</span><br><span class="line">       line_id)</span><br><span class="line">      <span class="keyword">SELECT</span> organization_name,</span><br><span class="line">             organization_short_code,</span><br><span class="line">             item_number,</span><br><span class="line">             item_desc,</span><br><span class="line">             PRIMARY_UOM_CODE,</span><br><span class="line">             SUBINVENTORY_CODE,</span><br><span class="line">             locator_name,</span><br><span class="line">             LOT_NUMBER,</span><br><span class="line">             safety_stock,</span><br><span class="line">             onhand_qty,</span><br><span class="line">             transaction_date,</span><br><span class="line">             organization_wid,</span><br><span class="line">             inventory_wid,</span><br><span class="line">             location_wid,</span><br><span class="line">             item_wid,</span><br><span class="line">             SYSDATE <span class="keyword">AS</span> W_INSERT_DT,</span><br><span class="line">             SYSDATE <span class="keyword">AS</span> W_UPDATE_DT,</span><br><span class="line">             <span class="number">1</span> <span class="keyword">AS</span> DATASOURCE_NUM_ID,</span><br><span class="line">             V_PROC_ID,</span><br><span class="line">             L_LOG.PROC_NAME,</span><br><span class="line">             inventory_item_id <span class="operator">||</span> organization_id <span class="operator">||</span> subinventory_code <span class="operator">||</span></span><br><span class="line">             nvl(lot_number, <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> hou.organization_name,</span><br><span class="line">                     hou.organization_short_code,</span><br><span class="line">                     msi.segment1 item_number,</span><br><span class="line">                     msi.DESCRIPTION item_desc,</span><br><span class="line">                     msi.PRIMARY_UOM_CODE,</span><br><span class="line">                     moq.SUBINVENTORY_CODE,</span><br><span class="line">                     dil.locator_name,</span><br><span class="line">                     moq.LOT_NUMBER,</span><br><span class="line">                     NVL(ms.SAFETY_STOCK_QUANTITY, <span class="number">0</span>) safety_stock,</span><br><span class="line">                     nvl(moq.TRANSACTION_QUANTITY, <span class="number">0</span>) onhand_qty,</span><br><span class="line">                     hou.organization_wid,</span><br><span class="line">                     di.inventory_wid,</span><br><span class="line">                     dil.location_wid,</span><br><span class="line">                     dim.item_wid,</span><br><span class="line">                     msi.inventory_item_id,</span><br><span class="line">                     msi.organization_id,</span><br><span class="line">                     get_transaction_date(msi.lot_control_code,</span><br><span class="line">                                          msi.organization_id,</span><br><span class="line">                                          msi.inventory_item_id,</span><br><span class="line">                                          moq.lot_number) transaction_date</span><br><span class="line">                <span class="keyword">FROM</span> BI_SRC.S_mtl_system_items_b           msi,</span><br><span class="line">                     BI_SRC.S_mtl_safety_stocks            ms,</span><br><span class="line">                     BI_SRC.S_mtl_onhand_quantities_detail moq,</span><br><span class="line">                     BI_DIM.DIM_ORGANIZATION_UNITS         hou,</span><br><span class="line">                     BI_DIM.DIM_INVENTORIES                di,</span><br><span class="line">                     BI_DIM.DIM_ITEM_LOCATION              dil,</span><br><span class="line">                     BI_DIM.DIM_ITEM                       dim</span><br><span class="line">               <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                 <span class="keyword">AND</span> ms.INVENTORY_ITEM_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.INVENTORY_ITEM_ID</span><br><span class="line">                 <span class="keyword">AND</span> ms.ORGANIZATION_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.ORGANIZATION_ID</span><br><span class="line">                 <span class="keyword">AND</span> moq.INVENTORY_ITEM_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.INVENTORY_ITEM_ID</span><br><span class="line">                 <span class="keyword">AND</span> moq.ORGANIZATION_ID(<span class="operator">+</span>) <span class="operator">=</span> msi.ORGANIZATION_ID</span><br><span class="line">                 <span class="keyword">AND</span> hou.organization_id <span class="operator">=</span> msi.organization_id</span><br><span class="line">                 <span class="keyword">AND</span> di.secondary_inventory_name <span class="operator">=</span></span><br><span class="line">                     nvl(moq.SUBINVENTORY_CODE, <span class="number">-1</span>)</span><br><span class="line">                 <span class="keyword">AND</span> di.organization_id <span class="operator">=</span> nvl(moq.organization_id, <span class="number">-1</span>)</span><br><span class="line">                 <span class="keyword">AND</span> dil.inventory_location_id <span class="operator">=</span> nvl(moq.locator_id, <span class="number">-1</span>)</span><br><span class="line">                 <span class="keyword">AND</span> dim.item_id <span class="operator">=</span> msi.INVENTORY_ITEM_ID</span><br><span class="line">                 <span class="keyword">AND</span> dim.organization_id <span class="operator">=</span> msi.organization_id</span><br><span class="line">                 <span class="keyword">AND</span> moq.SUBINVENTORY_CODE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%ç»“ç®—&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">    L_LOG.ETL_RECORD_INS :<span class="operator">=</span> L_LOG.ETL_RECORD_INS <span class="operator">+</span> <span class="keyword">SQL</span><span class="operator">%</span>ROWCOUNT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line">    <span class="comment">--ç¨‹åºç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">INTO</span> V_END_TIME <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    <span class="comment">--æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">    <span class="keyword">SELECT</span> TRUNC(TO_NUMBER(TO_CHAR(V_END_TIME, <span class="string">&#x27;YYYYMMDDHH24MISSXFF&#x27;</span>)), <span class="number">2</span>) <span class="operator">-</span></span><br><span class="line">           TRUNC(TO_NUMBER(TO_CHAR(V_START_TIME, <span class="string">&#x27;YYYYMMDDHH24MISSXFF&#x27;</span>)), <span class="number">2</span>)</span><br><span class="line">      <span class="keyword">INTO</span> L_LOG.ETL_DURATION</span><br><span class="line">      <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    L_LOG.END_TIME   :<span class="operator">=</span> V_END_TIME;</span><br><span class="line">    L_LOG.ETL_STATUS :<span class="operator">=</span> <span class="string">&#x27;SUCCESS&#x27;</span>;</span><br><span class="line">    <span class="comment">--è°ƒç”¨æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line">    BI_DW.SP_W_ETL_LOG(L_LOG);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">ROLLBACK</span>;</span><br><span class="line">      L_LOG.ETL_STATUS :<span class="operator">=</span> <span class="string">&#x27;FAILURE&#x27;</span>;</span><br><span class="line">      L_LOG.ERR_MSG    :<span class="operator">=</span> SUBSTR(SQLERRM, <span class="number">1</span>, <span class="number">2000</span>);</span><br><span class="line">      BI_DW.SP_W_ETL_LOG(L_LOG);</span><br><span class="line">  <span class="keyword">END</span> SP_DW_INV_AGACCOUNT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> PKG_DW_INV_AGACCOUNT;</span><br></pre></td></tr></table></figure><p>kettle å®šä¹‰ã€è¿è¡Œ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092146-fkkxbyl-image.png" alt="image.png"></p><h3 id="DM-å±‚åˆ†æè¡¨"><a href="#DM-å±‚åˆ†æè¡¨" class="headerlink" title="DM å±‚åˆ†æè¡¨"></a>DM å±‚åˆ†æè¡¨</h3><p>ç¼–å†™ SQL è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.organization_wid,</span><br><span class="line">       t.inventory_wid,</span><br><span class="line">       t.location_wid,</span><br><span class="line">       t.item_wid,</span><br><span class="line">       round(<span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">             <span class="keyword">WHEN</span> SYSDATE <span class="operator">-</span> TRUNC(t.transaction_date) <span class="operator">&gt;</span> DA.AGE_LOW <span class="keyword">AND</span></span><br><span class="line">                  SYSDATE <span class="operator">-</span> TRUNC(t.transaction_date) <span class="operator">&lt;=</span> DA.AGE_HIGH <span class="keyword">THEN</span></span><br><span class="line">              SYSDATE <span class="operator">-</span> TRUNC(t.transaction_date)</span><br><span class="line">             <span class="keyword">ELSE</span></span><br><span class="line">              <span class="number">0</span></span><br><span class="line">           <span class="keyword">END</span>),<span class="number">2</span>) è´¦é¾„</span><br><span class="line">  <span class="keyword">FROM</span> bi_dw.DW_INV_AGACCOUNT t, BI_DIM.DIM_AGE DA</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.organization_wid, t.inventory_wid, t.location_wid, t.item_wid</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»º dm å±‚æ•°æ®è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Create table</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> BI_DM.DM_INV_AGACCOUNT</span><br><span class="line">(</span><br><span class="line">  day_wid            NUMBER(<span class="number">10</span>),</span><br><span class="line">  organization_wid   NUMBER,</span><br><span class="line">  inventory_wid      NUMBER,</span><br><span class="line">  location_wid       NUMBER,</span><br><span class="line">  item_wid           NUMBER,</span><br><span class="line">  age_wid            NUMBER(<span class="number">15</span>),</span><br><span class="line">  age_account        NUMBER,</span><br><span class="line">  w_insert_dt        <span class="type">DATE</span>,</span><br><span class="line">  w_update_dt        <span class="type">DATE</span>,</span><br><span class="line">  datasource_num_id  NUMBER,</span><br><span class="line">  etl_proc_id        VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  etl_proc_name      VARCHAR2(<span class="number">50</span>)</span><br><span class="line">)</span><br><span class="line">tablespace BI_DM_DAT</span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">1</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">64</span>K</span><br><span class="line">    next <span class="number">1</span>M</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">  )</span><br><span class="line">nologging;</span><br><span class="line"><span class="comment">-- Add comments to the table </span></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> BI_DM.DM_INV_AGACCOUNT</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;åº“å­˜è´¦é¾„;</span></span><br><span class="line"><span class="string">-- Add comments to the columns </span></span><br><span class="line"><span class="string">comment on column BI_DM.DM_INV_AGACCOUNT.day_wid</span></span><br><span class="line"><span class="string">  is &#x27;</span>æ—¥æœŸ;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> BI_DM.DM_INV_AGACCOUNT.organization_wid</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;åº“å­˜ç»„ç»‡;</span></span><br><span class="line"><span class="string">comment on column BI_DM.DM_INV_AGACCOUNT.inventory_wid</span></span><br><span class="line"><span class="string">  is &#x27;</span>å­åº“å­˜;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> BI_DM.DM_INV_AGACCOUNT.location_wid</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;è´§ä½;</span></span><br><span class="line"><span class="string">comment on column BI_DM.DM_INV_AGACCOUNT.item_wid</span></span><br><span class="line"><span class="string">  is &#x27;</span>ç‰©æ–™;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> BI_DM.DM_INV_AGACCOUNT.age_wid</span><br><span class="line">  <span class="keyword">is</span> <span class="string">&#x27;è´¦é¾„æ®µ;</span></span><br><span class="line"><span class="string">comment on column BI_DM.DM_INV_AGACCOUNT.age_account</span></span><br><span class="line"><span class="string">  is &#x27;</span>è´¦é¾„;</span><br><span class="line"><span class="comment">-- Create/Recreate indexes </span></span><br><span class="line"><span class="keyword">create</span> index BI_DM.DM_INV_AGACCOUNT_N1 <span class="keyword">on</span> BI_DM.DM_INV_AGACCOUNT (DAY_WID)</span><br><span class="line">  tablespace BI_DM_DIX</span><br><span class="line">  pctfree <span class="number">10</span></span><br><span class="line">  initrans <span class="number">2</span></span><br><span class="line">  maxtrans <span class="number">255</span></span><br><span class="line">  storage</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">initial</span> <span class="number">64</span>K</span><br><span class="line">    next <span class="number">1</span>M</span><br><span class="line">    minextents <span class="number">1</span></span><br><span class="line">    maxextents unlimited</span><br><span class="line">  )</span><br><span class="line">  nologging;</span><br></pre></td></tr></table></figure><p>åˆ›å»º dm å±‚ package</p><p>package å®šä¹‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE PKG_DM_INV_AGACCOUNT <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Author  : KALOSORA</span></span><br><span class="line">  <span class="comment">-- Created : 2020-5-29 ä¸Šåˆ:42:34</span></span><br><span class="line">  <span class="comment">-- Purpose : å®¢æˆ·ä½™é¢è´¦é¾„</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> SP_DM_INV_AGACCOUNT(P_START_DAY <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_END_DAY   <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_PROC_ID   <span class="keyword">IN</span> NUMBER);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> PKG_DM_INV_AGACCOUNT;</span><br></pre></td></tr></table></figure><p>package å†…å®¹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE PACKAGE BODY PKG_DM_INV_AGACCOUNT <span class="keyword">IS</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Author  : KALOSORA</span></span><br><span class="line">  <span class="comment">-- Created : 2020-5-29 ä¸Šåˆ:42:34</span></span><br><span class="line">  <span class="comment">-- Purpose : å®¢æˆ·ä½™é¢è´¦é¾„</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> SP_DM_INV_AGACCOUNT(P_START_DAY <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_END_DAY   <span class="keyword">IN</span> NUMBER,</span><br><span class="line">                                P_PROC_ID   <span class="keyword">IN</span> NUMBER) <span class="keyword">IS</span></span><br><span class="line">    V_START_DAY  NUMBER(<span class="number">10</span>) :<span class="operator">=</span> P_START_DAY;</span><br><span class="line">    V_END_DAY    NUMBER(<span class="number">10</span>) :<span class="operator">=</span> P_END_DAY;</span><br><span class="line">    V_PROC_ID    NUMBER(<span class="number">8</span>) :<span class="operator">=</span> P_PROC_ID;</span><br><span class="line">    V_START_TIME <span class="type">TIMESTAMP</span>; <span class="comment">--å¼€å§‹æ—¶é—´</span></span><br><span class="line">    V_END_TIME   <span class="type">TIMESTAMP</span>; <span class="comment">--ç»“æŸæ—¶é—´</span></span><br><span class="line">    L_LOG        BI_DW.W_ETL_LOG<span class="operator">%</span>ROWTYPE; <span class="comment">--æ—¥å¿—è¡¨æ¸¸æ ‡</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">--è®°å½•ç¨‹åºå¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">INTO</span> V_START_TIME <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    <span class="comment">--è®°å½•æ—¥å¿—</span></span><br><span class="line">    L_LOG.PROC_NAME       :<span class="operator">=</span> <span class="string">&#x27;SP_DM_INV_AGACCOUNT&#x27;</span>; <span class="comment">--è¿‡ç¨‹åç§°</span></span><br><span class="line">    L_LOG.TABLE_TYPE      :<span class="operator">=</span> <span class="string">&#x27;F&#x27;</span>; <span class="comment">--è¡¨ç±»å‹</span></span><br><span class="line">    L_LOG.TABLE_NAME      :<span class="operator">=</span> <span class="string">&#x27;DM_INV_AGACCOUNT&#x27;</span>; <span class="comment">--è¡¨åç§°</span></span><br><span class="line">    L_LOG.MEASURE_ID      :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line">    L_LOG.ETL_INTERVAL    :<span class="operator">=</span> V_START_DAY <span class="operator">||</span> <span class="string">&#x27;~&#x27;</span> <span class="operator">||</span> V_END_DAY; <span class="comment">--æŠ½æ•°åŒºé—´</span></span><br><span class="line">    L_LOG.PROC_ID         :<span class="operator">=</span> V_PROC_ID; <span class="comment">--è¿‡ç¨‹D</span></span><br><span class="line">    L_LOG.START_TIME      :<span class="operator">=</span> V_START_TIME; <span class="comment">--å¼€å§‹æ—¶é—´</span></span><br><span class="line">    L_LOG.ETL_RECORD_LOAD :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ¶‰åŠè®°å½•æ•°</span></span><br><span class="line">    L_LOG.ETL_RECORD_INS  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--å®é™…æ’å…¥çš„è®°å½•æ•°</span></span><br><span class="line">    L_LOG.ETL_RECORD_UPD  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ›´æ–°çš„è®°å½•æ•°ï¼Œå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹æœ‰æ›´æ–°éƒ¨åˆ†ï¼Œåˆ™ä¸ç­‰äºé›¶</span></span><br><span class="line">    L_LOG.ETL_RECORD_DEL  :<span class="operator">=</span> <span class="number">0</span>; <span class="comment">--æ’å…¥å‰æ¸…ç†ç›®æ ‡æ—¶çš„åˆ é™¤è®°å½•æ•°</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">FOR</span> C <span class="keyword">IN</span> (<span class="keyword">SELECT</span> DAY_WID</span><br><span class="line">                <span class="keyword">FROM</span> BI_DIM.DIM_DAY</span><br><span class="line">               <span class="keyword">WHERE</span> DAY_WID <span class="operator">&gt;=</span></span><br><span class="line">                     TO_CHAR(ADD_MONTHS(TO_DATE(V_START_DAY, <span class="string">&#x27;YYYYMMDD&#x27;</span>), <span class="number">-1</span>),</span><br><span class="line">                             <span class="string">&#x27;YYYYMMDD&#x27;</span>)</span><br><span class="line">                 <span class="keyword">AND</span> DAY_WID <span class="operator">&lt;=</span> V_END_DAY</span><br><span class="line">               <span class="keyword">ORDER</span> <span class="keyword">BY</span> DAY_WID) LOOP</span><br><span class="line">      <span class="comment">--åˆ é™¤è®°å½•</span></span><br><span class="line">      <span class="keyword">DELETE</span> DM_INV_AGACCOUNT F <span class="keyword">WHERE</span> F.DAY_WID <span class="operator">=</span> C.DAY_WID;</span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">      <span class="comment">--åŠ è½½æ•°æ®</span></span><br><span class="line">      <span class="comment">--è´¦é¾„</span></span><br><span class="line">      <span class="keyword">INSERT</span> <span class="keyword">INTO</span> DM_INV_AGACCOUNT</span><br><span class="line">        (day_wid,</span><br><span class="line">         organization_wid,</span><br><span class="line">         inventory_wid,</span><br><span class="line">         location_wid,</span><br><span class="line">         item_wid,</span><br><span class="line">         age_wid,</span><br><span class="line">         age_account,</span><br><span class="line">         w_insert_dt,</span><br><span class="line">         w_update_dt,</span><br><span class="line">         datasource_num_id,</span><br><span class="line">         etl_proc_id,</span><br><span class="line">         etl_proc_name)</span><br><span class="line">        <span class="keyword">SELECT</span> C.DAY_WID,</span><br><span class="line">               t.organization_wid,</span><br><span class="line">               t.inventory_wid,</span><br><span class="line">               t.location_wid,</span><br><span class="line">               t.item_wid,</span><br><span class="line">               DA.AGE_WID,</span><br><span class="line">               round(<span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">                           <span class="keyword">WHEN</span> SYSDATE <span class="operator">-</span> TRUNC(t.transaction_date) <span class="operator">&gt;</span> DA.AGE_LOW <span class="keyword">AND</span></span><br><span class="line">                                SYSDATE <span class="operator">-</span> TRUNC(t.transaction_date) <span class="operator">&lt;=</span> DA.AGE_HIGH <span class="keyword">THEN</span></span><br><span class="line">                            SYSDATE <span class="operator">-</span> TRUNC(t.transaction_date)</span><br><span class="line">                           <span class="keyword">ELSE</span></span><br><span class="line">                            <span class="number">0</span></span><br><span class="line">                         <span class="keyword">END</span>),</span><br><span class="line">                     <span class="number">2</span>),</span><br><span class="line">               SYSDATE,</span><br><span class="line">               SYSDATE,</span><br><span class="line">               <span class="number">1</span>,</span><br><span class="line">               V_PROC_ID,</span><br><span class="line">               L_LOG.PROC_NAME</span><br><span class="line">          <span class="keyword">FROM</span> bi_dw.DW_INV_AGACCOUNT t, BI_DIM.DIM_AGE DA</span><br><span class="line">         <span class="keyword">WHERE</span> trunc(t.transaction_date) <span class="operator">&lt;=</span></span><br><span class="line">               TO_DATE(C.DAY_WID, <span class="string">&#x27;YYYYMMDD&#x27;</span>)</span><br><span class="line">           <span class="keyword">AND</span> DA.AGE_WID <span class="operator">&lt;&gt;</span> <span class="number">0</span></span><br><span class="line">         <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.organization_wid,</span><br><span class="line">                  t.inventory_wid,</span><br><span class="line">                  t.location_wid,</span><br><span class="line">                  t.item_wid,</span><br><span class="line">                  DA.AGE_WID</span><br><span class="line">        <span class="comment">--HAVING SUM(F.AMOUNT) &lt;&gt; 0</span></span><br><span class="line">        ;</span><br><span class="line">      L_LOG.ETL_RECORD_INS :<span class="operator">=</span> L_LOG.ETL_RECORD_INS <span class="operator">+</span> <span class="keyword">SQL</span><span class="operator">%</span>ROWCOUNT;</span><br><span class="line">      <span class="keyword">COMMIT</span>;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    <span class="comment">--ç¨‹åºç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">INTO</span> V_END_TIME <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    <span class="comment">--æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">    <span class="keyword">SELECT</span> TRUNC(TO_NUMBER(TO_CHAR(V_END_TIME, <span class="string">&#x27;YYYYMMDDHH24MISSXFF&#x27;</span>)), <span class="number">2</span>) <span class="operator">-</span></span><br><span class="line">           TRUNC(TO_NUMBER(TO_CHAR(V_START_TIME, <span class="string">&#x27;YYYYMMDDHH24MISSXFF&#x27;</span>)), <span class="number">2</span>)</span><br><span class="line">      <span class="keyword">INTO</span> L_LOG.ETL_DURATION</span><br><span class="line">      <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    L_LOG.END_TIME   :<span class="operator">=</span> V_END_TIME;</span><br><span class="line">    L_LOG.ETL_STATUS :<span class="operator">=</span> <span class="string">&#x27;SUCCESS&#x27;</span>;</span><br><span class="line">    <span class="comment">--è°ƒç”¨æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line">    BI_DW.SP_W_ETL_LOG(L_LOG);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">ROLLBACK</span>;</span><br><span class="line">      L_LOG.ETL_STATUS :<span class="operator">=</span> <span class="string">&#x27;FAILURE&#x27;</span>;</span><br><span class="line">      L_LOG.ERR_MSG    :<span class="operator">=</span> SUBSTR(SQLERRM, <span class="number">1</span>, <span class="number">2000</span>);</span><br><span class="line">      BI_DW.SP_W_ETL_LOG(L_LOG);</span><br><span class="line">  <span class="keyword">END</span> SP_DM_INV_AGACCOUNT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> PKG_DM_INV_AGACCOUNT;</span><br></pre></td></tr></table></figure><h3 id="BIEE-è§†å›¾å±‚å¼€å‘"><a href="#BIEE-è§†å›¾å±‚å¼€å‘" class="headerlink" title="BIEE è§†å›¾å±‚å¼€å‘"></a>BIEE è§†å›¾å±‚å¼€å‘</h3><p>ç™»å½•åˆ° biee æœåŠ¡å™¨ï¼Œä¸‹è½½ rpd æ–‡ä»¶ç”¨ç¦»çº¿æ¨¡å¼æ‰“å¼€(åŠ å¿«è¿è¡Œé€Ÿåº¦)ï¼Œæ‰¾åˆ°æ–‡ä»¶ GJ_BI.rpd</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/u01/biee/Oracle/Middleware/Config/user_projects/domains/bi/bidata/service_instances/ssi/metadata/datamodel/customizations/</span><br></pre></td></tr></table></figure><p>æ–°å»ºæ•°æ®åº“ï¼Œæ–°å»ºé“¾æ¥æ± </p><p>12c æ•°æ®åº“å±æ€§è®¾ç½®</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092453-czoqr5l-image.png" alt="image.png"></p><p>é“¾æ¥æ± å±æ€§è®¾ç½®</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092610-zcj308z-image.png" alt="image.png"></p><p>åˆ‡æ¢åˆ° BI_QUERY ç”¨æˆ·ï¼Œå…ˆä¸ºæ•°æ®è¡¨åˆ›å»ºåŒä¹‰è¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE SYNONYM DIM_INVENTORIESFOR <span class="keyword">FOR</span> BI_DIM.DIM_INVENTORIES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE SYNONYM DIM_ITEM  <span class="keyword">FOR</span> BI_DIM.DIM_ITEM;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE SYNONYM DIM_ITEM_LOCATION <span class="keyword">FOR</span> BI_DIM.DIM_ITEM_LOCATION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE SYNONYM DIM_ORGANIZATION_UNITS <span class="keyword">FOR</span> BI_DIM.DIM_ORGANIZATION_UNITS;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> SYNONYM dw_inv_agaccount <span class="keyword">FOR</span> bi_dw.dw_inv_agaccount;</span><br></pre></td></tr></table></figure><p>è¿æ¥æ± ï¼Œå³é”®ï¼Œå¯¼å…¥æ•°æ®è¡¨</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092642-xffd4m5-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092649-n9qb531-image.png" alt="image.png"></p><p>åˆ›å»ºç‰©ç†å±‚äº‹å®è¡¨</p><p>å¯¹éœ€è¦åˆ›å»ºçš„è¡¨ï¼Œå³é”®-ã€‹æ–°å»ºå¯¹è±¡-ã€‹åˆ«å</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092702-e35ftl6-image.png" alt="image.png"></p><p>è¾“å…¥åç§°ï¼Œä¿æŒä¸€è‡´</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092712-bmhlmwp-image.png" alt="image.png"></p><p>ç‰©ç†å±‚åˆ›å»ºå®Œæ¯•</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092723-htx7w3h-image.png" alt="image.png"></p><p>åŒç†ï¼Œdw è¡¨ä¹Ÿè¦åˆ›å»ºåˆ«å</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092735-2bivfmh-image.png" alt="image.png"></p><p>é€‰ä¸­ç»´åº¦å’Œäº‹å®è¡¨ï¼Œå³é”®ï¼Œç‰©ç†å›¾è¡¨-ã€‹ä»…æ‰€é€‰å¯¹è±¡ã€‚ç„¶åå…³è”ä¸»é”® id</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092747-cgyjccb-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092753-wbtt0xp-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092804-eg7uvlr-image.png" alt="image.png"></p><p>ä¿®æ”¹äº‹å®è¡¨&#x2F;ç»´åº¦è¡¨çš„è¡¨åç§°</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092816-jbyqz93-image.png" alt="image.png"></p><p>ä¿®æ”¹å­—æ®µåç§°ï¼Œåˆ é™¤ç»´åº¦å’Œäº‹å®è¡¨ä¸­ä¸éœ€è¦çš„å­—æ®µ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092828-ofkrki2-image.png" alt="image.png"></p><p>ç»´åº¦ä¿®æ”¹å</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092846-wss5x0s-image.png" alt="image.png"></p><p>äº‹å®è¡¨ä¿®æ”¹å</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092856-y2hsuz2-image.png" alt="image.png"></p><p>5.3 åˆ›å»ºé€»è¾‘ç»´</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092907-ubusmxx-image.png" alt="image.png"></p><p>ä¿®æ”¹ç»´åº¦çš„åç§°å’Œå­—æ®µåï¼Œå¹¶ä¸”åˆ é™¤ä¸éœ€è¦çš„å­—æ®µ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092917-tddmoss-image.png" alt="image.png"></p><p>åŒå‡»ç»´åº¦ detail å±‚ï¼Œè®¾ç½®æ˜¾ç¤ºçš„ä¸»é”®</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092926-pj7vvwc-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092934-rgi5q7r-image.png" alt="image.png"></p><p>æ³¨æ„ï¼šæ—¶é—´ç»´åº¦è¦åšå¦‚ä¸‹æ“ä½œ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023092945-sflgpox-image.png" alt="image.png"></p><p><strong>ä»¥ä¸Šï¼Œå…¶ä»–ç»´åº¦ä¹Ÿæ˜¯å¦‚æ­¤</strong></p><p>æ‹–åŠ¨æ•°æ®åˆ°å±•ç¤ºå±‚</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093001-jytkhem-image.png" alt="image.png"></p><p>ä¸Šä¼  rpd æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/u01/biee/Oracle/Middleware/Config/user_projects/domains/bi/bidata/service_instances/ssi/metadata/datamodel/customizations</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@OBIEE ~]$ cd /u01/biee/Oracle/Middleware/Config/user_projects/domains/bi/bidata/service_instances/ssi/metadata/datamodel/customizations[oracle@OBIEE customizations]$ /u01/biee/Oracle/Middleware/Config/user_projects/domains/bi/bitools/bin/datamodel.sh uploadrpd -u weblogic -p bieetest2019 -i liverpd.rpd -w Admin123 -S biee-test -SI ssi</span><br></pre></td></tr></table></figure><h3 id="BIEE-å‰ç«¯è®¾ç½®"><a href="#BIEE-å‰ç«¯è®¾ç½®" class="headerlink" title="BIEE å‰ç«¯è®¾ç½®"></a>BIEE å‰ç«¯è®¾ç½®</h3><p>æ–°å»ºåˆ†æ -ã€‹ å³ä¸Šè§’æ–°å»ºï¼Œåˆ†æ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093203-a674zaz-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093209-cfcsfoe-image.png" alt="image.png"></p><p>é€‰æ‹©ç›¸åº”çš„ä¸»é¢˜åï¼ŒæŠŠäº‹å®è¡¨ä¸­çš„åˆ—æ‹–åŠ¨åˆ°â€œæ‰€é€‰åˆ—ä¸­â€ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„ä¸»é¢˜åŒºåŸŸè¿›è¡Œä¿å­˜</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093436-g07egw4-image.png" alt="image.png"></p><p>æ–°å»ºä»ªè¡¨ç›˜æç¤ºï¼Œå¹¶é€‰æ‹©ä¸»é¢˜åŒºåŸŸ</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093237-zy0ioag-image.png" alt="image.png"></p><p>é€‰æ‹©åˆ—æç¤º</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093519-03y0bzw-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093525-vjg8yvh-image.png" alt="image.png"></p><p>æ–°å»ºä»ªè¡¨ç›˜</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093534-mknope5-image.png" alt="image.png"></p><p>æŠŠä»ªè¡¨ç›˜æç¤ºå’Œåˆ†æï¼Œåˆ†åˆ«æ‹–å…¥åˆ°ä»ªè¡¨ç›˜ä¸­</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093543-jf5d20v-image.png" alt="image.png"></p><p>å›åˆ° ç¼–è¾‘åˆ†æ é¡µé¢ï¼Œåˆ‡æ¢åˆ° æ ‡å‡† é€‰é¡¹å¡ï¼Œæ·»åŠ ç­›é€‰å™¨ï¼Œä½¿å¾—ä»ªè¡¨ç›˜æç¤ºèƒ½å¤Ÿæ­£å¸¸è¿‡æ»¤æ•°æ®</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093554-o94lrdz-image.png" alt="image.png"></p><p>é€‰æ‹©è¦è¿‡æ»¤çš„åˆ—</p><p>æ³¨æ„ï¼šä»ªè¡¨ç›˜ä¸­ï¼Œæç¤ºçš„æ•°æ®æºè¦å’Œç­›é€‰å™¨ä¸­çš„æ•°æ®æºç›¸åŒã€‚</p><p>å¦‚æœä»ªè¡¨ç›˜æç¤ºä½¿ç”¨çš„æ˜¯ ç»´è¡¨ é‚£ä¹ˆç­›é€‰å™¨ä¹Ÿè¦ä½¿ç”¨ ç»´è¡¨</p><p>å¦‚æœä»ªè¡¨ç›˜æç¤ºä½¿ç”¨çš„æ˜¯ äº‹å®è¡¨ é‚£ä¹ˆç­›é€‰å™¨ä¹Ÿè¦ä½¿ç”¨ äº‹å®è¡¨</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093626-jnnszl3-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093633-vyuk2cs-image.png" alt="image.png"></p><p>å®Œæˆæ•ˆæœå¦‚ä¸‹ï¼Œæ³¨æ„å…³é”®å­—æ®µçš„æ¥æºï¼Œæœ‰çš„æ¥æºäºç»´è¡¨ï¼Œç”¨äºè¿‡æ»¤æ•°æ®</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093640-cvvek5p-image.png" alt="image.png"></p><p>æç¤ºä¹Ÿå¿…é¡»æ¥æºäºç»´è¡¨</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093649-ykuxn2n-image.png" alt="image.png"></p><p>æ³¨æ„ï¼šå¦‚æœæŠ¥è¡¨æ— æ³•å……æ»¡æ•´ä¸ªå±å¹•ï¼Œè¦ç¼–è¾‘åˆ†æï¼Œé€‰æ‹©å†…å®¹åˆ†é¡µå³å¯</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093701-b02knsy-image.png" alt="image.png"></p><p>æ³¨æ„ï¼šè®¾ç½®å­—æ®µç›¸åŒä¹Ÿæ˜¾ç¤º</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093717-3au5muj-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093724-jx4h5k5-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093731-jm6m6mr-image.png" alt="image.png"></p><p>æ³¨æ„ï¼šè®¾ç½®æ‰“å°</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093741-x1da03q-image.png" alt="image.png"></p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093746-dfwkn3d-image.png" alt="image.png"></p><p>è®¾ç½® biee çš„æ•°æ®æ˜¾ç¤ºä¸ºæœ€å¤§è¡Œæ•°-é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/u01/biee/Oracle/Middleware/Config/user_projects/domains/bi/config/fmwconfig/biconfig/OBIPS/instanceconfig.xml</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œåè¦é‡å¯ biee åº”ç”¨</p><p>åŒæ—¶è¿˜è¦ä¿®æ”¹ Oracle EM ä¸Šçš„æœ€å¤§è¡Œæ•°</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093819-ne3cja5-image.png" alt="image.png"></p><p>BIEE æ·»åŠ ç”¨æˆ· -&gt; ç™»é™†åˆ° Oracle WEBLOGIC CONSOLE</p><p><img src="/2020/01/23/BIEE%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/20201023093837-zco6gaw-image.png" alt="image.png"></p><h3 id="æ•°æ®ä»“åº“è®¾è®¡"><a href="#æ•°æ®ä»“åº“è®¾è®¡" class="headerlink" title="æ•°æ®ä»“åº“è®¾è®¡"></a>æ•°æ®ä»“åº“è®¾è®¡</h3><p>æ•°æ®ä»“åº“è®¾è®¡</p><ul><li>ODS å…ƒæ•°æ® ï¼ˆBI_SRC å±‚ï¼‰</li><li>DIM  ç»´åº¦å±‚ï¼ˆBI_DIM å±‚ï¼Œè´¯ç©¿ DW å’Œ DM å±‚ï¼‰</li><li>DW   æ•°æ®ä»“åº“å±‚ï¼ˆBI_DW å±‚ï¼‰ï¼Œå±•ç¤ºæŠ¥è¡¨æ˜ç»†æ•°æ®</li><li>DM   æ•°æ®é›†å¸‚å±‚ï¼ˆBI_DM å±‚ï¼‰åŸºäº BI_DW å±‚çš„æ•°æ®ï¼Œç”Ÿæˆæ–°çš„è¡¨ï¼Œä¸»è¦ç”¨äºè®¡ç®—å¸é¾„ã€ä½™é¢çš„æ•°æ®ï¼Œæ ¹æ®ä¸åŒçš„æŒ‡æ ‡æ¥å±•ç°èšåˆçš„æ•°æ®</li></ul><p>å‘½åè§„èŒƒ</p><p>ä¹¦ç›®</p><ul><li>æ•°æ®ä»“åº“å·¥å…·ç®±-â€”â€”ç»´åº¦å»ºæ¨¡æƒå¨æŒ‡å—</li><li>ã€ŠHadoop æ„å»ºæ•°æ®ä»“åº“å®è·µã€‹</li></ul><p>æ•°æ®å±‚â€”â€”ETL å·¥å…·çš„ kettle</p><p>æ–°å»º kettle è½¬æ¢</p><p>é€‰æ‹©è¡¨è¾“å…¥å’Œè¡¨è¾“å‡º</p><p>æ ¹æ®éœ€è¦è®¾ç½®å¢é‡åŒæ­¥</p><p>æ–°å»º jobï¼ŒæŠŠå¤šä¸ª kettle æ–‡ä»¶è¿åœ¨ä¸€èµ·ï¼›job è®¾ç½®å®šæ—¶åŒæ­¥</p>]]></content>
      
      
      <categories>
          
          <category> ORACLE BIEE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DATAWARE HOUSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BIEEå¼€å‘ä»£ç ç›¸å…³</title>
      <link href="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/"/>
      <url>/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="BIEE-å¼€å‘ä»£ç ç›¸å…³"><a href="#BIEE-å¼€å‘ä»£ç ç›¸å…³" class="headerlink" title="BIEE å¼€å‘ä»£ç ç›¸å…³"></a>BIEE å¼€å‘ä»£ç ç›¸å…³</h1><h5 id="å¢åŠ ç”¨æˆ·"><a href="#å¢åŠ ç”¨æˆ·" class="headerlink" title="å¢åŠ ç”¨æˆ·"></a>å¢åŠ ç”¨æˆ·</h5><p>æ•°æ®åº“å¢åŠ æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ç”¨æˆ·å¯†ç è¡¨</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> BI_WRITE.APD_BI_USERS t;</span><br><span class="line"></span><br><span class="line"><span class="comment">--ç”¨æˆ·ç»„ç»‡æƒé™è¡¨</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, user_name, dimension_name æ³•äººä»£ç , dimension_data OUä»£ç </span><br><span class="line">  <span class="keyword">FROM</span> bi_write.apd_user_data_permisssion;</span><br><span class="line"></span><br><span class="line"><span class="comment">--ç”¨æˆ·çš„åŠŸèƒ½æƒé™ï¼ˆå¯è®¿é—®å“ªäº›æŠ¥è¡¨ï¼‰</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> BI_WRITE.APD_USER_REPORT_PERMISSION t</span><br></pre></td></tr></table></figure><p>BIEE çš„æ“ä½œ</p><p>1.ç”¨ weblogic ç®¡ç†å‘˜ç”¨æˆ·ç™»å½•ï¼Œç‚¹å‡»å³ä¸Šè§’ç®¡ç†</p><p><img src="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/20201023090531-w6rxee9-image.png" alt="BIEEå¼€å‘ä»£ç ç›¸å…³.png"></p><p>2.ç‚¹å‡» ä¼šè¯ç®¡ç†-&gt; ç®¡ç†å›è¯</p><p><img src="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/20201023090602-ivk6b8s-image.png" alt="BIEEå¼€å‘ä»£ç ç›¸å…³.png"></p><p>3.åˆ†åˆ«ç‚¹å‡» å…³é—­æ‰€æœ‰æ¸¸æ ‡ å’Œ å–æ¶ˆæ­£åœ¨è¿è¡Œçš„è¯·æ±‚</p><p><img src="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/20201023090614-ueaelqy-image.png" alt="BIEEå¼€å‘ä»£ç ç›¸å…³.png"></p><p>4.åé€€ï¼Œå›åˆ°ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»å‘é€ SQL è¯­å¥</p><p><img src="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/20201023090633-igpj75t-image.png" alt="BIEEå¼€å‘ä»£ç ç›¸å…³.png"></p><p>è¾“å…¥ CALL SAPURGEALLCACHE();å¹¶ç‚¹å‡»å‘é€</p><p><img src="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/20201023090648-ssvlj0u-image.png" alt="BIEEå¼€å‘ä»£ç ç›¸å…³.png"></p><p>ç‚¹å‡»åé€€ï¼Œå›åˆ°ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»é‡æ–°åŠ è½½æ–‡ä»¶å’Œå…ƒæ•°æ®</p><p><img src="/2020/01/23/BIEE%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3/20201023090701-uddn4z6-image.png" alt="BIEEå¼€å‘ä»£ç ç›¸å…³.png"></p><h5 id="æŸ¥çœ‹-bi-åŒæ­¥æ—¥å¿—"><a href="#æŸ¥çœ‹-bi-åŒæ­¥æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹ bi åŒæ­¥æ—¥å¿—"></a>æŸ¥çœ‹ bi åŒæ­¥æ—¥å¿—</h5><p>1.ä»æ•°æ®åº“æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> bi_dw.w_etl_log <span class="keyword">WHERE</span> proc_id <span class="operator">=</span> <span class="string">&#x27;20200516&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> start_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p>2.ä»æœåŠ¡å™¨æŸ¥çœ‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--ç¯å¢ƒä¿¡æ¯</span><br><span class="line">10.38.1.129</span><br><span class="line">bieetest/bieetest </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--å‘½ä»¤</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">su oratest/oratest //åˆ‡æ¢ç”¨æˆ·</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">crontab -l         //æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ä¿¡æ¯</span></span><br><span class="line">                     //å¯ä»¥cdåˆ° /u01/kettle/kettle_file/logç›®å½•ä¸‹æŸ¥çœ‹</span><br><span class="line">                     //u01/kettle/kettle_file/RunJob.sh æ˜¯æ‰§è¡ŒåŒæ­¥çš„å‘½ä»¤</span><br></pre></td></tr></table></figure><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> ORACLE BIEE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DATAWARE HOUSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé›†åˆ</title>
      <link href="/2019/11/17/Java%E9%9B%86%E5%90%88/"/>
      <url>/2019/11/17/Java%E9%9B%86%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaé›†åˆ"><a href="#Javaé›†åˆ" class="headerlink" title="Javaé›†åˆ"></a>Javaé›†åˆ</h1><p>â€</p><h2 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h2><p>é›†åˆä¸­çš„é¡¶çº§æ¥å£ï¼Œæºä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  E <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;remove&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">forEachRemaining</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(action);</span><br><span class="line">        <span class="keyword">while</span> (hasNext())</span><br><span class="line">            action.accept(next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ…å«2ä¸ªåŠ¨æ€æ–¹æ³•</p><p>å¾ªç¯çš„æ—¶å€™è¦å…ˆè°ƒç”¨hasNextè¿›è¡Œåˆ¤æ–­ï¼Œç„¶åå†è°ƒç”¨next</p><h3 id="å®ä¾‹1ï¼šIteratoréå†"><a href="#å®ä¾‹1ï¼šIteratoréå†" class="headerlink" title="å®ä¾‹1ï¼šIteratoréå†"></a>å®ä¾‹1ï¼šIteratoréå†</h3><p>é€šè¿‡æ“ä½œè¿­ä»£å™¨æ¥è¿›è¡Œé›†åˆçš„éå†</p><p>é›†åˆä¸­çš„ä»»ä½•æ•°æ®ç»“æ„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨foreachä»£æ›¿iteratorå¾ªç¯ã€‚</p><p>åŸå› æ˜¯Collectionæ¥å£æ‰©å±•äº†Iterableæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹ŸIterator</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Stream.of(<span class="string">&quot;Ashe&quot;</span>, <span class="string">&quot;Zed&quot;</span>, <span class="string">&quot;Yasuo&quot;</span>)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»»ä½•å®ç°äº† Iterator&lt;E&gt; æ¥å£çš„æ–¹æ³•ï¼Œéƒ½ä¼šæœ‰è¿­ä»£å™¨</span></span><br><span class="line">    <span class="comment">// è·å–listçš„è¿­ä»£å™¨</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">iterator</span> <span class="operator">=</span> list.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨è¿­ä»£å™¨å¾ªç¯</span></span><br><span class="line">    <span class="comment">// å¾ªç¯è¾“å‡ºlistï¼Œæ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œéƒ½è¦å…ˆåˆ¤æ–­hasNext</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰åˆ¤æ–­ï¼Œä¼šæŠ›å‡ºNoSuchElementException</span></span><br><span class="line">    System.out.println(<span class="string">&quot;è¿­ä»£å™¨å¾ªç¯ï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        System.out.println(iterator.next());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// forå¾ªç¯ä¸è¿­ä»£å™¨å¾ªç¯ç­‰ä»·</span></span><br><span class="line">    System.out.println(<span class="string">&quot;foreachå¾ªç¯ï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> element : list) &#123;</span><br><span class="line">        System.out.println(element);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å®ä¾‹2ï¼šIteratoråˆ é™¤"><a href="#å®ä¾‹2ï¼šIteratoråˆ é™¤" class="headerlink" title="å®ä¾‹2ï¼šIteratoråˆ é™¤"></a>å®ä¾‹2ï¼šIteratoråˆ é™¤</h3><p>Iterator ç±»ä¼¼äºä¸€ä¸ªæŒ‡é’ˆï¼Œæˆ–è€…æ˜¯SQLä¸­çš„ä¸€ä¸ªæ¸¸æ ‡ï¼šåœ¨æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œçš„åŒæ—¶ï¼Œè¿­ä»£å™¨çš„ä½ç½®ä¼šéšä¹‹å‘å‰ç§»åŠ¨ã€‚å¯ä»¥é€šè¿‡nextæ–¹æ³•ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>).collect(Collectors.toList());</span><br><span class="line">    <span class="type">var</span> <span class="variable">iterator</span> <span class="operator">=</span> list.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤ç¬¬äºŒä¸ªå…ƒç´ ï¼Œéœ€è¦ç§»åŠ¨ä¸¤æ¬¡è¿­ä»£å™¨</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œä»ç¬¬0ä½ç§»åŠ¨åˆ°äº†ç¬¬2ä½</span></span><br><span class="line">    iterator.next();</span><br><span class="line">    iterator.next();</span><br><span class="line">    iterator.remove();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> element : list) &#123;</span><br><span class="line">        System.out.println(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="å®ä¾‹3ï¼šéšæœºåºåˆ—äº§ç”Ÿå™¨"><a href="#å®ä¾‹3ï¼šéšæœºåºåˆ—äº§ç”Ÿå™¨" class="headerlink" title="å®ä¾‹3ï¼šéšæœºåºåˆ—äº§ç”Ÿå™¨"></a>å®ä¾‹3ï¼šéšæœºåºåˆ—äº§ç”Ÿå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ç°éšæœºåºåˆ—äº§ç”Ÿå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomStringGenerator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RandomStringGenerator</span><span class="params">(List&lt;T&gt; list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;T&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> list.get((<span class="type">int</span>) (list.size() * Math.random()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> Arrays.asList(<span class="string">&quot;List&quot;</span>, <span class="string">&quot;Tree&quot;</span>, <span class="string">&quot;Array&quot;</span>);</span><br><span class="line">        <span class="type">var</span> <span class="variable">gen</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomStringGenerator</span>&lt;String&gt;(list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ“ä½œè¿­ä»£å™¨</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">it</span> <span class="operator">=</span> gen.iterator();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(it.next());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        ArrayListè½¬æ¢æˆæ•°ç»„</span></span><br><span class="line"><span class="comment">//        ArrayList&lt;String&gt; arr = new ArrayList&lt;String&gt;();</span></span><br><span class="line"><span class="comment">//        arr.add(&quot;3&quot;);</span></span><br><span class="line"><span class="comment">//        var strArr = arr.toArray(new String[0]);</span></span><br><span class="line"><span class="comment">//        System.out.println(strArr.toString());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ArrayListé€šè¿‡æ„é€ å™¨è½¬æ¢ä¸ºæ•°ç»„</span></span><br><span class="line"><span class="comment">//        ArrayList&lt;String&gt; arr = new ArrayList&lt;String&gt;();</span></span><br><span class="line"><span class="comment">//        arr.add(&quot;3&quot;);</span></span><br><span class="line"><span class="comment">//        // Method Reference ::</span></span><br><span class="line"><span class="comment">//        // é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥è®¿é—®åˆ°æ•°ç»„çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        var strArr = arr.toArray(String[]::new);</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li><p>ä»ä¸Šè¿°å®ä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼ŒIteratoræ¥å£åªå…·æœ‰<code>éå†</code>å’Œ<code>åˆ é™¤</code>å…ƒç´ çš„åŠŸèƒ½</p></li><li><p>Collectionæ¥å£<code>ç»§æ‰¿</code>äº†Iterableæ¥å£ï¼Œå¹¶ä¸”æä¾›äº†<code>æŸ¥è¯¢</code>ã€<code>åˆ¤æ–­</code>ç­‰ç­‰çš„æ‰©å±•åŠŸèƒ½</p></li><li><p>AbstractCollectionå®ç°äº†Collectionæ–¹æ³•ï¼Œç›¸å½“äºæä¾›äº†é»˜è®¤çš„æ–¹æ³•ï¼Œå¦‚æœå­é›†åˆä¸­æœ‰æ›´é«˜æ•ˆçš„å®ç°å¯ä»¥äº¤ç»™å­ç±»æä¾›ã€‚</p><ol><li>ä½†æ˜¯java8ä»¥åæ¥å£å¼•å…¥äº†<code>default</code>ï¼Œè¿™ç§æ–¹å¼åº”è¯¥äº¤ç»™defaultæ–¹æ³•ï¼Œå……å½“åŠ¨æ€æ–¹æ³•ï¼Œå…è®¸å­ç±»é‡å†™</li><li>Abstractæ–¹æ³•å¿…é¡»å…ˆè¢«ç»§æ‰¿åï¼Œæ‰èƒ½å¤Ÿå®ä¾‹åŒ–ï¼›ä¸»è¦ç”¨äºå½“ä¸€ä¸ªç±»&#x2F;æ¥å£ä¸è¶³ä»¥æè¿°ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™çš„è¡¥å……æ‰‹æ®µï¼Œç›¸å½“äºæä¾›é»˜è®¤çš„å®ç°</li><li>Abstractæ–¹æ³•ï¼Œä¸€èˆ¬ç”¨äº<code>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</code>ï¼Œæä¾›é€šç”¨çš„æ€»ä½“ç®—æ³•éª¨æ¶ ä»¥åŠ å…·ä½“çš„ä¸šåŠ¡æŠ½è±¡æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•ç”±å­ç±»æ¥å®ç°ï¼‰</li></ol></li></ol><p>â€</p><p>â€</p><h2 id="å®¹å™¨æ¡†æ¶å›¾"><a href="#å®¹å™¨æ¡†æ¶å›¾" class="headerlink" title="å®¹å™¨æ¡†æ¶å›¾"></a>å®¹å™¨æ¡†æ¶å›¾</h2><p>å®¹å™¨ï¼šç”¨äºå®¹çº³ä¸€ç»„<strong>å¯¹è±¡</strong>ï¼Œä¸èƒ½å®¹çº³éå¯¹è±¡ç±»å‹ï¼Œè¦èƒ½å¤Ÿ<code>å¢åˆ æ”¹ä¸éå†</code></p><p>å®¹å™¨ <code>Collection</code> å…³ç³»å›¾</p><p><img src="/2019/11/17/Java%E9%9B%86%E5%90%88/402670-20191117185306543-1130864512-20210317094853-modvcpu.png" alt="image.png"></p><p>â€</p><h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h3><p>LinkedList</p><ul><li>ä¼˜ç‚¹ï¼šæ’å…¥ã€åˆ é™¤å…ƒç´ çš„å¼€é”€å°</li><li>ç¼ºç‚¹ï¼šæ— æ³•éšæœºè¯»å–å…ƒç´ </li><li>åœºæ™¯ï¼šé€‚ç”¨äºæŸ¥è¯¢å°‘ã€æ“ä½œå¤šçš„åœºæ™¯</li></ul><p>Javaä¸­çš„é“¾è¡¨éƒ½æ˜¯åŒå‘é“¾è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">   list.add(<span class="string">&quot;Ashe&quot;</span>);</span><br><span class="line">   list.add(<span class="string">&quot;Yasuo&quot;</span>);</span><br><span class="line">   list.add(<span class="string">&quot;Zed&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·å–è¿­ä»£å™¨</span></span><br><span class="line">   <span class="type">var</span> <span class="variable">iterator</span> <span class="operator">=</span> list.iterator();</span><br><span class="line">   <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">   <span class="type">String</span> <span class="variable">second</span> <span class="operator">=</span> iterator.next();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;ç¬¬ä¸€ä¸ªå…ƒç´ : &quot;</span> + first);</span><br><span class="line">    System.out.println(<span class="string">&quot;ç¬¬äºŒä¸ªå…ƒç´ : &quot;</span> + second);</span><br><span class="line"></span><br><span class="line">    list.remove();</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// addæ–¹æ³•ï¼Œå…ƒç´ è¡¨å°¾æ·»åŠ </span></span><br><span class="line">    list.add(<span class="string">&quot;NuNu&quot;</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§»åŠ¨æŒ‡é’ˆåï¼Œè¯»å–å‰é©±</span></span><br><span class="line">    <span class="comment">// ListIterator æ‰©å±•äº†Iteratoræ–¹æ³•ï¼Œä½¿å…¶å…·æœ‰addå’Œåå‘éå†çš„èƒ½åŠ›</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">listIterator</span> <span class="operator">=</span> list.listIterator();</span><br><span class="line">    listIterator.next();</span><br><span class="line">    System.out.println(listIterator.previous());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ•£åˆ—é›†"><a href="#æ•£åˆ—é›†" class="headerlink" title="æ•£åˆ—é›†"></a>æ•£åˆ—é›†</h3><p>é€‚ç”¨äºå¿«é€ŸæŸ¥æ‰¾å¯¹è±¡ï¼Œå¹¶ä¸”ä¸å…³å¿ƒé›†åˆä¸­å…ƒç´ é¡ºåºçš„åœºæ™¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">words</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="type">long</span> <span class="variable">totalTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">var</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in)) &#123;</span><br><span class="line">        <span class="keyword">while</span> (in.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">word</span> <span class="operator">=</span> in.next();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(word.equals(<span class="string">&quot;exit&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">long</span> <span class="variable">callTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            words.add(word);</span><br><span class="line">            callTime = System.currentTimeMillis() - callTime;</span><br><span class="line">            totalTime += callTime;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">iterator</span> <span class="operator">=</span> words.iterator();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">20</span> &amp;&amp; iterator.hasNext(); i++) &#123;</span><br><span class="line">        System.out.println(iterator.next());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;words size: &quot;</span> + words.size() + <span class="string">&quot; totalTime: &quot;</span> + totalTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ ‘é›†"><a href="#æ ‘é›†" class="headerlink" title="æ ‘é›†"></a>æ ‘é›†</h3><p>æ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œè¾“å…¥ä¸€ä¸ªä»»æ„é¡ºåºçš„å…ƒç´ ï¼Œåœ¨éå†æ—¶ä¼šè‡ªåŠ¨æŒ‰ç…§æ’åºåçš„é¡ºåºå‘ˆç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">treeSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;Integer&gt;();</span><br><span class="line">    treeSet.add(<span class="number">1</span>);</span><br><span class="line">    treeSet.add(<span class="number">8</span>);</span><br><span class="line">    treeSet.add(<span class="number">3</span>);</span><br><span class="line">    treeSet.add(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(treeSet);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="æ˜ å°„"><a href="#æ˜ å°„" class="headerlink" title="æ˜ å°„"></a>æ˜ å°„</h3><p>key-valueå­˜å‚¨çš„æ•°æ®ç»“æ„ï¼ŒæŒ‡ä¸¤ç»„æ•°æ®çš„æ˜ å°„å…³ç³»</p><p>é€šè¿‡get()æ–¹æ³•è·å–å€¼ï¼Œé€šè¿‡putæ–¹æ³•è®¾ç½®å€¼ï¼Œé€šè¿‡removeæ–¹æ³•åˆ é™¤å€¼</p><p>â€</p><p>TreeMapé€šè¿‡ä¸€å®šçš„é¡ºåºæ¥ç»„ç»‡å…ƒç´ ï¼Œè€ŒHashMapé‡Œçš„å…ƒç´ åˆ™æ˜¯æ— åºçš„</p><p>TreeMapå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">treeMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    treeMap.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;Yasuo&quot;</span>);</span><br><span class="line">    treeMap.put(<span class="string">&quot;8&quot;</span>, <span class="string">&quot;Ashe&quot;</span>);</span><br><span class="line">    treeMap.put(<span class="string">&quot;5&quot;</span>,<span class="string">&quot;NuNu&quot;</span>);</span><br><span class="line">    treeMap.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;Zed&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(treeMap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–é”®é›†åˆ</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">keys</span> <span class="operator">=</span> treeMap.keySet();</span><br><span class="line">    System.out.println(<span class="string">&quot;All keys: &quot;</span> + keys.toString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å€¼é›†åˆ</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">values</span> <span class="operator">=</span> treeMap.values();</span><br><span class="line">    System.out.println(<span class="string">&quot;All values: &quot;</span> + values.toString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–é”®&amp;å€¼é›†åˆ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;All Key &amp; Value: &quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">entrySet</span> <span class="operator">=</span> treeMap.entrySet();</span><br><span class="line">    treeMap.forEach((k,v) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;key: &quot;</span> + k + <span class="string">&quot; value: &quot;</span> + v);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="é“¾æ¥æ•£åˆ—é›†ä¸æ˜ å°„"><a href="#é“¾æ¥æ•£åˆ—é›†ä¸æ˜ å°„" class="headerlink" title="é“¾æ¥æ•£åˆ—é›†ä¸æ˜ å°„"></a>é“¾æ¥æ•£åˆ—é›†ä¸æ˜ å°„</h3><p>#TODO# LinkedHashSet &amp; LinkedHashMap</p><p>â€</p><h4 id="å®ç°LRUç¼“å­˜"><a href="#å®ç°LRUç¼“å­˜" class="headerlink" title="å®ç°LRUç¼“å­˜"></a>å®ç°LRUç¼“å­˜</h4><p>LRU(Least Recently Used)ç¼“å­˜ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œé¡µé¢è¢«ç½®æ¢</p><p>ä¸ºä»€ä¹ˆé€‰æ‹©LinkedHashMap</p><ul><li>é“¾è¡¨èƒ½å¤Ÿå®ç°é˜Ÿåˆ—ï¼Œå®Œæˆå…ˆè¿›å…ˆå‡ºçš„é€»è¾‘</li><li>&lt;K,V&gt;çš„æ˜ å°„èƒ½å¤Ÿé€šè¿‡Keyæ¥ç´¢å¼•æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ LinkedHashMap å®ç°LRUç¼“å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span>&lt;K, V&gt; <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;K&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    LinkedHashMap&lt;K, V&gt; cache = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cache</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®LRUï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œåˆ™å…ˆåˆ é™¤ï¼Œç„¶åä»æœ€å³è¾¹å…¥é˜Ÿ</span></span><br><span class="line">        <span class="keyword">if</span> (cache.containsKey(key)) &#123;</span><br><span class="line">            cache.remove(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“cacheå·²æ»¡ï¼Œç§»é™¤æœ€å·¦è¾¹çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cache.size() &gt;= MAX) &#123;</span><br><span class="line">            <span class="comment">// è·å–è¿­ä»£å™¨</span></span><br><span class="line">            <span class="type">var</span> <span class="variable">it</span> <span class="operator">=</span> cache.keySet().iterator();</span><br><span class="line">            <span class="comment">// é€šè¿‡è¿­ä»£å™¨è·å–ç¬¬ä¸€ä½å…ƒç´ ï¼ˆå³æœ€å·¦è¾¹å…ƒç´ ï¼‰ï¼Œå¹¶ç§»é™¤</span></span><br><span class="line">            <span class="type">var</span> <span class="variable">first</span> <span class="operator">=</span> it.next();</span><br><span class="line">            cache.remove(first);</span><br><span class="line">        &#125;</span><br><span class="line">        cache.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;K&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">it</span> <span class="operator">=</span> cache.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;K&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> it.hasNext();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> K <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> it.next().getKey();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// main function</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">lru</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LRUCache</span>&lt;String, Integer&gt;();</span><br><span class="line">        lru.cache(<span class="string">&quot;A&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        lru.cache(<span class="string">&quot;B&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        lru.cache(<span class="string">&quot;C&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        lru.cache(<span class="string">&quot;D&quot;</span>, <span class="number">4</span>);</span><br><span class="line">        lru.cache(<span class="string">&quot;C&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">&quot;leave &lt;-&quot;</span> +</span><br><span class="line">                StreamSupport.stream(lru.spliterator(), <span class="literal">false</span>)</span><br><span class="line">                        .map(x -&gt; x.toString())</span><br><span class="line">                        .collect(Collectors.joining(<span class="string">&quot;&lt;-&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="HashMap-HashTable"><a href="#HashMap-HashTable" class="headerlink" title="HashMap &amp; HashTable"></a>HashMap &amp; HashTable</h3><p>#TODO# HashMap &amp; HashTable</p><p>â€</p><h2 id="å®¹å™¨çš„å·¥å‚æ–¹æ³•"><a href="#å®¹å™¨çš„å·¥å‚æ–¹æ³•" class="headerlink" title="å®¹å™¨çš„å·¥å‚æ–¹æ³•"></a>å®¹å™¨çš„å·¥å‚æ–¹æ³•</h2><p><strong>Java9</strong> æ–°ç‰¹æ€§ï¼š<code>of</code>ä¸<code>ofEntries</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List</span></span><br><span class="line">    <span class="comment">// è¯¥Listæ˜¯å¯å˜çš„</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(List.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set</span></span><br><span class="line">    <span class="type">var</span>  <span class="variable">set</span> <span class="operator">=</span> Set.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Map</span></span><br><span class="line">    Map&lt;String,Integer&gt; map = ofEntries(</span><br><span class="line">            entry(<span class="string">&quot;Ashe&quot;</span>,<span class="number">1</span>),</span><br><span class="line">            entry(<span class="string">&quot;Zed&quot;</span>,<span class="number">2</span>),</span><br><span class="line">            entry(<span class="string">&quot;Yasuo&quot;</span>,<span class="number">3</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå·¥å‚æ–¹æ³•åˆ›å»ºå‡ºæ¥çš„é›†åˆå¯¹è±¡éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯ä»¥ä¸‹æ–¹å¼å¯ä»¥æ„é€ ä¸€ä¸ªå¯å˜çš„é›†åˆ</p><blockquote><p>var list &#x3D; new ArrayList&lt;&gt;(List.of(1,2,3,4,5));</p></blockquote><p>â€</p><h4 id="Arrays-asList"><a href="#Arrays-asList" class="headerlink" title="Arrays.asList"></a>Arrays.asList</h4><p>Arrays.asList è¢«ç§°ä¸ºä¸å¯å˜é›†åˆï¼Œè¯¥é›†åˆä¸­å…ƒç´ å¯ä»¥æ›´æ”¹ï¼Œä½†æ˜¯å¤§å°ä¸å¯å˜</p><p>1.é€šè¿‡ <code>Arrays.asList()</code> æ–¹æ³•æ„é€ å‡ºæ¥çš„listï¼Œä¸èƒ½æ‰§è¡Œ<code>add()</code>å’Œ<code>remove()</code>ã€‚</p><p>è¿™é‡Œçš„listï¼Œå¹¶é java.util.ArrayListï¼Œå®ƒæ²¡æœ‰é‡å†™çˆ¶ç±»<code>AbstractList</code>çš„æ–¹æ³•ã€‚</p><p><img src="/2019/11/17/Java%E9%9B%86%E5%90%88/image-20210322163538-uypfrz0.png" alt="image.png"></p><p>2.å¦‚æœä½¿ç”¨<code>Arrays.asList()</code>ç”Ÿæˆæ–°çš„æ•°ç»„ï¼Œé‚£ä¹ˆä¿®æ”¹çš„å†…å®¹ä¹Ÿä¼šåŒæ­¥å½±å“åˆ°æ—§æ•°ç»„ä¸Šã€‚</p><p><img src="/2019/11/17/Java%E9%9B%86%E5%90%88/image-20210322164604-bouxtrz.png" alt="image.png"></p><p>æ€»ç»“ï¼šå°½é‡ç”¨äºæµ‹è¯•ï¼Œä¸è¦ç”¨äºå¼€å‘ä¸šåŠ¡ä¸Šã€‚</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Core </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
