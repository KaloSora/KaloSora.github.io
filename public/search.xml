<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>从BIEE 12看数据仓库(一)</title>
      <link href="/2020/06/19/%E4%BB%8EBIEE%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93(%E4%B8%80)/"/>
      <url>/2020/06/19/%E4%BB%8EBIEE%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h1 id="从BIEE-12看数据仓库（一）"><a href="#从BIEE-12看数据仓库（一）" class="headerlink" title="从BIEE 12看数据仓库（一）"></a>从BIEE 12看数据仓库（一）</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h4 id="OLTP"><a href="#OLTP" class="headerlink" title="OLTP"></a>OLTP</h4><ul><li><p>OLTP即联机事务处理(On-Line Transaction Processing)，主要指发生在<strong>操作型系统</strong>上的面向事务的操作，这里的事务特指业务上的统一且不可分割的一系列操作，而不是数据库中增删改查的单个原子操作。</p></li><li><p>OLTP经常触发CRUD操作（CRUD是指在做计算处理时的增加(Create)、读取查询(Retrieve)、更新(Update)和删除(Delete)），是插入和更新密集型操作，要求（超）高并发，响应快。</p><p><strong>ORCALE EBS</strong>系统就是一个例子：用户在订单管理器创建订单，供应商的可用余额扣减，库存的可用量也同时扣减。从数据库角度上看，涉及到两个表（简化模型，实际涉及多张表）的更新操作，也就是发生了两个单独的update；但是从业务的角度上来说，这是同一个事务，即更新供应商余额和扣减库存必须同时成功，其中一个失败，整个事务必须回滚到处理前的结果。</p></li></ul><h4 id="OLAP"><a href="#OLAP" class="headerlink" title="OLAP"></a>OLAP</h4><ul><li><p>OLAP即联机分析处理(On-Line Analytical Processing)，主要指发生在<strong>分析型系统</strong>上的面向多维度查询操作，通常在装载数据前需要清洗和转换。</p></li><li><p>OLAP处理的事务相对<strong>操作型系统</strong>来说较少，但是查询通常对历史的、归档的数据进行非常复杂的逻辑，如聚合计算，大量表关联等，属于查询密集型操作，要求能够体现多维度，多主题，高整合度，能够反映变化趋势的数据。</p><p><strong>ORACLE BIEE</strong>上展现报表诸如<strong>库存账龄、追溯库存历史、现金流</strong>等，是对整个数据库业务数据的高度检索，能够反映出业务数据的同比（去年同期）和环比(同年不同季)。</p></li></ul><table><thead><tr><th>对比项</th><th>OLAP</th><th>OLTP</th></tr></thead><tbody><tr><td>数据源</td><td>可能来源于多个不同的业务系统，主要是历史、归档的数据</td><td>当前系统业务操作的所有明细记录都要保存</td></tr><tr><td>操作</td><td>注重于大量表的查询和聚合计算，数据装载量大</td><td>注重更新和插入，要求执行速度快，并发量大</td></tr><tr><td>应用</td><td>决策支持系统，报表分析系统</td><td>在线的交易、管理系统</td></tr><tr><td>用户</td><td>管理人员、分析人员</td><td>终端用户</td></tr><tr><td>数据模型</td><td>雪花型或星型模型</td><td>实体关系模型</td></tr><tr><td>备份</td><td>按天增量同步，若数据丢失需要从操作型系统重新装载</td><td>全量定期备份，数据不可丢失</td></tr><tr><td>时间</td><td>以年为单位</td><td>从天到年</td></tr><tr><td>空间要求</td><td>存放多个系统的数据的数据仓库，空间要求大</td><td>仅存放当前操作数据，空间要求小</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="数据仓库定义"><a href="#数据仓库定义" class="headerlink" title="数据仓库定义"></a>数据仓库定义</h4><p>数据仓库描述为一个面向主题的、集成的、随时间变化的、非易失的数据集合,用于支持管理者的决策过程。数据仓库通过抽取一个或多个系统的数据，经过清洗、转换装载到新的数据库中，它是OLAP的基础。</p><h5 id="数据仓库的必要性"><a href="#数据仓库的必要性" class="headerlink" title="数据仓库的必要性"></a>数据仓库的必要性</h5><ul><li>数据的类型非常多，除了不同数据库需要特定的一个仓库兼容以外，还有各种各样的文件类型（如xls、csv、html、xml等）</li><li>出于权限控制的要求，一个用户不能同时访问多个系统或多个数据表</li><li>用户需要看的字段，在数据库中可能需要一定的转换才能呈现，而每次发生业务变更后可能都需要额外编写这些字段，导致工作重复</li><li>系统以联机事务处理为主，频繁访问分析数据，可能会导致性能变差</li></ul><h5 id="数据仓库的特性"><a href="#数据仓库的特性" class="headerlink" title="数据仓库的特性"></a>数据仓库的特性</h5><ul><li>面向主题：拥有通过划分主题定义数据仓库的能力</li><li>集成：即面对多个系统、多个数据库，能够统一转换后存放在一起。同时能够解决命名冲突的问题</li><li>随时间变化：数据仓库关注的是数据随时间变化的情况,并且能反映在过去某个时间点的数据是怎样的。</li><li>稳定：一旦进入到数据仓库中,数据就不应该再有改变。</li><li>粒度：粒度之所以是数据仓库环境的关键设计问题,是因为它极大地影响数据仓库的数据量和可以进行的查询类型。粒度级别越低,数据量越大,查询的细节程度越高,查询范围越广泛,反之亦然。</li></ul><h2 id="数据仓库概念设计"><a href="#数据仓库概念设计" class="headerlink" title="数据仓库概念设计"></a>数据仓库概念设计</h2><h4 id="基本架构"><a href="#基本架构" class="headerlink" title="基本架构"></a>基本架构</h4><img src="/2020/06/19/%E4%BB%8EBIEE%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93(%E4%B8%80)/BIEE%E6%9E%B6%E6%9E%84.jpg" class><h4 id="数据需求"><a href="#数据需求" class="headerlink" title="数据需求"></a>数据需求</h4><h5 id="事实和维度"><a href="#事实和维度" class="headerlink" title="事实和维度"></a>事实和维度</h5><ol><li>明确业务范围，想清楚要设立的主题有哪些，主题下面的分析表有多少，然后确定装载数据的ER实体关系，每一个实体关系就是一个事实。</li><li>明确维度指标的范围，维度的范围随着业务范围改变而改变。<br>财务主题常用的维度一般有账龄、帐簿、成本中心、会计科目、法人、经营单位、客户、供应商、供应商地点、位置、销售员等；<br>库存主题常用的维度一般有物料、库存组织、子库存、货位、批次号、物料账龄等；<br>通用的维度一般有时间维度，按年月日存放。</li><li>明确事实表所选用的数据模型，一般从星型和和雪花型中选择。在雪花模式中,一个维度被规范化成多个关联的表,而在星型模式中,每个维度由一个单一的维度表所表示。<br>例如：单一的时间维度，在星型模型中，包含年份、月份、天，都存放在同一个表里，而雪花型中区分为年份维，月份维和天数维；产品维度分解成产品分类、产品两个表。</li></ol><h5 id="数据需求-1"><a href="#数据需求-1" class="headerlink" title="数据需求"></a>数据需求</h5><ol><li>时效性：明确时间粒度，对于时效性较强的数据，抓取的数据频率要提高，但是对于分析型系统而言一般不需要很强的实时性，一般把抓取数据的频率定为以一天为粒度。</li><li>追溯性：从业务系统中生成到BIEE的分析表要根据实际情况，部分分析表会有查询到某一历史事件点的需求。</li></ol>]]></content>
      
      
      <categories>
          
          <category> ORACLE BIEE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DATAWARE HOUSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ORACLE EBS 发票接口</title>
      <link href="/2020/05/21/AP%20%E5%8F%91%E7%A5%A8/"/>
      <url>/2020/05/21/AP%20%E5%8F%91%E7%A5%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="ORACLE-EBS-API"><a href="#ORACLE-EBS-API" class="headerlink" title="ORACLE EBS API"></a>ORACLE EBS API</h1><h2 id="AP-发票接口"><a href="#AP-发票接口" class="headerlink" title="AP 发票接口"></a>AP 发票接口</h2><h4 id="接口功能"><a href="#接口功能" class="headerlink" title="接口功能"></a>接口功能</h4><ol><li>从外围系统导入发票到ORACLE EBS系统</li><li>从外围系统对ORACLE EBS中可用状态的发票进行核销(R12新增)</li></ol><h4 id="开发参考"><a href="#开发参考" class="headerlink" title="开发参考"></a>开发参考</h4><h5 id="目标表"><a href="#目标表" class="headerlink" title="目标表"></a>目标表</h5><table><thead><tr><th>表名</th><th>说明</th></tr></thead><tbody><tr><td>AP_INVOICES_ALL</td><td>发票头表</td></tr><tr><td>AP_INVOICE_LINES_ALL</td><td>发票行表</td></tr><tr><td>AP_INVOICE_DISTRIBUTIONS_ALL</td><td>发票分配表，根据行上的会计科目进行汇总</td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="并发程序"><a href="#并发程序" class="headerlink" title="并发程序"></a>并发程序</h5><table><thead><tr><th>标题</th><th>路径</th><th>内容</th></tr></thead><tbody><tr><td>职责</td><td>/</td><td>应付款系统管理员</td></tr><tr><td>功能</td><td>发票/录入/发票</td><td>创建、验证发票，为发票创建会计科目，传输发票至总帐</td></tr><tr><td>并发</td><td>应付款管理系统开放接口导入</td><td>把发票接口表里的数据传送至EBS发票表</td></tr><tr><td>并发</td><td>发票验证</td><td>验证发票内容是否正常</td></tr><tr><td>文档</td><td><a href="https://docs.oracle.com/cd/E18727_01/doc.121/e12797/T295436T366808.htm#I_prepayx2Dopen" target="_blank" rel="noopener">https://docs.oracle.com/cd/E18727_01/doc.121/e12797/T295436T366808.htm#I_prepayx2Dopen</a></td><td>ORACLE EBS 应付用户手册</td></tr><tr><td>文档</td><td><a href="https://docs.oracle.com/cd/E18727_01/doc.121/e12796/T434602T367248.htm#I_ox2Dacctolay" target="_blank" rel="noopener">https://docs.oracle.com/cd/E18727_01/doc.121/e12796/T434602T367248.htm#I_ox2Dacctolay</a></td><td>ORACLE EBS 开放接口手册</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h5 id="接口信息"><a href="#接口信息" class="headerlink" title="接口信息"></a>接口信息</h5><table><thead><tr><th>表名</th><th>说明</th></tr></thead><tbody><tr><td>ap_invoices_interface</td><td>发票头表，生成的信息对应AP_INVOICES_ALL</td></tr><tr><td>ap_invoice_lines_interface</td><td>发票行表，记录会计科目、金额、会计日期等，生成的信息对应AP_INVOICE_LINES_ALL和AP_INVOICE_DISTRIBUTIONS_ALL</td></tr><tr><td>ap_interface_rejections</td><td>记录发票错误信息<br>发票头错误，parent_table为AP_INVOICES_INTERFACE，parent_id关联ap_invoices_interface的invoice_id<br>发票行错误，parent_table为AP_INVOICE_LINES_INTERFACE，parent_id关联ap_invoice_lines_interface的INVOICE_LINE_ID</td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="程序要点"><a href="#程序要点" class="headerlink" title="程序要点"></a>程序要点</h4><h5 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h5><h6 id="会计期"><a href="#会计期" class="headerlink" title="会计期"></a>会计期</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--l_cnt &lt; 1则校验失败</span><br><span class="line">SELECT COUNT(1)</span><br><span class="line">  INTO l_cnt</span><br><span class="line">  FROM gl_period_statuses    gps,</span><br><span class="line">       hr_operating_units    hou</span><br><span class="line"> WHERE gps.application_id &#x3D; 200</span><br><span class="line">   AND gpa.period_name &#x3D; gps.period_name</span><br><span class="line">   AND gps.start_date &lt;&#x3D; trunc(p_gl_date)</span><br><span class="line">   AND gps.end_date &gt;&#x3D; trunc(p_gl_date)</span><br><span class="line">   AND gps.closing_status &#x3D; &#39;O&#39; --会计期打开</span><br><span class="line">   AND hou.short_code &#x3D; p_org_code;</span><br></pre></td></tr></table></figure><h6 id="供应商"><a href="#供应商" class="headerlink" title="供应商"></a>供应商</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--l_cnt &lt; 1则校验失败</span><br><span class="line">SELECT COUNT(1), ass.vendor_name, ass.segment1</span><br><span class="line">  INTO l_cnt, l_vendor_name, l_vendor_code</span><br><span class="line">  FROM ap_supplier_sites_all assa， ap_suppliers ass</span><br><span class="line"> WHERE 1 &#x3D; 1</span><br><span class="line">   AND assa.vendor_id &#x3D; ass.vendor_id</span><br><span class="line">   AND assa.vendor_site_id &#x3D; p_vendor_site_id</span><br><span class="line">   AND assa.org_id &#x3D; p_org_id</span><br><span class="line"> GROUP BY ass.vendor_name, ass.segment1;</span><br></pre></td></tr></table></figure><h6 id="币种"><a href="#币种" class="headerlink" title="币种"></a>币种</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--l_cnt &lt; 1则校验失败</span><br><span class="line">SELECT COUNT(1)</span><br><span class="line">  INTO l_cnt</span><br><span class="line">  FROM fnd_currencies_vl fc, gl_daily_rates gd</span><br><span class="line"> WHERE 1 &#x3D; 1</span><br><span class="line">   AND gd.from_currency &#x3D; fc.currency_code</span><br><span class="line">   AND fc.currency_code &#x3D; p_currency_code;</span><br></pre></td></tr></table></figure><h5 id="发票头接口表"><a href="#发票头接口表" class="headerlink" title="发票头接口表"></a>发票头接口表</h5><p>ap_invoices_interface</p><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>last_update_date</td><td>更新日期</td></tr><tr><td>last_updated_by</td><td>更新人</td></tr><tr><td>creation_date</td><td>创建日期</td></tr><tr><td>created_by</td><td>创建人</td></tr><tr><td>last_update_login</td><td>最后登录id，取自fnd_global.login_id</td></tr><tr><td>request_id</td><td>当前请求id，取自fnd_global.conc_request_id</td></tr><tr><td>invoice_id</td><td>发票id，取自ap_invoices_interface_s.nextval</td></tr><tr><td>invoice_num</td><td>发票编号</td></tr><tr><td>invoice_type_lookup_code</td><td>发票类型，fnd_lookup_values.LOOKUP_TYPE = ‘INVOICE TYPE’<br>CREDIT类型的发票为红冲发票，金额要为负数<br>冲销时针对供应商而不是单张发票</td></tr><tr><td>invoice_date</td><td>发票日期</td></tr><tr><td>gl_date</td><td>总帐日期</td></tr><tr><td>vendor_id</td><td>供应商头id，必须为启用的供应商</td></tr><tr><td>vendor_site_id</td><td>供应商行id，必须为启用的供应商地点</td></tr><tr><td>invoice_amount</td><td>发票金额</td></tr><tr><td>invoice_currency_code</td><td>发票币种，如果不是CNY，则exchange_rate_XXX等的三个字段必填</td></tr><tr><td>source</td><td>来源，随便给</td></tr><tr><td>group_id</td><td>组id，随便给，也可以同invoice_id</td></tr><tr><td>org_id</td><td>业务实体id</td></tr><tr><td>exchange_rate_type</td><td>如果invoice_currency_code不是CNY则必填</td></tr><tr><td>exchange_date</td><td>同上</td></tr><tr><td>exchange_rate</td><td>同上</td></tr><tr><td>payment_method_code</td><td>付款方法</td></tr><tr><td>description</td><td>备注</td></tr><tr><td>terms_id</td><td>到期日id，来自ap_terms.term_id</td></tr><tr><td>pay_group_lookup_code</td><td>支付组，不同的外围系统可以给不同的支付组<br>fnd_lookup_values.LOOKUP_TYPE = ‘PAY GROUP’</td></tr><tr><td>prepay_num</td><td>核销字段，核销发票号，发票必须为可用状态</td></tr><tr><td>prepay_apply_amount</td><td>核销金额</td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="发票行接口表"><a href="#发票行接口表" class="headerlink" title="发票行接口表"></a>发票行接口表</h5><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>invoice_line_id</td><td>行ID，来自ap_invoice_lines_interface_s.nextval</td></tr><tr><td>org_id</td><td>业务实体id</td></tr><tr><td>invoice_id</td><td>头id，同ap_invoices_interface.invoice_id</td></tr><tr><td>accounting_date</td><td>会计日期</td></tr><tr><td>line_number</td><td>发票行号</td></tr><tr><td>line_type_lookup_code</td><td>fnd_lookup_values.LOOKUP_TYPE = ‘INVOICE LINE TYPE’</td></tr><tr><td>amount</td><td>行金额，行金额的合计必须等于头金额</td></tr><tr><td>dist_code_combination_id</td><td>会计科目id，必须为gl_code_combinations_kfv中已存在且启用的科目组合</td></tr><tr><td>dist_code_concatenated</td><td>会计科目组合</td></tr><tr><td>description</td><td>行备注</td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="导入前准备"><a href="#导入前准备" class="headerlink" title="导入前准备"></a>导入前准备</h5><p>必须先初始化环境，并且解除安全性。避免在发票导入、生成会计科目以及调用验证发票请求时遇到不必要的错误。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SELECT user_id</span><br><span class="line">  INTO global_user_id</span><br><span class="line">  FROM applsys.fnd_user</span><br><span class="line"> WHERE user_name &#x3D; &#39;10_ITJOB&#39;;</span><br><span class="line">SELECT responsibility_id</span><br><span class="line">  INTO global_resp_id</span><br><span class="line">  FROM apps.fnd_responsibility_tl</span><br><span class="line"> WHERE responsibility_name &#x3D; &#39;应付款系统管理员&#39;;</span><br><span class="line">SELECT application_id</span><br><span class="line">  INTO global_resp_appl_id</span><br><span class="line">  FROM applsys.fnd_application</span><br><span class="line"> WHERE application_short_name &#x3D; &#39;SQLAP&#39;;</span><br><span class="line">  </span><br><span class="line">--初始化 </span><br><span class="line">fnd_global.apps_initialize(user_id      &#x3D;&gt; global_user_id, --用户ID</span><br><span class="line">                           resp_id      &#x3D;&gt; global_resp_id, --责任ID</span><br><span class="line">                           resp_appl_id &#x3D;&gt; global_resp_appl_id); --应用ID</span><br><span class="line">mo_global.init(&#39;M&#39;);</span><br></pre></td></tr></table></figure><h5 id="自动创建会计科目"><a href="#自动创建会计科目" class="headerlink" title="自动创建会计科目"></a>自动创建会计科目</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">-- Author  : LYH</span><br><span class="line">-- Created : 2018&#x2F;9&#x2F;5 15:52:15</span><br><span class="line">-- Purpose : 校验-生成科目组合  </span><br><span class="line">PROCEDURE vld_ccid(p_code_combination IN VARCHAR2,</span><br><span class="line">                   p_legder_id        IN NUMBER,</span><br><span class="line">                   x_return_status    OUT VARCHAR2,</span><br><span class="line">                   x_msg_data         OUT VARCHAR2) IS</span><br><span class="line">  l_ccid                gl_code_combinations_kfv.code_combination_id%TYPE :&#x3D; 0;</span><br><span class="line">  l_chart_of_account_id fnd_id_flex_structures.id_flex_num%TYPE;</span><br><span class="line"></span><br><span class="line">  --保存消息</span><br><span class="line">  iscreate  BOOLEAN :&#x3D; FALSE;</span><br><span class="line">  isvalid   BOOLEAN :&#x3D; FALSE;</span><br><span class="line">  createmsg VARCHAR2(255);</span><br><span class="line">  validmsg  VARCHAR2(255);</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">  SELECT gl.chart_of_accounts_id</span><br><span class="line">    INTO l_chart_of_account_id</span><br><span class="line">    FROM gl_ledgers gl</span><br><span class="line">   WHERE gl.ledger_id &#x3D; p_legder_id;</span><br><span class="line"></span><br><span class="line">  SELECT gcc.code_combination_id</span><br><span class="line">    INTO l_ccid</span><br><span class="line">    FROM gl_code_combinations_kfv gcc</span><br><span class="line">   WHERE gcc.concatenated_segments &#x3D; p_code_combination</span><br><span class="line">     AND gcc.enabled_flag &#x3D; &#39;Y&#39;;</span><br><span class="line"></span><br><span class="line">  IF (l_ccid &lt; 1) OR l_ccid IS NULL THEN</span><br><span class="line">    --启动ccid自动生成程序</span><br><span class="line">    isvalid  :&#x3D; fnd_flex_keyval.validate_segs(operation        &#x3D;&gt; &#39;CHECK_COMBINATION&#39;,</span><br><span class="line">                                              appl_short_name  &#x3D;&gt; &#39;SQLGL&#39;,</span><br><span class="line">                                              key_flex_code    &#x3D;&gt; &#39;GL#&#39;,</span><br><span class="line">                                              structure_number &#x3D;&gt; l_chart_of_account_id,</span><br><span class="line">                                              concat_segments  &#x3D;&gt; p_code_combination);</span><br><span class="line">    validmsg :&#x3D; fnd_flex_keyval.error_message;</span><br><span class="line">  </span><br><span class="line">    IF isvalid THEN</span><br><span class="line">      --通过校验，则自动生成</span><br><span class="line">      iscreate  :&#x3D; fnd_flex_keyval.validate_segs(operation        &#x3D;&gt; &#39;CREATE_COMBINATION&#39;,</span><br><span class="line">                                                 appl_short_name  &#x3D;&gt; &#39;SQLGL&#39;,</span><br><span class="line">                                                 key_flex_code    &#x3D;&gt; &#39;GL#&#39;,</span><br><span class="line">                                                 structure_number &#x3D;&gt; l_chart_of_account_id,</span><br><span class="line">                                                 concat_segments  &#x3D;&gt; p_code_combination);</span><br><span class="line">      createmsg :&#x3D; fnd_flex_keyval.error_message;</span><br><span class="line">    </span><br><span class="line">      --生成成功，重新获取</span><br><span class="line">      IF iscreate THEN</span><br><span class="line">        BEGIN</span><br><span class="line">          SELECT gcc.code_combination_id</span><br><span class="line">            INTO l_ccid</span><br><span class="line">            FROM gl_code_combinations_kfv gcc</span><br><span class="line">           WHERE gcc.concatenated_segments &#x3D; p_code_combination</span><br><span class="line">             AND gcc.enabled_flag &#x3D; &#39;Y&#39;;</span><br><span class="line">        EXCEPTION</span><br><span class="line">          WHEN OTHERS THEN</span><br><span class="line">            --生成失败</span><br><span class="line">            x_return_status :&#x3D; g_error;</span><br><span class="line">          </span><br><span class="line">            fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                                 NAME        &#x3D;&gt; &#39;GJ_CODE_CREATE_ERROR&#39;);</span><br><span class="line">            x_msg_data :&#x3D; fnd_message.get || createmsg;</span><br><span class="line">            RETURN;</span><br><span class="line">        END;</span><br><span class="line">      ELSE</span><br><span class="line">        --校验失败，非法科目</span><br><span class="line">        x_return_status :&#x3D; g_error;</span><br><span class="line">      </span><br><span class="line">        fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                             NAME        &#x3D;&gt; &#39;GJ_CODE_VALID_ERROR&#39;);</span><br><span class="line">      </span><br><span class="line">        --x_msg_data :&#x3D; fnd_message.get || validmsg;</span><br><span class="line">        x_msg_data :&#x3D; &#39;科目校验失败：&#39; || validmsg;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">    ELSE</span><br><span class="line">      --校验失败,非法的科目</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">    </span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_COMBINATION_CODE_NOT_VALID&#39;);</span><br><span class="line">    </span><br><span class="line">      --x_msg_data :&#x3D; fnd_message.get || validmsg;</span><br><span class="line">      x_msg_data :&#x3D; &#39;无效的分配账户：&#39; || validmsg;</span><br><span class="line">    END IF;</span><br><span class="line">  END IF;</span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">  WHEN OTHERS THEN</span><br><span class="line">    --启动ccid自动生成程序</span><br><span class="line">    isvalid  :&#x3D; fnd_flex_keyval.validate_segs(operation        &#x3D;&gt; &#39;CHECK_COMBINATION&#39;,</span><br><span class="line">                                              appl_short_name  &#x3D;&gt; &#39;SQLGL&#39;,</span><br><span class="line">                                              key_flex_code    &#x3D;&gt; &#39;GL#&#39;,</span><br><span class="line">                                              structure_number &#x3D;&gt; l_chart_of_account_id,</span><br><span class="line">                                              concat_segments  &#x3D;&gt; p_code_combination);</span><br><span class="line">    validmsg :&#x3D; fnd_flex_keyval.error_message;</span><br><span class="line">  </span><br><span class="line">    IF isvalid THEN</span><br><span class="line">      --通过校验，则自动生成</span><br><span class="line">      iscreate  :&#x3D; fnd_flex_keyval.validate_segs(operation        &#x3D;&gt; &#39;CREATE_COMBINATION&#39;,</span><br><span class="line">                                                 appl_short_name  &#x3D;&gt; &#39;SQLGL&#39;,</span><br><span class="line">                                                 key_flex_code    &#x3D;&gt; &#39;GL#&#39;,</span><br><span class="line">                                                 structure_number &#x3D;&gt; l_chart_of_account_id,</span><br><span class="line">                                                 concat_segments  &#x3D;&gt; p_code_combination);</span><br><span class="line">      createmsg :&#x3D; fnd_flex_keyval.error_message;</span><br><span class="line">    </span><br><span class="line">      --生成成功，重新获取</span><br><span class="line">      IF iscreate THEN</span><br><span class="line">        BEGIN</span><br><span class="line">          SELECT gcc.code_combination_id</span><br><span class="line">            INTO l_ccid</span><br><span class="line">            FROM gl_code_combinations_kfv gcc</span><br><span class="line">           WHERE gcc.concatenated_segments &#x3D; p_code_combination</span><br><span class="line">             AND gcc.enabled_flag &#x3D; &#39;Y&#39;;</span><br><span class="line">        EXCEPTION</span><br><span class="line">          WHEN OTHERS THEN</span><br><span class="line">            --生成失败</span><br><span class="line">            x_return_status :&#x3D; g_error;</span><br><span class="line">          </span><br><span class="line">            fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                                 NAME        &#x3D;&gt; &#39;GJ_CODE_CREATE_ERROR&#39;);</span><br><span class="line">            x_msg_data :&#x3D; fnd_message.get || createmsg;</span><br><span class="line">            RETURN;</span><br><span class="line">        END;</span><br><span class="line">      ELSE</span><br><span class="line">        --校验失败，非法科目</span><br><span class="line">        x_return_status :&#x3D; g_error;</span><br><span class="line">      </span><br><span class="line">        fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                             NAME        &#x3D;&gt; &#39;GJ_CODE_VALID_ERROR&#39;);</span><br><span class="line">      </span><br><span class="line">        x_msg_data :&#x3D; fnd_message.get || validmsg;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">    ELSE</span><br><span class="line">      --校验失败,非法的科目</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">    </span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_COMBINATION_CODE_NOT_VALID&#39;);</span><br><span class="line">    </span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get || validmsg;</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">END vld_ccid;</span><br></pre></td></tr></table></figure><h5 id="发票自动验证"><a href="#发票自动验证" class="headerlink" title="发票自动验证"></a>发票自动验证</h5><p>提交请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">l_request_id :&#x3D; fnd_request.submit_request(&#39;SQLAP&#39;, --应用名称</span><br><span class="line">                                               &#39;APPRVL&#39;, --功能名称</span><br><span class="line">                                               &#39;&#39;, --请求备注</span><br><span class="line">                                               SYSDATE, --运行时间</span><br><span class="line">                                               FALSE,</span><br><span class="line">                                               NULL, --OU</span><br><span class="line">                                               &#39;All&#39;, --匹配行</span><br><span class="line">                                               NULL, --发票批</span><br><span class="line">                                               NULL, --起始发票日期</span><br><span class="line">                                               NULL, --终止发票日期</span><br><span class="line">                                               NULL, --供应商</span><br><span class="line">                                               &#39;FSSC支付组&#39;, --支付组,统一对共享平台发票成批验证</span><br><span class="line">                                               NULL, --发票编号</span><br><span class="line">                                               NULL,</span><br><span class="line">                                               &#39;N&#39;,</span><br><span class="line">                                               NULL,</span><br><span class="line">                                               1000,</span><br><span class="line">                                               &#39;N&#39;);</span><br><span class="line">    --等待请求                                          </span><br><span class="line">    IF l_request_id &lt;&gt; 0 THEN</span><br><span class="line">      l_request_status :&#x3D; fnd_concurrent.wait_for_request(l_request_id,</span><br><span class="line">                                                          5,</span><br><span class="line">                                                          0,</span><br><span class="line">                                                          l_phase,</span><br><span class="line">                                                          l_status,</span><br><span class="line">                                                          l_dev_phase,</span><br><span class="line">                                                          l_dev_status,</span><br><span class="line">                                                          l_message);</span><br><span class="line">     END IF;</span><br></pre></td></tr></table></figure><p>获取发票状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ap_invoices_pkg.get_approval_status(invoice_id,</span><br><span class="line">                                                                               invoice_amount,</span><br><span class="line">                                                                               payment_status_flag,</span><br><span class="line">                                                                               invoice_type_lookup_code)</span><br></pre></td></tr></table></figure><h5 id="查看接口错误信息"><a href="#查看接口错误信息" class="headerlink" title="查看接口错误信息"></a>查看接口错误信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">SELECT h.header_id,</span><br><span class="line">       l.line_id,</span><br><span class="line">       aii.invoice_id,</span><br><span class="line">       aii.invoice_num,</span><br><span class="line">       aii.source,</span><br><span class="line">       nvl(flv.meaning, air.reject_lookup_code) err_msg</span><br><span class="line">  FROM ap_interface_rejections                     air,</span><br><span class="line">       ap_invoices_interface                       aii,</span><br><span class="line">       fnd_lookup_values                           flv,</span><br><span class="line">       ap_interface_headers_all@gj_fsp_middle_prod h,  --中间表头</span><br><span class="line">       ap_interface_lines_all@gj_fsp_middle_prod   l --中间表行</span><br><span class="line"> WHERE 1 &#x3D; 1</span><br><span class="line">   AND h.invoice_number &#x3D; aii.invoice_num</span><br><span class="line">   AND h.header_id &#x3D; l.header_id</span><br><span class="line">   AND air.parent_id &#x3D; aii.invoice_id</span><br><span class="line">   AND air.reject_lookup_code &#x3D; flv.lookup_code(+)</span><br><span class="line">   AND flv.lookup_type(+) &#x3D; &#39;REJECT CODE&#39;</span><br><span class="line">   AND air.parent_table &#x3D; &#39;AP_INVOICES_INTERFACE&#39;</span><br><span class="line">   AND flv.language &#x3D; &#39;ZHS&#39;</span><br><span class="line">   AND h.process_status &#x3D; &#39;PENDING&#39;</span><br><span class="line">   AND aii.source &#x3D; &#39;FSSC&#39;</span><br><span class="line">   AND aii.status &#x3D; &#39;REJECTED&#39;</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT DISTINCT h.header_id,</span><br><span class="line">                l.line_id,</span><br><span class="line">                aii.invoice_id,</span><br><span class="line">                aii.invoice_num,</span><br><span class="line">                aii.source,</span><br><span class="line">                nvl(flv.meaning, air.reject_lookup_code) err_msg</span><br><span class="line">  FROM ap_interface_rejections                     air,</span><br><span class="line">       ap_invoices_interface                       aii,</span><br><span class="line">       ap_invoice_lines_interface                  ail,</span><br><span class="line">       fnd_lookup_values                           flv,</span><br><span class="line">       ap_interface_headers_all@gj_fsp_middle_prod h,</span><br><span class="line">       ap_interface_lines_all@gj_fsp_middle_prod   l</span><br><span class="line"> WHERE 1 &#x3D; 1</span><br><span class="line">   AND h.invoice_number &#x3D; aii.invoice_num</span><br><span class="line">   AND h.header_id &#x3D; l.header_id</span><br><span class="line">   AND air.parent_id &#x3D; ail.INVOICE_LINE_ID</span><br><span class="line">   AND ail.invoice_id &#x3D; aii.invoice_id</span><br><span class="line">   AND air.reject_lookup_code &#x3D; flv.lookup_code(+)</span><br><span class="line">   AND flv.lookup_type(+) &#x3D; &#39;REJECT CODE&#39;</span><br><span class="line">   AND air.parent_table &#x3D; &#39;AP_INVOICE_LINES_INTERFACE&#39;</span><br><span class="line">   AND flv.language &#x3D; &#39;ZHS&#39;</span><br><span class="line">   AND h.process_status &#x3D; &#39;PENDING&#39;</span><br><span class="line">   AND aii.source &#x3D; &#39;FSSC&#39;</span><br><span class="line">   AND aii.status &#x3D; &#39;REJECTED&#39;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ORACLE EBS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ORACLE EBS API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ORACLE EBS 接口处理</title>
      <link href="/2020/05/20/%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86/"/>
      <url>/2020/05/20/%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ORACLE-EBS-API"><a href="#ORACLE-EBS-API" class="headerlink" title="ORACLE EBS API"></a>ORACLE EBS API</h1><h2 id="接口处理"><a href="#接口处理" class="headerlink" title="接口处理"></a>接口处理</h2><h4 id="API处理流程"><a href="#API处理流程" class="headerlink" title="API处理流程"></a>API处理流程</h4><img src="/2020/05/20/%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86/API_PROCESS.png" class><ol><li><p>一般从外部系统过来的数据，首先拉取到中间表和历史表（中间表用于处理数据，历史表用于保存数据）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--处理中间表</span><br><span class="line">gj_bar_so_pick</span><br><span class="line"></span><br><span class="line">--处理历史表</span><br><span class="line">gj_bar_so_pick_his</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li>数据对中间表<u>进行校验</u>，这里一般是把校验写在sql程序里面，避免在erp标准接口中报错</li></ol><img src="/2020/05/20/%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86/validate_data.png" class><img src="/2020/05/20/%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86/validate_data_info.png" class><ol start="3"><li><p>校验完成以后，可能需要把数据回写到中间表和历史表，并且修改处理状态为待处理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">--更新中间表头</span><br><span class="line">UPDATE ap_interface_headers_all@gj_fsp_middle_prod h</span><br><span class="line">       SET h.last_updaeted_by  &#x3D; g_user_name,</span><br><span class="line">           h.last_update_login &#x3D; g_login_id,</span><br><span class="line">           h.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">           h.process_status    &#x3D; p_status,</span><br><span class="line">           h.process_message   &#x3D; p_msg_data</span><br><span class="line">     WHERE h.header_id &#x3D; p_header_id;</span><br><span class="line">  </span><br><span class="line">    --更新中间表行</span><br><span class="line">    UPDATE ap_interface_lines_all@gj_fsp_middle_prod l</span><br><span class="line">       SET l.last_update_login &#x3D; g_login_id,</span><br><span class="line">           l.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">           l.process_status    &#x3D; p_status,</span><br><span class="line">           l.process_message   &#x3D; p_msg_data</span><br><span class="line">     WHERE l.line_id &#x3D; p_line_id;</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>把中间表的数据推送到erp的接口表中，并且调用erp的并发程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">IF l_process_flag &#x3D; &#39;N&#39; THEN</span><br><span class="line">  g_cnt :&#x3D; g_cnt + 1;</span><br><span class="line"></span><br><span class="line">  -- 调用请求</span><br><span class="line">  l_request_id :&#x3D; fnd_request.submit_request(&#39;SQLAP&#39;, --应用简称</span><br><span class="line">                                             &#39;APXIIMPT&#39;, --应用程序</span><br><span class="line">                                             &#39;FSSC INVOICE IMPORT&#39;, --请求说明(可选)</span><br><span class="line">                                             to_char(SYSDATE, --RUN(运行)时间</span><br><span class="line">                                                     &#39;yyyy-mm-dd hh24:mi:ss&#39;),</span><br><span class="line">                                             FALSE, --是否作为子请求提交</span><br><span class="line">                                             l_org_id, --业务实体</span><br><span class="line">                                             &#39;FSSC&#39;, --SOURCE</span><br><span class="line">                                             l_group_id, --Group,</span><br><span class="line">                                             rec_headers.invoice_batch, --Invoice Batch Name</span><br><span class="line">                                             NULL, --Hold Name</span><br><span class="line">                                             NULL, --Hold Reason</span><br><span class="line">                                             NULL, --GL Date</span><br><span class="line">                                             &#39;N&#39;, --Purge  是否清除</span><br><span class="line">                                             &#39;N&#39;); --Summarize Report 是否打印汇总报表</span><br><span class="line"></span><br><span class="line">  COMMIT;</span><br><span class="line"></span><br><span class="line">  --不成功则删除接口表数据</span><br><span class="line">  IF l_request_id &#x3D; 0 THEN</span><br><span class="line">  </span><br><span class="line">    DELETE ap_invoices_interface ai WHERE ai.invoice_id &#x3D; l_group_id;</span><br><span class="line">    DELETE ap_invoice_lines_interface ail</span><br><span class="line">     WHERE ail.invoice_id &#x3D; l_group_id;</span><br><span class="line">  </span><br><span class="line">  ELSE</span><br><span class="line">    -- 等待请求</span><br><span class="line">    l_request_status :&#x3D; fnd_concurrent.wait_for_request(l_request_id,</span><br><span class="line">                                                        5,</span><br><span class="line">                                                        0,</span><br><span class="line">                                                        l_phase,</span><br><span class="line">                                                        l_status,</span><br><span class="line">                                                        l_dev_phase,</span><br><span class="line">                                                        l_dev_status,</span><br><span class="line">                                                        l_message);</span><br><span class="line">    IF g_debug &#x3D; &#39;Y&#39; THEN</span><br><span class="line">      log_msg(&#39;接收状态-&gt; &#39; || l_dev_status);</span><br><span class="line">    </span><br><span class="line">    END IF;</span><br><span class="line">    g_req_tbl(g_cnt) :&#x3D; l_request_id;</span><br><span class="line">  END IF;</span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>等待并发程序运行完毕后，更新到中间表和历史表。如果是成功，则回写success；如果是错误则回写error，并返回错误信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">--游标信息</span><br><span class="line">-- 处理失败</span><br><span class="line">    CURSOR cur_err IS</span><br><span class="line">      SELECT h.header_id,</span><br><span class="line">             l.line_id,</span><br><span class="line">             aii.invoice_id,</span><br><span class="line">             aii.invoice_num,</span><br><span class="line">             aii.source,</span><br><span class="line">             nvl(flv.meaning, air.reject_lookup_code) err_msg</span><br><span class="line">        FROM ap_interface_rejections                     air,</span><br><span class="line">             ap_invoices_interface                       aii,</span><br><span class="line">             fnd_lookup_values                           flv,</span><br><span class="line">             ap_interface_headers_all@gj_fsp_middle_prod h,</span><br><span class="line">             ap_interface_lines_all@gj_fsp_middle_prod   l</span><br><span class="line">       WHERE 1 &#x3D; 1</span><br><span class="line">         AND h.invoice_number &#x3D; aii.invoice_num</span><br><span class="line">         AND h.header_id &#x3D; l.header_id</span><br><span class="line">         AND air.parent_id &#x3D; aii.invoice_id</span><br><span class="line">         AND air.reject_lookup_code &#x3D; flv.lookup_code(+)</span><br><span class="line">         AND flv.lookup_type(+) &#x3D; &#39;REJECT CODE&#39;</span><br><span class="line">         AND air.parent_table &#x3D; &#39;AP_INVOICES_INTERFACE&#39;</span><br><span class="line">         AND flv.language &#x3D; &#39;ZHS&#39;</span><br><span class="line">         AND h.process_status &#x3D; &#39;PENDING&#39;</span><br><span class="line">         AND aii.source &#x3D; &#39;FSSC&#39;</span><br><span class="line">         AND aii.status &#x3D; &#39;REJECTED&#39;</span><br><span class="line">      UNION ALL</span><br><span class="line">      SELECT DISTINCT h.header_id,</span><br><span class="line">                      l.line_id,</span><br><span class="line">                      aii.invoice_id,</span><br><span class="line">                      aii.invoice_num,</span><br><span class="line">                      aii.source,</span><br><span class="line">                      nvl(flv.meaning, air.reject_lookup_code) err_msg</span><br><span class="line">        FROM ap_interface_rejections                     air,</span><br><span class="line">             ap_invoices_interface                       aii,</span><br><span class="line">             ap_invoice_lines_interface                  ail,</span><br><span class="line">             fnd_lookup_values                           flv,</span><br><span class="line">             ap_interface_headers_all@gj_fsp_middle_prod h,</span><br><span class="line">             ap_interface_lines_all@gj_fsp_middle_prod   l</span><br><span class="line">       WHERE 1 &#x3D; 1</span><br><span class="line">         AND h.invoice_number &#x3D; aii.invoice_num</span><br><span class="line">         AND h.header_id &#x3D; l.header_id</span><br><span class="line">         AND air.parent_id &#x3D; ail.INVOICE_LINE_ID</span><br><span class="line">         AND ail.invoice_id &#x3D; aii.invoice_id</span><br><span class="line">         AND air.reject_lookup_code &#x3D; flv.lookup_code(+)</span><br><span class="line">         AND flv.lookup_type(+) &#x3D; &#39;REJECT CODE&#39;</span><br><span class="line">         AND air.parent_table &#x3D; &#39;AP_INVOICE_LINES_INTERFACE&#39;</span><br><span class="line">         AND flv.language &#x3D; &#39;ZHS&#39;</span><br><span class="line">         AND h.process_status &#x3D; &#39;PENDING&#39;</span><br><span class="line">         AND aii.source &#x3D; &#39;FSSC&#39;</span><br><span class="line">         AND aii.status &#x3D; &#39;REJECTED&#39;;</span><br><span class="line">  </span><br><span class="line">    --处理成功</span><br><span class="line">    CURSOR cur_suc IS</span><br><span class="line">      SELECT h.header_id,</span><br><span class="line">             aia.voucher_num,</span><br><span class="line">             h.org_id,</span><br><span class="line">             l.line_id,</span><br><span class="line">             l.more_assist,</span><br><span class="line">             h.operator last_updaeted_by, --经办人</span><br><span class="line">             aia.invoice_id</span><br><span class="line">        FROM ap_invoices_all                             aia,</span><br><span class="line">             ap_interface_headers_all@gj_fsp_middle_prod h,</span><br><span class="line">             ap_interface_lines_all@gj_fsp_middle_prod   l</span><br><span class="line">       WHERE 1 &#x3D; 1</span><br><span class="line">         AND h.header_id &#x3D; l.header_id</span><br><span class="line">         AND h.invoice_number &#x3D; aia.invoice_num</span><br><span class="line">         AND h.process_status &#x3D; &#39;PENDING&#39;;</span><br><span class="line">         </span><br><span class="line">--更新状态</span><br><span class="line">FOR rec_err IN cur_err LOOP</span><br><span class="line">      update_remote_table(p_header_id &#x3D;&gt; rec_err.header_id,</span><br><span class="line">                          p_line_id   &#x3D;&gt; rec_err.line_id,</span><br><span class="line">                          p_status    &#x3D;&gt; g_error,</span><br><span class="line">                          p_msg_data  &#x3D;&gt; rec_err.err_msg);</span><br><span class="line">    </span><br><span class="line">      --处理失败，删除接口表信息                    </span><br><span class="line">      DELETE FROM ap_invoices_interface</span><br><span class="line">       WHERE invoice_id &#x3D; rec_err.invoice_id;</span><br><span class="line">      DELETE FROM ap_invoice_lines_interface</span><br><span class="line">       WHERE invoice_id &#x3D; rec_err.invoice_id;</span><br><span class="line">    END LOOP;</span><br><span class="line">  </span><br><span class="line">    FOR rec_suc IN cur_suc LOOP</span><br><span class="line">      UPDATE ap_interface_headers_all@gj_fsp_middle_prod h</span><br><span class="line">         SET h.process_status     &#x3D; g_success,</span><br><span class="line">             h.last_updaeted_by   &#x3D; g_user_name,</span><br><span class="line">             h.last_update_login  &#x3D; g_login_id,</span><br><span class="line">             h.last_update_date   &#x3D; g_sysdate,</span><br><span class="line">             h.doc_sequence_value &#x3D; rec_suc.voucher_num,</span><br><span class="line">             h.process_message    &#x3D; &#39;发票已导入，等待验证。&#39;</span><br><span class="line">       WHERE h.header_id &#x3D; rec_suc.header_id;</span><br><span class="line">    </span><br><span class="line">      UPDATE ap_interface_lines_all@gj_fsp_middle_prod l</span><br><span class="line">         SET l.process_status    &#x3D; g_success,</span><br><span class="line">             l.last_updaeted_by  &#x3D; g_user_name,</span><br><span class="line">             l.last_update_login &#x3D; g_login_id,</span><br><span class="line">             l.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">             l.process_message   &#x3D; NULL</span><br><span class="line">       WHERE l.line_id &#x3D; rec_suc.line_id;</span><br><span class="line">    </span><br><span class="line">    END LOOP;</span><br></pre></td></tr></table></figure></li></ol><ol start="6"><li><p>无论是成功还是失败，处理完毕后，删除中间表的信息，历史表的信息保留。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete from gj_bar_so_pick</span><br><span class="line">  where iface_id &#x3D; p_iface_id;</span><br></pre></td></tr></table></figure></li></ol><h4 id="问题解决办法"><a href="#问题解决办法" class="headerlink" title="问题解决办法"></a>问题解决办法</h4><ol><li><p>如果是运行报错，可以查看请求的日志文件</p><img src="/2020/05/20/%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86/ERROR_LOG_FILE.png" class></li></ol><ol start="2"><li><p>如果是package运行时异常，可以用断点的形式调试</p></li><li><p>如果运行无异常，但是事务处理无数据，可以查询标准事务处理表，里面有记录异常信息</p></li><li><p>如果异常信息不明确，可以到metalink查询结果，也可以到community查找</p><blockquote><p><a href="https://support.oracle.com/" target="_blank" rel="noopener">https://support.oracle.com/</a></p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> ORACLE EBS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ORACLE EBS API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ORACLE EBS R12变动表结构</title>
      <link href="/2020/05/15/R12%E5%8F%98%E5%8A%A8%E8%A1%A8%E7%BB%93%E6%9E%84/"/>
      <url>/2020/05/15/R12%E5%8F%98%E5%8A%A8%E8%A1%A8%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="ORACLE-EBS-FUNCTION"><a href="#ORACLE-EBS-FUNCTION" class="headerlink" title="ORACLE EBS FUNCTION"></a>ORACLE EBS FUNCTION</h1><h2 id="ORACLE-EBS-11i-与-R12不同的表"><a href="#ORACLE-EBS-11i-与-R12不同的表" class="headerlink" title="ORACLE EBS 11i 与 R12不同的表"></a>ORACLE EBS 11i 与 R12不同的表</h2><h4 id="Suppliers-供应商"><a href="#Suppliers-供应商" class="headerlink" title="Suppliers - 供应商"></a>Suppliers - 供应商</h4><table><thead><tr><th>R12</th><th>状态</th><th>11i</th></tr></thead><tbody><tr><td>IBY_EXTERNAL_PAYEES_ALL</td><td>新增</td><td>/</td></tr><tr><td>HZ_PARTIES</td><td>新增</td><td>/</td></tr><tr><td>HZ_PARTY_SITES</td><td>新增</td><td>/</td></tr><tr><td>PO_VENDORS</td><td>新增</td><td>/</td></tr><tr><td>PO_VENDOR_SITES_ALL</td><td>新增</td><td>/</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="Invoices-发票"><a href="#Invoices-发票" class="headerlink" title="Invoices - 发票"></a>Invoices - 发票</h4><table><thead><tr><th>R12</th><th>状态</th><th>11i</th></tr></thead><tbody><tr><td>AP_INVOICE_LINES_ALL</td><td>新增</td><td>/</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="Payment-付款"><a href="#Payment-付款" class="headerlink" title="Payment -付款"></a>Payment -付款</h4><table><thead><tr><th>R12</th><th>状态</th><th>11i</th></tr></thead><tbody><tr><td>IBY_PAYMENTS_ALL</td><td>新增</td><td>/</td></tr><tr><td>IBY_DOC_PAYABLES_ALL</td><td>新增</td><td>/</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="Accounting-会计"><a href="#Accounting-会计" class="headerlink" title="Accounting - 会计"></a>Accounting - 会计</h4><table><thead><tr><th>R12</th><th>状态</th><th>11i</th></tr></thead><tbody><tr><td>XLA_EVENTS</td><td>替换</td><td>AP_ACCOUNTING_EVEENTS_ALL</td></tr><tr><td>XLA_AE_HEADERS</td><td>替换</td><td>AP_AE_HEADERS</td></tr><tr><td>XLA_AE_LINES</td><td>替换</td><td>AP_AE_LINES</td></tr><tr><td>/</td><td>停用</td><td>AP_LIABILITY_BALANCE</td></tr><tr><td>XLA_DISTRIBUTION_LINKS</td><td>新增</td><td>/</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><blockquote><p>注意：新增的XLA子分类账收录了AP和AR的会计分录、会计事件，而原有的11i仅仅包含AP的会计。</p></blockquote><h4 id="Bank-银行"><a href="#Bank-银行" class="headerlink" title="Bank - 银行"></a>Bank - 银行</h4><table><thead><tr><th>R12</th><th>状态</th><th>11i</th></tr></thead><tbody><tr><td>CE_BANK_ACCOUNTS</td><td>替换</td><td>AP_BANK_ACCOUNTS_ALL</td></tr><tr><td>CE_BANK_ACCT_USES_ALL</td><td>替换</td><td>AP_BANK_ACCOUNT_USES_ALL</td></tr><tr><td>CE_BANK_BRANCHES_V</td><td>替换</td><td>AP_BANK_BRANCEHS</td></tr><tr><td>CE_PAYMENT_DOCUMENTS</td><td>替换</td><td>AP_CHECKS_STOCKS_ALL</td></tr><tr><td>CE_BANK_ACCT_USES_OU_V</td><td>新增</td><td>/</td></tr><tr><td></td><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ORACLE EBS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ORACLE EBS FUNCTION </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ORACLE EBS 投料与退料接口</title>
      <link href="/2020/05/14/WIP%20%E5%8F%91%E6%96%99%E4%B8%8E%E9%80%80%E6%96%99/"/>
      <url>/2020/05/14/WIP%20%E5%8F%91%E6%96%99%E4%B8%8E%E9%80%80%E6%96%99/</url>
      
        <content type="html"><![CDATA[<h1 id="ORACBE-EBS-API"><a href="#ORACBE-EBS-API" class="headerlink" title="ORACBE EBS API"></a>ORACBE EBS API</h1><h2 id="WIP-投料与退料"><a href="#WIP-投料与退料" class="headerlink" title="WIP 投料与退料"></a>WIP 投料与退料</h2><h4 id="开发参考"><a href="#开发参考" class="headerlink" title="开发参考"></a>开发参考</h4><h5 id="并发程序"><a href="#并发程序" class="headerlink" title="并发程序"></a>并发程序</h5><table><thead><tr><th>标题</th><th>路径</th><th>内容</th></tr></thead><tbody><tr><td>功能</td><td>库存管理/事务处理/物料事务处理</td><td>查询物料所有的事务处理</td></tr><tr><td>功能</td><td>在制品管理/物料事务处理/WIP 物料事务处理</td><td>Erp处理发料事务的界面</td></tr><tr><td>并发</td><td>查看/请求/提交新请求/处理事务处理接口</td><td>Erp运行请求处理提交到接口表的数据</td></tr><tr><td>并发</td><td>库存管理/设置/事务处理/接口管理器</td><td>查看各个管理器的状态，可以在工具中启动管理器</td></tr><tr><td>文档</td><td>暂无</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h5 id="接口信息"><a href="#接口信息" class="headerlink" title="接口信息"></a>接口信息</h5><table><thead><tr><th>表名</th><th>说明</th></tr></thead><tbody><tr><td>mtl_transactions_interface</td><td>事务处理主要接口表，记录物料详细信息，以及处理的结果</td></tr><tr><td>mtl_transaction_lots_interface</td><td>如果物料启用了批次控制，那么要在这个表中插入数据</td></tr><tr><td>mtl_serial_numbers_interface</td><td>如果物料启用了序列号，那么要在这个表中插入数据</td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="程序要点"><a href="#程序要点" class="headerlink" title="程序要点"></a>程序要点</h5><h6 id="1-事务处理接口表"><a href="#1-事务处理接口表" class="headerlink" title="1. 事务处理接口表"></a>1. 事务处理接口表</h6><p>mtl_transactions_interface</p><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>transaction_interface_id</td><td>事务处理id，来自序列mtl_material_transactions_s.nextval</td></tr><tr><td>transaction_header_id</td><td>事务处理标示，建议使用批处理的方式，即每一次提交接口，这个id都保持一致。来自序列mtl_material_transactions_s.nextval</td></tr><tr><td>transaction_type_id</td><td>事务处理类型id，来自mtl_transaction_types.transaction_type_id。<br>如果是投料，则mtl_transaction_types.transaction_type_name = ‘WIP 组件发放’；<br>如果是退料，则mtl_transaction_types.transaction_type_name = ‘WIP 组件退货’；</td></tr><tr><td>transaction_action_id</td><td>来自mtl_transaction_types.transaction_action_id,跟随事务处理类型</td></tr><tr><td>transaction_source_type_id</td><td>来自mtl_transaction_types.transaction_source_type_id，跟随事务处理类型</td></tr><tr><td>organization_id</td><td>库存组织，可参考hr_organization_units.organization_id或fnd_profile.value(‘MFG_ORGANIZATION_ID’)</td></tr><tr><td>subinventory_code</td><td>子库存，可参考mtl_secondary_inventories.SECONDARY_INVENTORY_NAME</td></tr><tr><td>locator_id</td><td>货位，可参考mtl_item_locations.INVENTORY_LOCATION_ID</td></tr><tr><td>inventory_item_id</td><td>物料id，跟随工单的子装配件</td></tr><tr><td>transaction_quantity</td><td>事务处理数量，如果是出库或子库存转移则为负数，要*-1，如果是入库则为正数。此处退料为正数，发料为负数</td></tr><tr><td>transaction_uom</td><td>事务处理单位，跟随mtl_system_items_b.PRIMARY_UOM_CODE ，如果单位不一致会报错</td></tr><tr><td>operation_seq_num</td><td>工序序号，来自wip_requirement_operations.operation_seq_num</td></tr><tr><td>transaction_source_id</td><td>事务处理来源id，关联其他模块的数据。<br>账户别名杂项，用别名ID即disposition_id<br>WIP物料事务，用任务ID即wip_entity_id<br>SO物料事务，用mtl_sales_orders.sales_order_id子库转移或组织间转移，为空<br>此处用wip_entities.wip_entity_id</td></tr><tr><td>transaction_source_name</td><td>事务处理来源名称，此处用wip_entities.wip_entity_name</td></tr><tr><td>transaction_reference</td><td>事务处理参考，如果是外部系统的数据，建议保存外部系统的id用于追溯，当然也可以存放备注等信息</td></tr><tr><td>transaction_date</td><td>事务处理日期</td></tr><tr><td>transaction_mode</td><td>给3<br>2 Concurrent, Process transaction interface不处理，需要程序调用Inventory transaction worker处理<br>3 Background, 由Process transaction interface处理</td></tr><tr><td>creation_date</td><td>who字段，创建日期</td></tr><tr><td>created_by</td><td>who字段,创建人</td></tr><tr><td>last_update_date</td><td>who字段，最后更新日期</td></tr><tr><td>last_updated_by</td><td>who字段，最后更新人</td></tr><tr><td>last_update_login</td><td>who字段，来自fnd_global.login_id</td></tr><tr><td>process_flag</td><td>给1。1 Yes；2 No；3 Error</td></tr><tr><td>source_code</td><td>来源代码，随便给</td></tr><tr><td>source_header_id</td><td>来源头id，随便给，这里同transaction_interface_id</td></tr><tr><td>source_line_id</td><td>来源行id，随便给，这里同transaction_interface_id</td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="2-批次处理接口表"><a href="#2-批次处理接口表" class="headerlink" title="2. 批次处理接口表"></a>2. 批次处理接口表</h6><p>mtl_transaction_lots_interface</p><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>transaction_interface_id</td><td>关联事务处理id，同mtl_transactions_interface.transaction_interface_id</td></tr><tr><td>lot_number</td><td>批次号</td></tr><tr><td>source_line_id</td><td>来源行id，随便给，这里同transaction_interface_id</td></tr><tr><td>transaction_quantity</td><td>事务处理数量，同mtl_transactions_interface.ransaction_quantity</td></tr><tr><td>primary_quantity</td><td>事务处理数量，同mtl_transactions_interface.ransaction_quantity</td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="3-数据校验"><a href="#3-数据校验" class="headerlink" title="3.数据校验"></a>3.数据校验</h6><ul><li><p>库存组织校验</p></li><li><p>工单校验</p></li><li><p>工单状态校验</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wip_discrete_jobs.status_type IN (&#39;3&#39;, &#39;4&#39;)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>物料编码校验</p></li><li><p>库存会计期校验</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT oap.open_flag --Y:open N:close</span><br><span class="line">  INTO l_result_flag</span><br><span class="line">  FROM org_acct_periods oap, org_organization_definitions ood</span><br><span class="line"> WHERE ood.organization_id &#x3D; oap.organization_id</span><br><span class="line">   AND ood.organization_id &#x3D; p_organization_id</span><br><span class="line">   AND p_txn_date BETWEEN oap.period_start_date AND</span><br><span class="line">       oap.schedule_close_date;</span><br><span class="line">    </span><br><span class="line">IF nvl(l_result_flag, &#39;N&#39;) &#x3D; &#39;N&#39; THEN</span><br><span class="line">  fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_INV_NOT_IN_PERIOD&#39;);</span><br><span class="line">  x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">  x_return_status :&#x3D; g_error;</span><br><span class="line"></span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure></li><li><p>数量校验：库存现有量 - 处理数量 &gt; 0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">FUNCTION get_onhand_qty(p_item_id           IN NUMBER,</span><br><span class="line">                        p_organization_id   IN NUMBER,</span><br><span class="line">                        p_subinventory_code IN VARCHAR2,</span><br><span class="line">                        p_locator_id        IN NUMBER DEFAULT NULL,</span><br><span class="line">                        p_lot_number        IN VARCHAR2) RETURN NUMBER IS</span><br><span class="line">  l_onhand_qty     NUMBER;</span><br><span class="line">  l_avail_qty      NUMBER;</span><br><span class="line">  l_rqoh           NUMBER;</span><br><span class="line">  l_qr             NUMBER;</span><br><span class="line">  l_qs             NUMBER;</span><br><span class="line">  l_atr            NUMBER;</span><br><span class="line">  l_tree_mode      NUMBER;</span><br><span class="line">  l_msg_count      NUMBER;</span><br><span class="line">  l_msg_data       VARCHAR2(4000);</span><br><span class="line">  l_return_status  VARCHAR2(1);</span><br><span class="line">  l_is_lot_control BOOLEAN;</span><br><span class="line">BEGIN</span><br><span class="line">  IF p_lot_number IS NULL THEN</span><br><span class="line">    l_is_lot_control :&#x3D; FALSE;</span><br><span class="line">  ELSE</span><br><span class="line">    l_is_lot_control :&#x3D; TRUE;</span><br><span class="line">  END IF;</span><br><span class="line"></span><br><span class="line">  l_tree_mode :&#x3D; 2;</span><br><span class="line">  inv_quantity_tree_pub.clear_quantity_cache;</span><br><span class="line">  inv_quantity_tree_pub.query_quantities(p_api_version_number  &#x3D;&gt; 1.0,</span><br><span class="line">                                         p_init_msg_lst        &#x3D;&gt; &#39;F&#39;,</span><br><span class="line">                                         x_return_status       &#x3D;&gt; l_return_status,</span><br><span class="line">                                         x_msg_count           &#x3D;&gt; l_msg_count,</span><br><span class="line">                                         x_msg_data            &#x3D;&gt; l_msg_data,</span><br><span class="line">                                         p_organization_id     &#x3D;&gt; p_organization_id,</span><br><span class="line">                                         p_inventory_item_id   &#x3D;&gt; p_item_id,</span><br><span class="line">                                         p_tree_mode           &#x3D;&gt; l_tree_mode,</span><br><span class="line">                                         p_is_revision_control &#x3D;&gt; FALSE,</span><br><span class="line">                                         p_is_lot_control      &#x3D;&gt; l_is_lot_control,</span><br><span class="line">                                         p_is_serial_control   &#x3D;&gt; FALSE,</span><br><span class="line">                                         p_revision            &#x3D;&gt; NULL,</span><br><span class="line">                                         p_lot_number          &#x3D;&gt; p_lot_number,</span><br><span class="line">                                         p_lot_expiration_date &#x3D;&gt; NULL,</span><br><span class="line">                                         p_subinventory_code   &#x3D;&gt; p_subinventory_code,</span><br><span class="line">                                         p_locator_id          &#x3D;&gt; p_locator_id,</span><br><span class="line">                                         p_onhand_source       &#x3D;&gt; inv_quantity_tree_pvt.g_all_subs,</span><br><span class="line">                                         x_qoh                 &#x3D;&gt; l_onhand_qty, --现有量</span><br><span class="line">                                         x_rqoh                &#x3D;&gt; l_rqoh,</span><br><span class="line">                                         x_qr                  &#x3D;&gt; l_qr,</span><br><span class="line">                                         x_qs                  &#x3D;&gt; l_qs,</span><br><span class="line">                                         x_att                 &#x3D;&gt; l_avail_qty, --可用量</span><br><span class="line">                                         x_atr                 &#x3D;&gt; l_atr); --可保留量</span><br><span class="line"></span><br><span class="line">  RETURN l_onhand_qty;</span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">  WHEN OTHERS THEN</span><br><span class="line">    RETURN 0;</span><br><span class="line">END get_onhand_qty;</span><br></pre></td></tr></table></figure></li><li><p>批次控制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--批次控制</span><br><span class="line">mtl_system_items_b.lot_control_code &#x3D; 2 AND lot_number IS NOT NULL</span><br><span class="line"></span><br><span class="line">--不控制批次</span><br><span class="line">mtl_system_items_b.lot_control_code &#x3D; 1 AND lot_number IS NULL</span><br></pre></td></tr></table></figure></li></ul><h6 id="4-调用系统标准API提交请求"><a href="#4-调用系统标准API提交请求" class="headerlink" title="4. 调用系统标准API提交请求"></a>4. 调用系统标准API提交请求</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">inv_txn_manager_pub.process_transactions(p_api_version      &#x3D;&gt; 1.0,</span><br><span class="line">                                                         p_init_msg_list    &#x3D;&gt; fnd_api.g_true,</span><br><span class="line">                                                         p_commit           &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                                                         p_validation_level &#x3D;&gt; fnd_api.g_valid_level_full,</span><br><span class="line">                                                         x_return_status    &#x3D;&gt; l_return_status,</span><br><span class="line">                                                         x_msg_count        &#x3D;&gt; l_msg_count,</span><br><span class="line">                                                         x_msg_data         &#x3D;&gt; l_msg_data,</span><br><span class="line">                                                         x_trans_count      &#x3D;&gt; l_txn_count,</span><br><span class="line">                                                         p_table            &#x3D;&gt; 1,</span><br><span class="line">                                                         p_header_id        &#x3D;&gt; p_transaction_header_id);</span><br></pre></td></tr></table></figure><h6 id="5-检查错误信息"><a href="#5-检查错误信息" class="headerlink" title="5. 检查错误信息"></a>5. 检查错误信息</h6><ul><li>接口事务处理信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT source_code,</span><br><span class="line">       source_header_id,</span><br><span class="line">       source_line_id,</span><br><span class="line">       ERROR_CODE,</span><br><span class="line">       error_explanation</span><br><span class="line">  FROM mtl_transactions_interface</span><br><span class="line"> WHERE transaction_header_id &#x3D; p_transaction_header_id</span><br><span class="line">   AND (ERROR_CODE IS NOT NULL OR error_explanation IS NOT NULL);</span><br></pre></td></tr></table></figure><ul><li>批次事务处理信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT source_code,</span><br><span class="line">       source_line_id,</span><br><span class="line">       ERROR_CODE,</span><br><span class="line">       error_explanation</span><br><span class="line">  FROM mtl_material_transactions_temp</span><br><span class="line"> WHERE transaction_header_id &#x3D; p_transaction_header_id</span><br><span class="line">   AND (ERROR_CODE IS NOT NULL OR error_explanation IS NOT NULL);</span><br></pre></td></tr></table></figure><h5 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h5><h6 id="1-序列"><a href="#1-序列" class="headerlink" title="1. 序列"></a>1. 序列</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE SEQUENCE GJ.GJ_MES_ISSUE_IFACE_SEQ </span><br><span class="line">INCREMENT BY 1 </span><br><span class="line">START WITH 1 </span><br><span class="line">NOMAXvalue </span><br><span class="line">NOCYCLE </span><br><span class="line">NOCACHE;</span><br></pre></td></tr></table></figure><h6 id="2-中间表"><a href="#2-中间表" class="headerlink" title="2. 中间表"></a>2. 中间表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &quot;GJ&quot;.&quot;GJ_MES_ISSUE_IFACE&quot; </span><br><span class="line">   (  &quot;IFACE_ID&quot; NUMBER NOT NULL ENABLE, </span><br><span class="line">  &quot;ORGANIZATION_ID&quot; NUMBER, </span><br><span class="line">  &quot;ORGANIZATION_CODE&quot; VARCHAR2(3) NOT NULL ENABLE, </span><br><span class="line">  &quot;ITEM_ID&quot; NUMBER, </span><br><span class="line">  &quot;ITEM_NUM&quot; VARCHAR2(40) NOT NULL ENABLE, </span><br><span class="line">  &quot;UOM_CODE&quot; VARCHAR2(3) NOT NULL ENABLE, </span><br><span class="line">  &quot;SUBINVENTORY_CODE&quot; VARCHAR2(10), </span><br><span class="line">  &quot;LOCATOR_ID&quot; NUMBER, </span><br><span class="line">  &quot;LOCATOR_CODE&quot; VARCHAR2(50), </span><br><span class="line">  &quot;LOT_NUMBER&quot; VARCHAR2(80), </span><br><span class="line">  &quot;WIP_ENTITY_NAME&quot; VARCHAR2(240) NOT NULL ENABLE, </span><br><span class="line">  &quot;QUANTITY&quot; NUMBER NOT NULL ENABLE, </span><br><span class="line">  &quot;WIP_ENTITY_ID&quot; NUMBER, </span><br><span class="line">  &quot;SOURCE_TXN_ID&quot; VARCHAR2(255) NOT NULL ENABLE, </span><br><span class="line">  &quot;REQUEST_ID&quot; NUMBER, </span><br><span class="line">  &quot;TRANSACTION_TYPE&quot; VARCHAR2(30),</span><br><span class="line">  &quot;PROCESS_TYPE&quot;  VARCHAR2(30),</span><br><span class="line">  &quot;PROCESS_STATUS&quot; VARCHAR2(30), </span><br><span class="line">  &quot;PROCESS_BY&quot; VARCHAR2(30), </span><br><span class="line">  &quot;PROCESS_DATE&quot; DATE NOT NULL ENABLE, </span><br><span class="line">  &quot;ERROR_MSG&quot; VARCHAR2(4000), </span><br><span class="line">  &quot;CREATION_DATE&quot; DATE DEFAULT sysdate NOT NULL ENABLE, </span><br><span class="line">  &quot;CREATED_BY&quot; NUMBER DEFAULT -1 NOT NULL ENABLE, </span><br><span class="line">  &quot;LAST_UPDATED_BY&quot; NUMBER DEFAULT -1 NOT NULL ENABLE, </span><br><span class="line">  &quot;LAST_UPDATE_DATE&quot; DATE DEFAULT sysdate NOT NULL ENABLE, </span><br><span class="line">  &quot;LAST_UPDATE_LOGIN&quot; NUMBER, </span><br><span class="line">  &quot;ATTRIBUTE_CATEGORY&quot; VARCHAR2(30), </span><br><span class="line">  &quot;ATTRIBUTE1&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE2&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE3&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE4&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE5&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE6&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE7&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE8&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE9&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE10&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE11&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE12&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE13&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE14&quot; VARCHAR2(240), </span><br><span class="line">  &quot;ATTRIBUTE15&quot; VARCHAR2(240), </span><br><span class="line">   CONSTRAINT &quot;GJ_MES_ISSUE_IFACE_PK&quot; PRIMARY KEY (&quot;IFACE_ID&quot;)</span><br><span class="line">   )</span><br></pre></td></tr></table></figure><h6 id="3-程序包定义"><a href="#3-程序包定义" class="headerlink" title="3. 程序包定义"></a>3. 程序包定义</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE GJ_MES_ISSUE_PKG IS</span><br><span class="line">  -- 接口出错记录组</span><br><span class="line">  TYPE rec_iface_error IS RECORD(</span><br><span class="line">    source_code       mtl_transactions_interface.source_code%TYPE,</span><br><span class="line">    source_header_id  mtl_transactions_interface.source_header_id%TYPE,</span><br><span class="line">    source_line_id    mtl_transactions_interface.source_line_id%TYPE,</span><br><span class="line">    ERROR_CODE        mtl_transactions_interface.error_code%TYPE,</span><br><span class="line">    error_explanation mtl_transactions_interface.error_explanation%TYPE);</span><br><span class="line">  TYPE tab_iface_error IS TABLE OF rec_iface_error INDEX BY BINARY_INTEGER;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      main</span><br><span class="line">  Description:</span><br><span class="line">      MES智能工厂发料接口</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE main(errbuf OUT VARCHAR2, retcode OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">END GJ_MES_ISSUE_PKG;</span><br></pre></td></tr></table></figure><h6 id="4-程序包体"><a href="#4-程序包体" class="headerlink" title="4. 程序包体"></a>4. 程序包体</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE BODY GJ_MES_ISSUE_PKG IS</span><br><span class="line"></span><br><span class="line">  -- Global variable</span><br><span class="line">  g_pkg_name VARCHAR2(30) :&#x3D; &#39;gj_mes_issue_pkg&#39;;</span><br><span class="line"></span><br><span class="line">  g_debug VARCHAR2(1) :&#x3D; nvl(fnd_profile.value(&#39;AFLOG_ENABLED&#39;), &#39;N&#39;);</span><br><span class="line"></span><br><span class="line">  -- who</span><br><span class="line">  g_user_id         NUMBER :&#x3D; fnd_global.user_id;</span><br><span class="line">  g_sysdate         DATE :&#x3D; SYSDATE;</span><br><span class="line">  g_login_id        NUMBER :&#x3D; fnd_global.login_id;</span><br><span class="line">  g_conc_request_id NUMBER :&#x3D; fnd_global.conc_request_id;</span><br><span class="line"></span><br><span class="line">  -- status</span><br><span class="line">  g_pending CONSTANT VARCHAR2(10) :&#x3D; &#39;PENDING&#39;; --已通过验证</span><br><span class="line">  g_error   CONSTANT VARCHAR2(10) :&#x3D; &#39;ERROR&#39;; -- 处理失败</span><br><span class="line">  g_success CONSTANT VARCHAR2(10) :&#x3D; &#39;SUCCESS&#39;; -- 处理成功</span><br><span class="line"></span><br><span class="line">  --异常处理</span><br><span class="line">  PROCEDURE raise_exception(x_return_status IN OUT VARCHAR2) IS</span><br><span class="line">  BEGIN</span><br><span class="line">    IF (x_return_status &#x3D; fnd_api.g_ret_sts_unexp_error) THEN</span><br><span class="line">      RAISE fnd_api.g_exc_unexpected_error;</span><br><span class="line">    ELSIF (x_return_status &#x3D; fnd_api.g_ret_sts_error) THEN</span><br><span class="line">      RAISE fnd_api.g_exc_error;</span><br><span class="line">    END IF;</span><br><span class="line">  END raise_exception;</span><br><span class="line"></span><br><span class="line">  --输出日志</span><br><span class="line">  PROCEDURE log_msg(p_message_text IN VARCHAR2) IS</span><br><span class="line">  BEGIN</span><br><span class="line">    fnd_file.put_line(fnd_file.log, p_message_text);</span><br><span class="line">  END log_msg;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    update_iface</span><br><span class="line">  Description:</span><br><span class="line">    更新接口表 </span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;14  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE update_iface(p_iface_id IN VARCHAR2,</span><br><span class="line">                         p_status   IN VARCHAR2,</span><br><span class="line">                         p_msg_data IN VARCHAR2) IS</span><br><span class="line">  BEGIN</span><br><span class="line">    UPDATE GJ.GJ_MES_ISSUE_IFACE gbc</span><br><span class="line">       SET gbc.process_status    &#x3D; p_status,</span><br><span class="line">           gbc.error_msg         &#x3D; p_msg_data,</span><br><span class="line">           gbc.last_update_login &#x3D; g_login_id,</span><br><span class="line">           gbc.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">           gbc.last_updated_by   &#x3D; g_user_id</span><br><span class="line">     WHERE gbc.iface_id &#x3D; p_iface_id;</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      NULL;</span><br><span class="line">  END update_iface;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    update_remote_table</span><br><span class="line">  Description:</span><br><span class="line">    更新中间库历史表</span><br><span class="line">  Argument:</span><br><span class="line">  </span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;14  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE update_remote_table(p_serial_number IN VARCHAR2,</span><br><span class="line">                                p_status        IN VARCHAR2,</span><br><span class="line">                                p_msg_data      IN VARCHAR2) IS</span><br><span class="line">  BEGIN</span><br><span class="line">    UPDATE gj_mes_wip_feed@GJ_ERP_MIDDLE_TEST gbc</span><br><span class="line">       SET gbc.process_status   &#x3D; p_status,</span><br><span class="line">           gbc.process_message  &#x3D; p_msg_data,</span><br><span class="line">           gbc.last_update_date &#x3D; SYSDATE</span><br><span class="line">     WHERE gbc.serial_number &#x3D; p_serial_number;</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      NULL;</span><br><span class="line">  END update_remote_table;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    get_onhand_qty</span><br><span class="line">  Description:</span><br><span class="line">    获取可用量</span><br><span class="line">  Argument:</span><br><span class="line">    p_item_id                       物料ID</span><br><span class="line">    p_organization_id               库存组织ID</span><br><span class="line">    p_subinventory_code             子库</span><br><span class="line">    p_locator_id                    货位</span><br><span class="line">  History:</span><br><span class="line">    1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  FUNCTION get_onhand_qty(p_item_id           IN NUMBER,</span><br><span class="line">                          p_organization_id   IN NUMBER,</span><br><span class="line">                          p_subinventory_code IN VARCHAR2,</span><br><span class="line">                          p_locator_id        IN NUMBER DEFAULT NULL,</span><br><span class="line">                          p_lot_number        IN VARCHAR2) RETURN NUMBER IS</span><br><span class="line">    l_onhand_qty     NUMBER;</span><br><span class="line">    l_avail_qty      NUMBER;</span><br><span class="line">    l_rqoh           NUMBER;</span><br><span class="line">    l_qr             NUMBER;</span><br><span class="line">    l_qs             NUMBER;</span><br><span class="line">    l_atr            NUMBER;</span><br><span class="line">    l_tree_mode      NUMBER;</span><br><span class="line">    l_msg_count      NUMBER;</span><br><span class="line">    l_msg_data       VARCHAR2(4000);</span><br><span class="line">    l_return_status  VARCHAR2(1);</span><br><span class="line">    l_is_lot_control BOOLEAN;</span><br><span class="line">  BEGIN</span><br><span class="line">    IF p_lot_number IS NULL THEN</span><br><span class="line">      l_is_lot_control :&#x3D; FALSE;</span><br><span class="line">    ELSE</span><br><span class="line">      l_is_lot_control :&#x3D; TRUE;</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">    l_tree_mode :&#x3D; 2;</span><br><span class="line">    inv_quantity_tree_pub.clear_quantity_cache;</span><br><span class="line">    inv_quantity_tree_pub.query_quantities(p_api_version_number  &#x3D;&gt; 1.0,</span><br><span class="line">                                           p_init_msg_lst        &#x3D;&gt; &#39;F&#39;,</span><br><span class="line">                                           x_return_status       &#x3D;&gt; l_return_status,</span><br><span class="line">                                           x_msg_count           &#x3D;&gt; l_msg_count,</span><br><span class="line">                                           x_msg_data            &#x3D;&gt; l_msg_data,</span><br><span class="line">                                           p_organization_id     &#x3D;&gt; p_organization_id,</span><br><span class="line">                                           p_inventory_item_id   &#x3D;&gt; p_item_id,</span><br><span class="line">                                           p_tree_mode           &#x3D;&gt; l_tree_mode,</span><br><span class="line">                                           p_is_revision_control &#x3D;&gt; FALSE,</span><br><span class="line">                                           p_is_lot_control      &#x3D;&gt; l_is_lot_control,</span><br><span class="line">                                           p_is_serial_control   &#x3D;&gt; FALSE,</span><br><span class="line">                                           p_revision            &#x3D;&gt; NULL,</span><br><span class="line">                                           p_lot_number          &#x3D;&gt; p_lot_number,</span><br><span class="line">                                           p_lot_expiration_date &#x3D;&gt; NULL,</span><br><span class="line">                                           p_subinventory_code   &#x3D;&gt; p_subinventory_code,</span><br><span class="line">                                           p_locator_id          &#x3D;&gt; p_locator_id,</span><br><span class="line">                                           p_onhand_source       &#x3D;&gt; inv_quantity_tree_pvt.g_all_subs,</span><br><span class="line">                                           x_qoh                 &#x3D;&gt; l_onhand_qty, --现有量</span><br><span class="line">                                           x_rqoh                &#x3D;&gt; l_rqoh,</span><br><span class="line">                                           x_qr                  &#x3D;&gt; l_qr,</span><br><span class="line">                                           x_qs                  &#x3D;&gt; l_qs,</span><br><span class="line">                                           x_att                 &#x3D;&gt; l_avail_qty, --可用量</span><br><span class="line">                                           x_atr                 &#x3D;&gt; l_atr); --可保留量</span><br><span class="line">  </span><br><span class="line">    RETURN l_onhand_qty;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      RETURN 0;</span><br><span class="line">  END get_onhand_qty;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    get_issue_data</span><br><span class="line">  Description:</span><br><span class="line">    从接口表拉取数据</span><br><span class="line">  Argument:</span><br><span class="line">    NULL</span><br><span class="line">  History:</span><br><span class="line">    1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE get_issue_data(x_return_status OUT NOCOPY VARCHAR2,</span><br><span class="line">                           x_msg_count     OUT NOCOPY NUMBER,</span><br><span class="line">                           x_msg_data      OUT NOCOPY VARCHAR2) IS</span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(30) :&#x3D; &#39;get_issue_data&#39;;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(30) :&#x3D; &#39;sp_get_issue_data&#39;;</span><br><span class="line">  </span><br><span class="line">    l_row_tbl GJ.GJ_MES_ISSUE_IFACE%ROWTYPE;</span><br><span class="line">    CURSOR cur_data IS</span><br><span class="line">      SELECT t.organization_id,</span><br><span class="line">             org.ORGANIZATION_CODE,</span><br><span class="line">             t.wip_entity_id,</span><br><span class="line">             t.wip_entity_name,</span><br><span class="line">             t.inventory_item_id item_id,</span><br><span class="line">             t.item_number,</span><br><span class="line">             t.item_qty,</span><br><span class="line">             t.uom_code,</span><br><span class="line">             t.lot_number,</span><br><span class="line">             t.transaction_type,</span><br><span class="line">             t.process_date,</span><br><span class="line">             t.process_status,</span><br><span class="line">             t.process_message,</span><br><span class="line">             t.created_by,</span><br><span class="line">             t.creation_date,</span><br><span class="line">             t.last_updated_by,</span><br><span class="line">             t.last_update_date,</span><br><span class="line">             t.process_type,</span><br><span class="line">             t.serial_number,</span><br><span class="line">             t.subinventory_code,</span><br><span class="line">             t.locator_name</span><br><span class="line">        FROM gj_mes_wip_feed@GJ_ERP_MIDDLE_TEST t,</span><br><span class="line">             --关联快码，确定处理范围</span><br><span class="line">             (SELECT ood.ORGANIZATION_CODE, ood.ORGANIZATION_ID</span><br><span class="line">                FROM org_organization_definitions ood, fnd_lookup_values flv</span><br><span class="line">               WHERE 1 &#x3D; 1</span><br><span class="line">                 AND flv.LANGUAGE &#x3D; &#39;ZHS&#39;</span><br><span class="line">                 AND ood.ORGANIZATION_CODE &#x3D; flv.LOOKUP_CODE</span><br><span class="line">                 AND flv.LOOKUP_TYPE &#x3D; &#39;GJ_MES_IFACE_TYPE&#39;) org</span><br><span class="line">       WHERE 1 &#x3D; 1</span><br><span class="line">         AND org.organization_id &#x3D; t.organization_id</span><br><span class="line">         AND upper(t.process_status) &#x3D; &#39;NEW&#39;</span><br><span class="line">            --增量同步</span><br><span class="line">         AND NOT EXISTS</span><br><span class="line">       (SELECT 1</span><br><span class="line">                FROM GJ.GJ_MES_ISSUE_IFACE</span><br><span class="line">               WHERE source_txn_id &#x3D; t.serial_number);</span><br><span class="line">  BEGIN</span><br><span class="line">    -- start activity to create savepoint, check compatibility</span><br><span class="line">    -- and initialize message list, include debug message hint to enter api</span><br><span class="line">    x_return_status :&#x3D; cux_api.start_activity(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                              p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                              p_savepoint_name &#x3D;&gt; l_savepoint_name);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  </span><br><span class="line">    FOR rec_data IN cur_data LOOP</span><br><span class="line">      l_row_tbl.iface_id          :&#x3D; GJ.GJ_MES_ISSUE_IFACE_SEQ.nextval;</span><br><span class="line">      l_row_tbl.organization_id   :&#x3D; rec_data.organization_id;</span><br><span class="line">      l_row_tbl.organization_code :&#x3D; rec_data.organization_code;</span><br><span class="line">      l_row_tbl.item_id           :&#x3D; rec_data.item_id;</span><br><span class="line">      l_row_tbl.item_num          :&#x3D; rec_data.item_number;</span><br><span class="line">      l_row_tbl.uom_code          :&#x3D; rec_data.uom_code;</span><br><span class="line">      l_row_tbl.subinventory_code :&#x3D; rec_data.subinventory_code;</span><br><span class="line">      l_row_tbl.locator_id        :&#x3D; NULL;</span><br><span class="line">      l_row_tbl.locator_code      :&#x3D; rec_data.locator_name;</span><br><span class="line">      l_row_tbl.lot_number        :&#x3D; rec_data.lot_number;</span><br><span class="line">      l_row_tbl.wip_entity_name   :&#x3D; rec_data.wip_entity_name;</span><br><span class="line">      l_row_tbl.wip_entity_id     :&#x3D; rec_data.wip_entity_id;</span><br><span class="line">      l_row_tbl.quantity          :&#x3D; rec_data.item_qty;</span><br><span class="line">      l_row_tbl.source_txn_id     :&#x3D; rec_data.serial_number;</span><br><span class="line">      l_row_tbl.process_type      :&#x3D; rec_data.process_type;</span><br><span class="line">      l_row_tbl.process_by        :&#x3D; NULL;</span><br><span class="line">      l_row_tbl.process_status    :&#x3D; NULL;</span><br><span class="line">      l_row_tbl.process_date      :&#x3D; rec_data.process_date;</span><br><span class="line">    </span><br><span class="line">      --set transaction_type</span><br><span class="line">      IF upper(rec_data.transaction_type) &#x3D; &#39;ISSUE&#39; THEN</span><br><span class="line">        l_row_tbl.transaction_type :&#x3D; &#39;WIP 组件发放&#39;;</span><br><span class="line">        l_row_tbl.quantity         :&#x3D; (-1) * rec_data.item_qty;</span><br><span class="line">      ELSIF upper(rec_data.transaction_type) &#x3D; &#39;RETURN&#39; THEN</span><br><span class="line">        l_row_tbl.transaction_type :&#x3D; &#39;WIP 组件退货&#39;;</span><br><span class="line">        l_row_tbl.quantity         :&#x3D; rec_data.item_qty;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      --set who</span><br><span class="line">      l_row_tbl.creation_date    :&#x3D; rec_data.creation_date;</span><br><span class="line">      l_row_tbl.created_by       :&#x3D; g_user_id;</span><br><span class="line">      l_row_tbl.last_update_date :&#x3D; rec_data.last_update_date;</span><br><span class="line">      l_row_tbl.last_updated_by  :&#x3D; g_user_id;</span><br><span class="line">    </span><br><span class="line">      INSERT INTO GJ.GJ_MES_ISSUE_IFACE VALUES l_row_tbl;</span><br><span class="line">      COMMIT;</span><br><span class="line">    END LOOP;</span><br><span class="line">  </span><br><span class="line">    -- API end body</span><br><span class="line">    -- end activity, include debug message hint to exit api</span><br><span class="line">    x_return_status :&#x3D; cux_api.end_activity(p_pkg_name  &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                            p_api_name  &#x3D;&gt; l_api_name,</span><br><span class="line">                                            x_msg_count &#x3D;&gt; x_msg_count,</span><br><span class="line">                                            x_msg_data  &#x3D;&gt; x_msg_data);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">  END get_issue_data;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    is_between_open_period</span><br><span class="line">  Description:</span><br><span class="line">    判断是否在打开的库存会计期内</span><br><span class="line">  History:</span><br><span class="line">    1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_txn_data(p_txn_date        IN DATE,</span><br><span class="line">                         p_organization_id IN NUMBER,</span><br><span class="line">                         x_msg_data        OUT VARCHAR2,</span><br><span class="line">                         x_return_status   OUT VARCHAR2) IS</span><br><span class="line">    l_result_flag VARCHAR2(1);</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT oap.open_flag --Y:open N:close</span><br><span class="line">      INTO l_result_flag</span><br><span class="line">      FROM org_acct_periods oap, org_organization_definitions ood</span><br><span class="line">     WHERE ood.organization_id &#x3D; oap.organization_id</span><br><span class="line">       AND ood.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND p_txn_date BETWEEN oap.period_start_date AND</span><br><span class="line">           oap.schedule_close_date;</span><br><span class="line">  </span><br><span class="line">    IF nvl(l_result_flag, &#39;N&#39;) &#x3D; &#39;N&#39; THEN</span><br><span class="line">      fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_INV_NOT_IN_PERIOD&#39;);</span><br><span class="line">      x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">    </span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_INV_NOT_IN_PERIOD&#39;);</span><br><span class="line">      x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">  END vld_txn_data;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    is_between_open_period</span><br><span class="line">  Description:</span><br><span class="line">    判断物料是否存在批次</span><br><span class="line">  History:</span><br><span class="line">    1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_lot_control(p_organization_id   IN NUMBER,</span><br><span class="line">                            p_item_id           IN NUMBER,</span><br><span class="line">                            p_lot_number        IN VARCHAR2,</span><br><span class="line">                            x_subinventory_code OUT VARCHAR2,</span><br><span class="line">                            x_locator_code      OUT VARCHAR2,</span><br><span class="line">                            x_locator_id        OUT NUMBER,</span><br><span class="line">                            x_msg_data          OUT VARCHAR2,</span><br><span class="line">                            x_return_status     OUT VARCHAR2) IS</span><br><span class="line">    l_lot_control NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT MAX(msb.lot_control_code)</span><br><span class="line">      INTO l_lot_control</span><br><span class="line">      FROM mtl_system_items_b msb</span><br><span class="line">     WHERE msb.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND msb.inventory_item_id &#x3D; p_item_id;</span><br><span class="line">  </span><br><span class="line">    IF nvl(l_lot_control, 1) &#x3D; 2 AND p_lot_number IS NULL THEN</span><br><span class="line">      fnd_message.set_name(&#39;ICX&#39;, &#39;ICX_POR_MTL_LOT_CONTROL_FAIL&#39;); -- 批次控制验证失败。</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">    </span><br><span class="line">    ELSIF l_lot_control &#x3D; 1 AND p_lot_number IS NOT NULL THEN</span><br><span class="line">      fnd_message.set_name(&#39;ICX&#39;, &#39;ICX_POR_MTL_LOT_CONTROL_FAIL&#39;); -- 批次控制验证失败。</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">    </span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">    --判断是否存在批次</span><br><span class="line">    IF nvl(l_lot_control, 1) &#x3D; 2 THEN</span><br><span class="line">      BEGIN</span><br><span class="line">        SELECT mq.concatenated_segments locator_name,</span><br><span class="line">               mq.LOCATOR_ID,</span><br><span class="line">               mq.SUBINVENTORY_CODE</span><br><span class="line">          INTO x_locator_code, x_locator_id, x_subinventory_code</span><br><span class="line">          FROM wip_requirement_operations wro,</span><br><span class="line">               (SELECT mil.concatenated_segments,</span><br><span class="line">                       moq.INVENTORY_ITEM_ID,</span><br><span class="line">                       moq.LOCATOR_ID,</span><br><span class="line">                       moq.SUBINVENTORY_CODE,</span><br><span class="line">                       moq.LOT_NUMBER,</span><br><span class="line">                       moq.ORGANIZATION_ID,</span><br><span class="line">                       SUM(moq.TRANSACTION_QUANTITY)</span><br><span class="line">                  FROM mtl_onhand_quantities_detail moq,</span><br><span class="line">                       mtl_item_locations_kfv       mil</span><br><span class="line">                 WHERE 1 &#x3D; 1</span><br><span class="line">                   AND mil.INVENTORY_LOCATION_ID &#x3D; moq.LOCATOR_ID</span><br><span class="line">                   AND moq.INVENTORY_ITEM_ID &#x3D; 1692</span><br><span class="line">                   AND moq.ORGANIZATION_ID &#x3D; 326</span><br><span class="line">                   AND moq.LOT_NUMBER &#x3D; &#39;201800&#39;</span><br><span class="line">                 GROUP BY mil.concatenated_segments,</span><br><span class="line">                          moq.LOCATOR_ID,</span><br><span class="line">                          moq.SUBINVENTORY_CODE,</span><br><span class="line">                          moq.INVENTORY_ITEM_ID,</span><br><span class="line">                          moq.ORGANIZATION_ID,</span><br><span class="line">                          moq.LOT_NUMBER) mq</span><br><span class="line">         WHERE 1 &#x3D; 1</span><br><span class="line">           AND wro.INVENTORY_ITEM_ID &#x3D; mq.INVENTORY_ITEM_ID</span><br><span class="line">           AND wro.ORGANIZATION_ID &#x3D; mq.ORGANIZATION_ID</span><br><span class="line">           AND wro.SUPPLY_SUBINVENTORY &#x3D; mq.SUBINVENTORY_CODE</span><br><span class="line">           AND wro.wip_entity_id &#x3D; 181176;</span><br><span class="line">      EXCEPTION</span><br><span class="line">        WHEN NO_DATA_FOUND THEN</span><br><span class="line">          x_msg_data      :&#x3D; &#39;需求物料与子装配件编码不匹配，请检查。&#39;;</span><br><span class="line">          x_return_status :&#x3D; g_error;</span><br><span class="line">        WHEN OTHERS THEN</span><br><span class="line">          x_msg_data      :&#x3D; &#39;获取子库&#x2F;货位存在内部错误。&#39;;</span><br><span class="line">          x_return_status :&#x3D; g_error;</span><br><span class="line">      END;</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_msg_data      :&#x3D; &#39;批次校验存在内部错误。&#39;;</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">    </span><br><span class="line">  END;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      vld_data</span><br><span class="line">  Description:</span><br><span class="line">      校验数据</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_data(x_return_status OUT NOCOPY VARCHAR2,</span><br><span class="line">                     x_msg_count     OUT NOCOPY NUMBER,</span><br><span class="line">                     x_msg_data      OUT NOCOPY VARCHAR2) IS</span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(30) :&#x3D; &#39;vld_data&#39;;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(30) :&#x3D; &#39;sp_vld_data&#39;;</span><br><span class="line">    l_return_status VARCHAR2(10);</span><br><span class="line">    l_msg_data      VARCHAR2(4000);</span><br><span class="line">    l_row_status    VARCHAR2(10);</span><br><span class="line">    l_row_msg       VARCHAR2(4000);</span><br><span class="line">  </span><br><span class="line">    l_subinventory_code VARCHAR2(255);</span><br><span class="line">    l_locator_code      VARCHAR2(255);</span><br><span class="line">    l_locator_id        NUMBER;</span><br><span class="line">  </span><br><span class="line">    CURSOR cur_vld IS</span><br><span class="line">      SELECT t.iface_id,</span><br><span class="line">             t.organization_id,</span><br><span class="line">             t.organization_code,</span><br><span class="line">             t.item_id,</span><br><span class="line">             t.item_num,</span><br><span class="line">             t.uom_code,</span><br><span class="line">             t.subinventory_code,</span><br><span class="line">             t.locator_id,</span><br><span class="line">             t.locator_code,</span><br><span class="line">             t.lot_number,</span><br><span class="line">             t.wip_entity_name,</span><br><span class="line">             t.quantity,</span><br><span class="line">             t.wip_entity_id,</span><br><span class="line">             t.source_txn_id,</span><br><span class="line">             t.request_id,</span><br><span class="line">             t.transaction_type,</span><br><span class="line">             t.process_type,</span><br><span class="line">             t.process_status,</span><br><span class="line">             t.process_by,</span><br><span class="line">             t.process_date,</span><br><span class="line">             t.error_msg,</span><br><span class="line">             t.creation_date,</span><br><span class="line">             t.created_by,</span><br><span class="line">             t.last_updated_by,</span><br><span class="line">             t.last_update_date,</span><br><span class="line">             t.last_update_login,</span><br><span class="line">             t.attribute_category,</span><br><span class="line">             t.attribute1,</span><br><span class="line">             t.attribute2,</span><br><span class="line">             t.attribute3,</span><br><span class="line">             t.attribute4,</span><br><span class="line">             t.attribute5,</span><br><span class="line">             t.attribute6,</span><br><span class="line">             t.attribute7,</span><br><span class="line">             t.attribute8,</span><br><span class="line">             t.attribute9,</span><br><span class="line">             t.attribute10,</span><br><span class="line">             t.attribute11,</span><br><span class="line">             t.attribute12,</span><br><span class="line">             t.attribute13,</span><br><span class="line">             t.attribute14,</span><br><span class="line">             t.attribute15</span><br><span class="line">        FROM GJ.GJ_MES_ISSUE_IFACE t</span><br><span class="line">       WHERE 1 &#x3D; 1</span><br><span class="line">         AND t.process_status IS NULL;</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    -- start activity to create savepoint, check compatibility</span><br><span class="line">    -- and initialize message list, include debug message hint to enter api</span><br><span class="line">    x_return_status :&#x3D; cux_api.start_activity(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                              p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                              p_savepoint_name &#x3D;&gt; l_savepoint_name);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">    -- API body</span><br><span class="line">    FOR rec_vld IN cur_vld LOOP</span><br><span class="line">      --初始化</span><br><span class="line">      l_row_status :&#x3D; g_pending;</span><br><span class="line">      l_row_msg    :&#x3D; NULL;</span><br><span class="line">    </span><br><span class="line">      --校验控制</span><br><span class="line">      -- 1.库存组织  是否在ERP中存在</span><br><span class="line">      gj_bc_vld_data_utl.vld_organization(p_organization_code &#x3D;&gt; rec_vld.organization_code,</span><br><span class="line">                                          x_msg_data          &#x3D;&gt; l_msg_data,</span><br><span class="line">                                          x_organization_id   &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                                          x_return_status     &#x3D;&gt; l_return_status);</span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      -- 2.工单</span><br><span class="line">      gj_bc_vld_data_utl.vld_wip_entity_name(p_organization_id   &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                                             p_organization_code &#x3D;&gt; rec_vld.organization_code,</span><br><span class="line">                                             p_wip_entity_name   &#x3D;&gt; rec_vld.wip_entity_name,</span><br><span class="line">                                             x_wip_entity_id     &#x3D;&gt; rec_vld.wip_entity_id,</span><br><span class="line">                                             x_msg_data          &#x3D;&gt; l_msg_data,</span><br><span class="line">                                             x_return_status     &#x3D;&gt; l_return_status);</span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      -- 3.工单状态</span><br><span class="line">      gj_bc_vld_data_utl.vld_wip_entity_status(p_wip_entity_id   &#x3D;&gt; rec_vld.wip_entity_id,</span><br><span class="line">                                               p_wip_entity_name &#x3D;&gt; rec_vld.wip_entity_name,</span><br><span class="line">                                               p_organization_id &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                                               x_return_status   &#x3D;&gt; l_return_status,</span><br><span class="line">                                               x_msg_data        &#x3D;&gt; l_msg_data);</span><br><span class="line">    </span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      -- 4.物料编码</span><br><span class="line">      gj_bc_vld_data_utl.vld_item_num(p_organization_id &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                                      p_item_num        &#x3D;&gt; rec_vld.item_num,</span><br><span class="line">                                      x_item_id         &#x3D;&gt; rec_vld.item_id,</span><br><span class="line">                                      x_msg_data        &#x3D;&gt; l_msg_data,</span><br><span class="line">                                      x_return_status   &#x3D;&gt; l_return_status);</span><br><span class="line">    </span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      &#x2F;*      -- 推式</span><br><span class="line">      vld_item_push(p_item_id         &#x3D;&gt; rec_vld.item_id,</span><br><span class="line">                    p_item_num        &#x3D;&gt; rec_vld.item_num,</span><br><span class="line">                    p_organization_id &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                    x_msg_data        &#x3D;&gt; l_msg_data,</span><br><span class="line">                    x_return_status   &#x3D;&gt; l_return_status);</span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;*&#x2F;</span><br><span class="line">    </span><br><span class="line">      -- 投料日期  1不能为未来时间 2.在库存会计期内</span><br><span class="line">      IF rec_vld.process_date &gt; SYSDATE THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_INV_TXN_DATE_UNVALID&#39;);</span><br><span class="line">        l_msg_data :&#x3D; fnd_message.get;</span><br><span class="line">        l_row_msg  :&#x3D; l_msg_data || l_row_msg;</span><br><span class="line">      END IF;</span><br><span class="line">      vld_txn_data(p_txn_date        &#x3D;&gt; rec_vld.process_date,</span><br><span class="line">                   p_organization_id &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                   x_msg_data        &#x3D;&gt; l_msg_data,</span><br><span class="line">                   x_return_status   &#x3D;&gt; l_return_status);</span><br><span class="line">    </span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      -- 数量</span><br><span class="line">      IF rec_vld.quantity &gt;</span><br><span class="line">         get_onhand_qty(p_item_id           &#x3D;&gt; rec_vld.item_id,</span><br><span class="line">                        p_organization_id   &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                        p_subinventory_code &#x3D;&gt; rec_vld.subinventory_code,</span><br><span class="line">                        p_locator_id        &#x3D;&gt; rec_vld.locator_id,</span><br><span class="line">                        p_lot_number        &#x3D;&gt; rec_vld.lot_number) THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        fnd_message.set_name(&#39;INV&#39;, &#39;INV-NEGQTY VIOLATION&#39;); --现有量不足</span><br><span class="line">        l_row_msg :&#x3D; l_row_msg || fnd_message.get;</span><br><span class="line">      </span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      -- 批次</span><br><span class="line">      vld_lot_control(p_organization_id   &#x3D;&gt; rec_vld.organization_id,</span><br><span class="line">                      p_item_id           &#x3D;&gt; rec_vld.item_id,</span><br><span class="line">                      p_lot_number        &#x3D;&gt; rec_vld.lot_number,</span><br><span class="line">                      x_subinventory_code &#x3D;&gt; l_subinventory_code,</span><br><span class="line">                      x_locator_code      &#x3D;&gt; l_locator_code,</span><br><span class="line">                      x_locator_id        &#x3D;&gt; l_locator_id,</span><br><span class="line">                      x_msg_data          &#x3D;&gt; l_msg_data,</span><br><span class="line">                      x_return_status     &#x3D;&gt; l_return_status);</span><br><span class="line">      IF l_return_status IS NOT NULL THEN</span><br><span class="line">        l_row_status :&#x3D; g_error;</span><br><span class="line">        l_row_msg    :&#x3D; l_row_msg || l_msg_data;</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">      -- 更新接口信息</span><br><span class="line">      UPDATE GJ.GJ_MES_ISSUE_IFACE gm</span><br><span class="line">         SET gm.item_id           &#x3D; rec_vld.item_id,</span><br><span class="line">             gm.wip_entity_id     &#x3D; rec_vld.wip_entity_id,</span><br><span class="line">             gm.locator_id        &#x3D; l_locator_id,</span><br><span class="line">             gm.subinventory_code &#x3D; l_subinventory_code,</span><br><span class="line">             gm.locator_code      &#x3D; l_locator_code,</span><br><span class="line">             gm.process_status    &#x3D; l_row_status,</span><br><span class="line">             gm.error_msg         &#x3D; l_row_msg,</span><br><span class="line">             gm.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">             gm.created_by        &#x3D; nvl(rec_vld.created_by, g_user_id),</span><br><span class="line">             gm.last_updated_by   &#x3D; nvl(rec_vld.created_by, g_user_id),</span><br><span class="line">             gm.last_update_login &#x3D; g_login_id,</span><br><span class="line">             gm.creation_date     &#x3D; g_sysdate,</span><br><span class="line">             gm.request_id        &#x3D; g_conc_request_id,</span><br><span class="line">             gm.process_by        &#x3D; g_user_id</span><br><span class="line">       WHERE gm.iface_id &#x3D; rec_vld.iface_id;</span><br><span class="line">    </span><br><span class="line">      IF l_row_status &#x3D; g_error THEN</span><br><span class="line">        update_remote_table(p_serial_number &#x3D;&gt; rec_vld.source_txn_id,</span><br><span class="line">                            p_status        &#x3D;&gt; g_error,</span><br><span class="line">                            p_msg_data      &#x3D;&gt; l_row_msg);</span><br><span class="line">      ELSE</span><br><span class="line">        update_remote_table(p_serial_number &#x3D;&gt; rec_vld.source_txn_id,</span><br><span class="line">                            p_status        &#x3D;&gt; g_pending,</span><br><span class="line">                            p_msg_data      &#x3D;&gt; &#39;数据已校验，等待排队处理。&#39;);</span><br><span class="line">      END IF;</span><br><span class="line">    </span><br><span class="line">    END LOOP;</span><br><span class="line">    -- API end body</span><br><span class="line">    -- end activity, include debug message hint to exit api</span><br><span class="line">    x_return_status :&#x3D; cux_api.end_activity(p_pkg_name  &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                            p_api_name  &#x3D;&gt; l_api_name,</span><br><span class="line">                                            x_msg_count &#x3D;&gt; x_msg_count,</span><br><span class="line">                                            x_msg_data  &#x3D;&gt; x_msg_data);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">  END vld_data;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      calling_program</span><br><span class="line">  Description:</span><br><span class="line">      处理事务处理API</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE calling_program(p_api_version   IN NUMBER,</span><br><span class="line">                            p_init_msg_list IN VARCHAR2 DEFAULT fnd_api.g_false,</span><br><span class="line">                            p_commit        IN VARCHAR2 DEFAULT fnd_api.g_false,</span><br><span class="line">                            p_table         IN NUMBER DEFAULT 1,</span><br><span class="line">                            p_txn_header_id IN NUMBER,</span><br><span class="line">                            x_error_record  OUT tab_iface_error,</span><br><span class="line">                            x_return_status OUT VARCHAR2,</span><br><span class="line">                            x_msg_count     OUT VARCHAR2,</span><br><span class="line">                            x_msg_data      OUT VARCHAR2) IS</span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(50) :&#x3D; &#39;process_transaction&#39;;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(30) :&#x3D; &#39;process_transaction01&#39;;</span><br><span class="line">    l_api_version    CONSTANT NUMBER :&#x3D; 1.0;</span><br><span class="line">    l_return_status VARCHAR2(1);</span><br><span class="line">    l_msg_count     NUMBER;</span><br><span class="line">    l_msg_data      VARCHAR2(2000);</span><br><span class="line">    l_txn_count     NUMBER;</span><br><span class="line">    l_retval        NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    x_return_status :&#x3D; cux_api.start_activity(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                              p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                              p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                              p_init_msg_list  &#x3D;&gt; p_init_msg_list,</span><br><span class="line">                                              l_api_version    &#x3D;&gt; l_api_version,</span><br><span class="line">                                              p_api_version    &#x3D;&gt; p_api_version);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    -- 调用系统标准API导入</span><br><span class="line">    l_retval :&#x3D; inv_txn_manager_pub.process_transactions(p_api_version      &#x3D;&gt; 1.0,</span><br><span class="line">                                                         p_init_msg_list    &#x3D;&gt; fnd_api.g_true,</span><br><span class="line">                                                         p_commit           &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                                                         p_validation_level &#x3D;&gt; fnd_api.g_valid_level_full,</span><br><span class="line">                                                         x_return_status    &#x3D;&gt; l_return_status,</span><br><span class="line">                                                         x_msg_count        &#x3D;&gt; l_msg_count,</span><br><span class="line">                                                         x_msg_data         &#x3D;&gt; l_msg_data,</span><br><span class="line">                                                         x_trans_count      &#x3D;&gt; l_txn_count,</span><br><span class="line">                                                         p_table            &#x3D;&gt; p_table,</span><br><span class="line">                                                         p_header_id        &#x3D;&gt; p_txn_header_id);</span><br><span class="line">    -- 接口处理不成功</span><br><span class="line">    IF l_retval &lt;&gt; 0 THEN</span><br><span class="line">      IF p_table &#x3D; 1 THEN</span><br><span class="line">        -- 返回出错信息记录组</span><br><span class="line">        SELECT source_code,</span><br><span class="line">               source_header_id,</span><br><span class="line">               source_line_id,</span><br><span class="line">               ERROR_CODE,</span><br><span class="line">               error_explanation</span><br><span class="line">          BULK COLLECT</span><br><span class="line">          INTO x_error_record</span><br><span class="line">          FROM mtl_transactions_interface</span><br><span class="line">         WHERE transaction_header_id &#x3D; p_txn_header_id</span><br><span class="line">           AND (ERROR_CODE IS NOT NULL OR error_explanation IS NOT NULL);</span><br><span class="line">      </span><br><span class="line">      ELSIF p_table &#x3D; 2 THEN</span><br><span class="line">        SELECT source_code,</span><br><span class="line">               NULL, --source_header_id,</span><br><span class="line">               source_line_id,</span><br><span class="line">               ERROR_CODE,</span><br><span class="line">               error_explanation</span><br><span class="line">          BULK COLLECT</span><br><span class="line">          INTO x_error_record</span><br><span class="line">          FROM mtl_material_transactions_temp</span><br><span class="line">         WHERE transaction_header_id &#x3D; p_txn_header_id</span><br><span class="line">           AND (ERROR_CODE IS NOT NULL OR error_explanation IS NOT NULL);</span><br><span class="line">      END IF;</span><br><span class="line">    END IF;</span><br><span class="line">    x_msg_data      :&#x3D; l_msg_data;</span><br><span class="line">    x_return_status :&#x3D; cux_api.end_activity(p_pkg_name  &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                            p_api_name  &#x3D;&gt; l_api_name,</span><br><span class="line">                                            p_commit    &#x3D;&gt; p_commit,</span><br><span class="line">                                            x_msg_count &#x3D;&gt; x_msg_count,</span><br><span class="line">                                            x_msg_data  &#x3D;&gt; x_msg_data);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">  END calling_program;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      process_transaction</span><br><span class="line">  Description:</span><br><span class="line">      处理事务处理</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE process_transaction(x_return_status OUT NOCOPY VARCHAR2,</span><br><span class="line">                                x_msg_count     OUT NOCOPY NUMBER,</span><br><span class="line">                                x_msg_data      OUT NOCOPY VARCHAR2,</span><br><span class="line">                                p_group_id      IN NUMBER) IS</span><br><span class="line">    l_api_name    CONSTANT VARCHAR2(100) :&#x3D; &#39;process_transaction_pick&#39;;</span><br><span class="line">    l_api_version CONSTANT NUMBER :&#x3D; 1.0;</span><br><span class="line">    l_savepoint_name  VARCHAR2(30) :&#x3D; &#39;sp_process_transaction&#39;;</span><br><span class="line">    l_tab_iface_error tab_iface_error;</span><br><span class="line">    l_error_msg       VARCHAR2(4000);</span><br><span class="line">    l_source_txn_id   VARCHAR2(36);</span><br><span class="line">    l_header_id       NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    x_return_status :&#x3D; cux_api.start_activity(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                              p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                              p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                              p_init_msg_list  &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                                              l_api_version    &#x3D;&gt; l_api_version,</span><br><span class="line">                                              p_api_version    &#x3D;&gt; l_api_version);</span><br><span class="line">  </span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  </span><br><span class="line">    calling_program(p_api_version   &#x3D;&gt; &#39;1.0&#39;,</span><br><span class="line">                    p_init_msg_list &#x3D;&gt; fnd_api.g_true,</span><br><span class="line">                    p_commit        &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                    p_table         &#x3D;&gt; 1,</span><br><span class="line">                    p_txn_header_id &#x3D;&gt; p_group_id,</span><br><span class="line">                    x_error_record  &#x3D;&gt; l_tab_iface_error,</span><br><span class="line">                    x_return_status &#x3D;&gt; x_return_status,</span><br><span class="line">                    x_msg_count     &#x3D;&gt; x_msg_count,</span><br><span class="line">                    x_msg_data      &#x3D;&gt; x_msg_data);</span><br><span class="line">    --更新错误信息</span><br><span class="line">    IF x_return_status &lt;&gt; fnd_api.g_ret_sts_success OR</span><br><span class="line">       l_tab_iface_error.count &gt; 0 THEN</span><br><span class="line">      FOR i IN 1 .. l_tab_iface_error.count LOOP</span><br><span class="line">        l_error_msg :&#x3D; substr(l_error_msg || l_tab_iface_error(i)</span><br><span class="line">                              .error_explanation,</span><br><span class="line">                              1,</span><br><span class="line">                              1000);</span><br><span class="line">        l_header_id :&#x3D; l_tab_iface_error(i).source_header_id;</span><br><span class="line">        IF nvl(g_debug, &#39;Y&#39;) &#x3D; &#39;Y&#39; THEN</span><br><span class="line">          log_msg(&#39;iface_id-&gt; &#39; || l_header_id || &#39;status---&gt;&#39; ||</span><br><span class="line">                  x_return_status || &#39; msg---&gt;&#39; || x_msg_data);</span><br><span class="line">        END IF;</span><br><span class="line">      </span><br><span class="line">        UPDATE GJ.GJ_MES_ISSUE_IFACE gbc</span><br><span class="line">           SET gbc.error_msg      &#x3D; l_error_msg,</span><br><span class="line">               gbc.process_status &#x3D; g_error,</span><br><span class="line">               --who</span><br><span class="line">               gbc.last_updated_by   &#x3D; g_user_id,</span><br><span class="line">               gbc.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">               gbc.last_update_login &#x3D; g_login_id,</span><br><span class="line">               gbc.request_id        &#x3D; g_conc_request_id</span><br><span class="line">         WHERE gbc.iface_id &#x3D; l_header_id;</span><br><span class="line">      </span><br><span class="line">        SELECT MAX(source_txn_id)</span><br><span class="line">          INTO l_source_txn_id</span><br><span class="line">          FROM GJ.GJ_MES_ISSUE_IFACE gbc</span><br><span class="line">         WHERE gbc.iface_id &#x3D; l_header_id;</span><br><span class="line">        IF l_source_txn_id IS NOT NULL THEN</span><br><span class="line">          update_remote_table(p_serial_number &#x3D;&gt; l_source_txn_id,</span><br><span class="line">                              p_status        &#x3D;&gt; g_error,</span><br><span class="line">                              p_msg_data      &#x3D;&gt; l_error_msg);</span><br><span class="line">        </span><br><span class="line">        END IF;</span><br><span class="line">      </span><br><span class="line">      END LOOP;</span><br><span class="line">    </span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">    x_return_status :&#x3D; cux_api.end_activity(p_pkg_name  &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                            p_api_name  &#x3D;&gt; l_api_name,</span><br><span class="line">                                            p_commit    &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                                            x_msg_count &#x3D;&gt; x_msg_count,</span><br><span class="line">                                            x_msg_data  &#x3D;&gt; x_msg_data);</span><br><span class="line">    raise_exception(x_return_status);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">  END process_transaction;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      process_issue</span><br><span class="line">  Description:</span><br><span class="line">      工单投料</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE process_issue(x_return_status OUT NOCOPY VARCHAR2,</span><br><span class="line">                          x_msg_count     OUT NOCOPY NUMBER,</span><br><span class="line">                          x_msg_data      OUT NOCOPY VARCHAR2,</span><br><span class="line">                          x_group_id      OUT NUMBER) IS</span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(30) :&#x3D; &#39;process_issue&#39;;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(30) :&#x3D; &#39;sp_process_issue&#39;;</span><br><span class="line">  </span><br><span class="line">    l_iface_rec                  inv.mtl_transactions_interface%ROWTYPE;</span><br><span class="line">    l_iface_lot_rec              mtl_transaction_lots_interface%ROWTYPE;</span><br><span class="line">    l_transaction_type_id        NUMBER;</span><br><span class="line">    l_transaction_action_id      NUMBER;</span><br><span class="line">    l_transaction_source_type_id NUMBER;</span><br><span class="line">  </span><br><span class="line">    l_iface_id      NUMBER;</span><br><span class="line">    l_source_txn_id VARCHAR2(36);</span><br><span class="line">  </span><br><span class="line">    CURSOR cur_txn_type(p_transaction_name IN VARCHAR2) IS</span><br><span class="line">      SELECT mtt.transaction_type_id,</span><br><span class="line">             mtt.transaction_action_id,</span><br><span class="line">             mtt.transaction_source_type_id</span><br><span class="line">        FROM mtl_transaction_types mtt</span><br><span class="line">       WHERE mtt.TRANSACTION_TYPE_NAME &#x3D; p_transaction_name;</span><br><span class="line">  </span><br><span class="line">    CURSOR cur_iss IS</span><br><span class="line">      SELECT t.iface_id,</span><br><span class="line">             t.organization_id,</span><br><span class="line">             t.organization_code,</span><br><span class="line">             t.item_id,</span><br><span class="line">             t.item_num,</span><br><span class="line">             t.uom_code,</span><br><span class="line">             t.subinventory_code,</span><br><span class="line">             t.locator_id,</span><br><span class="line">             t.locator_code,</span><br><span class="line">             t.lot_number,</span><br><span class="line">             t.wip_entity_name,</span><br><span class="line">             t.quantity,</span><br><span class="line">             t.wip_entity_id,</span><br><span class="line">             t.source_txn_id,</span><br><span class="line">             t.request_id,</span><br><span class="line">             t.transaction_type,</span><br><span class="line">             t.process_type,</span><br><span class="line">             t.process_status,</span><br><span class="line">             t.process_by,</span><br><span class="line">             t.process_date,</span><br><span class="line">             t.error_msg,</span><br><span class="line">             t.creation_date,</span><br><span class="line">             t.created_by,</span><br><span class="line">             t.last_updated_by,</span><br><span class="line">             t.last_update_date,</span><br><span class="line">             t.last_update_login,</span><br><span class="line">             t.attribute_category,</span><br><span class="line">             t.attribute1,</span><br><span class="line">             t.attribute2,</span><br><span class="line">             t.attribute3,</span><br><span class="line">             t.attribute4,</span><br><span class="line">             t.attribute5,</span><br><span class="line">             t.attribute6,</span><br><span class="line">             t.attribute7,</span><br><span class="line">             t.attribute8,</span><br><span class="line">             t.attribute9,</span><br><span class="line">             t.attribute10,</span><br><span class="line">             t.attribute11,</span><br><span class="line">             t.attribute12,</span><br><span class="line">             t.attribute13,</span><br><span class="line">             t.attribute14,</span><br><span class="line">             t.attribute15</span><br><span class="line">        FROM GJ.GJ_MES_ISSUE_IFACE t</span><br><span class="line">       WHERE 1 &#x3D; 1</span><br><span class="line">         AND t.process_status &#x3D; g_pending;</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    -- start activity to create savepoint, check compatibility</span><br><span class="line">    -- and initialize message list, include debug message hint to enter api</span><br><span class="line">    x_return_status :&#x3D; cux_api.start_activity(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                              p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                              p_savepoint_name &#x3D;&gt; l_savepoint_name);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">    -- API body</span><br><span class="line">  </span><br><span class="line">    --获取事务处理批次ID</span><br><span class="line">    SELECT mtl_material_transactions_s.nextval INTO x_group_id FROM dual;</span><br><span class="line">  </span><br><span class="line">    FOR rec_iss IN cur_iss LOOP</span><br><span class="line">      l_iface_rec :&#x3D; NULL;</span><br><span class="line">      </span><br><span class="line">      -- 事务处理类型</span><br><span class="line">      OPEN cur_txn_type(p_transaction_name &#x3D;&gt; rec_iss.transaction_type);</span><br><span class="line">      FETCH cur_txn_type</span><br><span class="line">        INTO l_transaction_type_id,</span><br><span class="line">             l_transaction_action_id,</span><br><span class="line">             l_transaction_source_type_id;</span><br><span class="line">      CLOSE cur_txn_type;</span><br><span class="line">    </span><br><span class="line">      l_iface_id      :&#x3D; rec_iss.iface_id;</span><br><span class="line">      l_source_txn_id :&#x3D; rec_iss.source_txn_id;</span><br><span class="line">    </span><br><span class="line">      -- 主键</span><br><span class="line">      SELECT mtl_material_transactions_s.nextval</span><br><span class="line">        INTO l_iface_rec.transaction_interface_id</span><br><span class="line">        FROM dual;</span><br><span class="line">    </span><br><span class="line">      -- 事务处理类型</span><br><span class="line">      l_iface_rec.transaction_type_id        :&#x3D; l_transaction_type_id; --wip issue</span><br><span class="line">      l_iface_rec.transaction_source_type_id :&#x3D; l_transaction_source_type_id;</span><br><span class="line">      l_iface_rec.transaction_action_id      :&#x3D; l_transaction_action_id;</span><br><span class="line">      </span><br><span class="line">      -- 库存组织</span><br><span class="line">      l_iface_rec.organization_id :&#x3D; rec_iss.organization_id;</span><br><span class="line">    </span><br><span class="line">      -- 子库</span><br><span class="line">      l_iface_rec.subinventory_code :&#x3D; rec_iss.subinventory_code;</span><br><span class="line">    </span><br><span class="line">      -- 货位</span><br><span class="line">      l_iface_rec.locator_id :&#x3D; rec_iss.locator_id;</span><br><span class="line">    </span><br><span class="line">      --物料</span><br><span class="line">      l_iface_rec.inventory_item_id :&#x3D; rec_iss.item_id;</span><br><span class="line">      l_iface_rec.inventory_item    :&#x3D; rec_iss.item_num;</span><br><span class="line">    </span><br><span class="line">      -- 数量</span><br><span class="line">      l_iface_rec.transaction_quantity :&#x3D; rec_iss.quantity;</span><br><span class="line">    </span><br><span class="line">      -- 单位</span><br><span class="line">      l_iface_rec.transaction_uom :&#x3D; rec_iss.uom_code;</span><br><span class="line">    </span><br><span class="line">      -- 工序</span><br><span class="line">      SELECT MIN(wro.operation_seq_num)</span><br><span class="line">        INTO l_iface_rec.operation_seq_num</span><br><span class="line">        FROM wip_requirement_operations wro</span><br><span class="line">       WHERE wro.organization_id &#x3D; rec_iss.organization_id</span><br><span class="line">         AND wro.wip_entity_id &#x3D; rec_iss.wip_entity_id</span><br><span class="line">       ORDER BY wro.operation_seq_num;</span><br><span class="line">    </span><br><span class="line">      -- 工单</span><br><span class="line">      l_iface_rec.transaction_source_id   :&#x3D; rec_iss.wip_entity_id;</span><br><span class="line">      l_iface_rec.transaction_source_name :&#x3D; rec_iss.wip_entity_name;</span><br><span class="line">    </span><br><span class="line">      --参考</span><br><span class="line">      l_iface_rec.transaction_reference :&#x3D; rec_iss.iface_id;</span><br><span class="line">    </span><br><span class="line">      --日期</span><br><span class="line">      l_iface_rec.transaction_date :&#x3D; rec_iss.process_date;</span><br><span class="line">    </span><br><span class="line">      -- who</span><br><span class="line">      l_iface_rec.last_update_date  :&#x3D; g_sysdate;</span><br><span class="line">      l_iface_rec.creation_date     :&#x3D; g_sysdate;</span><br><span class="line">      l_iface_rec.created_by        :&#x3D; rec_iss.created_by;</span><br><span class="line">      l_iface_rec.last_updated_by   :&#x3D; rec_iss.created_by;</span><br><span class="line">      l_iface_rec.last_update_login :&#x3D; g_login_id;</span><br><span class="line">    </span><br><span class="line">      -- mode</span><br><span class="line">      l_iface_rec.transaction_header_id :&#x3D; x_group_id;</span><br><span class="line">      l_iface_rec.transaction_mode      :&#x3D; 3;</span><br><span class="line">      l_iface_rec.process_flag          :&#x3D; 1;</span><br><span class="line">      l_iface_rec.source_code           :&#x3D; &#39;GJ_MES_ISSUE_IFACE&#39;; --来源代码，作为追溯条件</span><br><span class="line">      l_iface_rec.source_header_id      :&#x3D; rec_iss.iface_id;</span><br><span class="line">      l_iface_rec.source_line_id        :&#x3D; rec_iss.iface_id;</span><br><span class="line">    </span><br><span class="line">      -- insert</span><br><span class="line">      INSERT INTO inv.mtl_transactions_interface VALUES l_iface_rec;</span><br><span class="line">    </span><br><span class="line">      -- lot_number</span><br><span class="line">      IF rec_iss.lot_number IS NOT NULL THEN</span><br><span class="line">      </span><br><span class="line">        l_iface_lot_rec.transaction_interface_id :&#x3D; l_iface_rec.transaction_interface_id;</span><br><span class="line">        l_iface_lot_rec.lot_number               :&#x3D; rec_iss.lot_number;</span><br><span class="line">        l_iface_lot_rec.transaction_quantity     :&#x3D; (-1) * rec_iss.quantity;</span><br><span class="line">        l_iface_lot_rec.primary_quantity         :&#x3D; (-1) * rec_iss.quantity;</span><br><span class="line">        l_iface_lot_rec.source_line_id           :&#x3D; rec_iss.iface_id;</span><br><span class="line">      </span><br><span class="line">        l_iface_lot_rec.last_update_date  :&#x3D; g_sysdate;</span><br><span class="line">        l_iface_lot_rec.last_updated_by   :&#x3D; rec_iss.created_by;</span><br><span class="line">        l_iface_lot_rec.creation_date     :&#x3D; g_sysdate;</span><br><span class="line">        l_iface_lot_rec.created_by        :&#x3D; rec_iss.created_by;</span><br><span class="line">        l_iface_lot_rec.last_update_login :&#x3D; g_login_id;</span><br><span class="line">      </span><br><span class="line">        INSERT INTO mtl_transaction_lots_interface VALUES l_iface_lot_rec;</span><br><span class="line">      </span><br><span class="line">      END IF; -- 存在批次</span><br><span class="line">    </span><br><span class="line">      --先更新为成功状态，等待处理完如果报错则更新为错误</span><br><span class="line">      UPDATE GJ.GJ_MES_ISSUE_IFACE gbc</span><br><span class="line">         SET gbc.error_msg      &#x3D; NULL,</span><br><span class="line">             gbc.process_status &#x3D; g_success,</span><br><span class="line">             --who</span><br><span class="line">             gbc.last_updated_by   &#x3D; g_user_id,</span><br><span class="line">             gbc.last_update_date  &#x3D; g_sysdate,</span><br><span class="line">             gbc.last_update_login &#x3D; g_login_id,</span><br><span class="line">             gbc.request_id        &#x3D; g_conc_request_id</span><br><span class="line">       WHERE gbc.iface_id &#x3D; rec_iss.iface_id;</span><br><span class="line">    </span><br><span class="line">      update_remote_table(p_serial_number &#x3D;&gt; rec_iss.source_txn_id,</span><br><span class="line">                          p_status        &#x3D;&gt; g_success,</span><br><span class="line">                          p_msg_data      &#x3D;&gt; NULL);</span><br><span class="line">    </span><br><span class="line">    END LOOP;</span><br><span class="line">  </span><br><span class="line">    -- API end body</span><br><span class="line">    -- end activity, include debug message hint to exit api</span><br><span class="line">    x_return_status :&#x3D; cux_api.end_activity(p_pkg_name  &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                            p_api_name  &#x3D;&gt; l_api_name,</span><br><span class="line">                                            x_msg_count &#x3D;&gt; x_msg_count,</span><br><span class="line">                                            x_msg_data  &#x3D;&gt; x_msg_data);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    </span><br><span class="line">      update_iface(p_iface_id &#x3D;&gt; l_iface_id,</span><br><span class="line">                   p_status   &#x3D;&gt; g_error,</span><br><span class="line">                   p_msg_data &#x3D;&gt; x_msg_data);</span><br><span class="line">      update_remote_table(p_serial_number &#x3D;&gt; l_source_txn_id,</span><br><span class="line">                          p_status        &#x3D;&gt; g_error,</span><br><span class="line">                          p_msg_data      &#x3D;&gt; x_msg_data);</span><br><span class="line">    </span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">    </span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    </span><br><span class="line">      update_iface(p_iface_id &#x3D;&gt; l_iface_id,</span><br><span class="line">                   p_status   &#x3D;&gt; g_error,</span><br><span class="line">                   p_msg_data &#x3D;&gt; x_msg_data);</span><br><span class="line">      update_remote_table(p_serial_number &#x3D;&gt; l_source_txn_id,</span><br><span class="line">                          p_status        &#x3D;&gt; g_error,</span><br><span class="line">                          p_msg_data      &#x3D;&gt; x_msg_data);</span><br><span class="line">    </span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">    </span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">      update_iface(p_iface_id &#x3D;&gt; l_iface_id,</span><br><span class="line">                   p_status   &#x3D;&gt; g_error,</span><br><span class="line">                   p_msg_data &#x3D;&gt; x_msg_data);</span><br><span class="line">      update_remote_table(p_serial_number &#x3D;&gt; l_source_txn_id,</span><br><span class="line">                          p_status        &#x3D;&gt; g_error,</span><br><span class="line">                          p_msg_data      &#x3D;&gt; x_msg_data);</span><br><span class="line">  END process_issue;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      process_request</span><br><span class="line">  Description:</span><br><span class="line">      处理请求</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020-4-28 上午 8:20:08  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE process_request(p_init_msg_list IN VARCHAR2 DEFAULT fnd_api.g_false,</span><br><span class="line">                            p_commit        IN VARCHAR2 DEFAULT fnd_api.g_false,</span><br><span class="line">                            x_return_status OUT NOCOPY VARCHAR2,</span><br><span class="line">                            x_msg_count     OUT NOCOPY NUMBER,</span><br><span class="line">                            x_msg_data      OUT NOCOPY VARCHAR2) IS</span><br><span class="line">    l_api_name       CONSTANT VARCHAR2(30) :&#x3D; &#39;process_request&#39;;</span><br><span class="line">    l_savepoint_name CONSTANT VARCHAR2(30) :&#x3D; &#39;sp_process_request&#39;;</span><br><span class="line">    l_group_id NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    x_return_status :&#x3D; cux_api.start_activity(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                              p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                              p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                              p_init_msg_list  &#x3D;&gt; p_init_msg_list);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  </span><br><span class="line">    -------------API body start</span><br><span class="line">  </span><br><span class="line">    --1.拉取中间库的数据</span><br><span class="line">    get_issue_data(x_return_status &#x3D;&gt; x_return_status,</span><br><span class="line">                   x_msg_count     &#x3D;&gt; x_msg_count,</span><br><span class="line">                   x_msg_data      &#x3D;&gt; x_msg_data);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  </span><br><span class="line">    -- 2.校验数据</span><br><span class="line">    vld_data(x_return_status &#x3D;&gt; x_return_status,</span><br><span class="line">             x_msg_count     &#x3D;&gt; x_msg_count,</span><br><span class="line">             x_msg_data      &#x3D;&gt; x_msg_data);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  </span><br><span class="line">    --3.工单投料</span><br><span class="line">    process_issue(x_return_status &#x3D;&gt; x_return_status,</span><br><span class="line">                  x_msg_count     &#x3D;&gt; x_msg_count,</span><br><span class="line">                  x_msg_data      &#x3D;&gt; x_msg_data,</span><br><span class="line">                  x_group_id      &#x3D;&gt; l_group_id);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  </span><br><span class="line">    --4.调用事务处理管理器</span><br><span class="line">    process_transaction(x_return_status &#x3D;&gt; x_return_status,</span><br><span class="line">                        x_msg_count     &#x3D;&gt; x_msg_count,</span><br><span class="line">                        x_msg_data      &#x3D;&gt; x_msg_data,</span><br><span class="line">                        p_group_id      &#x3D;&gt; l_group_id);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; x_return_status);</span><br><span class="line">  </span><br><span class="line">    -------------API body end</span><br><span class="line">  </span><br><span class="line">    x_return_status :&#x3D; cux_api.end_activity(p_pkg_name  &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                            p_api_name  &#x3D;&gt; l_api_name,</span><br><span class="line">                                            p_commit    &#x3D;&gt; p_commit,</span><br><span class="line">                                            x_msg_count &#x3D;&gt; x_msg_count,</span><br><span class="line">                                            x_msg_data  &#x3D;&gt; x_msg_data);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_error,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_unexp,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; cux_api.handle_exceptions(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                                                   p_api_name       &#x3D;&gt; l_api_name,</span><br><span class="line">                                                   p_savepoint_name &#x3D;&gt; l_savepoint_name,</span><br><span class="line">                                                   p_exc_name       &#x3D;&gt; cux_api.g_exc_name_others,</span><br><span class="line">                                                   x_msg_count      &#x3D;&gt; x_msg_count,</span><br><span class="line">                                                   x_msg_data       &#x3D;&gt; x_msg_data);</span><br><span class="line">  END process_request;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      main</span><br><span class="line">  Description:</span><br><span class="line">      主程序入口</span><br><span class="line">  History:</span><br><span class="line">      1.00  2020&#x2F;04&#x2F;28  LYH  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE main(errbuf OUT VARCHAR2, retcode OUT VARCHAR2) IS</span><br><span class="line">    l_return_status VARCHAR2(30);</span><br><span class="line">    l_msg_count     NUMBER;</span><br><span class="line">    l_msg_data      VARCHAR2(2000);</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">  </span><br><span class="line">    retcode :&#x3D; &#39;0&#39;;</span><br><span class="line">    -- concurrent header log</span><br><span class="line">    cux_conc_utl.log_header;</span><br><span class="line">  </span><br><span class="line">    process_request(p_init_msg_list &#x3D;&gt; fnd_api.g_true,</span><br><span class="line">                    p_commit        &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                    x_return_status &#x3D;&gt; l_return_status,</span><br><span class="line">                    x_msg_count     &#x3D;&gt; l_msg_count,</span><br><span class="line">                    x_msg_data      &#x3D;&gt; l_msg_data);</span><br><span class="line">    raise_exception(x_return_status &#x3D;&gt; l_return_status);</span><br><span class="line">  </span><br><span class="line">    -------------API body end</span><br><span class="line">  </span><br><span class="line">    -- conc end body</span><br><span class="line">    -- concurrent footer log</span><br><span class="line">    cux_conc_utl.log_footer;</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN fnd_api.g_exc_error THEN</span><br><span class="line">      cux_conc_utl.log_message_list;</span><br><span class="line">      retcode :&#x3D; &#39;1&#39;;</span><br><span class="line">      fnd_msg_pub.count_and_get(p_encoded &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                                p_count   &#x3D;&gt; l_msg_count,</span><br><span class="line">                                p_data    &#x3D;&gt; l_msg_data);</span><br><span class="line">      IF l_msg_count &gt; 1 THEN</span><br><span class="line">        l_msg_data :&#x3D; fnd_msg_pub.get_detail(p_msg_index &#x3D;&gt; fnd_msg_pub.g_first,</span><br><span class="line">                                             p_encoded   &#x3D;&gt; fnd_api.g_false);</span><br><span class="line">      END IF;</span><br><span class="line">      errbuf :&#x3D; l_msg_data;</span><br><span class="line">    WHEN fnd_api.g_exc_unexpected_error THEN</span><br><span class="line">      cux_conc_utl.log_message_list;</span><br><span class="line">      retcode :&#x3D; &#39;2&#39;;</span><br><span class="line">      fnd_msg_pub.count_and_get(p_encoded &#x3D;&gt; fnd_api.g_false,</span><br><span class="line">                                p_count   &#x3D;&gt; l_msg_count,</span><br><span class="line">                                p_data    &#x3D;&gt; l_msg_data);</span><br><span class="line">      IF l_msg_count &gt; 1 THEN</span><br><span class="line">        l_msg_data :&#x3D; fnd_msg_pub.get_detail(p_msg_index &#x3D;&gt; fnd_msg_pub.g_first,</span><br><span class="line">                                             p_encoded   &#x3D;&gt; fnd_api.g_false);</span><br><span class="line">      END IF;</span><br><span class="line">      errbuf :&#x3D; l_msg_data;</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      fnd_msg_pub.add_exc_msg(p_pkg_name       &#x3D;&gt; g_pkg_name,</span><br><span class="line">                              p_procedure_name &#x3D;&gt; &#39;MAIN&#39;,</span><br><span class="line">                              p_error_text     &#x3D;&gt; substrb(SQLERRM, 1, 240));</span><br><span class="line">      cux_conc_utl.log_message_list;</span><br><span class="line">      retcode :&#x3D; &#39;2&#39;;</span><br><span class="line">      errbuf  :&#x3D; SQLERRM;</span><br><span class="line">    </span><br><span class="line">  END main;</span><br><span class="line"></span><br><span class="line">END GJ_MES_ISSUE_PKG;</span><br></pre></td></tr></table></figure><h6 id="5-工具包"><a href="#5-工具包" class="headerlink" title="5.工具包"></a>5.工具包</h6><ol><li><p>工具包定义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE gj_bc_vld_data_utl IS</span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Copyright (C) Hand Enterprise Solutions Co.,Ltd.</span><br><span class="line">             AllRights Reserved</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Copyright (C) Hand Enterprise Solutions Co.,Ltd.</span><br><span class="line">             AllRights Reserved</span><br><span class="line">  Program Name:</span><br><span class="line">      GJ_BC_POINV_PKG</span><br><span class="line">  Description:</span><br><span class="line">      条码接口基础数据校验</span><br><span class="line">  History:</span><br><span class="line">      1.00  2017&#x2F;10&#x2F;9  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_po_organization</span><br><span class="line">  Description:</span><br><span class="line">    校验收货方</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id           库存组织ID</span><br><span class="line">    p_organization_code         库存组织代码</span><br><span class="line">    p_line_location_id          发运行ID</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;29  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_po_organization(p_organization_id   IN NUMBER,</span><br><span class="line">                                p_organization_code IN VARCHAR2,</span><br><span class="line">                                p_line_location_id  IN NUMBER,</span><br><span class="line">                                x_return_status     OUT VARCHAR2,</span><br><span class="line">                                x_msg_data          OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_po_item</span><br><span class="line">  Description:</span><br><span class="line">    验证PO是否存在该物料</span><br><span class="line">  Argument:</span><br><span class="line">  </span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;29  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_po_item(p_po_num          IN VARCHAR2,</span><br><span class="line">                        p_distribution_id IN NUMBER,</span><br><span class="line">                        p_item_id         IN NUMBER,</span><br><span class="line">                        p_item_num        IN VARCHAR2,</span><br><span class="line">                        x_msg_data        OUT VARCHAR2,</span><br><span class="line">                        x_return_status   OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_item_num</span><br><span class="line">  Description:</span><br><span class="line">    验证物料编码</span><br><span class="line">  Argument:</span><br><span class="line">  </span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_item_num(p_organization_id IN NUMBER,</span><br><span class="line">                         p_item_num        IN VARCHAR2,</span><br><span class="line">                         x_item_id         OUT NUMBER,</span><br><span class="line">                         x_return_status   OUT VARCHAR2,</span><br><span class="line">                         x_msg_data        OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_locator</span><br><span class="line">  Description:</span><br><span class="line">    验证货位</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id  库存组织</span><br><span class="line">    p_sub_code         子库</span><br><span class="line">    p_locator_code     货位</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_locator(p_organization_id IN NUMBER,</span><br><span class="line">                        p_sub_code        IN VARCHAR2,</span><br><span class="line">                        p_locator_code    IN VARCHAR2,</span><br><span class="line">                        x_locator_id      OUT NUMBER,</span><br><span class="line">                        x_return_status   OUT VARCHAR2,</span><br><span class="line">                        x_msg_data        OUT VARCHAR2);</span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_sub_code</span><br><span class="line">  Description:</span><br><span class="line">    验证子库</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id      库存组织ID</span><br><span class="line">    p_sub_code             子库</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_sub_code(p_organization_id IN NUMBER,</span><br><span class="line">                         p_sub_code        IN VARCHAR2,</span><br><span class="line">                         x_return_status   OUT VARCHAR2,</span><br><span class="line">                         x_msg_data        OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      vld_organization</span><br><span class="line">  Description:</span><br><span class="line">      验证库存组织</span><br><span class="line">  Argument:</span><br><span class="line">      p_organization_code 库存组织代码</span><br><span class="line">  History:</span><br><span class="line">      1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_organization(p_organization_code IN VARCHAR2,</span><br><span class="line">                             x_organization_id   OUT NUMBER,</span><br><span class="line">                             x_return_status     OUT NOCOPY VARCHAR2,</span><br><span class="line">                             x_msg_data          OUT NOCOPY VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_org</span><br><span class="line">  Description:</span><br><span class="line">    校验业务实体</span><br><span class="line">  Argument:</span><br><span class="line">    p_org_code     业务实体代码</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;29  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_org(p_org_code      IN VARCHAR2,</span><br><span class="line">                    x_org_id        OUT NUMBER,</span><br><span class="line">                    x_return_status OUT VARCHAR2,</span><br><span class="line">                    x_msg_data      OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_wip_entity_name</span><br><span class="line">  Description:</span><br><span class="line">    验证工单</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id                库存组织</span><br><span class="line">    p_wip_entity_name</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;1  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_wip_entity_name(p_organization_id   IN NUMBER,</span><br><span class="line">                                p_organization_code IN VARCHAR2,</span><br><span class="line">                                p_wip_entity_name   IN VARCHAR2,</span><br><span class="line">                                x_wip_entity_id     OUT NUMBER,</span><br><span class="line">                                x_return_status     OUT VARCHAR2,</span><br><span class="line">                                x_msg_data          OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    get_wip_entity_status</span><br><span class="line">  Description:</span><br><span class="line">    工单状态</span><br><span class="line">   Argument:</span><br><span class="line">   p_wip_entity_id                      工单id</span><br><span class="line">   p_wip_entity_name                    工单</span><br><span class="line">   p_organization_id                    库存组织ID</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;1  zhuolun.zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_wip_entity_status(p_wip_entity_id   IN NUMBER,</span><br><span class="line">                                  p_wip_entity_name IN VARCHAR2,</span><br><span class="line">                                  p_organization_id IN NUMBER,</span><br><span class="line">                                  x_return_status   OUT VARCHAR2,</span><br><span class="line">                                  x_msg_data        OUT VARCHAR2);</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_user_name</span><br><span class="line">  Description:</span><br><span class="line">    验证用户</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;1  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_user_name(p_user_name     IN VARCHAR2,</span><br><span class="line">                          x_user_id       OUT VARCHAR2,</span><br><span class="line">                          x_return_status OUT VARCHAR2,</span><br><span class="line">                          x_msg_data      OUT VARCHAR2);</span><br><span class="line">END gj_bc_vld_data_utl;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li>工具包体</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE BODY gj_bc_vld_data_utl IS</span><br><span class="line"></span><br><span class="line">  -- status</span><br><span class="line">  g_error CONSTANT VARCHAR2(10) :&#x3D; &#39;ERROR&#39;; -- 处理失败</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_po_organization</span><br><span class="line">  Description:</span><br><span class="line">    校验收货方</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id           库存组织ID</span><br><span class="line">    p_organization_code         库存组织代码</span><br><span class="line">    p_line_location_id          发运行ID</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;29  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_po_organization(p_organization_id   IN NUMBER,</span><br><span class="line">                                p_organization_code IN VARCHAR2,</span><br><span class="line">                                p_line_location_id  IN NUMBER,</span><br><span class="line">                                x_return_status     OUT VARCHAR2,</span><br><span class="line">                                x_msg_data          OUT VARCHAR2) IS</span><br><span class="line">    l_cnt NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT COUNT(1)</span><br><span class="line">      INTO l_cnt</span><br><span class="line">      FROM po_line_locations_all pll</span><br><span class="line">     WHERE pll.line_location_id &#x3D; p_line_location_id</span><br><span class="line">       AND pll.ship_to_organization_id &#x3D; p_organization_id;</span><br><span class="line">  </span><br><span class="line">    IF nvl(l_cnt, 0) &#x3D; 0 THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_PO_ORG_NOT_MATCH&#39;); --当前库存组织 &amp;ORGANIZATION_CODE 与采购订单收货组织不匹配</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ORGANIZATION_CODE&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_organization_code);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get;</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_PO_ORG_NOT_MATCH&#39;); --当前库存组织 &amp;ORGANIZATION_CODE 与采购订单收货组织不匹配</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ORGANIZATION_CODE&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_organization_code);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get;</span><br><span class="line">    </span><br><span class="line">  END vld_po_organization;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_po_item</span><br><span class="line">  Description:</span><br><span class="line">    验证PO是否存在该物料</span><br><span class="line">  Argument:</span><br><span class="line">  </span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;29  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_po_item(p_po_num          IN VARCHAR2,</span><br><span class="line">                        p_distribution_id IN NUMBER,</span><br><span class="line">                        p_item_id         IN NUMBER,</span><br><span class="line">                        p_item_num        IN VARCHAR2,</span><br><span class="line">                        x_msg_data        OUT VARCHAR2,</span><br><span class="line">                        x_return_status   OUT VARCHAR2) IS</span><br><span class="line">    l_cnt NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT COUNT(1)</span><br><span class="line">      INTO l_cnt</span><br><span class="line">      FROM po_headers_all        pha,</span><br><span class="line">           po_lines_all          pla,</span><br><span class="line">           po_line_locations_all pll,</span><br><span class="line">           po_distributions_all  pda</span><br><span class="line">     WHERE pha.po_header_id &#x3D; pla.po_header_id</span><br><span class="line">       AND pla.item_id &#x3D; p_item_id</span><br><span class="line">       AND pla.po_line_id &#x3D; pll.po_line_id</span><br><span class="line">       AND pll.line_location_id &#x3D; pda.line_location_id</span><br><span class="line">       AND pda.po_distribution_id &#x3D; p_distribution_id;</span><br><span class="line">  </span><br><span class="line">    IF nvl(l_cnt, 0) &#x3D; 0 THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_PO_ITEM_NOT_MATCH&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ITEM_NUM&#39;, VALUE &#x3D;&gt; p_item_num);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;PO_NUM&#39;, VALUE &#x3D;&gt; p_po_num);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; --物料 &amp;item_num 不存在于采购订单 &amp;PO_NUM中</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_PO_ITEM_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ITEM_NUM&#39;, VALUE &#x3D;&gt; p_item_num);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;PO_NUM&#39;, VALUE &#x3D;&gt; p_po_num);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; --物料 &amp;item_num 不存在于采购订单 &amp;PO_NUM中</span><br><span class="line">  END vld_po_item;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_item_num</span><br><span class="line">  Description:</span><br><span class="line">    验证物料编码</span><br><span class="line">  Argument:</span><br><span class="line">  </span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_item_num(p_organization_id IN NUMBER,</span><br><span class="line">                         p_item_num        IN VARCHAR2,</span><br><span class="line">                         x_item_id         OUT NUMBER,</span><br><span class="line">                         x_return_status   OUT VARCHAR2,</span><br><span class="line">                         x_msg_data        OUT VARCHAR2) IS</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT inventory_item_id</span><br><span class="line">      INTO x_item_id</span><br><span class="line">      FROM mtl_system_items_b msb</span><br><span class="line">     WHERE msb.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND msb.segment1 &#x3D; p_item_num;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_INV_ITEM_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ITEM_NUM&#39;, VALUE &#x3D;&gt; p_item_num);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; --物料 &amp;ITEM_NUM 在ERP系统中不存在</span><br><span class="line">  </span><br><span class="line">  END vld_item_num;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_locator</span><br><span class="line">  Description:</span><br><span class="line">    验证货位</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id  库存组织</span><br><span class="line">    p_sub_code         子库</span><br><span class="line">    p_locator_code     货位</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_locator(p_organization_id IN NUMBER,</span><br><span class="line">                        p_sub_code        IN VARCHAR2,</span><br><span class="line">                        p_locator_code    IN VARCHAR2,</span><br><span class="line">                        x_locator_id      OUT NUMBER,</span><br><span class="line">                        x_return_status   OUT VARCHAR2,</span><br><span class="line">                        x_msg_data        OUT VARCHAR2) IS</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT mil.inventory_location_id</span><br><span class="line">      INTO x_locator_id</span><br><span class="line">      FROM mtl_item_locations mil</span><br><span class="line">     WHERE mil.segment1 || &#39;.&#39; || mil.segment2 || &#39;.&#39; || mil.segment3 &#x3D;</span><br><span class="line">           p_locator_code</span><br><span class="line">       AND mil.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND mil.subinventory_code &#x3D; p_sub_code</span><br><span class="line">       AND SYSDATE &lt;&#x3D; nvl(mil.disable_date, SYSDATE);</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_INV_LOCA_NOT_FOUND&#39;);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; -- 该货位在ERP系统中不存在</span><br><span class="line">  </span><br><span class="line">  END vld_locator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_sub_code</span><br><span class="line">  Description:</span><br><span class="line">    验证子库</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id      库存组织ID</span><br><span class="line">    p_sub_code             子库</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_sub_code(p_organization_id IN NUMBER,</span><br><span class="line">                         p_sub_code        IN VARCHAR2,</span><br><span class="line">                         x_return_status   OUT VARCHAR2,</span><br><span class="line">                         x_msg_data        OUT VARCHAR2) IS</span><br><span class="line">    l_result NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT COUNT(1)</span><br><span class="line">      INTO l_result</span><br><span class="line">      FROM mtl_secondary_inventories msi</span><br><span class="line">     WHERE msi.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND msi.secondary_inventory_name &#x3D; p_sub_code;</span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_INV_SUCD_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;SUB_CODE&#39;, VALUE &#x3D;&gt; p_sub_code);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; -- 子库 &amp;SUB_CODE 在ERP系统中不存在</span><br><span class="line">  END vld_sub_code;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">      vld_organization</span><br><span class="line">  Description:</span><br><span class="line">      验证库存组织</span><br><span class="line">  Argument:</span><br><span class="line">      p_organization_code 库存组织代码</span><br><span class="line">  History:</span><br><span class="line">      1.00  2017&#x2F;10&#x2F;10  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_organization(p_organization_code IN VARCHAR2,</span><br><span class="line">                             x_organization_id   OUT NUMBER,</span><br><span class="line">                             x_return_status     OUT NOCOPY VARCHAR2,</span><br><span class="line">                             x_msg_data          OUT NOCOPY VARCHAR2) IS</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    -- API body</span><br><span class="line">    SELECT ood.organization_id</span><br><span class="line">      INTO x_organization_id</span><br><span class="line">      FROM org_organization_definitions ood</span><br><span class="line">     WHERE ood.organization_code &#x3D; p_organization_code;</span><br><span class="line">  </span><br><span class="line">    -- API end body</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_INV_ORG_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ORG_CODE&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_organization_code);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; -- 库存组织 &amp;ORG_CODE 在ERP系统中不存在</span><br><span class="line">  </span><br><span class="line">  END vld_organization;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_org</span><br><span class="line">  Description:</span><br><span class="line">    校验业务实体</span><br><span class="line">  Argument:</span><br><span class="line">    p_org_code     业务实体代码</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;10&#x2F;29  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_org(p_org_code      IN VARCHAR2,</span><br><span class="line">                    x_org_id        OUT NUMBER,</span><br><span class="line">                    x_return_status OUT VARCHAR2,</span><br><span class="line">                    x_msg_data      OUT VARCHAR2) IS</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT hou.organization_id</span><br><span class="line">      INTO x_org_id</span><br><span class="line">      FROM hr_operating_units hou</span><br><span class="line">     WHERE hou.short_code &#x3D; p_org_code;</span><br><span class="line">    IF nvl(x_org_id, 0) &#x3D; 0 THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_INV_OU_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ORG_CODE&#39;, VALUE &#x3D;&gt; p_org_code);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; -- 业务实体 &amp;ORG_CODE 在ERP系统中不存在</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(application &#x3D;&gt; &#39;GJ&#39;,</span><br><span class="line">                           NAME        &#x3D;&gt; &#39;GJ_INV_OU_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ORG_CODE&#39;, VALUE &#x3D;&gt; p_org_code);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get; -- 业务实体 &amp;ORG_CODE 在ERP系统中不存在</span><br><span class="line">  </span><br><span class="line">  END vld_org;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_wip_entity_name</span><br><span class="line">  Description:</span><br><span class="line">    验证工单</span><br><span class="line">  Argument:</span><br><span class="line">    p_organization_id                库存组织</span><br><span class="line">    p_wip_entity_name</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;1  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_wip_entity_name(p_organization_id   IN NUMBER,</span><br><span class="line">                                p_organization_code IN VARCHAR2,</span><br><span class="line">                                p_wip_entity_name   IN VARCHAR2,</span><br><span class="line">                                x_wip_entity_id     OUT NUMBER,</span><br><span class="line">                                x_return_status     OUT VARCHAR2,</span><br><span class="line">                                x_msg_data          OUT VARCHAR2) IS</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT we.wip_entity_id</span><br><span class="line">      INTO x_wip_entity_id</span><br><span class="line">      FROM wip_entities we</span><br><span class="line">     WHERE we.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND we.wip_entity_name &#x3D; p_wip_entity_name;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_WIP_ENTITY_NOT_FOUND&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;WIP_NAME&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_wip_entity_name);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;ORG_NAME&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_organization_code);</span><br><span class="line">    </span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get;</span><br><span class="line">    </span><br><span class="line">  END vld_wip_entity_name;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    get_wip_entity_status</span><br><span class="line">  Description:</span><br><span class="line">    工单状态</span><br><span class="line">   Argument:</span><br><span class="line">   p_wip_entity_id                      工单id</span><br><span class="line">   p_wip_entity_name                    工单</span><br><span class="line">   p_organization_id                    库存组织ID</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;1  zhuolun.zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_wip_entity_status(p_wip_entity_id   IN NUMBER,</span><br><span class="line">                                  p_wip_entity_name IN VARCHAR2,</span><br><span class="line">                                  p_organization_id IN NUMBER,</span><br><span class="line">                                  x_return_status   OUT VARCHAR2,</span><br><span class="line">                                  x_msg_data        OUT VARCHAR2) IS</span><br><span class="line">    l_cntt NUMBER;</span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT COUNT(1)</span><br><span class="line">      INTO l_cntt</span><br><span class="line">      FROM wip_discrete_jobs wdj</span><br><span class="line">     WHERE wdj.wip_entity_id &#x3D; p_wip_entity_id</span><br><span class="line">       AND wdj.organization_id &#x3D; p_organization_id</span><br><span class="line">       AND wdj.status_type IN (&#39;3&#39;, &#39;4&#39;); --3 Released 4 Complete</span><br><span class="line">  </span><br><span class="line">    IF nvl(l_cntt, 0) &#x3D; 0 THEN</span><br><span class="line">      fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_BC_UNVAL_WIPSTATUS&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;WIP_ENTITY_NAME&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_wip_entity_name);</span><br><span class="line">      x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">    END IF;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_BC_UNVAL_WIPSTATUS&#39;);</span><br><span class="line">      fnd_message.set_token(token &#x3D;&gt; &#39;WIP_ENTITY_NAME&#39;,</span><br><span class="line">                            VALUE &#x3D;&gt; p_wip_entity_name);</span><br><span class="line">      x_msg_data      :&#x3D; fnd_message.get;</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">  END vld_wip_entity_status;</span><br><span class="line"></span><br><span class="line">  &#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  Program Name:</span><br><span class="line">    vld_user_name</span><br><span class="line">  Description:</span><br><span class="line">    验证用户</span><br><span class="line">  History:</span><br><span class="line">    1.00  2017&#x2F;11&#x2F;1  ZhuoLun.Zhong  Creation</span><br><span class="line">  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;</span><br><span class="line">  PROCEDURE vld_user_name(p_user_name     IN VARCHAR2,</span><br><span class="line">                          x_user_id       OUT VARCHAR2,</span><br><span class="line">                          x_return_status OUT VARCHAR2,</span><br><span class="line">                          x_msg_data      OUT VARCHAR2) IS</span><br><span class="line">  </span><br><span class="line">  BEGIN</span><br><span class="line">    SELECT fu.user_id</span><br><span class="line">      INTO x_user_id</span><br><span class="line">      FROM fnd_user fu</span><br><span class="line">     WHERE fu.user_name &#x3D; p_user_name;</span><br><span class="line">  </span><br><span class="line">  EXCEPTION</span><br><span class="line">    WHEN OTHERS THEN</span><br><span class="line">      x_return_status :&#x3D; g_error;</span><br><span class="line">      fnd_message.set_name(&#39;GJ&#39;, &#39;GJ_BC_USER_NOT_FOUND&#39;);</span><br><span class="line">      x_msg_data :&#x3D; fnd_message.get;</span><br><span class="line">    </span><br><span class="line">  END vld_user_name;</span><br><span class="line"></span><br><span class="line">END gj_bc_vld_data_utl;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ORACLE EBS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ORACLE EBS API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>青年的力量</title>
      <link href="/2020/05/10/%E9%9D%92%E5%B9%B4%E7%9A%84%E5%8A%9B%E9%87%8F/"/>
      <url>/2020/05/10/%E9%9D%92%E5%B9%B4%E7%9A%84%E5%8A%9B%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<p>青年的力量就是知识，是对知识具有虔诚笃定的向往，是对未来抱有无与伦比的热情，对世界还有客观理性的认知。</p><p>青年的力量在于勇敢，他对于未知和未来是勇敢的而不是怯懦的。</p><p>青年的力量就是在自己既定的岗位演好自己的剧本，用世界性的眼光摆脱傲慢与自怜，诚实的对待自己的职业，日拱一卒，勉励而行。</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
