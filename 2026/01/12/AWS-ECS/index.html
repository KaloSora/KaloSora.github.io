<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="AWS,Docker," />





  <link rel="alternate" href="/atom.xml" title="KaloSora的博客" type="application/atom+xml" />






<meta name="description" content="AWS ECRGithub repository Github repository Amazon Elastic Container Registry (Amazon ECR) is an AWS managed container image registry service that is secure, scalable, and reliable. Amazon ECR supports">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS ECR &amp; ECS">
<meta property="og:url" content="https://kalosora.github.io/2026/01/12/AWS-ECS/index.html">
<meta property="og:site_name" content="KaloSora的博客">
<meta property="og:description" content="AWS ECRGithub repository Github repository Amazon Elastic Container Registry (Amazon ECR) is an AWS managed container image registry service that is secure, scalable, and reliable. Amazon ECR supports">
<meta property="og:locale">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230095444-818u91z.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230102004-k2jbh7q.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230104515-o5qxz7o.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230112557-o7sisnc.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230114603-bm8npc9.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230151741-fcmc9ri.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20260112084803-i22s4bl.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20260105210222-sabxe1f.png">
<meta property="og:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20260105213352-7yo21e4.png">
<meta property="article:published_time" content="2026-01-12T00:51:09.000Z">
<meta property="article:modified_time" content="2026-01-18T08:54:45.930Z">
<meta property="article:author" content="KaloSora">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kalosora.github.io/2026/01/12/AWS-ECS/image-20251230095444-818u91z.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://kalosora.github.io/2026/01/12/AWS-ECS/"/>





  <title>AWS ECR & ECS | KaloSora的博客</title>
  








<meta name="generator" content="Hexo 7.1.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">KaloSora的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">登峰造极境</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kalosora.github.io/2026/01/12/AWS-ECS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KaloSora的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">AWS ECR & ECS</h1>
        

        <div class="post-meta">
          <span class="post-time">

          

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2026-01-12T08:51:09+08:00">
                2026-01-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cloud-Native/" itemprop="url" rel="index">
                    <span itemprop="name">Cloud Native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  955 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="AWS-ECR"><a href="#AWS-ECR" class="headerlink" title="AWS ECR"></a>AWS ECR</h2><p>Github repository <a target="_blank" rel="noopener" href="https://github.com/KaloSora/AWS-ECS">Github repository</a></p>
<p>Amazon Elastic Container Registry (Amazon ECR) is an AWS managed container image registry service that is secure, scalable, and reliable. Amazon ECR supports private repositories with resource-based permissions using AWS IAM. This is so that specified users or Amazon EC2 instances can access your container repositories and images.<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html">AWS ECR</a></p>
<p>Run below command to create AWS ECR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply -target=module.ecr -var-file=<span class="string">&quot;aws-ecs.tfvars&quot;</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<p>The terraform will create 2 ECR repository, attach access rule and lifecycle policy.</p>
<p><img src="/2026/01/12/AWS-ECS/image-20251230095444-818u91z.png" alt="image"></p>
<p>Both repository are using below lifecycle policy</p>
<ul>
<li>Remove all untagged images after 7 days</li>
<li>Remove all images after 30 days since the ECR only for testing purpose.</li>
</ul>
<p><img src="/2026/01/12/AWS-ECS/image-20251230102004-k2jbh7q.png" alt="image"></p>
<p>Both repository will enable docker image scan after it’s been published to ECR.</p>
<p>*Remember to Enable AWS Inspector V2 from console before enhanced scanning, ECR enhanced scanning will use AWS inspector to scan images. For AWS free plan not allow to use the service, thus discard the code as below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ECR image scan</span></span><br><span class="line"><span class="comment"># Remember to Enable AWS Inspector V2 from console before enhanced scanning</span></span><br><span class="line">resource <span class="string">&quot;aws_ecr_registry_scanning_configuration&quot;</span> <span class="string">&quot;ecr_enhanced_scanning&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">  scan_type = <span class="string">&quot;ENHANCED&quot;</span></span><br><span class="line"></span><br><span class="line">  rule &#123;</span><br><span class="line">    scan_frequency = <span class="string">&quot;CONTINUOUS_SCAN&quot;</span></span><br><span class="line">    repository_filter &#123;</span><br><span class="line">      filter      = <span class="string">&quot;*&quot;</span> <span class="comment"># For all repositories</span></span><br><span class="line">      filter_type = <span class="string">&quot;WILDCARD&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h3 id="Push-to-ECR"><a href="#Push-to-ECR" class="headerlink" title="Push to ECR"></a>Push to ECR</h3><p>Run step3 to build docker image first if you don’t have.</p>
<p>In this example, I will push nginx to ECR.</p>
<p><img src="/2026/01/12/AWS-ECS/image-20251230104515-o5qxz7o.png" alt="image"></p>
<p>Use below script to login ECR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">AWS_ACCOUNT_ID=<span class="string">&quot;795359014551&quot;</span></span><br><span class="line">REGION=<span class="string">&quot;ap-northeast-1&quot;</span></span><br><span class="line">REPO_NAME=<span class="string">&quot;my-app-test&quot;</span></span><br><span class="line">IMAGE_NAME=<span class="string">&quot;ecr-nginx&quot;</span></span><br><span class="line">IMAGE_TAG=<span class="string">&quot;latest&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Login to ECR</span></span><br><span class="line">aws ecr get-login-password --region <span class="variable">$REGION</span> | \</span><br><span class="line">docker login --username AWS --password-stdin \</span><br><span class="line"><span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tag local image</span></span><br><span class="line">docker tag <span class="variable">$IMAGE_NAME</span>:<span class="variable">$IMAGE_TAG</span> \</span><br><span class="line"><span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com/<span class="variable">$REPO_NAME</span>:<span class="variable">$IMAGE_NAME</span>-<span class="variable">$IMAGE_TAG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Push to ECR</span></span><br><span class="line">docker push \</span><br><span class="line"><span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com/<span class="variable">$REPO_NAME</span>:<span class="variable">$IMAGE_NAME</span>-<span class="variable">$IMAGE_TAG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Health check</span></span><br><span class="line">aws ecr describe-images \</span><br><span class="line">    --repository-name <span class="variable">$REPO_NAME</span> \</span><br><span class="line">    --region <span class="variable">$REGION</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<p>Push result as below</p>
<p><img src="/2026/01/12/AWS-ECS/image-20251230112557-o7sisnc.png" alt="image"></p>
<p>Login AWS Console to check image in ECR</p>
<p><img src="/2026/01/12/AWS-ECS/image-20251230114603-bm8npc9.png" alt="image"></p>
<p>‍</p>
<p><strong>Promote image to another repository</strong></p>
<p>Promote image from <code>my-app-test</code> to <code>my-app-prod</code>​</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AWS_ACCOUNT_ID=<span class="string">&quot;795359014551&quot;</span></span><br><span class="line">REGION=<span class="string">&quot;ap-northeast-1&quot;</span></span><br><span class="line">SOURCE_REPO_NAME=<span class="string">&quot;my-app-test&quot;</span></span><br><span class="line">TARGET_REPO_NAME=<span class="string">&quot;my-app-prod&quot;</span></span><br><span class="line">IMAGE_NAME=<span class="string">&quot;ecr-nginx&quot;</span></span><br><span class="line">IMAGE_TAG=<span class="string">&quot;latest&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get from ECR, can use describe api</span></span><br><span class="line">IMAGE_DIGEST=<span class="string">&quot;sha256:2b8abdef88bc14753679af02869bebd507ad15705da02e6992af06078c47291b&quot;</span></span><br><span class="line"></span><br><span class="line">TARGET_TAG=<span class="string">&quot;<span class="variable">$&#123;IMAGE_NAME:-<span class="variable">$IMAGE_TAG</span>&#125;</span>&quot;</span></span><br><span class="line">TARGET_IMAGE_URI=<span class="string">&quot;<span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com/<span class="variable">$TARGET_REPO_NAME</span>:<span class="variable">$TARGET_TAG</span>&quot;</span></span><br><span class="line"></span><br><span class="line">docker tag <span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com/<span class="variable">$SOURCE_REPO_NAME</span>@<span class="variable">$IMAGE_DIGEST</span> <span class="variable">$TARGET_IMAGE_URI</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<h3 id="Best-Practise"><a href="#Best-Practise" class="headerlink" title="Best Practise"></a>Best Practise</h3><p>1.We should create repository for each application for better management and control.</p>
<p>For example</p>
<p>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;user-service:latest<br>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;order-service:latest<br>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;payment-service:latest<br>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;api-gateway:latest<br>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;nginx:latest</p>
<p>In CI&#x2F;CD, we need to check whether repository exists or not. If not then need to create a new 1 before we push the images.</p>
<p>‍</p>
<p>2.We should seprate the image for difference environment.</p>
<p>For example</p>
<p>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;user-service-dev:latest</p>
<p>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;user-service-uat:latest</p>
<p>123456789012.dkr.ecr.us-east-1.amazonaws.com&#x2F;user-service-prod:latest</p>
<p>‍</p>
<h3 id="Pull-from-ECR"><a href="#Pull-from-ECR" class="headerlink" title="Pull from ECR"></a>Pull from ECR</h3><p>Run below command to pull image from ECR.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AWS_ACCOUNT_ID=<span class="string">&quot;795359014551&quot;</span></span><br><span class="line">REGION=<span class="string">&quot;ap-northeast-1&quot;</span></span><br><span class="line">REPO_NAME=<span class="string">&quot;my-app-test&quot;</span></span><br><span class="line">IMAGE_NAME=<span class="string">&quot;ecr-nginx&quot;</span></span><br><span class="line">IMAGE_TAG=<span class="string">&quot;latest&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Login</span></span><br><span class="line">aws ecr get-login-password --region <span class="variable">$REGION</span> | \</span><br><span class="line">docker login --username AWS --password-stdin \</span><br><span class="line"><span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pull the image</span></span><br><span class="line">docker pull <span class="variable">$AWS_ACCOUNT_ID</span>.dkr.ecr.<span class="variable">$REGION</span>.amazonaws.com/<span class="variable">$REPO_NAME</span>:<span class="variable">$IMAGE_NAME</span>-<span class="variable">$IMAGE_TAG</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<p>Result as below</p>
<p><img src="/2026/01/12/AWS-ECS/image-20251230151741-fcmc9ri.png" alt="image"></p>
<p>‍</p>
<h2 id="ECS"><a href="#ECS" class="headerlink" title="ECS"></a>ECS</h2><p>Amazon Elastic Container Service (Amazon ECS) is a fully managed container orchestration service that helps you easily deploy, manage, and scale containerized applications. As a fully managed service, Amazon ECS comes with AWS configuration and operational best practices built-in. It’s integrated with both AWS tools, such as Amazon Elastic Container Registry (ECR), and third-party tools, such as Docker. <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html">AWS ECS</a></p>
<p>‍</p>
<p>ECS provide 2 type of capacity:</p>
<ul>
<li>Fargate - Serviceless compute engine managed by AWS, developer no need to care about the server detail like CPU and memory but higher cost.</li>
<li>EC2 - Developer need to create EC2 and managed instance on their own with lower cost.</li>
</ul>
<p>‍</p>
<h3 id="Fargate"><a href="#Fargate" class="headerlink" title="Fargate"></a>Fargate</h3><p><img src="/2026/01/12/AWS-ECS/image-20260112084803-i22s4bl.png" alt="image"></p>
<p>In this example, terraform module will create:</p>
<ul>
<li>Route53</li>
<li>VPC endpoint to access ECR</li>
<li>AWS Application Load Balancer</li>
<li>ECS service with fargate type</li>
<li>CloudWatch log group</li>
</ul>
<p>‍</p>
<p>Run step 5 command as below</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply -target=module.ecs_fargate -var-file=<span class="string">&quot;aws-ecs.tfvars&quot;</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<p>To stop ECS task, can execute below command</p>
<p>*After the task stop, it will auto start up a new task.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws ecs stop-task \</span><br><span class="line">  --cluster &lt;your_cluster&gt; \</span><br><span class="line">  --task &lt;your_task_id&gt;</span><br></pre></td></tr></table></figure>

<p>‍</p>
<p>If we need to stop all task without auto startup, then we will need the whole ECS service get stopped.</p>
<p>Change the expected task count to be 0.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">aws ecs update-service \</span><br><span class="line">    --cluster your-cluster-name \</span><br><span class="line">    --service your-service-name \</span><br><span class="line">    --desired-count 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># For example</span></span><br><span class="line">aws ecs update-service \</span><br><span class="line">    --cluster my-ecs-cluster \</span><br><span class="line">    --service my-app-service \</span><br><span class="line">    --desired-count 0</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h2 id="TroubleShoot"><a href="#TroubleShoot" class="headerlink" title="TroubleShoot"></a>TroubleShoot</h2><p><strong>Fail to pull image from ECR</strong></p>
<p>ResourceInitializationError: unable to pull secrets or registry auth: The task cannot pull registry auth from Amazon ECR: There is a connection issue between the task and Amazon ECR.</p>
<p><img src="/2026/01/12/AWS-ECS/image-20260105210222-sabxe1f.png" alt="image"></p>
<p>‍</p>
<p>Solution:</p>
<p>Execute AWS document to idenfity the root cause.</p>
<p><img src="/2026/01/12/AWS-ECS/image-20260105213352-7yo21e4.png" alt="image"></p>
<p>‍</p>
<p>Reference <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/verify-connectivity.html">Verify AWS ECS task connectivity</a></p>
<p>‍</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/AWS/" rel="tag"># AWS</a>
          
            <a href="/tags/Docker/" rel="tag"># Docker</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2025/12/28/Deep-dive-into-Docker/" rel="next" title="Deep dive into Docker">
                <i class="fa fa-chevron-left"></i> Deep dive into Docker
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2026/01/19/K3S-deployment/" rel="prev" title="K3s deployment">
                K3s deployment <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/yi-hui-li-8591ab383" target="_blank" title="Linkedin">
                      
                        <i class="fa fa-fw fa-linkedin"></i>Linkedin</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:kalosora@outlook.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#AWS-ECR"><span class="nav-number">1.</span> <span class="nav-text">AWS ECR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Push-to-ECR"><span class="nav-number">1.1.</span> <span class="nav-text">Push to ECR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Best-Practise"><span class="nav-number">1.2.</span> <span class="nav-text">Best Practise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pull-from-ECR"><span class="nav-number">1.3.</span> <span class="nav-text">Pull from ECR</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ECS"><span class="nav-number">2.</span> <span class="nav-text">ECS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Fargate"><span class="nav-number">2.1.</span> <span class="nav-text">Fargate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TroubleShoot"><span class="nav-number">3.</span> <span class="nav-text">TroubleShoot</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">KaloSora</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">84.2k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "./public/search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":100,"vOffset":-50},"mobile":{"show":true,"scale":0.5}});</script></body>
</html>
